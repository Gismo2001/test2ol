function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var Yb=Object.defineProperty;var Kb=(n,t,e)=>t in n?Yb(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var sy=(n,t,e)=>(Kb(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();const Ki={ADD:"add",REMOVE:"remove"},Ph={PROPERTYCHANGE:"propertychange"},ie={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Su{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Zb(n,t,e){let i,r;e=e||Ds;let s=0,a=n.length,o=!1;for(;s<a;)i=s+(a-s>>1),r=+e(n[i],t),r<0?s=i+1:(a=i,o=!r);return o?s:~s}function Ds(n,t){return n>t?1:n<t?-1:0}function Jb(n,t){return n<t?1:n>t?-1:0}function qp(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if(typeof e=="function"){for(let r=1;r<i;++r){const s=n[r];if(s===t)return r;if(s<t)return e(t,n[r-1],s)>0?r-1:r}return i-1}if(e>0){for(let r=1;r<i;++r)if(n[r]<t)return r-1;return i-1}if(e<0){for(let r=1;r<i;++r)if(n[r]<=t)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==t)return r;if(n[r]<t)return n[r-1]-t<t-n[r]?r-1:r}return i-1}function Qb(n,t,e){for(;t<e;){const i=n[t];n[t]=n[e],n[e]=i,++t,--e}}function ze(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let r=0;r<i;r++)n[n.length]=e[r]}function Hs(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function tE(n,t,e){const i=t||Ds;return n.every(function(r,s){if(s===0)return!0;const a=i(n[s-1],r);return!(a>0||e&&a===0)})}function Sa(){return!0}function zh(){return!1}function ru(){}function Rv(n){let t,e,i;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==i||!Hs(r,e))&&(i=this,e=r,t=n.apply(this,arguments)),t}}function eE(n){function t(){let e;try{e=n()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function rl(n){for(const t in n)delete n[t]}function Xo(n){let t;for(t in n)return!1;return!t}class Cr{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class og extends Su{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),r=i[t]||(i[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=e?new Cr(t):t;s.target||(s.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});i in a||(a[i]=0,o[i]=0),++a[i];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--a[i]===0){let h=o[i];for(delete o[i];h--;)this.removeEventListener(i,ru);delete a[i]}return l}disposeInternal(){this.listeners_&&rl(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const r=i.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[r]=ru,++this.pendingRemovals_[t]):(i.splice(r,1),i.length===0&&delete this.listeners_[t]))}}function ve(n,t,e,i,r){if(r){const a=e;e=function(o){return n.removeEventListener(t,e),a.call(i??this,o)}}else i&&i!==n&&(e=e.bind(i));const s={target:n,type:t,listener:e};return n.addEventListener(t,e),s}function Ed(n,t,e,i){return ve(n,t,e,i,!0)}function ai(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),rl(n))}class Lu extends og{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ie.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=ve(this,t[s],e);return r}return ve(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const r=t.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=Ed(this,t[s],e)}else i=Ed(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)Lr(i);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}Lu.prototype.on;Lu.prototype.once;Lu.prototype.un;function Lr(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)ai(n[t]);else ai(n)}function he(){throw new Error("Unimplemented abstract method.")}let iE=0;function Ht(n){return n.ol_uid||(n.ol_uid=String(++iE))}class ay extends Cr{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Ar extends Lu{constructor(t){super(),this.on,this.once,this.un,Ht(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new ay(i,t,e)),i=Ph.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new ay(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const r=this.values_||(this.values_={});if(i)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Xo(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const oy={LENGTH:"length"};class Rf extends Cr{constructor(t,e,i){super(t),this.element=e,this.index=i}}class On extends Ar{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(oy.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Rf(Ki.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Rf(Ki.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Rf(Ki.REMOVE,r,t)),this.dispatchEvent(new Rf(Ki.ADD,e,t))}updateLength_(){this.set(oy.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}}class Ql extends Cr{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class Ms extends Ql{constructor(t,e,i,r,s,a){super(t,e,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Ie={SINGLECLICK:"singleclick",CLICK:ie.CLICK,DBLCLICK:ie.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Yo=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",nE=Yo.includes("safari")&&!Yo.includes("chrom"),rE=nE&&(Yo.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Yo)),sE=Yo.includes("webkit")&&!Yo.includes("edge"),Iv=Yo.includes("macintosh"),aE=typeof devicePixelRatio<"u"?devicePixelRatio:1,Nv=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Fv=typeof Image<"u"&&Image.prototype.decode,kv=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}(),su={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class oE extends og{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=ve(i,su.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ve(i,su.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ie.TOUCHMOVE,this.boundHandleTouchMove_,kv?{passive:!1}:!1)}emulateClick_(t){let e=new Ms(Ie.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Ms(Ie.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new Ms(Ie.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==Ie.POINTERUP||e.type==Ie.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==Ie.POINTERDOWN||e.type==Ie.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Ms(Ie.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(ai),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Ms(Ie.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ve(i,Ie.POINTERMOVE,this.handlePointerMove_,this),ve(i,Ie.POINTERUP,this.handlePointerUp_,this),ve(this.element_,Ie.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(ve(this.element_.getRootNode(),Ie.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Ms(Ie.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Ms(Ie.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(ai(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ie.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ai(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ai),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ga={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},fn={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Qt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Be(n,t){if(!n)throw new Error(t)}const Sd=1/0;class lE{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,rl(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(t){Be(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Sd?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,r=e.length,s=e[t],a=i[t],o=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<r&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=s,i[t]=a,this.siftDown_(o,t)}siftDown_(t,e){const i=this.elements_,r=this.priorities_,s=i[e],a=r[e];for(;e>t;){const o=this.getParentIndex_(e);if(r[o]>a)i[e]=i[o],r[e]=r[o],e=o;else break}i[e]=s,r[e]=a}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let r=0;const s=e.length;let a,o,l;for(o=0;o<s;++o)a=e[o],l=t(a),l==Sd?delete this.queuedElements_[this.keyFunction_(a)]:(i[r]=l,e[r++]=a);e.length=r,i.length=r,this.heapify_()}}class hE extends lE{constructor(t,e){super(i=>t.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(ie.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===Qt.LOADED||i===Qt.ERROR||i===Qt.EMPTY){i!==Qt.ERROR&&e.removeEventListener(ie.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;){const r=this.dequeue()[0],s=r.getKey();r.getState()===Qt.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++i,r.load())}}}function cE(n,t,e,i,r){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return Sd;const s=n.viewState.center,a=i[0]-s[0],o=i[1]-s[1];return 65536*Math.log(r)+Math.sqrt(a*a+o*o)/r}const vi={ANIMATING:0,INTERACTING:1},os={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function pi(n,t,e){return Math.min(Math.max(n,t),e)}function uE(n,t,e,i,r,s){const a=r-e,o=s-i;if(a!==0||o!==0){const l=((n-e)*a+(t-i)*o)/(a*a+o*o);l>1?(e=r,i=s):l>0&&(e+=a*l,i+=o*l)}return va(n,t,e,i)}function va(n,t,e,i){const r=e-n,s=i-t;return r*r+s*s}function fE(n){const t=n.length;for(let i=0;i<t;i++){let r=i,s=Math.abs(n[i][i]);for(let o=i+1;o<t;o++){const l=Math.abs(n[o][i]);l>s&&(s=l,r=o)}if(s===0)return null;const a=n[r];n[r]=n[i],n[i]=a;for(let o=i+1;o<t;o++){const l=-n[o][i]/n[i][i];for(let h=i;h<t+1;h++)i==h?n[o][h]=0:n[o][h]+=l*n[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let r=i-1;r>=0;r--)n[r][t]-=n[r][i]*e[i]}return e}function Ld(n){return n*180/Math.PI}function ur(n){return n*Math.PI/180}function uo(n,t){const e=n%t;return e*t<0?e+t:e}function br(n,t,e){return n+e*(t-n)}function qh(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function ly(n,t){return Math.round(qh(n,t))}function If(n,t){return Math.floor(qh(n,t))}function Nf(n,t){return Math.ceil(qh(n,t))}function zm(n,t,e){if(n>=t&&n<e)return n;const i=e-t;return((n-t)%i+i)%i+t}function hy(n,t,e){return function(i,r,s,a,o){if(!i)return;if(!r&&!t)return i;const l=t?0:s[0]*r,h=t?0:s[1]*r,c=o?o[0]:0,u=o?o[1]:0;let d=n[0]+l/2+c,g=n[2]-l/2+c,p=n[1]+h/2+u,y=n[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),p>y&&(p=(y+p)/2,y=p);let w=pi(i[0],d,g),x=pi(i[1],p,y);if(a&&e&&r){const b=30*r;w+=-b*Math.log(1+Math.max(0,d-i[0])/b)+b*Math.log(1+Math.max(0,i[0]-g)/b),x+=-b*Math.log(1+Math.max(0,p-i[1])/b)+b*Math.log(1+Math.max(0,i[1]-y)/b)}return[w,x]}}function dE(n){return n}const gn={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function bn(n){const t=Bn();for(let e=0,i=n.length;e<i;++e)Wc(t,n[e]);return t}function gE(n,t,e){const i=Math.min.apply(null,n),r=Math.min.apply(null,t),s=Math.max.apply(null,n),a=Math.max.apply(null,t);return zs(i,r,s,a,e)}function Vr(n,t,e){return e?(e[0]=n[0]-t,e[1]=n[1]-t,e[2]=n[2]+t,e[3]=n[3]+t,e):[n[0]-t,n[1]-t,n[2]+t,n[3]+t]}function Ov(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n.slice()}function sl(n,t,e){let i,r;return t<n[0]?i=n[0]-t:n[2]<t?i=t-n[2]:i=0,e<n[1]?r=n[1]-e:n[3]<e?r=e-n[3]:r=0,i*i+r*r}function mo(n,t){return Vp(n,t[0],t[1])}function so(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function Vp(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function qm(n,t){const e=n[0],i=n[1],r=n[2],s=n[3],a=t[0],o=t[1];let l=gn.UNKNOWN;return a<e?l=l|gn.LEFT:a>r&&(l=l|gn.RIGHT),o<i?l=l|gn.BELOW:o>s&&(l=l|gn.ABOVE),l===gn.UNKNOWN&&(l=gn.INTERSECTING),l}function Bn(){return[1/0,1/0,-1/0,-1/0]}function zs(n,t,e,i,r){return r?(r[0]=n,r[1]=t,r[2]=e,r[3]=i,r):[n,t,e,i]}function Vh(n){return zs(1/0,1/0,-1/0,-1/0,n)}function qc(n,t){const e=n[0],i=n[1];return zs(e,i,e,i,t)}function Wp(n,t,e,i,r){const s=Vh(r);return Dv(s,n,t,e,i)}function Ko(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function Vc(n,t){return t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3]),n}function Wc(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function Dv(n,t,e,i,r){for(;e<i;e+=r)mE(n,t[e],t[e+1]);return n}function mE(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function Hp(n,t){let e;return e=t(lg(n)),e||(e=t(hg(n)),e)||(e=t(cg(n)),e)||(e=t(xo(n)),e)?e:!1}function Vm(n){let t=0;return Wh(n)||(t=ke(n)*_n(n)),t}function lg(n){return[n[0],n[1]]}function hg(n){return[n[2],n[1]]}function qs(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function pE(n,t){let e;if(t==="bottom-left")e=lg(n);else if(t==="bottom-right")e=hg(n);else if(t==="top-left")e=xo(n);else if(t==="top-right")e=cg(n);else throw new Error("Invalid corner");return e}function Wm(n,t,e,i,r){const[s,a,o,l,h,c,u,d]=Bv(n,t,e,i);return zs(Math.min(s,o,h,u),Math.min(a,l,c,d),Math.max(s,o,h,u),Math.max(a,l,c,d),r)}function Bv(n,t,e,i){const r=t*i[0]/2,s=t*i[1]/2,a=Math.cos(e),o=Math.sin(e),l=r*a,h=r*o,c=s*a,u=s*o,d=n[0],g=n[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function _n(n){return n[3]-n[1]}function wa(n,t,e){const i=e||Bn();return ki(n,t)?(n[0]>t[0]?i[0]=n[0]:i[0]=t[0],n[1]>t[1]?i[1]=n[1]:i[1]=t[1],n[2]<t[2]?i[2]=n[2]:i[2]=t[2],n[3]<t[3]?i[3]=n[3]:i[3]=t[3]):Vh(i),i}function xo(n){return[n[0],n[3]]}function cg(n){return[n[2],n[3]]}function ke(n){return n[2]-n[0]}function ki(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function Wh(n){return n[2]<n[0]||n[3]<n[1]}function _E(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}function yE(n,t,e){let i=!1;const r=qm(n,t),s=qm(n,e);if(r===gn.INTERSECTING||s===gn.INTERSECTING)i=!0;else{const a=n[0],o=n[1],l=n[2],h=n[3],c=t[0],u=t[1],d=e[0],g=e[1],p=(g-u)/(d-c);let y,w;s&gn.ABOVE&&!(r&gn.ABOVE)&&(y=d-(g-h)/p,i=y>=a&&y<=l),!i&&s&gn.RIGHT&&!(r&gn.RIGHT)&&(w=g-(d-l)*p,i=w>=o&&w<=h),!i&&s&gn.BELOW&&!(r&gn.BELOW)&&(y=d-(g-o)/p,i=y>=a&&y<=l),!i&&s&gn.LEFT&&!(r&gn.LEFT)&&(w=g-(d-a)*p,i=w>=o&&w<=h)}return i}function vE(n,t,e,i){if(Wh(n))return Vh(e);let r=[];if(i>1){const o=n[2]-n[0],l=n[3]-n[1];for(let h=0;h<i;++h)r.push(n[0]+o*h/i,n[1],n[2],n[1]+l*h/i,n[2]-o*h/i,n[3],n[0],n[3]-l*h/i)}else r=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]];t(r,r,2);const s=[],a=[];for(let o=0,l=r.length;o<l;o+=2)s.push(r[o]),a.push(r[o+1]);return gE(s,a,e)}function Gv(n,t){const e=t.getExtent(),i=qs(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const r=ke(e),a=Math.floor((i[0]-e[0])/r)*r;n[0]-=a,n[2]-=a}return n}function jv(n,t,e){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];Gv(n,t);const r=ke(i);if(ke(n)>r&&!e)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+r,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-r,n[3]]]}return[n]}function $p(n,t){const e=(""+n).split("."),i=(""+t).split(".");for(let r=0;r<Math.max(e.length,i.length);r++){const s=parseInt(e[r]||"0",10),a=parseInt(i[r]||"0",10);if(s>a)return 1;if(a>s)return-1}return 0}function wE(n,t){return n[0]+=+t[0],n[1]+=+t[1],n}function Uv(n,t){const e=n[0],i=n[1],r=t[0],s=t[1],a=r[0],o=r[1],l=s[0],h=s[1],c=l-a,u=h-o,d=c===0&&u===0?0:(c*(e-a)+u*(i-o))/(c*c+u*u||0);let g,p;return d<=0?(g=a,p=o):d>=1?(g=l,p=h):(g=a+d*c,p=o+d*u),[g,p]}function Vo(n){return function(t){return SE(t,n)}}function xE(n,t,e){return n?t.replace("{x}",n[0].toFixed(e)).replace("{y}",n[1].toFixed(e)):""}function qn(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function Xp(n,t){const e=Math.cos(t),i=Math.sin(t),r=n[0]*e-n[1]*i,s=n[1]*e+n[0]*i;return n[0]=r,n[1]=s,n}function bE(n,t){return n[0]*=t,n[1]*=t,n}function Rh(n,t){const e=n[0]-t[0],i=n[1]-t[1];return e*e+i*i}function Cd(n,t){return Math.sqrt(Rh(n,t))}function EE(n,t){return Rh(n,Uv(n,t))}function SE(n,t){return xE(n,"{x}, {y}",t)}function ug(n,t){if(t.canWrapX()){const e=ke(t.getExtent()),i=zv(n,t,e);i&&(n[0]-=i*e)}return n}function zv(n,t,e){const i=t.getExtent();let r=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||ke(i),r=Math.floor((n[0]-i[0])/e)),r}function qv(n){return Math.pow(n,3)}function Hh(n){return 1-qv(1-n)}function LE(n){return 3*n*n-2*n*n*n}function CE(n){return n}const fg=63710088e-1;function au(n,t,e){e=e||fg;const i=ur(n[1]),r=ur(t[1]),s=(r-i)/2,a=ur(t[0]-n[0])/2,o=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(i)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}function k0(n,t){let e=0;for(let i=0,r=n.length;i<r-1;++i)e+=au(n[i],n[i+1],t);return e}function dg(n,t){t=t||{};const e=t.radius||fg,i=t.projection||"EPSG:3857",r=n.getType();r!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let s=0,a,o,l,h,c,u;switch(r){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{a=n.getCoordinates(),s=k0(a,e);break}case"MultiLineString":case"Polygon":{for(a=n.getCoordinates(),l=0,h=a.length;l<h;++l)s+=k0(a[l],e);break}case"MultiPolygon":{for(a=n.getCoordinates(),l=0,h=a.length;l<h;++l)for(o=a[l],c=0,u=o.length;c<u;++c)s+=k0(o[c],e);break}case"GeometryCollection":{const d=n.getGeometries();for(l=0,h=d.length;l<h;++l)s+=dg(d[l],t);break}default:throw new Error("Unsupported geometry type: "+r)}return s}function Ff(n,t){let e=0;const i=n.length;let r=n[i-1][0],s=n[i-1][1];for(let a=0;a<i;a++){const o=n[a][0],l=n[a][1];e+=ur(o-r)*(2+Math.sin(ur(s))+Math.sin(ur(l))),r=o,s=l}return e*t*t/2}function gg(n,t){t=t||{};const e=t.radius||fg,i=t.projection||"EPSG:3857",r=n.getType();r!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let s=0,a,o,l,h,c,u;switch(r){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(a=n.getCoordinates(),s=Math.abs(Ff(a[0],e)),l=1,h=a.length;l<h;++l)s-=Math.abs(Ff(a[l],e));break}case"MultiPolygon":{for(a=n.getCoordinates(),l=0,h=a.length;l<h;++l)for(o=a[l],s+=Math.abs(Ff(o[0],e)),c=1,u=o.length;c<u;++c)s-=Math.abs(Ff(o[c],e));break}case"GeometryCollection":{const d=n.getGeometries();for(l=0,h=d.length;l<h;++l)s+=gg(d[l],t);break}default:throw new Error("Unsupported geometry type: "+r)}return s}function AE(n,t,e,i){i=i||fg;const r=ur(n[1]),s=ur(n[0]),a=t/i,o=Math.asin(Math.sin(r)*Math.cos(a)+Math.cos(r)*Math.sin(a)*Math.cos(e)),l=s+Math.atan2(Math.sin(e)*Math.sin(a)*Math.cos(r),Math.cos(a)-Math.sin(r)*Math.sin(o));return[Ld(l),Ld(o)]}function Vv(...n){console.warn(...n)}const Ih={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let TE=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Ih[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const mg=TE,Cu=6378137,oh=Math.PI*Cu,ME=[-oh,-oh,oh,oh],PE=[-180,-85,180,85],kf=Cu*Math.log(Math.tan(Math.PI/2));class jl extends mg{constructor(t){super({code:t,units:"m",extent:ME,global:!0,worldExtent:PE,getPointResolution:function(e,i){return e/Math.cosh(i[1]/Cu)}})}}const cy=[new jl("EPSG:3857"),new jl("EPSG:102100"),new jl("EPSG:102113"),new jl("EPSG:900913"),new jl("http://www.opengis.net/def/crs/EPSG/0/3857"),new jl("http://www.opengis.net/gml/srs/epsg.xml#3857")];function RE(n,t,e,i){const r=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let s=0;s<r;s+=i){t[s]=oh*n[s]/180;let a=Cu*Math.log(Math.tan(Math.PI*(+n[s+1]+90)/360));a>kf?a=kf:a<-kf&&(a=-kf),t[s+1]=a}return t}function IE(n,t,e,i){const r=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let s=0;s<r;s+=i)t[s]=180*n[s]/oh,t[s+1]=360*Math.atan(Math.exp(n[s+1]/Cu))/Math.PI-90;return t}const NE=6378137,uy=[-180,-90,180,90],FE=Math.PI*NE/180;class Ro extends mg{constructor(t,e){super({code:t,units:"degrees",extent:uy,axisOrientation:e,global:!0,metersPerUnit:FE,worldExtent:uy})}}const fy=[new Ro("CRS:84"),new Ro("EPSG:4326","neu"),new Ro("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ro("urn:ogc:def:crs:OGC:2:84"),new Ro("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ro("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ro("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Hm={};function od(n){return Hm[n]||Hm[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function kE(n,t){Hm[n]=t}let _h={};function Zo(n,t,e){const i=n.getCode(),r=t.getCode();i in _h||(_h[i]={}),_h[i][r]=e}function ld(n,t){return n in _h&&t in _h[n]?_h[n][t]:null}const Ad=.9996,zr=.00669438,pg=zr*zr,_g=pg*zr,Oo=zr/(1-zr),dy=Math.sqrt(1-zr),Nh=(1-dy)/(1+dy),Wv=Nh*Nh,Yp=Wv*Nh,Kp=Yp*Nh,Hv=Kp*Nh,$v=1-zr/4-3*pg/64-5*_g/256,OE=3*zr/8+3*pg/32+45*_g/1024,DE=15*pg/256+45*_g/1024,BE=35*_g/3072,GE=3/2*Nh-27/32*Yp+269/512*Hv,jE=21/16*Wv-55/32*Kp,UE=151/96*Yp-417/128*Hv,zE=1097/512*Kp,Td=6378137;function qE(n,t,e){const i=n-5e5,a=(e.north?t:t-1e7)/Ad/(Td*$v),o=a+GE*Math.sin(2*a)+jE*Math.sin(4*a)+UE*Math.sin(6*a)+zE*Math.sin(8*a),l=Math.sin(o),h=l*l,c=Math.cos(o),u=l/c,d=u*u,g=d*d,p=1-zr*h,y=Math.sqrt(1-zr*h),w=Td/y,x=(1-zr)/p,b=Oo*c**2,L=b*b,P=i/(w*Ad),R=P*P,j=R*P,k=j*P,T=k*P,q=T*P,W=o-u/x*(R/2-k/24*(5+3*d+10*b-4*L-9*Oo))+q/720*(61+90*d+298*b+45*g-252*Oo-3*L);let F=(P-j/6*(1+2*d+b)+T/120*(5-2*b+28*d-3*L+8*Oo+24*g))/c;return F=zm(F+ur(Xv(e.number)),-Math.PI,Math.PI),[Ld(F),Ld(W)]}const gy=-80,my=84,VE=-180,WE=180;function HE(n,t,e){n=zm(n,VE,WE),t<gy?t=gy:t>my&&(t=my);const i=ur(t),r=Math.sin(i),s=Math.cos(i),a=r/s,o=a*a,l=o*o,h=ur(n),c=Xv(e.number),u=ur(c),d=Td/Math.sqrt(1-zr*r**2),g=Oo*s**2,p=s*zm(h-u,-Math.PI,Math.PI),y=p*p,w=y*p,x=w*p,b=x*p,L=b*p,P=Td*($v*i-OE*Math.sin(2*i)+DE*Math.sin(4*i)-BE*Math.sin(6*i)),R=Ad*d*(p+w/6*(1-o+g)+b/120*(5-18*o+l+72*g-58*Oo))+5e5;let j=Ad*(P+d*a*(y/2+x/24*(5-o+9*g+4*g**2)+L/720*(61-58*o+l+600*g-330*Oo)));return e.north||(j+=1e7),[R,j]}function Xv(n){return(n-1)*6-180+3}const $E=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Yv(n){let t=0;for(const r of $E){const s=n.match(r);if(s){t=parseInt(s[1]);break}}if(!t)return null;let e=0,i=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(i=!0,e=t-32600),e?{number:e,north:i}:null}function py(n,t){return function(e,i,r,s){const a=e.length;r=r>1?r:2,s=s??r,i||(r>2?i=e.slice():i=new Array(a));for(let o=0;o<a;o+=s){const l=e[o],h=e[o+1],c=n(l,h,t);i[o]=c[0],i[o+1]=c[1]}return i}}function XE(n){return Yv(n)?new mg({code:n,units:"m"}):null}function YE(n){const t=Yv(n.getCode());return t?{forward:py(HE,t),inverse:py(qE,t)}:null}const KE=[YE],ZE=[XE];let $m=!0;function Kv(n){$m=!(n===void 0?!0:n)}function Zp(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function JE(n,t){if(t!==void 0&&n!==t){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];n=t}return n}function Md(n){kE(n.getCode(),n),Zo(n,n,Zp)}function QE(n){n.forEach(Md)}function di(n){if(typeof n!="string")return n;const t=od(n);if(t)return t;for(const e of ZE){const i=e(n);if(i)return i}return null}function Pd(n,t,e,i){n=di(n);let r;const s=n.getPointResolutionFunc();if(s){if(r=s(t,e),i&&i!==n.getUnits()){const a=n.getMetersPerUnit();a&&(r=r*a/Ih[i])}}else{const a=n.getUnits();if(a=="degrees"&&!i||i=="degrees")r=t;else{const o=Au(n,di("EPSG:4326"));if(!o&&a!=="degrees")r=t*n.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=o(h,h,2);const c=au(h.slice(0,2),h.slice(2,4)),u=au(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=i?Ih[i]:n.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Xm(n){QE(n),n.forEach(function(t){n.forEach(function(e){t!==e&&Zo(t,e,Zp)})})}function tS(n,t,e,i){n.forEach(function(r){t.forEach(function(s){Zo(r,s,e),Zo(s,r,i)})})}function Jp(n,t){return n?typeof n=="string"?di(n):n:di(t)}function Ym(n){return function(t,e,i,r){const s=t.length;i=i!==void 0?i:2,r=r??i,e=e!==void 0?e:new Array(s);for(let a=0;a<s;a+=r){const o=n(t.slice(a,a+i)),l=o.length;for(let h=0,c=r;h<c;++h)e[a+h]=h>=l?t[a+h]:o[h]}return e}}function eS(n,t,e,i){const r=di(n),s=di(t);Zo(r,s,Ym(e)),Zo(s,r,Ym(i))}function Zv(n,t){return Kv(),Kn(n,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function hd(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||Au(n,t)===Zp)&&e}function Au(n,t){const e=n.getCode(),i=t.getCode();let r=ld(e,i);if(r)return r;let s=null,a=null;for(const l of KE)s||(s=l(n)),a||(a=l(t));if(!s&&!a)return null;const o="EPSG:4326";if(a)if(s)r=O0(s.inverse,a.forward);else{const l=ld(e,o);l&&(r=O0(l,a.forward))}else{const l=ld(o,i);l&&(r=O0(s.inverse,l))}return r&&(Md(n),Md(t),Zo(n,t,r)),r}function O0(n,t){return function(e,i,r,s){return i=n(e,i,r,s),t(i,i,r,s)}}function Fh(n,t){const e=di(n),i=di(t);return Au(e,i)}function Kn(n,t,e){const i=Fh(t,e);if(!i){const r=di(t).getCode(),s=di(e).getCode();throw new Error(`No transform available between ${r} and ${s}`)}return i(n,void 0,n.length)}function iS(n,t,e,i){const r=Fh(t,e);return vE(n,r,void 0,i)}let nS=null;function Jv(){return nS}function Jo(n,t){return n}function Mi(n,t){return $m&&!qn(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&($m=!1,Vv("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function yg(n,t){return n}function Gr(n,t){return n}function _y(n,t,e){return function(i){let r,s;if(n.canWrapX()){const a=n.getExtent(),o=ke(a);i=i.slice(0),s=zv(i,n,o),s&&(i[0]=i[0]-s*o),i[0]=pi(i[0],a[0],a[2]),i[1]=pi(i[1],a[1],a[3]),r=e(i)}else r=e(i);return s&&t.canWrapX()&&(r[0]+=s*ke(t.getExtent())),r}}function rS(){Xm(cy),Xm(fy),tS(fy,cy,RE,IE)}rS();const Qv=new Array(6);function Zi(){return[1,0,0,1,0,0]}function yy(n){return Qp(n,1,0,0,1,0,0)}function vg(n,t){const e=n[0],i=n[1],r=n[2],s=n[3],a=n[4],o=n[5],l=t[0],h=t[1],c=t[2],u=t[3],d=t[4],g=t[5];return n[0]=e*l+r*h,n[1]=i*l+s*h,n[2]=e*c+r*u,n[3]=i*c+s*u,n[4]=e*d+r*g+a,n[5]=i*d+s*g+o,n}function Qp(n,t,e,i,r,s,a){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n[4]=s,n[5]=a,n}function t5(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function Pi(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function D0(n,t,e){return vg(n,Qp(Qv,t,0,0,e,0,0))}function e5(n,t,e){return vg(n,Qp(Qv,1,0,0,1,t,e))}function Wr(n,t,e,i,r,s,a,o){const l=Math.sin(s),h=Math.cos(s);return n[0]=i*h,n[1]=r*l,n[2]=-i*l,n[3]=r*h,n[4]=a*i*h-o*i*l+t,n[5]=a*r*l+o*r*h+e,n}function ou(n,t){const e=sS(t);Be(e!==0,"Transformation matrix cannot be inverted");const i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];return n[0]=a/e,n[1]=-r/e,n[2]=-s/e,n[3]=i/e,n[4]=(s*l-a*o)/e,n[5]=-(i*l-r*o)/e,n}function sS(n){return n[0]*n[3]-n[1]*n[2]}const aS=[1e5,1e5,1e5,1e5,2,2];function oS(n){return"matrix("+n.join(", ")+")"}function vy(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function lS(n,t){const e=vy(n),i=vy(t);for(let r=0;r<6;++r)if(Math.round((e[r]-i[r])*aS[r])!==0)return!1;return!0}function Bs(n,t,e,i,r,s,a){s=s||[],a=a||2;let o=0;for(let l=t;l<e;l+=i){const h=n[l],c=n[l+1];s[o++]=r[0]*h+r[2]*c+r[4],s[o++]=r[1]*h+r[3]*c+r[5];for(let u=2;u<a;u++)s[o++]=n[l+u]}return s&&s.length!=o&&(s.length=o),s}function t1(n,t,e,i,r,s,a){a=a||[];const o=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=t;d<e;d+=i){const g=n[d]-h,p=n[d+1]-c;a[u++]=h+g*o-p*l,a[u++]=c+g*l+p*o;for(let y=d+2;y<d+i;++y)a[u++]=n[y]}return a&&a.length!=u&&(a.length=u),a}function hS(n,t,e,i,r,s,a,o){o=o||[];const l=a[0],h=a[1];let c=0;for(let u=t;u<e;u+=i){const d=n[u]-l,g=n[u+1]-h;o[c++]=l+r*d,o[c++]=h+s*g;for(let p=u+2;p<u+i;++p)o[c++]=n[p]}return o&&o.length!=c&&(o.length=c),o}function cS(n,t,e,i,r,s,a){a=a||[];let o=0;for(let l=t;l<e;l+=i){a[o++]=n[l]+r,a[o++]=n[l+1]+s;for(let h=l+2;h<l+i;++h)a[o++]=n[h]}return a&&a.length!=o&&(a.length=o),a}const wy=Zi(),uS=[NaN,NaN];class e1 extends Ar{constructor(){super(),this.extent_=Bn(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Rv((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return he()}closestPointXY(t,e,i,r){return he()}containsXY(t,e){return this.closestPointXY(t,e,uS,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return he()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Vh(e),this.extentRevision_=this.getRevision()}return _E(this.extent_,t)}rotate(t,e){he()}scale(t,e,i){he()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return he()}getType(){return he()}applyTransform(t){he()}intersectsExtent(t){return he()}translate(t,e){he()}transform(t,e){const i=di(t),r=i.getUnits()=="tile-pixels"?function(s,a,o){const l=i.getExtent(),h=i.getWorldExtent(),c=_n(h)/_n(l);Wr(wy,h[0],h[3],c,-c,0,0,0);const u=Bs(s,0,s.length,o,wy,a),d=Fh(i,e);return d?d(u,u,o):u}:Fh(i,e);return this.applyTransform(r),this}}class bo extends e1{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Wp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return he()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Rd(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){he()}setLayout(t,e,i){let r;if(t)r=Rd(t);else{for(let s=0;s<i;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=al(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();t1(i,0,i.length,r,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=qs(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();hS(r,0,r.length,s,t,e,i,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();cS(i,0,i.length,r,t,e,i),this.changed()}}}function al(n){let t;return n==2?t="XY":n==3?t="XYZ":n==4&&(t="XYZM"),t}function Rd(n){let t;return n=="XY"?t=2:n=="XYZ"||n=="XYM"?t=3:n=="XYZM"&&(t=4),t}function fS(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return Bs(i,0,i.length,r,t,e)}function i5(n,t,e,i){let r=0;const s=n[e-i],a=n[e-i+1];let o=0,l=0;for(;t<e;t+=i){const h=n[t]-s,c=n[t+1]-a;r+=l*h-o*c,o=h,l=c}return r/2}function n5(n,t,e,i){let r=0;for(let s=0,a=e.length;s<a;++s){const o=e[s];r+=i5(n,t,o,i),t=o}return r}function dS(n,t,e,i){let r=0;for(let s=0,a=e.length;s<a;++s){const o=e[s];r+=n5(n,t,o,i),t=o[o.length-1]}return r}function xy(n,t,e,i,r,s,a){const o=n[t],l=n[t+1],h=n[e]-o,c=n[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((r-o)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let g=0;g<i;++g)a[g]=br(n[t+g],n[e+g],d);a.length=i;return}else u=t}for(let d=0;d<i;++d)a[d]=n[u+d];a.length=i}function i1(n,t,e,i,r){let s=n[t],a=n[t+1];for(t+=i;t<e;t+=i){const o=n[t],l=n[t+1],h=va(s,a,o,l);h>r&&(r=h),s=o,a=l}return r}function n1(n,t,e,i,r){for(let s=0,a=e.length;s<a;++s){const o=e[s];r=i1(n,t,o,i,r),t=o}return r}function gS(n,t,e,i,r){for(let s=0,a=e.length;s<a;++s){const o=e[s];r=n1(n,t,o,i,r),t=o[o.length-1]}return r}function r1(n,t,e,i,r,s,a,o,l,h,c){if(t==e)return h;let u,d;if(r===0){if(d=va(a,o,n[t],n[t+1]),d<h){for(u=0;u<i;++u)l[u]=n[t+u];return l.length=i,d}return h}c=c||[NaN,NaN];let g=t+i;for(;g<e;)if(xy(n,g-i,g,i,a,o,c),d=va(a,o,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,g+=i}else g+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(s&&(xy(n,e-i,t,i,a,o,c),d=va(a,o,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function s1(n,t,e,i,r,s,a,o,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=r1(n,t,g,i,r,s,a,o,l,h,c),t=g}return h}function mS(n,t,e,i,r,s,a,o,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=s1(n,t,g,i,r,s,a,o,l,h,c),t=g[g.length-1]}return h}function r5(n,t,e,i){for(let r=0,s=e.length;r<s;++r)n[t++]=e[r];return t}function wg(n,t,e,i){for(let r=0,s=e.length;r<s;++r){const a=e[r];for(let o=0;o<i;++o)n[t++]=a[o]}return t}function Tu(n,t,e,i,r){r=r||[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=wg(n,t,e[a],i);r[s++]=l,t=l}return r.length=s,r}function s5(n,t,e,i,r){r=r||[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=Tu(n,t,e[a],i,r[s]);l.length===0&&(l[0]=t),r[s++]=l,t=l[l.length-1]}return r.length=s,r}function ao(n,t,e,i,r){r=r!==void 0?r:[];let s=0;for(let a=t;a<e;a+=i)r[s++]=n.slice(a,a+i);return r.length=s,r}function lu(n,t,e,i,r){r=r!==void 0?r:[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=e[a];r[s++]=ao(n,t,l,i,r[s]),t=l}return r.length=s,r}function Km(n,t,e,i,r){r=r!==void 0?r:[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=e[a];r[s++]=l.length===1&&l[0]===t?[]:lu(n,t,l,i,r[s]),t=l[l.length-1]}return r.length=s,r}function xg(n,t,e,i,r,s,a){const o=(e-t)/i;if(o<3){for(;t<e;t+=i)s[a++]=n[t],s[a++]=n[t+1];return a}const l=new Array(o);l[0]=1,l[o-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const p=n[d],y=n[d+1],w=n[u],x=n[u+1];for(let b=d+i;b<u;b+=i){const L=n[b],P=n[b+1],R=uE(L,P,p,y,w,x);R>g&&(c=b,g=R)}g>r&&(l[(c-t)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<o;++u)l[u]&&(s[a++]=n[t+u*i],s[a++]=n[t+u*i+1]);return a}function a5(n,t,e,i,r,s,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l];a=xg(n,t,c,i,r,s,a),o.push(a),t=c}return a}function No(n,t){return t*Math.round(n/t)}function pS(n,t,e,i,r,s,a){if(t==e)return a;let o=No(n[t],r),l=No(n[t+1],r);t+=i,s[a++]=o,s[a++]=l;let h,c;do if(h=No(n[t],r),c=No(n[t+1],r),t+=i,t==e)return s[a++]=h,s[a++]=c,a;while(h==o&&c==l);for(;t<e;){const u=No(n[t],r),d=No(n[t+1],r);if(t+=i,u==h&&d==c)continue;const g=h-o,p=c-l,y=u-o,w=d-l;if(g*w==p*y&&(g<0&&y<g||g==y||g>0&&y>g)&&(p<0&&w<p||p==w||p>0&&w>p)){h=u,c=d;continue}s[a++]=h,s[a++]=c,o=h,l=c,h=u,c=d}return s[a++]=h,s[a++]=c,a}function a1(n,t,e,i,r,s,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l];a=pS(n,t,c,i,r,s,a),o.push(a),t=c}return a}function _S(n,t,e,i,r,s,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];a=a1(n,t,c,i,r,s,a,u),o.push(u),t=c[c.length-1]}return a}class Qo extends bo{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Qo(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,r){return r<sl(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(i1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),r1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))}getArea(){return i5(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=xg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Qo(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wg(this.flatCoordinates,0,t,this.stride),this.changed()}}let yS=class o5 extends bo{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new o5(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const s=this.flatCoordinates,a=va(t,e,s[0],s[1]);if(a<r){const o=this.stride;for(let l=0;l<o;++l)i[l]=s[l];return i.length=o,a}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return qc(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Vp(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=r5(this.flatCoordinates,0,t,this.stride),this.changed()}};const fi=yS;function vS(n,t,e,i,r){return!Hp(r,function(a){return!Do(n,t,e,i,a[0],a[1])})}function Do(n,t,e,i,r,s){let a=0,o=n[e-i],l=n[e-i+1];for(;t<e;t+=i){const h=n[t],c=n[t+1];l<=s?c>s&&(h-o)*(s-l)-(r-o)*(c-l)>0&&a++:c<=s&&(h-o)*(s-l)-(r-o)*(c-l)<0&&a--,o=h,l=c}return a!==0}function o1(n,t,e,i,r,s){if(e.length===0||!Do(n,t,e[0],i,r,s))return!1;for(let a=1,o=e.length;a<o;++a)if(Do(n,e[a-1],e[a],i,r,s))return!1;return!0}function wS(n,t,e,i,r,s){if(e.length===0)return!1;for(let a=0,o=e.length;a<o;++a){const l=e[a];if(o1(n,t,l,i,r,s))return!0;t=l[l.length-1]}return!1}function l1(n,t,e,i,r,s,a){let o,l,h,c,u,d,g;const p=r[s+1],y=[];for(let b=0,L=e.length;b<L;++b){const P=e[b];for(c=n[P-i],d=n[P-i+1],o=t;o<P;o+=i)u=n[o],g=n[o+1],(p<=d&&g<=p||d<=p&&p<=g)&&(h=(p-d)/(g-d)*(u-c)+c,y.push(h)),c=u,d=g}let w=NaN,x=-1/0;for(y.sort(Ds),c=y[0],o=1,l=y.length;o<l;++o){u=y[o];const b=Math.abs(u-c);b>x&&(h=(c+u)/2,o1(n,t,e,i,h,p)&&(w=h,x=b)),c=u}return isNaN(w)&&(w=r[s]),a?(a.push(w,p,x),a):[w,p,x]}function l5(n,t,e,i,r){let s=[];for(let a=0,o=e.length;a<o;++a){const l=e[a];s=l1(n,t,l,i,r,2*a,s),t=l[l.length-1]}return s}function h5(n,t,e,i,r){let s;for(t+=i;t<e;t+=i)if(s=r(n.slice(t-i,t),n.slice(t,t+i)),s)return s;return!1}function bg(n,t,e,i,r,s){return s=s??Dv(Bn(),n,t,e,i),ki(r,s)?s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:h5(n,t,e,i,function(a,o){return yE(r,a,o)}):!1}function xS(n,t,e,i,r){for(let s=0,a=e.length;s<a;++s){if(bg(n,t,e[s],i,r))return!0;t=e[s]}return!1}function c5(n,t,e,i,r){return!!(bg(n,t,e,i,r)||Do(n,t,e,i,r[0],r[1])||Do(n,t,e,i,r[0],r[3])||Do(n,t,e,i,r[2],r[1])||Do(n,t,e,i,r[2],r[3]))}function u5(n,t,e,i,r){if(!c5(n,t,e[0],i,r))return!1;if(e.length===1)return!0;for(let s=1,a=e.length;s<a;++s)if(vS(n,e[s-1],e[s],i,r)&&!bg(n,e[s-1],e[s],i,r))return!1;return!0}function bS(n,t,e,i,r){for(let s=0,a=e.length;s<a;++s){const o=e[s];if(u5(n,t,o,i,r))return!0;t=o[o.length-1]}return!1}function ES(n,t,e,i){for(;t<e-i;){for(let r=0;r<i;++r){const s=n[t+r];n[t+r]=n[e-i+r],n[e-i+r]=s}t+=i,e-=i}}function h1(n,t,e,i){let r=0,s=n[e-i],a=n[e-i+1];for(;t<e;t+=i){const o=n[t],l=n[t+1];r+=(o-s)*(l+a),s=o,a=l}return r===0?void 0:r>0}function c1(n,t,e,i,r){r=r!==void 0?r:!1;for(let s=0,a=e.length;s<a;++s){const o=e[s],l=h1(n,t,o,i);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=o}return!0}function f5(n,t,e,i,r){for(let s=0,a=e.length;s<a;++s){const o=e[s];if(!c1(n,t,o,i,r))return!1;o.length&&(t=o[o.length-1])}return!0}function Id(n,t,e,i,r){r=r!==void 0?r:!1;for(let s=0,a=e.length;s<a;++s){const o=e[s],l=h1(n,t,o,i);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&ES(n,t,o,i),t=o}return t}function Zm(n,t,e,i,r){for(let s=0,a=e.length;s<a;++s)t=Id(n,t,e[s],i,r);return t}function d5(n,t){const e=[];let i=0,r=0,s;for(let a=0,o=t.length;a<o;++a){const l=t[a],h=h1(n,i,l,2);if(s===void 0&&(s=h),h===s)e.push(t.slice(r,a+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=a+1,i=l}return e}class Ei extends bo{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?ze(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ei(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<sl(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(n1(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),s1(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return o1(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return n5(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Id(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,lu(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=qs(this.getExtent());this.flatInteriorPoint_=l1(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new fi(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Qo(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[];let s=0;for(let a=0,o=i.length;a<o;++a){const l=i[a],h=new Qo(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;c1(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Id(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=a1(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Ei(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return u5(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Tu(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function SS(n,t,e,i){e=e||32;const r=[];for(let s=0;s<e;++s)ze(r,AE(n,t,2*Math.PI*s/e,i));return r.push(r[0],r[1]),new Ei(r,"XY",[r.length])}function Bo(n){if(Wh(n))throw new Error("Cannot create polygon from empty extent");const t=n[0],e=n[1],i=n[2],r=n[3],s=[t,e,t,r,i,r,i,e,t,e];return new Ei(s,"XY",[s.length])}function B0(n,t,e){t=t||32;const i=n.getStride(),r=n.getLayout(),s=n.getCenter(),a=i*(t+1),o=new Array(a);for(let c=0;c<a;c+=i){o[c]=0,o[c+1]=0;for(let u=2;u<i;u++)o[c+u]=s[u]}const l=[o.length],h=new Ei(o,r,l);return LS(h,s,n.getRadius(),e),h}function LS(n,t,e,i){const r=n.getFlatCoordinates(),s=n.getStride(),a=r.length/s-1,o=i||0;for(let l=0;l<=a;++l){const h=l*s,c=o+uo(l,a)*2*Math.PI/a;r[h]=t[0]+e*Math.cos(c),r[h+1]=t[1]+e*Math.sin(c)}n.changed()}function u1(n,t,e,i){const r=ke(t)/e[0],s=_n(t)/e[1];return i?Math.min(n,Math.max(r,s)):Math.min(n,Math.min(r,s))}function f1(n,t,e){let i=Math.min(n,t);const r=50;return i*=Math.log(1+r*Math.max(0,n/t-1))/r+1,e&&(i=Math.max(i,e),i/=Math.log(1+r*Math.max(0,e/n-1))/r+1),pi(i,e/2,t*2)}function CS(n,t,e,i){return t=t!==void 0?t:!0,function(r,s,a,o){if(r!==void 0){const l=n[0],h=n[n.length-1],c=e?u1(l,e,a,i):l;if(o)return t?f1(r,c,h):pi(r,h,c);const u=Math.min(c,r),d=Math.floor(qp(n,u,s));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}function AS(n,t,e,i,r,s){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(a,o,l,h){if(a!==void 0){const c=r?u1(t,r,l,s):t;if(h)return i?f1(a,c,e):pi(a,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(n)-u),g=-o*(.5-u)+.5,p=Math.min(c,a),y=Math.floor(Math.log(t/p)/Math.log(n)+g),w=Math.max(d,y),x=t/Math.pow(n,w);return pi(x,e,c)}}}function by(n,t,e,i,r){return e=e!==void 0?e:!0,function(s,a,o,l){if(s!==void 0){const h=i?u1(n,i,o,r):n;return!e||!l?pi(s,t,h):f1(s,h,t)}}}function d1(n){if(n!==void 0)return 0}function Ey(n){if(n!==void 0)return n}function TS(n){const t=2*Math.PI/n;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function MS(n){const t=n===void 0?ur(5):n;return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}const PS=42,g1=256,G0=0;class RS extends Ar{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Jp(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Kv(),t.center&&(t.center=Mi(t.center,this.projection_)),t.extent&&(t.extent=Gr(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const o in os)delete e[o];this.setProperties(e,!0);const i=NS(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const r=IS(t),s=i.constraint,a=FS(t);this.constraints_={center:r,resolution:s,rotation:a},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const r=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),a=s/2*(r[3]-e[3]+e[1]-r[1]),o=s/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([i[0]+a,i[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=Mi(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=Mi(r.anchor,this.getProjection())),e[i]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===e){i&&Of(i,!0);return}let s=Date.now(),a=this.targetCenter_.slice(),o=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||LE,callback:i};if(c.center&&(u.sourceCenter=a,u.targetCenter=c.center.slice(),a=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=o,u.targetResolution=this.getResolutionForZoom(c.zoom),o=u.targetResolution):c.resolution&&(u.sourceResolution=o,u.targetResolution=c.resolution,o=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=uo(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}kS(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(vi.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[vi.ANIMATING]>0}getInteracting(){return this.hints_[vi.INTERACTING]>0}cancelAnimations(){this.setHint(vi.ANIMATING,-this.hints_[vi.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const r=this.animations_[e];if(r[0].callback&&Of(r[0].callback,!1),!t)for(let s=0,a=r.length;s<a;++s){const o=r[s];if(!o.complete){t=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let s=!0;for(let a=0,o=r.length;a<o;++a){const l=r[a];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],p=l.targetCenter[0],y=l.targetCenter[1];this.nextCenter_=l.targetCenter;const w=d+u*(p-d),x=g+u*(y-g);this.targetCenter_=[w,x]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?uo(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(vi.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=r[0].callback;a&&Of(a,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-e[0],r[1]-e[1]],Xp(i,t-this.getRotation()),wE(i,e)),i}calculateCenterZoom(t,e){let i;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const a=e[0]-t*(e[0]-r[0])/s,o=e[1]-t*(e[1]-r[1])/s;i=[a,o]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],r=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Jo(t,this.getProjection())}getCenterInternal(){return this.get(os.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return yg(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Be(e,"The view center is not defined");const i=this.getResolution();Be(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return Be(r!==void 0,"The view rotation is not defined"),Wm(e,i,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(os.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Gr(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=ke(t)/e[0],r=_n(t)/e[1];return Math.max(i,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(e/i)/Math.log(t);return function(s){return e/Math.pow(t,s*r)}}getRotation(){return this.get(os.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(i/r)/e;return function(a){return Math.log(i/a)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const a=this.getViewportSizeMinusPadding_();r=j0(r,this.getViewportSize_(),[a[0]/2+s[3],a[1]/2+s[0]],e,i)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,r;if(this.resolutions_){const s=qp(this.resolutions_,t,1);e=s,i=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=i/this.resolutions_[s+1]}else i=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(i/t)/Math.log(r)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=pi(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(r,pi(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(Be(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Be(!Wh(t),"Cannot fit empty extent provided as `geometry`");const r=Gr(t,this.getProjection());i=Bo(r)}else if(t.getType()==="Circle"){const r=Gr(t.getExtent(),this.getProjection());i=Bo(r),i.rotate(this.getRotation(),qs(r))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),r=Math.sin(-e),s=t.getFlatCoordinates(),a=t.getStride();let o=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=a){const g=s[u]*i-s[u+1]*r,p=s[u]*r+s[u+1]*i;o=Math.min(o,g),l=Math.min(l,p),h=Math.max(h,g),c=Math.max(c,p)}return[o,l,h,c]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let a;e.minResolution!==void 0?a=e.minResolution:e.maxZoom!==void 0?a=this.getResolutionForZoom(e.maxZoom):a=0;const o=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(o,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);l=isNaN(l)?a:Math.max(l,a),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=qs(o);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const g=d[0]*u-d[1]*c,p=d[1]*u+d[0]*c,y=this.getConstrainedCenter([g,p],l),w=e.callback?e.callback:ru;e.duration!==void 0?this.animateInternal({resolution:l,center:y,duration:e.duration,easing:e.easing},w):(this.targetResolution_=l,this.targetCenter_=y,this.applyTargetState_(!1,!0),Of(w,!0))}centerOn(t,e,i){this.centerOnInternal(Mi(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(j0(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,r){let s;const a=this.padding_;if(a&&t){const o=this.getViewportSizeMinusPadding_(-i),l=j0(t,r,[o[0]/2+a[3],o[1]/2+a[0]],e,i);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Jo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Mi(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,r,i);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Mi(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Mi(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,0,s,i),o=this.constraints_.center(this.targetCenter_,a,s,i,this.calculateCenterShift(this.targetCenter_,a,r,s));this.get(os.ROTATION)!==r&&this.set(os.ROTATION,r),this.get(os.RESOLUTION)!==a&&(this.set(os.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(os.CENTER)||!qn(this.get(os.CENTER),o))&&this.set(os.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const r=e||0,s=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,r,a),l=this.constraints_.center(this.targetCenter_,o,a,!1,this.calculateCenterShift(this.targetCenter_,o,s,a));if(t===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==s||!this.getCenterInternal()||!qn(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:o,duration:t,easing:Hh,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(vi.INTERACTING,1)}endInteraction(t,e,i){i=i&&Mi(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(vi.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Of(n,t){setTimeout(function(){n(t)},0)}function IS(n){if(n.extent!==void 0){const e=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return hy(n.extent,n.constrainOnlyCenter,e)}const t=Jp(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,hy(e,!1,!1)}return dE}function NS(n){let t,e,i,a=n.minZoom!==void 0?n.minZoom:G0,o=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,c=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,u=n.showFullExtent!==void 0?n.showFullExtent:!1,d=Jp(n.projection,"EPSG:3857"),g=d.getExtent();let p=n.constrainOnlyCenter,y=n.extent;if(!h&&!y&&d.isGlobal()&&(p=!1,y=g),n.resolutions!==void 0){const w=n.resolutions;e=w[a],i=w[o]!==void 0?w[o]:w[w.length-1],n.constrainResolution?t=CS(w,c,!p&&y,u):t=by(e,i,c,!p&&y,u)}else{const x=(g?Math.max(ke(g),_n(g)):360*Ih.degrees/d.getMetersPerUnit())/g1/Math.pow(2,G0),b=x/Math.pow(2,28-G0);e=n.maxResolution,e!==void 0?a=0:e=x/Math.pow(l,a),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=e/Math.pow(l,o):i=x/Math.pow(l,o):i=b),o=a+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,o-a),n.constrainResolution?t=AS(l,e,i,c,!p&&y,u):t=by(e,i,c,!p&&y,u)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:a,zoomFactor:l}}function FS(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const e=n.constrainRotation;return e===void 0||e===!0?MS():e===!1?Ey:typeof e=="number"?TS(e):Ey}return d1}function kS(n){return!(n.sourceCenter&&n.targetCenter&&!qn(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function j0(n,t,e,i,r){const s=Math.cos(-r);let a=Math.sin(-r),o=n[0]*s-n[1]*a,l=n[1]*s+n[0]*a;o+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,a=-a;const h=o*s-l*a,c=l*s+o*a;return[h,c]}const kr=RS,Df="ol-hidden",OS="ol-selectable",ll="ol-unselectable",Sy="ol-unsupported",Mu="ol-control",Ly="ol-collapsed",DS=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Cy=["style","variant","weight","size","lineHeight","family"],g5=function(n){const t=n.match(DS);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,r=Cy.length;i<r;++i){const s=t[i+1];s!==void 0&&(e[Cy[i]]=s)}return e.families=e.family.split(/,\s?/),e};function Ji(n,t,e,i){let r;return e&&e.length?r=e.shift():Nv?r=new OffscreenCanvas(n||300,t||300):r=document.createElement("canvas"),n&&(r.width=n),t&&(r.height=t),r.getContext("2d",i)}let U0;function Nd(){return U0||(U0=Ji(1,1)),U0}function Eg(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function BS(n){let t=n.offsetWidth;const e=getComputedStyle(n);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function GS(n){let t=n.offsetHeight;const e=getComputedStyle(n);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Fd(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function m5(n){for(;n.lastChild;)n.lastChild.remove()}function jS(n,t){const e=n.childNodes;for(let i=0;;++i){const r=e[i],s=t[i];if(!r&&!s)break;if(r!==s){if(!r){n.appendChild(s);continue}if(!s){n.removeChild(r),--i;continue}n.insertBefore(s,r)}}}class sn extends Ar{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let i=0,r=this.listenerKeys.length;i<r;++i)ai(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,t){const i=this.target_??t.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==ru&&this.listenerKeys.push(ve(t,ga.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class m1 extends sn{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"",a=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=a):this.collapseLabel_=s;const o=t.label!==void 0?t.label:"i";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=r):this.label_=o;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(ie.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+ll+" "+Mu+(this.collapsed_&&this.collapsible_?" "+Ly:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),i=new Set(e.flatMap(r=>r.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(r=>i.add(r)):i.add(this.attributions_)),!this.overrideCollapsible_){const r=!e.some(s=>{var a;return((a=s.getSource())==null?void 0:a.getAttributionsCollapsible())===!1});this.setCollapsible(r)}return Array.from(i)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(r=>eE(()=>r))),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Hs(e,this.renderedAttributions_)){m5(this.ulElement_);for(let r=0,s=e.length;r<s;++r){const a=document.createElement("li");a.innerHTML=e[r],this.ulElement_.appendChild(a)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ly),this.collapsed_?Fd(this.collapseLabel_,this.label_):Fd(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class US extends sn{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const s=t.tipLabel?t.tipLabel:"Reset rotation",a=document.createElement("button");a.className=e+"-reset",a.setAttribute("type","button"),a.title=s,a.appendChild(this.label_),a.addEventListener(ie.CLICK,this.handleClick_.bind(this),!1);const o=e+" "+ll+" "+Mu,l=this.element;l.className=o,l.appendChild(a),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Df)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Hh}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Df);!s&&i===0?this.element.classList.add(Df):s&&i!==0&&this.element.classList.remove(Df)}this.label_.style.transform=r}this.rotation_=i}}const zS=US;class qS extends sn{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",a=t.zoomInLabel!==void 0?t.zoomInLabel:"+",o=t.zoomOutLabel!==void 0?t.zoomOutLabel:"",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof a=="string"?document.createTextNode(a):a),c.addEventListener(ie.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(ie.CLICK,this.handleClick_.bind(this,-i),!1);const d=e+" "+ll+" "+Mu,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(r!==void 0){const s=i.getConstrainedZoom(r+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:Hh})):i.setZoom(s)}}}const VS=qS;function p5(n){n=n||{};const t=new On;return(n.zoom!==void 0?n.zoom:!0)&&t.push(new VS(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&t.push(new zS(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&t.push(new m1(n.attributionOptions)),t}class WS{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;const s=this.points_[e]-this.points_[i],a=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(a,s),this.initialVelocity_=Math.sqrt(s*s+a*a)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Jm={ACTIVE:"active"};class _s extends Ar{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Jm.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Jm.ACTIVE,t)}setMap(t){this.map_=t}}function HS(n,t,e){const i=n.getCenterInternal();if(i){const r=[i[0]+t[0],i[1]+t[1]];n.animateInternal({duration:e!==void 0?e:250,easing:CE,center:n.getConstrainedCenter(r)})}}function p1(n,t,e,i){const r=n.getZoom();if(r===void 0)return;const s=n.getConstrainedZoom(r+t),a=n.getResolutionForZoom(s);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:a,anchor:e,duration:i!==void 0?i:250,easing:Hh})}class $S extends _s{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Ie.DBLCLICK){const i=t.originalEvent,r=t.map,s=t.coordinate,a=i.shiftKey?-this.delta_:this.delta_,o=r.getView();p1(o,a,s,this.duration_),i.preventDefault(),e=!0}return!e}}const XS=$S;function Qm(n){const t=arguments;return function(e){let i=!0;for(let r=0,s=t.length;r<s&&(i=i&&t[r](e),!!i);++r);return i}}const _5=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},YS=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},KS=function(n){const t=n.map.getTargetElement(),e=t.getRootNode(),i=n.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(i):t.contains(i)},y5=function(n){const t=n.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?KS(n):!0},hu=Sa,ZS=function(n){return n.type==Ie.CLICK},v5=function(n){const t=n.originalEvent;return t instanceof PointerEvent&&t.button==0&&!(sE&&Iv&&t.ctrlKey)},tp=zh,_1=function(n){return n.type==Ie.SINGLECLICK},y1=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},JS=function(n){const t=n.originalEvent;return Iv?t.metaKey:t.ctrlKey},Pu=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},w5=function(n){const t=n.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},yh=function(n){const t=n.originalEvent;return t instanceof PointerEvent&&t.pointerType=="mouse"},v1=function(n){const t=n.originalEvent;return t instanceof PointerEvent&&t.isPrimary&&t.button===0};class $s extends _s{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ie.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Ie.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==Ie.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==Ie.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function w1(n){const t=n.length;let e=0,i=0;for(let r=0;r<t;r++)e+=n[r].clientX,i+=n[r].clientY;return{clientX:e/t,clientY:i/t}}class QS extends $s{constructor(t){super({stopDown:zh}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Qm(y1,v1);this.condition_=t.onFocusOnly?Qm(y5,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,r=e.getEventPixel(w1(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=t.map.getView();bE(s,o.getResolution()),Xp(s,o.getRotation()),o.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),a=i.getCenterInternal(),o=e.getPixelFromCoordinateInternal(a),l=e.getCoordinateFromPixelInternal([o[0]-r*Math.cos(s),o[1]-r*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Hh})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const tL=QS;class eL extends $s{constructor(t){t=t||{},super({stopDown:zh}),this.condition_=t.condition?t.condition:YS,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!yh(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===d1)return;const r=e.getSize(),s=t.pixel,a=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const o=a-this.lastAngle_;i.adjustRotationInternal(-o)}this.lastAngle_=a}handleUpEvent(t){return yh(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return yh(t)&&v5(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class iL extends Su{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+i,r.top=Math.min(t[1],e[1])+i,r.width=Math.abs(e[0]-t[0])+i,r.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Ei([r])}getGeometry(){return this.geometry_}}const Ul={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Cc extends Cr{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class nL extends $s{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new iL(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??v5,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const r=i[0]-e[0],s=i[1]-e[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Cc(Ul.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Cc(e?Ul.BOXEND:Ul.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Cc(Ul.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Cc(Ul.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Cc(Ul.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class rL extends nL{constructor(t){t=t||{};const e=t.condition?t.condition:Pu;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(r),a=i.getResolutionForExtentInternal(s),o=i.getResolution()/a;r=r.clone(),r.scale(o*o)}i.fitInternal(r,{duration:this.duration_,easing:Hh})}}const sL=rL,Io={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class aL extends _s{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return y1(e)&&w5(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==ie.KEYDOWN){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&(r==Io.DOWN||r==Io.LEFT||r==Io.RIGHT||r==Io.UP)){const a=t.map.getView(),o=a.getResolution()*this.pixelDelta_;let l=0,h=0;r==Io.DOWN?h=-o:r==Io.LEFT?l=-o:r==Io.RIGHT?l=o:h=o;const c=[l,h];Xp(c,a.getRotation()),HS(a,c,this.duration_),i.preventDefault(),e=!0}}return!e}}class oL extends _s{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!JS(e)&&w5(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==ie.KEYDOWN||t.type==ie.KEYPRESS){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&(r==="+"||r==="-")){const s=t.map,a=r==="+"?this.delta_:-this.delta_,o=s.getView();p1(o,a,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}const lL=oL;class hL extends _s{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:hu;this.condition_=t.onFocusOnly?Qm(y5,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==ie.WHEEL)return!0;const i=t.map,r=t.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let s;if(t.type==ie.WHEEL&&(s=r.deltaY,r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const o=i.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=a,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-pi(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),p1(e,i,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const cL=hL;class uL extends $s{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=zh),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;const a=t.map,o=a.getView();o.getConstraints().rotation!==d1&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(w1(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class fL extends $s{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=zh),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],r=this.targetPointers[1],s=i.clientX-r.clientX,a=i.clientY-r.clientY,o=Math.sqrt(s*s+a*a);this.lastDistance_!==void 0&&(e=this.lastDistance_/o),this.lastDistance_=o;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(w1(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const dL=fL;function x5(n){n=n||{};const t=new On,e=new WS(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&t.push(new eL),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&t.push(new XS({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&t.push(new tL({onFocusOnly:n.onFocusOnly,kinetic:e})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&t.push(new uL),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&t.push(new dL({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(t.push(new aL),t.push(new lL({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&t.push(new cL({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&t.push(new sL({duration:n.zoomDuration})),t}const $e={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class b5 extends Ar{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[$e.OPACITY]=t.opacity!==void 0?t.opacity:1,Be(typeof e[$e.OPACITY]=="number","Layer opacity must be a number"),e[$e.VISIBLE]=t.visible!==void 0?t.visible:!0,e[$e.Z_INDEX]=t.zIndex,e[$e.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[$e.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[$e.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[$e.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=pi(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return he()}getLayerStatesArray(t){return he()}getExtent(){return this.get($e.EXTENT)}getMaxResolution(){return this.get($e.MAX_RESOLUTION)}getMinResolution(){return this.get($e.MIN_RESOLUTION)}getMinZoom(){return this.get($e.MIN_ZOOM)}getMaxZoom(){return this.get($e.MAX_ZOOM)}getOpacity(){return this.get($e.OPACITY)}getSourceState(){return he()}getVisible(){return this.get($e.VISIBLE)}getZIndex(){return this.get($e.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set($e.EXTENT,t)}setMaxResolution(t){this.set($e.MAX_RESOLUTION,t)}setMinResolution(t){this.set($e.MIN_RESOLUTION,t)}setMaxZoom(t){this.set($e.MAX_ZOOM,t)}setMinZoom(t){this.set($e.MIN_ZOOM,t)}setOpacity(t){Be(typeof t=="number","Layer opacity must be a number"),this.set($e.OPACITY,t)}setVisible(t){this.set($e.VISIBLE,t)}setZIndex(t){this.set($e.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class eo extends Cr{constructor(t,e){super(t),this.layer=e}}const z0={LAYERS:"layers"};class Qn extends b5{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(z0.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new On(i.slice(),{unique:!0}):Be(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new On(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ai),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(ve(t,Ki.ADD,this.handleLayersAdd_,this),ve(t,Ki.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(ai);rl(this.listenerKeys_);const e=t.getArray();for(let i=0,r=e.length;i<r;i++){const s=e[i];this.registerLayerListeners_(s),this.dispatchEvent(new eo("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[ve(t,Ph.PROPERTYCHANGE,this.handleLayerChange_,this),ve(t,ie.CHANGE,this.handleLayerChange_,this)];t instanceof Qn&&e.push(ve(t,"addlayer",this.handleLayerGroupAdd_,this),ve(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Ht(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new eo("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new eo("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new eo("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=Ht(e);this.listenerKeys_[i].forEach(ai),delete this.listenerKeys_[i],this.dispatchEvent(new eo("removelayer",e)),this.changed()}getLayers(){return this.get(z0.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let r=0,s=i.length;r<s;++r)this.dispatchEvent(new eo("removelayer",i[r]))}this.set(z0.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&r.zIndex===void 0&&(s=0);for(let a=i,o=e.length;a<o;a++){const l=e[a];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=wa(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}const pn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class $h extends b5{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener($e.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get($e.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ai(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=ve(t,ie.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof kr?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;if(e.layerStatesArray){if(r=e.layerStatesArray.find(a=>a.layer===this),!r)return!1}else r=this.getLayerState();const s=this.getExtent();return x1(r,e.viewState)&&(!s||ki(s,e.extent))}getAttributions(t){var s;if(!this.isVisible(t))return[];const e=(s=this.getSource())==null?void 0:s.getAttributions();if(!e)return[];const i=t instanceof kr?t.getViewStateAndExtent():t;let r=e(i);return Array.isArray(r)||(r=[r]),r}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set($e.MAP,t)}getMapInternal(){return this.get($e.MAP)}setMap(t){this.mapPrecomposeKey_&&(ai(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ai(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ve(t,pn.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=ve(this,ie.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);Be(!e.some(r=>r.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(i)}setSource(t){this.set($e.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function x1(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}function E5(n,t,e=0,i=n.length-1,r=gL){for(;i>e;){if(i-e>600){const l=i-e+1,h=t-e+1,c=Math.log(l),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),g=Math.max(e,Math.floor(t-h*u/l+d)),p=Math.min(i,Math.floor(t+(l-h)*u/l+d));E5(n,t,g,p,r)}const s=n[t];let a=e,o=i;for(Ac(n,e,t),r(n[i],s)>0&&Ac(n,e,i);a<o;){for(Ac(n,a,o),a++,o--;r(n[a],s)<0;)a++;for(;r(n[o],s)>0;)o--}r(n[e],s)===0?Ac(n,e,o):(o++,Ac(n,o,i)),o<=t&&(e=o+1),t<=o&&(i=o-1)}}function Ac(n,t,e){const i=n[t];n[t]=n[e],n[e]=i}function gL(n,t){return n<t?-1:n>t?1:0}let S5=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Gf(t,e))return i;const r=this.toBBox,s=[];for(;e;){for(let a=0;a<e.children.length;a++){const o=e.children[a],l=e.leaf?r(o):o;Gf(t,l)&&(e.leaf?i.push(o):V0(t,l)?this._all(o,i):s.push(o))}e=s.pop()}return i}collides(t){let e=this.data;if(!Gf(t,e))return!1;const i=[];for(;e;){for(let r=0;r<e.children.length;r++){const s=e.children[r],a=e.leaf?this.toBBox(s):s;if(Gf(t,a)){if(e.leaf||V0(t,a))return!0;i.push(s)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=th([]),this}remove(t,e){if(!t)return this;let i=this.data;const r=this.toBBox(t),s=[],a=[];let o,l,h;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],o=a.pop(),h=!0),i.leaf){const c=mL(t,i.children,e);if(c!==-1)return i.children.splice(c,1),s.push(i),this._condense(s),this}!h&&!i.leaf&&V0(i,r)?(s.push(i),a.push(o),o=0,l=i,i=i.children[0]):l?(o++,i=l.children[o],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,r){const s=i-e+1;let a=this._maxEntries,o;if(s<=a)return o=th(t.slice(e,i+1)),zl(o,this.toBBox),o;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),o=th([]),o.leaf=!1,o.height=r;const l=Math.ceil(s/a),h=l*Math.ceil(Math.sqrt(a));Ay(t,e,i,h,this.compareMinX);for(let c=e;c<=i;c+=h){const u=Math.min(c+h-1,i);Ay(t,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const g=Math.min(d+l-1,u);o.children.push(this._build(t,d,g,r-1))}}return zl(o,this.toBBox),o}_chooseSubtree(t,e,i,r){for(;r.push(e),!(e.leaf||r.length-1===i);){let s=1/0,a=1/0,o;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=q0(h),u=yL(t,h)-c;u<a?(a=u,s=c<s?c:s,o=h):u===a&&c<s&&(s=c,o=h)}e=o||e.children[0]}return e}_insert(t,e,i){const r=i?t:this.toBBox(t),s=[],a=this._chooseSubtree(r,this.data,e,s);for(a.children.push(t),Oc(a,r);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(r,s,e)}_split(t,e){const i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);const a=this._chooseSplitIndex(i,s,r),o=th(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,zl(i,this.toBBox),zl(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this.data=th([t,e]),this.data.height=t.height+1,this.data.leaf=!1,zl(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let r,s=1/0,a=1/0;for(let o=e;o<=i-e;o++){const l=kc(t,0,o,this.toBBox),h=kc(t,o,i,this.toBBox),c=vL(l,h),u=q0(l)+q0(h);c<s?(s=c,r=o,a=u<a?u:a):c===s&&u<a&&(a=u,r=o)}return r||i-e}_chooseSplitAxis(t,e,i){const r=t.leaf?this.compareMinX:pL,s=t.leaf?this.compareMinY:_L,a=this._allDistMargin(t,e,i,r),o=this._allDistMargin(t,e,i,s);a<o&&t.children.sort(r)}_allDistMargin(t,e,i,r){t.children.sort(r);const s=this.toBBox,a=kc(t,0,e,s),o=kc(t,i-e,i,s);let l=Bf(a)+Bf(o);for(let h=e;h<i-e;h++){const c=t.children[h];Oc(a,t.leaf?s(c):c),l+=Bf(a)}for(let h=i-e-1;h>=e;h--){const c=t.children[h];Oc(o,t.leaf?s(c):c),l+=Bf(o)}return l}_adjustParentBBoxes(t,e,i){for(let r=i;r>=0;r--)Oc(e[r],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():zl(t[e],this.toBBox)}};function mL(n,t,e){if(!e)return t.indexOf(n);for(let i=0;i<t.length;i++)if(e(n,t[i]))return i;return-1}function zl(n,t){kc(n,0,n.children.length,t,n)}function kc(n,t,e,i,r){r||(r=th(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<e;s++){const a=n.children[s];Oc(r,n.leaf?i(a):a)}return r}function Oc(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function pL(n,t){return n.minX-t.minX}function _L(n,t){return n.minY-t.minY}function q0(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Bf(n){return n.maxX-n.minX+(n.maxY-n.minY)}function yL(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function vL(n,t){const e=Math.max(n.minX,t.minX),i=Math.max(n.minY,t.minY),r=Math.min(n.maxX,t.maxX),s=Math.min(n.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,s-i)}function V0(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function Gf(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function th(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ay(n,t,e,i,r){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=i)continue;const a=t+Math.ceil((e-t)/i/2)*i;E5(n,a,t,e,r),s.push(t,a,a,e)}}const b1=[NaN,NaN,NaN,0];let W0;function wL(){return W0||(W0=Ji(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),W0}const xL=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,bL=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,EL=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,SL=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function jf(n,t){return n.endsWith("%")?Number(n.substring(0,n.length-1))/t:Number(n)}function Hc(n){throw new Error('failed to parse "'+n+'" as color')}function L5(n){if(n.toLowerCase().startsWith("rgb")){const s=n.match(bL)||n.match(xL)||n.match(EL);if(s){const a=s[4],o=100/255;return[pi(jf(s[1],o)+.5|0,0,255),pi(jf(s[2],o)+.5|0,0,255),pi(jf(s[3],o)+.5|0,0,255),a!==void 0?pi(jf(a,100),0,1):1]}Hc(n)}if(n.startsWith("#")){if(SL.test(n)){const s=n.substring(1),a=s.length<=4?1:2,o=[0,0,0,255];for(let l=0,h=s.length;l<h;l+=a){let c=parseInt(s.substring(l,l+a),16);a===1&&(c+=c<<4),o[l/a]=c}return o[3]=o[3]/255,o}Hc(n)}const t=wL();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=n,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=n,t.fillStyle===e&&Hc(n));const i=t.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return L5(i);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const r=Array.from(t.getImageData(0,0,1,1).data);return r[3]=qh(r[3]/255,3),r}function fs(n){return typeof n=="string"?n:S1(n)}const LL=1024,Tc={};let H0=0;function CL(n){if(n.length===4)return n;const t=n.slice();return t[3]=1,t}function $0(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function X0(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function Y0(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function K0(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function Ty(n){const t=Y0(n[0]),e=Y0(n[1]),i=Y0(n[2]),r=K0(t*.222488403+e*.716873169+i*.06060791),s=500*(K0(t*.452247074+e*.399439023+i*.148375274)-r),a=200*(r-K0(t*.016863605+e*.117638439+i*.865350722)),o=Math.atan2(a,s)*(180/Math.PI);return[116*r-16,Math.sqrt(s*s+a*a),o<0?o+360:o,n[3]]}function AL(n){const t=(n[0]+16)/116,e=n[1],i=n[2]*Math.PI/180,r=X0(t),s=X0(t+e/500*Math.cos(i)),a=X0(t-e/200*Math.sin(i)),o=$0(s*3.021973625-r*1.617392459-a*.404875592),l=$0(s*-.943766287+r*1.916279586+a*.027607165),h=$0(s*.069407491-r*.22898585+a*1.159737864);return[pi(o+.5|0,0,255),pi(l+.5|0,0,255),pi(h+.5|0,0,255),n[3]]}function E1(n){if(n==="none")return b1;if(Tc.hasOwnProperty(n))return Tc[n];if(H0>=LL){let e=0;for(const i in Tc)e++&3||(delete Tc[i],--H0)}const t=L5(n);t.length!==4&&Hc(n);for(const e of t)isNaN(e)&&Hc(n);return Tc[n]=t,++H0,t}function Hr(n){return Array.isArray(n)?n:E1(n)}function S1(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+r+")"}function My(n){return n[0]>0&&n[1]>0}function TL(n,t,e){return e===void 0&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}function Dn(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}let hl=0;const nn=1<<hl++,Xt=1<<hl++,rn=1<<hl++,Li=1<<hl++,Zn=1<<hl++,ds=1<<hl++,Uf=Math.pow(2,hl)-1,L1={[nn]:"boolean",[Xt]:"number",[rn]:"string",[Li]:"color",[Zn]:"number[]",[ds]:"size"},ML=Object.keys(L1).map(Number).sort(Ds);function PL(n){return n in L1}function lh(n){const t=[];for(const e of ML)Dc(n,e)&&t.push(L1[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Dc(n,t){return(n&t)===t}function Ha(n,t){return n===t}class en{constructor(t,e){if(!PL(t))throw new Error(`literal expressions must have a specific type, got ${lh(t)}`);this.type=t,this.value=e}}class C5{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function Sg(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function yn(n,t,e){switch(typeof n){case"boolean":{if(Ha(t,rn))return new en(rn,n?"true":"false");if(!Dc(t,nn))throw new Error(`got a boolean, but expected ${lh(t)}`);return new en(nn,n)}case"number":{if(Ha(t,ds))return new en(ds,Dn(n));if(Ha(t,nn))return new en(nn,!!n);if(Ha(t,rn))return new en(rn,n.toString());if(!Dc(t,Xt))throw new Error(`got a number, but expected ${lh(t)}`);return new en(Xt,n)}case"string":{if(Ha(t,Li))return new en(Li,E1(n));if(Ha(t,nn))return new en(nn,!!n);if(!Dc(t,rn))throw new Error(`got a string, but expected ${lh(t)}`);return new en(rn,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return UL(n,t,e);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(Ha(t,ds)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new en(ds,n)}if(Ha(t,Li)){if(n.length===3)return new en(Li,[...n,1]);if(n.length===4)return new en(Li,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!Dc(t,Zn))throw new Error(`got an array of numbers, but expected ${lh(t)}`);return new en(Zn,n)}const ut={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},RL={[ut.Get]:ge(Ae(1,1/0),Py),[ut.Var]:ge(Ae(1,1),IL),[ut.Has]:ge(Ae(1,1/0),Py),[ut.Id]:ge(NL,ql),[ut.Concat]:ge(Ae(2,1/0),He(rn)),[ut.GeometryType]:ge(FL,ql),[ut.LineMetric]:ge(ql),[ut.Resolution]:ge(Z0,ql),[ut.Zoom]:ge(Z0,ql),[ut.Time]:ge(Z0,ql),[ut.Any]:ge(Ae(2,1/0),He(nn)),[ut.All]:ge(Ae(2,1/0),He(nn)),[ut.Not]:ge(Ae(1,1),He(nn)),[ut.Equal]:ge(Ae(2,2),He(Uf)),[ut.NotEqual]:ge(Ae(2,2),He(Uf)),[ut.GreaterThan]:ge(Ae(2,2),He(Xt)),[ut.GreaterThanOrEqualTo]:ge(Ae(2,2),He(Xt)),[ut.LessThan]:ge(Ae(2,2),He(Xt)),[ut.LessThanOrEqualTo]:ge(Ae(2,2),He(Xt)),[ut.Multiply]:ge(Ae(2,1/0),Ry),[ut.Coalesce]:ge(Ae(2,1/0),Ry),[ut.Divide]:ge(Ae(2,2),He(Xt)),[ut.Add]:ge(Ae(2,1/0),He(Xt)),[ut.Subtract]:ge(Ae(2,2),He(Xt)),[ut.Clamp]:ge(Ae(3,3),He(Xt)),[ut.Mod]:ge(Ae(2,2),He(Xt)),[ut.Pow]:ge(Ae(2,2),He(Xt)),[ut.Abs]:ge(Ae(1,1),He(Xt)),[ut.Floor]:ge(Ae(1,1),He(Xt)),[ut.Ceil]:ge(Ae(1,1),He(Xt)),[ut.Round]:ge(Ae(1,1),He(Xt)),[ut.Sin]:ge(Ae(1,1),He(Xt)),[ut.Cos]:ge(Ae(1,1),He(Xt)),[ut.Atan]:ge(Ae(1,2),He(Xt)),[ut.Sqrt]:ge(Ae(1,1),He(Xt)),[ut.Match]:ge(Ae(4,1/0),Iy,OL),[ut.Between]:ge(Ae(3,3),He(Xt)),[ut.Interpolate]:ge(Ae(6,1/0),Iy,DL),[ut.Case]:ge(Ae(3,1/0),kL,BL),[ut.In]:ge(Ae(2,2),GL),[ut.Number]:ge(Ae(1,1/0),He(Uf)),[ut.String]:ge(Ae(1,1/0),He(Uf)),[ut.Array]:ge(Ae(1,1/0),He(Xt)),[ut.Color]:ge(Ae(1,4),He(Xt)),[ut.Band]:ge(Ae(1,3),He(Xt)),[ut.Palette]:ge(Ae(2,2),jL),[ut.ToString]:ge(Ae(1,1),He(nn|Xt|rn|Li))};function Py(n,t,e){const i=n.length-1,r=new Array(i);for(let s=0;s<i;++s){const a=n[s+1];switch(typeof a){case"number":{r[s]=new en(Xt,a);break}case"string":{r[s]=new en(rn,a);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${a}`)}s===0&&e.properties.add(String(a))}return r}function IL(n,t,e){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return e.variables.add(i),[new en(rn,i)]}function NL(n,t,e){e.featureId=!0}function FL(n,t,e){e.geometryType=!0}function Z0(n,t,e){e.mapState=!0}function ql(n,t,e){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function Ae(n,t){return function(e,i,r){const s=e[0],a=e.length-1;if(n===t){if(a!==n){const o=n===1?"":"s";throw new Error(`expected ${n} argument${o} for ${s}, got ${a}`)}}else if(a<n||a>t){const o=t===1/0?`${n} or more`:`${n} to ${t}`;throw new Error(`expected ${o} arguments for ${s}, got ${a}`)}}}function Ry(n,t,e){const i=n.length-1,r=new Array(i);for(let s=0;s<i;++s){const a=yn(n[s+1],t,e);r[s]=a}return r}function He(n){return function(t,e,i){const r=t.length-1,s=new Array(r);for(let a=0;a<r;++a){const o=yn(t[a+1],n,i);s[a]=o}return s}}function kL(n,t,e){const i=n[0],r=n.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${r} instead`)}function Iy(n,t,e){const i=n[0],r=n.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${r} instead`)}function OL(n,t,e){const i=n.length-1,r=rn|Xt|nn,s=yn(n[1],r,e),a=yn(n[n.length-1],t,e),o=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const h=yn(n[l+2],s.type,e);o[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=yn(n[l+3],a.type,e);o[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[s,...o,a]}function DL(n,t,e){const i=n[1];let r;switch(i[0]){case"linear":r=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);r=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const s=new en(Xt,r);let a;try{a=yn(n[2],Xt,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const o=new Array(n.length-3);for(let l=0;l<o.length;l+=2){try{const h=yn(n[l+3],Xt,e);o[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=yn(n[l+4],t,e);o[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[s,a,...o]}function BL(n,t,e){const i=yn(n[n.length-1],t,e),r=new Array(n.length-1);for(let s=0;s<r.length-1;s+=2){try{const a=yn(n[s+1],nn,e);r[s]=a}catch(a){throw new Error(`failed to parse argument ${s} of case expression: ${a.message}`)}try{const a=yn(n[s+2],i.type,e);r[s+1]=a}catch(a){throw new Error(`failed to parse argument ${s+1} of case expression: ${a.message}`)}}return r[r.length-1]=i,r}function GL(n,t,e){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],r=rn}else r=Xt;const s=new Array(i.length);for(let o=0;o<s.length;o++)try{const l=yn(i[o],r,e);s[o]=l}catch(l){throw new Error(`failed to parse haystack item ${o} for "in" expression: ${l.message}`)}return[yn(n[1],r,e),...s]}function jL(n,t,e){let i;try{i=yn(n[1],Xt,e)}catch(a){throw new Error(`failed to parse first argument in palette expression: ${a.message}`)}const r=n[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const s=new Array(r.length);for(let a=0;a<s.length;a++){let o;try{o=yn(r[a],Li,e)}catch(l){throw new Error(`failed to parse color at index ${a} in palette expression: ${l.message}`)}if(!(o instanceof en))throw new Error(`the palette color at index ${a} must be a literal value`);s[a]=o}return[i,...s]}function ge(...n){return function(t,e,i){const r=t[0];let s;for(let a=0;a<n.length;a++){const o=n[a](t,e,i);if(a==n.length-1){if(!o)throw new Error("expected last argument validator to return the parsed args");s=o}}return new C5(e,r,...s)}}function UL(n,t,e){const i=n[0],r=RL[i];if(!r)throw new Error(`unknown operator: ${i}`);return r(n,t,e)}function Lg(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Lg(n.getGeometries()[0]);default:return""}}function C1(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Xs(n,t,e){const i=yn(n,t,e);return ms(i)}function ms(n,t){if(n instanceof en){if(n.type===Li&&typeof n.value=="string"){const i=E1(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case ut.Number:case ut.String:case ut.Coalesce:return zL(n);case ut.Get:case ut.Var:case ut.Has:return qL(n);case ut.Id:return i=>i.featureId;case ut.GeometryType:return i=>i.geometryType;case ut.Concat:{const i=n.args.map(r=>ms(r));return r=>"".concat(...i.map(s=>s(r).toString()))}case ut.Resolution:return i=>i.resolution;case ut.Any:case ut.All:case ut.Between:case ut.In:case ut.Not:return WL(n);case ut.Equal:case ut.NotEqual:case ut.LessThan:case ut.LessThanOrEqualTo:case ut.GreaterThan:case ut.GreaterThanOrEqualTo:return VL(n);case ut.Multiply:case ut.Divide:case ut.Add:case ut.Subtract:case ut.Clamp:case ut.Mod:case ut.Pow:case ut.Abs:case ut.Floor:case ut.Ceil:case ut.Round:case ut.Sin:case ut.Cos:case ut.Atan:case ut.Sqrt:return HL(n);case ut.Case:return $L(n);case ut.Match:return XL(n);case ut.Interpolate:return YL(n);case ut.ToString:return KL(n);default:throw new Error(`Unsupported operator ${e}`)}}function zL(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=ms(n.args[s]);switch(e){case ut.Coalesce:return s=>{for(let a=0;a<i;++a){const o=r[a](s);if(typeof o<"u"&&o!==null)return o}throw new Error("Expected one of the values to be non-null")};case ut.Number:case ut.String:return s=>{for(let a=0;a<i;++a){const o=r[a](s);if(typeof o===e)return o}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function qL(n,t){const i=n.args[0].value;switch(n.operator){case ut.Get:return r=>{const s=n.args;let a=r.properties[i];for(let o=1,l=s.length;o<l;++o){const c=s[o].value;a=a[c]}return a};case ut.Var:return r=>r.variables[i];case ut.Has:return r=>{const s=n.args;if(!(i in r.properties))return!1;let a=r.properties[i];for(let o=1,l=s.length;o<l;++o){const c=s[o].value;if(!a||!Object.hasOwn(a,c))return!1;a=a[c]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function VL(n,t){const e=n.operator,i=ms(n.args[0]),r=ms(n.args[1]);switch(e){case ut.Equal:return s=>i(s)===r(s);case ut.NotEqual:return s=>i(s)!==r(s);case ut.LessThan:return s=>i(s)<r(s);case ut.LessThanOrEqualTo:return s=>i(s)<=r(s);case ut.GreaterThan:return s=>i(s)>r(s);case ut.GreaterThanOrEqualTo:return s=>i(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function WL(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=ms(n.args[s]);switch(e){case ut.Any:return s=>{for(let a=0;a<i;++a)if(r[a](s))return!0;return!1};case ut.All:return s=>{for(let a=0;a<i;++a)if(!r[a](s))return!1;return!0};case ut.Between:return s=>{const a=r[0](s),o=r[1](s),l=r[2](s);return a>=o&&a<=l};case ut.In:return s=>{const a=r[0](s);for(let o=1;o<i;++o)if(a===r[o](s))return!0;return!1};case ut.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function HL(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=ms(n.args[s]);switch(e){case ut.Multiply:return s=>{let a=1;for(let o=0;o<i;++o)a*=r[o](s);return a};case ut.Divide:return s=>r[0](s)/r[1](s);case ut.Add:return s=>{let a=0;for(let o=0;o<i;++o)a+=r[o](s);return a};case ut.Subtract:return s=>r[0](s)-r[1](s);case ut.Clamp:return s=>{const a=r[0](s),o=r[1](s);if(a<o)return o;const l=r[2](s);return a>l?l:a};case ut.Mod:return s=>r[0](s)%r[1](s);case ut.Pow:return s=>Math.pow(r[0](s),r[1](s));case ut.Abs:return s=>Math.abs(r[0](s));case ut.Floor:return s=>Math.floor(r[0](s));case ut.Ceil:return s=>Math.ceil(r[0](s));case ut.Round:return s=>Math.round(r[0](s));case ut.Sin:return s=>Math.sin(r[0](s));case ut.Cos:return s=>Math.cos(r[0](s));case ut.Atan:return i===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case ut.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function $L(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=ms(n.args[r]);return r=>{for(let s=0;s<e-1;s+=2)if(i[s](r))return i[s+1](r);return i[e-1](r)}}function XL(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=ms(n.args[r]);return r=>{const s=i[0](r);for(let a=1;a<e-1;a+=2)if(s===i[a](r))return i[a+1](r);return i[e-1](r)}}function YL(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=ms(n.args[r]);return r=>{const s=i[0](r),a=i[1](r);let o,l;for(let h=2;h<e;h+=2){const c=i[h](r);let u=i[h+1](r);const d=Array.isArray(u);if(d&&(u=CL(u)),c>=a)return h===2?u:d?ZL(s,a,o,l,c,u):Bc(s,a,o,l,c,u);o=c,l=u}return l}}function KL(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=ms(n.args[s]);switch(e){case ut.ToString:return s=>{const a=r[0](s);return n.args[0].type===Li?S1(a):a.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Bc(n,t,e,i,r,s){const a=r-e;if(a===0)return i;const o=t-e,l=n===1?o/a:(Math.pow(n,o)-1)/(Math.pow(n,a)-1);return i+l*(s-i)}function ZL(n,t,e,i,r,s){if(r-e===0)return i;const o=Ty(i),l=Ty(s);let h=l[2]-o[2];h>180?h-=360:h<-180&&(h+=360);const c=[Bc(n,t,e,o[0],r,l[0]),Bc(n,t,e,o[1],r,l[1]),o[2]+Bc(n,t,e,0,r,h),Bc(n,t,e,i[3],r,s[3])];return AL(c)}const me={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function JL(n,t,e){const i=n;let r=!0,s=!1,a=!1;const o=[Ed(i,ie.LOAD,function(){a=!0,s||t()})];return i.src&&Fv?(s=!0,i.decode().then(function(){r&&t()}).catch(function(l){r&&(a?t():e())})):o.push(Ed(i,ie.ERROR,e)),function(){r=!1,o.forEach(ai)}}function QL(n,t){return new Promise((e,i)=>{function r(){a(),e(n)}function s(){a(),i(new Error("Image load error"))}function a(){n.removeEventListener("load",r),n.removeEventListener("error",s)}n.addEventListener("load",r),n.addEventListener("error",s),t&&(n.src=t)})}function tC(n,t){return t&&(n.src=t),n.src&&Fv?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(r=>n.complete&&n.width?e(n):i(r))):QL(n)}class eC{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const r=J0(t,e,i);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,i){const r=J0(t,e,i);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,i,r,s){const a=J0(t,e,i),o=a in this.cache_;this.cache_[a]=r,s&&(r.getImageState()===me.IDLE&&r.load(),r.getImageState()===me.LOADING?r.ready().then(()=>{this.patternCache_[a]=Nd().createPattern(r.getImage(1),"repeat")}):this.patternCache_[a]=Nd().createPattern(r.getImage(1),"repeat")),o||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function J0(n,t,e){const i=e?Hr(e):"null";return t+":"+n+":"+i}const jr=new eC;let Mc=null;class A5 extends og{constructor(t,e,i,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=r===void 0?me.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===me.LOADED){Mc||(Mc=Ji(1,1,void 0,{willReadFrequently:!0})),Mc.drawImage(this.image_,0,0);try{Mc.getImageData(0,0,1,1),this.tainted_=!1}catch{Mc=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ie.CHANGE)}handleImageError_(){this.imageState_=me.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=me.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Ji(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===me.IDLE){this.image_||this.initializeImage_(),this.imageState_=me.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&tC(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==me.LOADED)return;const e=this.image_,i=Ji(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=fs(this.color_),i.fillRect(0,0,r.width/t,r.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===me.LOADED||this.imageState_===me.ERROR)t();else{const e=()=>{(this.imageState_===me.LOADED||this.imageState_===me.ERROR)&&(this.removeEventListener(ie.CHANGE,e),t())};this.addEventListener(ie.CHANGE,e)}})),this.ready_}}function A1(n,t,e,i,r,s){let a=t===void 0?void 0:jr.get(t,e,r);return a||(a=new A5(n,n&&"src"in n?n.src||void 0:t,e,i,r),jr.set(t,e,r,a,s)),s&&a&&!jr.getPattern(t,e,r)&&jr.set(t,e,r,a,s),a}function Ns(n){return n?Array.isArray(n)?S1(n):typeof n=="object"&&"src"in n?iC(n):n:null}function iC(n){if(!n.offset||!n.size)return jr.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=jr.getPattern(t,void 0,n.color);if(e)return e;const i=jr.get(n.src,"anonymous",null);if(i.getImageState()!==me.LOADED)return null;const r=Ji(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),A1(r.canvas,t,void 0,me.LOADED,n.color,!0),jr.getPattern(t,void 0,n.color)}const T5="10px sans-serif",lr="#000",kh="round",xa=[],ba=0,Oh="round",cu=10,uu="#000",fu="center",kd="middle",Go=[0,0,0,0],du=1,fa=new Ar;let eh=null,ep;const ip={},nC=function(){const t="32px ",e=["monospace","serif"],i=e.length,r="wmytzilWMYTZIL@#/&?$%10";let s,a;function o(h,c,u){let d=!0;for(let g=0;g<i;++g){const p=e[g];if(a=Od(h+" "+c+" "+t+p,r),u!=p){const y=Od(h+" "+c+" "+t+u+","+p,r);d=d&&y!=a}}return!!d}function l(){let h=!0;const c=fa.getKeys();for(let u=0,d=c.length;u<d;++u){const g=c[u];if(fa.get(g)<100){const[p,y,w]=g.split(`
`);o(p,y,w)?(rl(ip),eh=null,ep=void 0,fa.set(g,100)):(fa.set(g,fa.get(g)+1,!0),h=!1)}}h&&(clearInterval(s),s=void 0)}return function(h){const c=g5(h);if(!c)return;const u=c.families;for(let d=0,g=u.length;d<g;++d){const p=u[d],y=c.style+`
`+c.weight+`
`+p;fa.get(y)===void 0&&(fa.set(y,100,!0),o(c.style,c.weight,p)||(fa.set(y,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),rC=function(){let n;return function(t){let e=ip[t];if(e==null){if(Nv){const i=g5(t),r=M5(t,"g");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);ip[t]=e}return e}}();function M5(n,t){return eh||(eh=Ji(1,1)),n!=ep&&(eh.font=n,ep=eh.font),eh.measureText(t)}function Od(n,t){return M5(n,t).width}function Ny(n,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((r,s)=>Math.max(r,Od(n,s)),0);return e[t]=i,i}function sC(n,t){const e=[],i=[],r=[];let s=0,a=0,o=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){s=Math.max(s,a),r.push(a),a=0,o+=l,l=0;continue}const d=t[h+1]||n.font,g=Od(d,u);e.push(g),a+=g;const p=rC(d);i.push(p),l=Math.max(l,p)}return{width:s,height:o,widths:e,heights:i,lineWidths:r}}function aC(n,t,e,i,r,s,a,o,l,h,c){n.save(),e!==1&&(n.globalAlpha===void 0?n.globalAlpha=u=>u.globalAlpha*=e:n.globalAlpha*=e),t&&n.transform.apply(n,t),i.contextInstructions?(n.translate(l,h),n.scale(c[0],c[1]),oC(i,n)):c[0]<0||c[1]<0?(n.translate(l,h),n.scale(c[0],c[1]),n.drawImage(i,r,s,a,o,0,0,a,o)):n.drawImage(i,r,s,a,o,l,h,a*c[0],o*c[1]),n.restore()}function oC(n,t){const e=n.contextInstructions;for(let i=0,r=e.length;i<r;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class Cg{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Dn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Cg({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return he()}getImage(t){return he()}getHitDetectionImage(){return he()}getPixelRatio(t){return 1}getImageState(){return he()}getImageSize(){return he()}getOrigin(){return he()}getSize(){return he()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Dn(t)}listenImageChange(t){he()}load(){he()}unlistenImageChange(t){he()}ready(){return Promise.resolve()}}class Wo extends Cg{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?me.LOADING:me.LOADED,this.imageState_===me.LOADING&&this.ready().then(()=>this.imageState_=me.LOADED),this.render()}clone(){const t=this.getScale(),e=new Wo({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var s,a;const e=(s=this.fill_)==null?void 0:s.getKey(),i=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let r=(a=jr.get(i,null,null))==null?void 0:a.getImage(1);if(!r){const o=this.renderOptions_,l=Math.ceil(o.size*t),h=Ji(l,l);this.draw_(o,h,t),r=h.canvas,jr.set(i,null,null,new A5(r,void 0,null,me.LOADED,null))}return r}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const j=r;r=s,s=j}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,l=s*Math.sin(o),h=Math.sqrt(s*s-l*l),c=r-h,u=Math.sqrt(l*l+c*c),d=u/l;if(t==="miter"&&d<=i)return d*e;const g=e/2/d,p=e/2*(c/u),w=Math.sqrt((r+g)*(r+g)+p*p)-r;if(this.radius2_===void 0||t==="bevel")return w*2;const x=r*Math.sin(o),b=Math.sqrt(r*r-x*x),L=s-b,R=Math.sqrt(x*x+L*L)/x;if(R<=i){const j=R*e/2-s-r;return 2*Math.max(w,j)}return w*2}createRenderOptions(){let t=kh,e=Oh,i=0,r=null,s=0,a,o=0;this.stroke_&&(a=Ns(this.stroke_.getColor()??uu),o=this.stroke_.getWidth()??du,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Oh,t=this.stroke_.getLineCap()??kh,i=this.stroke_.getMiterLimit()??cu);const l=this.calculateLineJoinSize_(e,o,i),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:a,strokeWidth:o,size:c,lineCap:t,lineDash:r,lineDashOffset:s,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=lr),e.fillStyle=Ns(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=Hr(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(e=Ji(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let o=0;o<e;o++){const l=s+o*a,h=o%2===0?i:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=lr,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class T1 extends Wo{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new T1({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}const fr=T1;class M1{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new M1({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=A1(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===me.IDLE&&e.load(),e.getImageState()===me.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?Ht(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:Hr(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const Ne=M1;function Fy(n,t,e,i){return e!==void 0&&i!==void 0?[e/n,i/t]:e!==void 0?e/n:i!==void 0?i/t:1}class vn extends Cg{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;let o=t.src;Be(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||Ht(a)),Be(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),Be(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=me.IDLE:a!==void 0&&("complete"in a?a.complete?l=a.src?me.LOADED:me.IDLE:l=me.LOADING:l=me.LOADED),this.color_=t.color!==void 0?Hr(t.color):null,this.iconImage_=A1(a,o,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(Fy(g[0],g[1],t.width,t.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(Fy(h,c,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new vn({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==me.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==me.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(ie.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(ie.CHANGE,t)}ready(){return this.iconImage_.ready()}}class fe{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new fe({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class oo{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=ky,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new oo({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=ky,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function lC(n){let t;if(typeof n=="function")t=n;else{let e;Array.isArray(n)?e=n:(Be(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[n]),t=function(){return e}}return t}let Q0=null;function P5(n,t){if(!Q0){const e=new Ne({color:"rgba(255,255,255,0.4)"}),i=new fe({color:"#3399CC",width:1.25});Q0=[new oo({image:new fr({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return Q0}function P1(){const n={},t=[255,255,255,1],e=[0,153,255,1],i=3;return n.Polygon=[new oo({fill:new Ne({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new oo({stroke:new fe({color:t,width:i+2})}),new oo({stroke:new fe({color:e,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new oo({image:new fr({radius:i*2,fill:new Ne({color:e}),stroke:new fe({color:t,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function ky(n){return n.getGeometry()}const Zt=oo,hC="#333";class Sr{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Dn(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Ne({color:hC}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Sr({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Dn(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function cC(n){return!0}function uC(n){const t=Sg(),e=fC(n,t),i=C1();return function(r,s){if(i.properties=r.getPropertiesInternal(),i.resolution=s,t.featureId){const a=r.getId();a!==void 0?i.featureId=a:i.featureId=null}return t.geometryType&&(i.geometryType=Lg(r.getGeometry())),e(i)}}function Oy(n){const t=Sg(),e=n.length,i=new Array(e);for(let a=0;a<e;++a)i[a]=np(n[a],t);const r=C1(),s=new Array(e);return function(a,o){if(r.properties=a.getPropertiesInternal(),r.resolution=o,t.featureId){const h=a.getId();h!==void 0?r.featureId=h:r.featureId=null}let l=0;for(let h=0;h<e;++h){const c=i[h](r);c&&(s[l]=c,l+=1)}return s.length=l,s}}function fC(n,t){const e=n.length,i=new Array(e);for(let r=0;r<e;++r){const s=n[r],a="filter"in s?Xs(s.filter,nn,t):cC;let o;if(Array.isArray(s.style)){const l=s.style.length;o=new Array(l);for(let h=0;h<l;++h)o[h]=np(s.style[h],t)}else o=[np(s.style,t)];i[r]={filter:a,styles:o}}return function(r){const s=[];let a=!1;for(let o=0;o<e;++o){const l=i[o].filter;if(l(r)&&!(n[o].else&&a)){a=!0;for(const h of i[o].styles){const c=h(r);c&&s.push(c)}}}return s}}function np(n,t){const e=gu(n,"",t),i=mu(n,"",t),r=dC(n,t),s=gC(n,t),a=cr(n,"z-index",t);if(!e&&!i&&!r&&!s&&!Xo(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const o=new Zt;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),o.setFill(c)}if(i){const c=i(l);c&&(h=!1),o.setStroke(c)}if(r){const c=r(l);c&&(h=!1),o.setText(c)}if(s){const c=s(l);c&&(h=!1),o.setImage(c)}return a&&o.setZIndex(a(l)),h?null:o}}function gu(n,t,e){let i;if(t+"fill-pattern-src"in n)i=yC(n,t+"fill-",e);else{if(n[t+"fill-color"]==="none")return s=>null;i=R1(n,t+"fill-color",e)}if(!i)return null;const r=new Ne;return function(s){const a=i(s);return a===b1?null:(r.setColor(a),r)}}function mu(n,t,e){const i=cr(n,t+"stroke-width",e),r=R1(n,t+"stroke-color",e);if(!i&&!r)return null;const s=ma(n,t+"stroke-line-cap",e),a=ma(n,t+"stroke-line-join",e),o=R5(n,t+"stroke-line-dash",e),l=cr(n,t+"stroke-line-dash-offset",e),h=cr(n,t+"stroke-miter-limit",e),c=new fe;return function(u){if(r){const d=r(u);if(d===b1)return null;c.setColor(d)}if(i&&c.setWidth(i(u)),s){const d=s(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(a){const d=a(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return o&&c.setLineDash(o(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function dC(n,t){const e="text-",i=ma(n,e+"value",t);if(!i)return null;const r=gu(n,e,t),s=gu(n,e+"background-",t),a=mu(n,e,t),o=mu(n,e+"background-",t),l=ma(n,e+"font",t),h=cr(n,e+"max-angle",t),c=cr(n,e+"offset-x",t),u=cr(n,e+"offset-y",t),d=vh(n,e+"overflow",t),g=ma(n,e+"placement",t),p=cr(n,e+"repeat",t),y=Ag(n,e+"scale",t),w=vh(n,e+"rotate-with-view",t),x=cr(n,e+"rotation",t),b=ma(n,e+"align",t),L=ma(n,e+"justify",t),P=ma(n,e+"baseline",t),R=vh(n,e+"keep-upright",t),j=R5(n,e+"padding",t),k=Tg(n,e+"declutter-mode"),T=new Sr({declutterMode:k});return function(q){if(T.setText(i(q)),r&&T.setFill(r(q)),s&&T.setBackgroundFill(s(q)),a&&T.setStroke(a(q)),o&&T.setBackgroundStroke(o(q)),l&&T.setFont(l(q)),h&&T.setMaxAngle(h(q)),c&&T.setOffsetX(c(q)),u&&T.setOffsetY(u(q)),d&&T.setOverflow(d(q)),g){const W=g(q);if(W!=="point"&&W!=="line")throw new Error("Expected point or line for text-placement");T.setPlacement(W)}if(p&&T.setRepeat(p(q)),y&&T.setScale(y(q)),w&&T.setRotateWithView(w(q)),x&&T.setRotation(x(q)),b){const W=b(q);if(W!=="left"&&W!=="center"&&W!=="right"&&W!=="end"&&W!=="start")throw new Error("Expected left, right, center, start, or end for text-align");T.setTextAlign(W)}if(L){const W=L(q);if(W!=="left"&&W!=="right"&&W!=="center")throw new Error("Expected left, right, or center for text-justify");T.setJustify(W)}if(P){const W=P(q);if(W!=="bottom"&&W!=="top"&&W!=="middle"&&W!=="alphabetic"&&W!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");T.setTextBaseline(W)}return j&&T.setPadding(j(q)),R&&T.setKeepUpright(R(q)),T}}function gC(n,t){return"icon-src"in n?mC(n,t):"shape-points"in n?pC(n,t):"circle-radius"in n?_C(n,t):null}function mC(n,t){const e="icon-",i=e+"src",r=I5(n[i],i),s=Dd(n,e+"anchor",t),a=Ag(n,e+"scale",t),o=cr(n,e+"opacity",t),l=Dd(n,e+"displacement",t),h=cr(n,e+"rotation",t),c=vh(n,e+"rotate-with-view",t),u=By(n,e+"anchor-origin"),d=Gy(n,e+"anchor-x-units"),g=Gy(n,e+"anchor-y-units"),p=bC(n,e+"color"),y=wC(n,e+"cross-origin"),w=xC(n,e+"offset"),x=By(n,e+"offset-origin"),b=Bd(n,e+"width"),L=Bd(n,e+"height"),P=vC(n,e+"size"),R=Tg(n,e+"declutter-mode"),j=new vn({src:r,anchorOrigin:u,anchorXUnits:d,anchorYUnits:g,color:p,crossOrigin:y,offset:w,offsetOrigin:x,height:L,width:b,size:P,declutterMode:R});return function(k){return o&&j.setOpacity(o(k)),l&&j.setDisplacement(l(k)),h&&j.setRotation(h(k)),c&&j.setRotateWithView(c(k)),a&&j.setScale(a(k)),s&&j.setAnchor(s(k)),j}}function pC(n,t){const e="shape-",i=e+"points",r=e+"radius",s=rp(n[i],i),a=rp(n[r],r),o=gu(n,e,t),l=mu(n,e,t),h=Ag(n,e+"scale",t),c=Dd(n,e+"displacement",t),u=cr(n,e+"rotation",t),d=vh(n,e+"rotate-with-view",t),g=Bd(n,e+"radius2"),p=Bd(n,e+"angle"),y=Tg(n,e+"declutter-mode"),w=new Wo({points:s,radius:a,radius2:g,angle:p,declutterMode:y});return function(x){return o&&w.setFill(o(x)),l&&w.setStroke(l(x)),c&&w.setDisplacement(c(x)),u&&w.setRotation(u(x)),d&&w.setRotateWithView(d(x)),h&&w.setScale(h(x)),w}}function _C(n,t){const e="circle-",i=gu(n,e,t),r=mu(n,e,t),s=cr(n,e+"radius",t),a=Ag(n,e+"scale",t),o=Dd(n,e+"displacement",t),l=cr(n,e+"rotation",t),h=vh(n,e+"rotate-with-view",t),c=Tg(n,e+"declutter-mode"),u=new fr({radius:5,declutterMode:c});return function(d){return s&&u.setRadius(s(d)),i&&u.setFill(i(d)),r&&u.setStroke(r(d)),o&&u.setDisplacement(o(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),a&&u.setScale(a(d)),u}}function cr(n,t,e){if(!(t in n))return;const i=Xs(n[t],Xt,e);return function(r){return rp(i(r),t)}}function ma(n,t,e){if(!(t in n))return null;const i=Xs(n[t],rn,e);return function(r){return I5(i(r),t)}}function yC(n,t,e){const i=ma(n,t+"pattern-src",e),r=Dy(n,t+"pattern-offset",e),s=Dy(n,t+"pattern-size",e),a=R1(n,t+"color",e);return function(o){return{src:i(o),offset:r&&r(o),size:s&&s(o),color:a&&a(o)}}}function vh(n,t,e){if(!(t in n))return null;const i=Xs(n[t],nn,e);return function(r){const s=i(r);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function R1(n,t,e){if(!(t in n))return null;const i=Xs(n[t],Li,e);return function(r){return N5(i(r),t)}}function R5(n,t,e){if(!(t in n))return null;const i=Xs(n[t],Zn,e);return function(r){return Ru(i(r),t)}}function Dd(n,t,e){if(!(t in n))return null;const i=Xs(n[t],Zn,e);return function(r){const s=Ru(i(r),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function Dy(n,t,e){if(!(t in n))return null;const i=Xs(n[t],Zn,e);return function(r){return F5(i(r),t)}}function Ag(n,t,e){if(!(t in n))return null;const i=Xs(n[t],Zn|Xt,e);return function(r){return EC(i(r),t)}}function Bd(n,t){const e=n[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function vC(n,t){const e=n[t];if(e!==void 0){if(typeof e=="number")return Dn(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function wC(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function By(n,t){const e=n[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function Gy(n,t){const e=n[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function xC(n,t){const e=n[t];if(e!==void 0)return Ru(e,t)}function Tg(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function bC(n,t){const e=n[t];if(e!==void 0)return N5(e,t)}function Ru(n,t){if(!Array.isArray(n))throw new Error(`Expected an array for ${t}`);const e=n.length;for(let i=0;i<e;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return n}function I5(n,t){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}function rp(n,t){if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}function N5(n,t){if(typeof n=="string")return n;const e=Ru(n,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function F5(n,t){const e=Ru(n,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function EC(n,t){return typeof n=="number"?n:F5(n,t)}const jy={RENDER_ORDER:"renderOrder"};class Iu extends $h{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(jy.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new S5(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(jy.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?P5:t;const e=SC(t);this.styleFunction_=t===null?void 0:lC(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function SC(n){if(n===void 0)return P5;if(!n)return null;if(typeof n=="function"||n instanceof Zt)return n;if(!Array.isArray(n))return Oy([n]);if(n.length===0)return[];const t=n.length,e=n[0];if(e instanceof Zt){const r=new Array(t);for(let s=0;s<t;++s){const a=n[s];if(!(a instanceof Zt))throw new Error("Expected a list of style instances");r[s]=a}return r}if("style"in e){const r=new Array(t);for(let s=0;s<t;++s){const a=n[s];if(!("style"in a))throw new Error("Expected a list of rules with a style property");r[s]=a}return uC(r)}return Oy(n)}class $c extends Cr{constructor(t,e,i,r){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=r}}class LC extends Su{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){he()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;Wr(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ou(r,i)}forEachFeatureAtCoordinate(t,e,i,r,s,a,o,l){let h;const c=e.viewState;function u(P,R,j,k){return s.call(a,R,P?j:null,k)}const d=c.projection,g=ug(t.slice(),d),p=[[0,0]];if(d.canWrapX()&&r){const P=d.getExtent(),R=ke(P);p.push([-R,0],[R,0])}const y=e.layerStatesArray,w=y.length,x=[],b=[];for(let P=0;P<p.length;P++)for(let R=w-1;R>=0;--R){const j=y[R],k=j.layer;if(k.hasRenderer()&&x1(j,c)&&o.call(l,k)){const T=k.getRenderer(),q=k.getSource();if(T&&q){const W=q.getWrapX()?g:t,F=u.bind(null,j.managed);b[0]=W[0]+p[P][0],b[1]=W[1]+p[P][1],h=T.forEachFeatureAtCoordinate(b,e,i,F,x)}if(h)return h}}if(x.length===0)return;const L=1/x.length;return x.forEach((P,R)=>P.distanceSq+=R*L),x.sort((P,R)=>P.distanceSq-R.distanceSq),x.some(P=>h=P.callback(P.feature,P.layer,P.geometry)),h}hasFeatureAtCoordinate(t,e,i,r,s,a){return this.forEachFeatureAtCoordinate(t,e,i,r,Sa,this,s,a)!==void 0}getMap(){return this.map_}renderFrame(t){he()}scheduleExpireIconCache(t){jr.canExpireCache()&&t.postRenderFunctions.push(CC)}}function CC(n,t){jr.expire()}class AC extends LC{constructor(t){super(t),this.fontChangeListenerKey_=ve(fa,Ph.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=ll+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const r=new $c(t,void 0,e);i.dispatchEvent(r)}}disposeInternal(){ai(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(pn.PRECOMPOSE,t);const e=t.layerStatesArray.sort((o,l)=>o.zIndex-l.zIndex);e.some(o=>o.layer instanceof Iu&&o.layer.getDeclutter())&&(t.declutter={});const r=t.viewState;this.children_.length=0;const s=[];let a=null;for(let o=0,l=e.length;o<l;++o){const h=e[o];t.layerIndex=o;const c=h.layer,u=c.getSourceState();if(!x1(h,r)||u!="ready"&&u!="undefined"){c.unrender();continue}const d=c.render(t,a);d&&(d!==a&&(this.children_.push(d),a=d),s.push(h))}this.declutter(t,s),jS(this.element_,this.children_),this.dispatchRenderEvent(pn.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let i=e.length-1;i>=0;--i){const r=e[i],s=r.layer;s.getDeclutter()&&s.renderDeclutter(t,r)}e.forEach(i=>i.layer.renderDeferred(t))}}}function k5(n){if(n instanceof $h){n.setMapInternal(null);return}n instanceof Qn&&n.getLayers().forEach(k5)}function O5(n,t){if(n instanceof $h){n.setMapInternal(t);return}if(n instanceof Qn){const e=n.getLayers().getArray();for(let i=0,r=e.length;i<r;++i)O5(e[i],t)}}let TC=class extends Ar{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=MC(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:aE,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Zi(),this.pixelToCoordinateTransform_=Zi(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||p5(),this.interactions=e.interactions||x5({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new hE(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(fn.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(fn.VIEW,this.handleViewChanged_),this.addChangeListener(fn.SIZE,this.handleSizeChanged_),this.addChangeListener(fn.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof kr)&&t.view.then(function(r){i.setView(new kr(r))}),this.controls.addEventListener(Ki.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Ki.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Ki.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Ki.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Ki.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Ki.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){O5(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,a=i.layerFilter!==void 0?i.layerFilter:Sa,o=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,o,e,null,a,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(r){i.push(r)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(r){r instanceof Qn?e(r.getLayers()):t.push(r)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const r=e.layerFilter!==void 0?e.layerFilter:Sa,s=e.hitTolerance!==void 0?e.hitTolerance:0,a=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,a,r,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=i.width/r[0],a=i.height/r[1],o="changedTouches"in t?t.changedTouches[0]:t;return[(o.clientX-i.left)/s,(o.clientY-i.top)/a]}getTarget(){return this.get(fn.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Jo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Pi(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(fn.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof On){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const r=t[e];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const a=r.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Mi(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Pi(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(fn.SIZE)}getView(){return this.get(fn.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,r){return cE(this.frameState_,t,e,i,r)}handleBrowserEvent(t,e){e=e||t.type;const i=new Ms(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===su.POINTERDOWN||i===ie.WHEEL||i===ie.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,a=e.target,o=s instanceof ShadowRoot?s.host===a?s.host.ownerDocument:s:s===r?r.documentElement:s;if(this.overlayContainerStopEvent_.contains(a)||!o.contains(a))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const a=r[s];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let r=this.maxTilesLoading_,s=r;if(t){const a=t.viewHints;if(a[vi.ANIMATING]||a[vi.INTERACTING]){const o=Date.now()-t.time>8;r=o?0:8,s=o?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(pn.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(pn.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ql(ga.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ql(ga.LOADSTART,this,t))));const i=this.postRenderFunctions_;if(t)for(let r=0,s=i.length;r<s;++r)i[r](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)ai(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ie.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ie.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new AC(this)),this.mapBrowserEventHandler_=new oE(this,this.moveTolerance_);for(const s in Ie)this.mapBrowserEventHandler_.addEventListener(Ie[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ie.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ie.WHEEL,this.boundHandleBrowserEvent_,kv?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const s=e.getRootNode();i=s instanceof ShadowRoot?s.host:e}this.targetChangeHandlerKeys_=[ve(i,ie.KEYDOWN,this.handleBrowserEvent,this),ve(i,ie.KEYPRESS,this.handleBrowserEvent,this)];const r=e.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(ai(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ai(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ve(t,Ph.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ve(t,ie.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ai),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new eo("addlayer",t)),this.layerGroupPropertyListenerKeys_=[ve(t,Ph.PROPERTYCHANGE,this.render,this),ve(t,ie.CHANGE,this.render,this),ve(t,"addlayer",this.handleLayerAdd_,this),ve(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){k5(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),r=this.frameState_;let s=null;if(e!==void 0&&My(e)&&i&&i.isDef()){const a=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Wm(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:o,viewHints:a,wantedTiles:{},mapId:Ht(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const l=isNaN(o.nextRotation)?o.rotation:o.nextRotation;s.nextExtent=Wm(o.nextCenter,o.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!Wh(this.previousExtent_)&&!Ko(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Ql(ga.MOVESTART,this,r)),this.previousExtent_=Vh(this.previousExtent_)),this.previousExtent_&&!s.viewHints[vi.ANIMATING]&&!s.viewHints[vi.INTERACTING]&&!Ko(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Ql(ga.MOVEEND,this,s)),Ov(s.extent,this.previousExtent_))),this.dispatchEvent(new Ql(ga.POSTRENDER,this,s)),this.renderComplete_=(this.hasListener(ga.LOADSTART)||this.hasListener(ga.LOADEND)||this.hasListener(pn.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new eo("removelayer",e)),this.set(fn.LAYERGROUP,t)}setSize(t){this.set(fn.SIZE,t)}setTarget(t){this.set(fn.TARGET,t)}setView(t){if(!t||t instanceof kr){this.set(fn.VIEW,t);return}this.set(fn.VIEW,new kr);const e=this;t.then(function(i){e.setView(new kr(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const r=getComputedStyle(t),s=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),a=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(a)&&(e=[Math.max(0,s),Math.max(0,a)],!My(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Vv("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!Hs(e,i))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function MC(n){let t=null;n.keyboardEventTarget!==void 0&&(t=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Qn({layers:n.layers});e[fn.LAYERGROUP]=i,e[fn.TARGET]=n.target,e[fn.VIEW]=n.view instanceof kr?n.view:new kr;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new On(n.controls.slice()):(Be(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls));let s;n.interactions!==void 0&&(Array.isArray(n.interactions)?s=new On(n.interactions.slice()):(Be(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=n.interactions));let a;return n.overlays!==void 0?Array.isArray(n.overlays)?a=new On(n.overlays.slice()):(Be(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),a=n.overlays):a=new On,{controls:r,interactions:s,keyboardEventTarget:t,overlays:a,values:e}}const PC=TC;class I1 extends Ar{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new I1(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ai(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ve(t,ie.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?RC(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function RC(n){if(typeof n=="function")return n;let t;return Array.isArray(n)?t=n:(Be(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[n]),function(){return t}}const ei=I1;function D5(n,t,e,i){const r=[];let s=Bn();for(let a=0,o=e.length;a<o;++a){const l=e[a];s=Wp(n,t,l[0],i),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return r}function Gd(n,t,e,i,r,s,a){let o,l;const h=(e-t)/i;if(h===1)o=t;else if(h===2)o=t,l=r;else if(h!==0){let c=n[t],u=n[t+1],d=0;const g=[0];for(let w=t+i;w<e;w+=i){const x=n[w],b=n[w+1];d+=Math.sqrt((x-c)*(x-c)+(b-u)*(b-u)),g.push(d),c=x,u=b}const p=r*d,y=Zb(g,p);y<0?(l=(p-g[-y-2])/(g[-y-1]-g[-y-2]),o=t+(-y-2)*i):o=t+y*i}a=a>1?a:2,s=s||new Array(a);for(let c=0;c<a;++c)s[c]=o===void 0?NaN:l===void 0?n[o+c]:br(n[o+c],n[o+i+c],l);return s}function sp(n,t,e,i,r,s){if(e==t)return null;let a;if(r<n[t+i-1])return s?(a=n.slice(t,t+i),a[i-1]=r,a):null;if(n[e-1]<r)return s?(a=n.slice(e-i,e),a[i-1]=r,a):null;if(r==n[t+i-1])return n.slice(t,t+i);let o=t/i,l=e/i;for(;o<l;){const d=o+l>>1;r<n[(d+1)*i-1]?l=d:o=d+1}const h=n[o*i-1];if(r==h)return n.slice((o-1)*i,(o-1)*i+i);const c=n[(o+1)*i-1],u=(r-h)/(c-h);a=[];for(let d=0;d<i-1;++d)a.push(br(n[(o-1)*i+d],n[o*i+d],u));return a.push(r),a}function IC(n,t,e,i,r,s,a){if(a)return sp(n,t,e[e.length-1],i,r,s);let o;if(r<n[i-1])return s?(o=n.slice(0,i),o[i-1]=r,o):null;if(n[n.length-1]<r)return s?(o=n.slice(n.length-i),o[i-1]=r,o):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(r<n[t+i-1])return null;if(r<=n[c-1])return sp(n,t,c,i,r,!1);t=c}}return null}class tl extends bo{constructor(t,e,i){super(),i!==void 0&&e===void 0?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new tl(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const s=this.flatCoordinates,a=t-s[0],o=e-s[1],l=a*a+o*o;if(l<r){if(l===0)for(let h=0;h<this.stride;++h)i[h]=s[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=s[0]+h*a,i[1]=s[1]+h*o;for(let c=2;c<this.stride;++c)i[c]=s[c]}return i.length=this.stride,l}return r}containsXY(t,e){const i=this.flatCoordinates,r=t-i[0],s=e-i[1];return r*r+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return zs(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if(ki(t,e)){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]?!0:Hp(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],r=t.slice();r[e]=r[0]+i;for(let s=1;s<e;++s)r[e+s]=t[s];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let s=r5(r,0,t,this.stride);r[s++]=r[0]+e;for(let a=1,o=this.stride;a<o;++a)r[s++]=r[a];r.length=s,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),r=this.getStride();this.setCenter(t1(i,0,i.length,r,t,e,i)),this.changed()}}tl.prototype.transform;class jd extends e1{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ai),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(ve(t[e],ie.CHANGE,this.changed,this))}clone(){const t=new jd(tm(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<sl(this.getExtent(),t,e))return r;const s=this.geometries_;for(let a=0,o=s.length;a<o;++a)r=s[a].closestPointXY(t,e,i,r);return r}containsXY(t,e){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)if(i[r].containsXY(t,e))return!0;return!1}computeExtent(t){Vh(t);const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)Vc(t,e[i].getExtent());return t}getGeometries(){return tm(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let r=!1;for(let s=0,a=i.length;s<a;++s){const o=i[s],l=o.getSimplifiedGeometry(t);e.push(l),l!==o&&(r=!0)}return r?new jd(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].rotate(t,e);this.changed()}scale(t,e,i){i||(i=qs(this.getExtent()));const r=this.geometries_;for(let s=0,a=r.length;s<a;++s)r[s].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(tm(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function tm(n){return n.map(t=>t.clone())}const Ea=jd;function N1(n,t,e,i){let r=n[t],s=n[t+1],a=0;for(let o=t+i;o<e;o+=i){const l=n[o],h=n[o+1];a+=Math.sqrt((l-r)*(l-r)+(h-s)*(h-s)),r=l,s=h}return a}class wi extends bo{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){ze(this.flatCoordinates,t),this.changed()}clone(){const t=new wi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<sl(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(i1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),r1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r))}forEachSegment(t){return h5(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,sp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Gd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return N1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=xg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new wi(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return bg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wg(this.flatCoordinates,0,t,this.stride),this.changed()}}class Vs extends bo{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const r=t,s=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];ze(s,c.getFlatCoordinates()),a.push(s.length)}const o=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(o,s),this.ends_=a}}appendLineString(t){ze(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Vs(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<sl(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(n1(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),s1(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,IC(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return lu(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new wi(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[];let s=0;for(let a=0,o=e.length;a<o;++a){const l=e[a],h=new wi(t.slice(s,l),i);r.push(h),s=l}return r}getLength(){const t=this.ends_;let e=0,i=0;for(let r=0,s=t.length;r<s;++r)i+=N1(this.flatCoordinates,e,t[r],this.stride),e=t[r];return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const r=this.ends_,s=this.stride;for(let a=0,o=r.length;a<o;++a){const l=r[a],h=Gd(e,i,l,s,.5);ze(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=a5(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new Vs(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return xS(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Tu(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class F1 extends bo{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){ze(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new F1(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<sl(this.getExtent(),t,e))return r;const s=this.flatCoordinates,a=this.stride;for(let o=0,l=s.length;o<l;o+=a){const h=va(t,e,s[o],s[o+1]);if(h<r){r=h;for(let c=0;c<a;++c)i[c]=s[o+c];i.length=a}}return r}getCoordinates(){return ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new fi(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,r=[];for(let s=0,a=t.length;s<a;s+=i){const o=new fi(t.slice(s,s+i),e);r.push(o)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let r=0,s=e.length;r<s;r+=i){const a=e[r],o=e[r+1];if(Vp(t,a,o))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wg(this.flatCoordinates,0,t,this.stride),this.changed()}}const Nu=F1;class $r extends bo{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const r=t,s=[],a=[];for(let o=0,l=r.length;o<l;++o){const h=r[o],c=s.length,u=h.getEnds();for(let d=0,g=u.length;d<g;++d)u[d]+=c;ze(s,h.getFlatCoordinates()),a.push(u)}e=r.length===0?this.getLayout():r[0].getLayout(),t=s,i=a}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ze(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,s=e.length;r<s;++r)e[r]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const i=new $r(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,r){return r<sl(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gS(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mS(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return wS(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return dS(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Zm(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Km(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=D5(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=l5(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Nu(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;f5(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Zm(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=_S(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new $r(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const i=this.endss_[t].slice(),r=i[i.length-1];if(e!==0)for(let s=0,a=i.length;s<a;++s)i[s]-=e;return new Ei(this.flatCoordinates.slice(e,r),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[];let s=0;for(let a=0,o=i.length;a<o;++a){const l=i[a].slice(),h=l[l.length-1];if(s!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=s;const c=new Ei(e.slice(s,h),t,l);r.push(c),s=h}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return bS(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=s5(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const Uy=Zi();class hr{constructor(t,e,i,r,s,a){this.styleFunction,this.extent_,this.id_=a,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?qc(this.flatCoordinates_):Wp(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=qs(this.getExtent());this.flatInteriorPoints_=l1(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=d5(this.flatCoordinates_,this.ends_),e=D5(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=l5(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Gd(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let r=0,s=i.length;r<s;++r){const a=i[r],o=Gd(t,e,a,2,.5);ze(this.flatMidpoints_,o),e=a}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=di(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const r=_n(i)/_n(e);Wr(Uy,i[0],i[3],r,-r,0,0,0),Bs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Uy,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new hr(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Rv((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=xg(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=a5(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,r);break;case"Polygon":r=[],i.length=a1(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,r);break}return r&&(this.simplifiedGeometry_=new hr(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}hr.prototype.getFlatCoordinates=hr.prototype.getOrientedFlatCoordinates;class B5{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=ei,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?di(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=di(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return he()}readFeature(t,e){return he()}readFeatures(t,e){return he()}readGeometry(t,e){return he()}readProjection(t){return he()}writeFeature(t,e){return he()}writeFeatures(t,e){return he()}writeGeometry(t,e){return he()}}function Fu(n,t,e){const i=e?di(e.featureProjection):null,r=e?di(e.dataProjection):null;let s=n;if(i&&r&&!hd(i,r)){t&&(s=n.clone());const a=t?i:r,o=t?r:i;a.getUnits()==="tile-pixels"?s.transform(a,o):s.applyTransform(Fh(a,o))}if(t&&e&&e.decimals!==void 0){const a=Math.pow(10,e.decimals),o=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*a)/a;return l};s===n&&(s=n.clone()),s.applyTransform(o)}return s}const NC={Point:fi,LineString:wi,Polygon:Ei,MultiPoint:Nu,MultiLineString:Vs,MultiPolygon:$r};function FC(n,t,e){return Array.isArray(t[0])?(f5(n,0,t,e)||(n=n.slice(),Zm(n,0,t,e)),n):(c1(n,0,t,e)||(n=n.slice(),Id(n,0,t,e)),n)}function G5(n,t){var s;const e=n.geometry;if(!e)return[];if(Array.isArray(e))return e.map(a=>G5({...n,geometry:a})).flat();const i=e.type==="MultiPolygon"?"Polygon":e.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const r=e.layout.length;return Fu(new hr(i,i==="Polygon"?FC(e.flatCoordinates,e.ends,r):e.flatCoordinates,(s=e.ends)==null?void 0:s.flat(),r,n.properties||{},n.id).enableSimplifyTransformed(),!1,t)}function k1(n,t){if(!n)return null;if(Array.isArray(n)){const i=n.map(r=>k1(r,t));return new Ea(i)}const e=NC[n.type];return Fu(new e(n.flatCoordinates,n.layout||"XY",n.ends),!1,t)}class kC extends B5{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(zf(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(zf(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return he()}readFeaturesFromObject(t,e){return he()}readGeometry(t,e){return this.readGeometryFromObject(zf(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return he()}readProjection(t){return this.readProjectionFromObject(zf(t))}readProjectionFromObject(t){return he()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return he()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return he()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return he()}}function zf(n){if(typeof n=="string"){const t=JSON.parse(n);return t||null}return n!==null?n:null}class Oi extends kC{constructor(t){t=t||{},super(),this.dataProjection=di(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=di(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const r=O1(i.geometry);if(this.featureClass===hr)return G5({geometry:r,id:i.id,properties:i.properties},e);const s=new ei;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&s.setGeometryName(i.geometry_name),s.setGeometry(k1(r,e)),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(t,e){const i=t;let r=null;if(i.type==="FeatureCollection"){const s=t;r=[];const a=s.features;for(let o=0,l=a.length;o<l;++o){const h=this.readFeatureFromObject(a[o],e);h&&r.push(h)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return OC(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=di(e.properties.name);else if(e.type==="EPSG")i=di("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(i.id=r),!t.hasProperties())return i;const s=t.getProperties(),a=t.getGeometry();return a&&(i.geometry=ap(a,e),delete s[t.getGeometryName()]),Xo(s)||(i.properties=s),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let r=0,s=t.length;r<s;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return ap(t,this.adaptOptions(e))}}function O1(n,t){if(!n)return null;let e;switch(n.type){case"Point":{e=BC(n);break}case"LineString":{e=GC(n);break}case"Polygon":{e=qC(n);break}case"MultiPoint":{e=UC(n);break}case"MultiLineString":{e=jC(n);break}case"MultiPolygon":{e=zC(n);break}case"GeometryCollection":{e=DC(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return e}function OC(n,t){const e=O1(n);return k1(e,t)}function DC(n,t){return n.geometries.map(function(i){return O1(i)})}function BC(n){const t=n.coordinates;return{type:"Point",flatCoordinates:t,layout:al(t.length)}}function GC(n){var i;const t=n.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:al(((i=t[0])==null?void 0:i.length)||2)}}function jC(n){var s,a;const t=n.coordinates,e=((a=(s=t[0])==null?void 0:s[0])==null?void 0:a.length)||2,i=[],r=Tu(i,0,t,e);return{type:"MultiLineString",flatCoordinates:i,ends:r,layout:al(e)}}function UC(n){var e;const t=n.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:al(((e=t[0])==null?void 0:e.length)||2)}}function zC(n){var s,a;const t=n.coordinates,e=[],i=((a=(s=t[0])==null?void 0:s[0])==null?void 0:a[0].length)||2,r=s5(e,0,t,i);return{type:"MultiPolygon",flatCoordinates:e,ends:r,layout:al(i)}}function qC(n){var s,a;const t=n.coordinates,e=[],i=(a=(s=t[0])==null?void 0:s[0])==null?void 0:a.length,r=Tu(e,0,t,i);return{type:"Polygon",flatCoordinates:e,ends:r,layout:al(i)}}function ap(n,t){n=Fu(n,!0,t);const e=n.getType();let i;switch(e){case"Point":{i=YC(n);break}case"LineString":{i=WC(n);break}case"Polygon":{i=KC(n,t);break}case"MultiPoint":{i=$C(n);break}case"MultiLineString":{i=HC(n);break}case"MultiPolygon":{i=XC(n,t);break}case"GeometryCollection":{i=VC(n,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function VC(n,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return ap(i,t)})}}function WC(n,t){return{type:"LineString",coordinates:n.getCoordinates()}}function HC(n,t){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function $C(n,t){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function XC(n,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(e)}}function YC(n,t){return{type:"Point",coordinates:n.getCoordinates()}}function KC(n,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(e)}}const zy="http://www.w3.org/2001/XMLSchema-instance";function ku(n,t){return Mg().createElementNS(n,t)}function Ys(n,t){return j5(n,t,[]).join("")}function j5(n,t,e){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)t?e.push(String(n.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(n.nodeValue);else{let i;for(i=n.firstChild;i;i=i.nextSibling)j5(i,t,e)}return e}function _a(n){return"documentElement"in n}function ya(n){return new DOMParser().parseFromString(n,"application/xml")}function qy(n,t){return function(e,i){const r=n.call(t??this,e,i);if(r!==void 0){const s=i[i.length-1];ze(s,r)}}}function Rs(n,t){return function(e,i){const r=n.call(t??this,e,i);r!==void 0&&i[i.length-1].push(r)}}function D1(n,t){return function(e,i){const r=n.call(t??this,e,i);r!==void 0&&(i[i.length-1]=r)}}function Sn(n,t,e){return function(i,r){const s=n.call(e??this,i,r);if(s!==void 0){const a=r[r.length-1],o=t!==void 0?t:i.localName;let l;o in a?l=a[o]:(l=[],a[o]=l),l.push(s)}}}function vt(n,t,e){return function(i,r){const s=n.call(e??this,i,r);if(s!==void 0){const a=r[r.length-1],o=t!==void 0?t:i.localName;a[o]=s}}}function re(n,t){return function(e,i,r){n.call(t??this,e,i,r),r[r.length-1].node.appendChild(e)}}function Aa(n,t){return function(e,i,r){const a=i[i.length-1].node;let o=n;o===void 0&&(o=r);const l=t!==void 0?t:a.namespaceURI;return ku(l,o)}}const qr=Aa();function ps(n,t){const e=t.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=n[t[r]];return i}function Dt(n,t,e){e=e!==void 0?e:{};let i,r;for(i=0,r=n.length;i<r;++i)e[n[i]]=t;return e}function Xh(n,t,e,i){let r;for(r=t.firstElementChild;r;r=r.nextElementSibling){const s=n[r.namespaceURI];if(s!==void 0){const a=s[r.localName];a!==void 0&&a.call(i,r,e)}}}function we(n,t,e,i,r){return i.push(n),Xh(t,e,i,r),i.pop()}function ZC(n,t,e,i,r,s){const a=(r!==void 0?r:e).length;let o,l;for(let h=0;h<a;++h)o=e[h],o!==void 0&&(l=t.call(s,o,i,r!==void 0?r[h]:void 0),l!==void 0&&n[l.namespaceURI][l.localName].call(s,l,o,i))}function Wi(n,t,e,i,r,s,a){return r.push(n),ZC(t,e,i,r,s,a),r.pop()}let em;function JC(){return em===void 0&&typeof XMLSerializer<"u"&&(em=new XMLSerializer),em}let im;function Mg(){return im===void 0&&typeof document<"u"&&(im=document.implementation.createDocument("","",null)),im}class QC extends B5{constructor(){super(),this.xmlSerializer_=JC()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const i=ya(t);return this.readFeatureFromDocument(i,e)}return _a(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const i=this.readFeaturesFromDocument(t,e);return i.length>0?i[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const i=ya(t);return this.readFeaturesFromDocument(i,e)}return _a(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const i=[];for(let r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&ze(i,this.readFeaturesFromNode(r,e));return i}readFeaturesFromNode(t,e){return he()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const i=ya(t);return this.readGeometryFromDocument(i,e)}return _a(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=ya(t);return this.readProjectionFromDocument(e)}return _a(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(t,e){return null}}function po(n){const t=Ys(n,!1);return Ur(t)}function Ur(n){const t=/^\s*(true|1)|(false|0)\s*$/.exec(n);if(t)return t[1]!==void 0||!1}function si(n){const t=Ys(n,!1);return cs(t)}function cs(n){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(t)return parseFloat(t[1])}function nm(n){const t=Ys(n,!1);return Ud(t)}function Ud(n){const t=/^\s*(\d+)\s*$/.exec(n);if(t)return parseInt(t[1],10)}function ue(n){return Ys(n,!1).trim()}function Dh(n,t){Or(n,t?"1":"0")}function t3(n,t){n.appendChild(Mg().createCDATASection(t))}function jo(n,t){const e=t.toPrecision();n.appendChild(Mg().createTextNode(e))}const e3=/^\s/,i3=/\s$/,n3=/(\n|\t|\r|<|&| {2})/;function Or(n,t){typeof t=="string"&&(e3.test(t)||i3.test(t)||n3.test(t))?t.split("]]>").forEach((e,i,r)=>{i<r.length-1&&(e+="]]"),i>0&&(e=">"+e),t3(n,e)}):n.appendChild(Mg().createTextNode(t))}const Ta=["http://www.google.com/kml/ext/2.2"],Yt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],r3="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",Vy={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},s3=Dt(Yt,{ExtendedData:ew,Region:iw,MultiGeometry:vt(J5,"geometry"),LineString:vt(K5,"geometry"),LinearRing:vt(Z5,"geometry"),Point:vt(Q5,"geometry"),Polygon:vt(tw,"geometry"),Style:vt(j1),StyleMap:z3,address:vt(ue),description:vt(ue),name:vt(ue),open:vt(po),phoneNumber:vt(ue),styleUrl:vt(W5),visibility:vt(po)},Dt(Ta,{MultiTrack:vt(M3,"geometry"),Track:vt(Y5,"geometry")})),a3=Dt(Yt,{ExtendedData:ew,Region:iw,Link:tA,address:vt(ue),description:vt(ue),name:vt(ue),open:vt(po),phoneNumber:vt(ue),visibility:vt(po)}),o3=Dt(Yt,{href:vt(V5)}),l3=Dt(Yt,{Altitude:vt(si),Longitude:vt(si),Latitude:vt(si),Tilt:vt(si),AltitudeMode:vt(ue),Heading:vt(si),Roll:vt(si)}),U5=Dt(Yt,{LatLonAltBox:$3,Lod:Y3}),h3=Dt(Yt,["Document","Placemark"]),c3=Dt(Yt,{Document:re(lA),Placemark:re(sw)});let wh,cd=null,op,Xc,Yc,Kc,zd,lp=null,B1,hp=null,cp,Uo=null,Wy=null,up=null;function qd(n){return 32/Math.min(n[0],n[1])}function u3(){wh=[255,255,255,1],cd=new Ne({color:wh}),op=[20,2],Xc="pixels",Yc="pixels",Kc=[64,64],zd="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",lp=new vn({anchor:op,anchorOrigin:"bottom-left",anchorXUnits:Xc,anchorYUnits:Yc,crossOrigin:"anonymous",rotation:0,scale:qd(Kc),size:Kc,src:zd}),B1="NO_IMAGE",hp=new fe({color:wh,width:1}),cp=new fe({color:[51,51,51,1],width:2}),Uo=new Sr({font:"bold 16px Helvetica",fill:cd,stroke:cp,scale:.8}),Wy=new Zt({fill:cd,image:lp,text:Uo,stroke:hp,zIndex:0}),up=[Wy]}let qf;function f3(n){return n}class d3 extends QC{constructor(t){super(),t=t||{},up||u3(),this.dataProjection=di("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:up,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:f3,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const i=Dt(Yt,{Document:qy(this.readDocumentOrFolder_,this),Folder:qy(this.readDocumentOrFolder_,this),Placemark:Rs(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=we([],i,t,e,this);if(r)return r}readPlacemark_(t,e){const i=we({geometry:null},s3,t,e,this);if(!i)return;const r=new ei,s=t.getAttribute("id");s!==null&&r.setId(s);const a=e[0],o=i.geometry;if(o&&Fu(o,!1,a),r.setGeometry(o),delete i.geometry,this.extractStyles_){const l=i.Style,h=i.styleUrl,c=m3(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(c)}return delete i.Style,r.setProperties(i,!0),r}readSharedStyle_(t,e){const i=t.getAttribute("id");if(i!==null){const r=j1.call(this,t,e);if(r){let s,a=t.baseURI;(!a||a=="about:blank")&&(a=window.location.href),a?s=new URL("#"+i,a).href:s="#"+i,this.sharedStyles_[s]=r}}}readSharedStyleMap_(t,e){const i=t.getAttribute("id");if(i===null)return;const r=$5.call(this,t,e);if(!r)return;let s,a=t.baseURI;(!a||a=="about:blank")&&(a=window.location.href),a?s=new URL("#"+i,a).href:s="#"+i,this.sharedStyles_[s]=r}readFeatureFromNode(t,e){if(!Yt.includes(t.namespaceURI))return null;const i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i||null}readFeaturesFromNode(t,e){if(!Yt.includes(t.namespaceURI))return[];let i;const r=t.localName;if(r=="Document"||r=="Folder")return i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),i||[];if(r=="Placemark"){const s=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return s?[s]:[]}if(r=="kml"){i=[];for(let s=t.firstElementChild;s;s=s.nextElementSibling){const a=this.readFeaturesFromNode(s,e);a&&ze(i,a)}return i}return[]}readName(t){if(t){if(typeof t=="string"){const e=ya(t);return this.readNameFromDocument(e)}return _a(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(e);if(i)return i}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(Yt.includes(e.namespaceURI)&&e.localName=="name")return ue(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const i=e.localName;if(Yt.includes(e.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const r=this.readNameFromNode(e);if(r)return r}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const i=ya(t);ze(e,this.readNetworkLinksFromDocument(i))}else _a(t)?ze(e,this.readNetworkLinksFromDocument(t)):ze(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&ze(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(Yt.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const r=we({},a3,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Yt.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&ze(e,this.readNetworkLinksFromNode(i))}return e}readRegion(t){const e=[];if(typeof t=="string"){const i=ya(t);ze(e,this.readRegionFromDocument(i))}else _a(t)?ze(e,this.readRegionFromDocument(t)):ze(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&ze(e,this.readRegionFromNode(i));return e}readRegionFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(Yt.includes(i.namespaceURI)&&i.localName=="Region"){const r=we({},U5,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Yt.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&ze(e,this.readRegionFromNode(i))}return e}readCamera(t){const e=[];if(typeof t=="string"){const i=ya(t);ze(e,this.readCameraFromDocument(i))}else _a(t)?ze(e,this.readCameraFromDocument(t)):ze(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&ze(e,this.readCameraFromNode(i));return e}readCameraFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(Yt.includes(i.namespaceURI)&&i.localName==="Camera"){const r=we({},l3,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Yt.includes(i.namespaceURI)&&(r==="Document"||r==="Folder"||r==="Placemark"||r==="kml")&&ze(e,this.readCameraFromNode(i))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=ku(Yt[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",Ta[0]),i.setAttributeNS(r,"xmlns:xsi",zy),i.setAttributeNS(zy,"xsi:schemaLocation",r3);const s={node:i},a={};t.length>1?a.Document=t:t.length==1&&(a.Placemark=t[0]);const o=h3[i.namespaceURI],l=ps(a,o);return Wi(s,c3,qr,l,[e],o,this),i}}function g3(n,t){const e=[0,0];let i="start";const r=n.getImage();if(r){const o=r.getSize();if(o&&o.length==2){const l=r.getScaleArray(),h=r.getAnchor();e[0]=l[0]*(o[0]-h[0]),e[1]=l[1]*(o[1]/2-h[1]),i="left"}}let s=n.getText();return s?(s=s.clone(),s.setFont(s.getFont()||Uo.getFont()),s.setScale(s.getScale()||Uo.getScale()),s.setFill(s.getFill()||Uo.getFill()),s.setStroke(s.getStroke()||cp)):s=Uo.clone(),s.setText(t),s.setOffsetX(e[0]),s.setOffsetY(e[1]),s.setTextAlign(i),new Zt({image:r,text:s})}function m3(n,t,e,i,r){return function(s,a){let o=r,l="",h=[];if(o){const u=s.getGeometry();if(u)if(u instanceof Ea)h=u.getGeometriesArrayRecursive().filter(function(d){const g=d.getType();return g==="Point"||g==="MultiPoint"}),o=h.length>0;else{const d=u.getType();o=d==="Point"||d==="MultiPoint"}}o&&(l=s.get("name"),o=o&&!!l,o&&/&[^&]+;/.test(l)&&(qf||(qf=document.createElement("textarea")),qf.innerHTML=l,l=qf.value));let c=e;if(n?c=n:t&&(c=z5(t,e,i)),o){const u=g3(c[0],l);if(h.length>0){u.setGeometry(new Ea(h));const d=new Zt({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null});return[u,d].concat(c.slice(1))}return u}return c}}function z5(n,t,e){return Array.isArray(n)?n:typeof n=="string"?z5(e[n],t,e):t}function Pg(n){const t=Ys(n,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const i=e[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function q5(n){let t=Ys(n,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=i.exec(t);){const s=parseFloat(r[1]),a=parseFloat(r[2]),o=r[3]?parseFloat(r[3]):0;e.push(s,a,o),t=t.substr(r[0].length)}if(t==="")return e}function V5(n){const t=Ys(n,!1).trim();let e=n.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function W5(n){const t=Ys(n,!1).trim().replace(/^(?!.*#)/,"#");let e=n.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function p3(n){const t=n.getAttribute("xunits"),e=n.getAttribute("yunits");let i;return t!=="insetPixels"?e!=="insetPixels"?i="bottom-left":i="top-left":e!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(n.getAttribute("x")),xunits:Vy[t],y:parseFloat(n.getAttribute("y")),yunits:Vy[e],origin:i}}function H5(n){return si(n)}const _3=Dt(Yt,{Pair:U3});function $5(n,t){return we(void 0,_3,n,t,this)}const y3=Dt(Yt,{Icon:vt(I3),color:vt(Pg),heading:vt(si),hotSpot:vt(p3),scale:vt(H5)});function v3(n,t){const e=we({},y3,n,t);if(!e)return;const i=t[t.length-1],r="Icon"in e?e.Icon:{},s=!("Icon"in e)||Object.keys(r).length>0;let a;const o=r.href;o?a=o:s&&(a=zd);let l,h,c,u="bottom-left";const d=e.hotSpot;d?(l=[d.x,d.y],h=d.xunits,c=d.yunits,u=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(a.includes("pushpin")?(l=op,h=Xc,c=Yc):a.includes("arrow-reverse")?(l=[54,42],h=Xc,c=Yc):a.includes("paddle")&&(l=[32,1],h=Xc,c=Yc));let g;const p=r.x,y=r.y;p!==void 0&&y!==void 0&&(g=[p,y]);let w;const x=r.w,b=r.h;x!==void 0&&b!==void 0&&(w=[x,b]);let L;const P=e.heading;P!==void 0&&(L=ur(P));const R=e.scale,j=e.color;if(s){a==zd&&(w=Kc);const k=new vn({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:g,offsetOrigin:"bottom-left",rotation:L,scale:R,size:w,src:this.iconUrlFunction_(a),color:j}),T=k.getScaleArray()[0],q=k.getSize();if(q===null){const W=k.getImageState();if(W===me.IDLE||W===me.LOADING){const F=function(){const M=k.getImageState();if(!(M===me.IDLE||M===me.LOADING)){const O=k.getSize();if(O&&O.length==2){const G=qd(O);k.setScale(T*G)}k.unlistenImageChange(F)}};k.listenImageChange(F),W===me.IDLE&&k.load()}}else if(q.length==2){const W=qd(q);k.setScale(T*W)}i.imageStyle=k}else i.imageStyle=B1}const w3=Dt(Yt,{color:vt(Pg),scale:vt(H5)});function x3(n,t){const e=we({},w3,n,t);if(!e)return;const i=t[t.length-1],r=new Sr({fill:new Ne({color:"color"in e?e.color:wh}),scale:e.scale});i.textStyle=r}const b3=Dt(Yt,{color:vt(Pg),width:vt(si)});function E3(n,t){const e=we({},b3,n,t);if(!e)return;const i=t[t.length-1],r=new fe({color:"color"in e?e.color:wh,width:"width"in e?e.width:1});i.strokeStyle=r}const S3=Dt(Yt,{color:vt(Pg),fill:vt(po),outline:vt(po)});function L3(n,t){const e=we({},S3,n,t);if(!e)return;const i=t[t.length-1],r=new Ne({color:"color"in e?e.color:wh});i.fillStyle=r;const s=e.fill;s!==void 0&&(i.fill=s);const a=e.outline;a!==void 0&&(i.outline=a)}const C3=Dt(Yt,{coordinates:D1(q5)});function X5(n,t){return we(null,C3,n,t)}function A3(n,t){const i=t[t.length-1].coordinates,r=Ys(n,!1),a=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(a){const o=parseFloat(a[1]),l=parseFloat(a[2]),h=parseFloat(a[3]);i.push([o,l,h])}else i.push([])}const T3=Dt(Ta,{Track:Rs(Y5)});function M3(n,t){const e=we([],T3,n,t);if(e)return new Vs(e)}const P3=Dt(Yt,{when:eA},Dt(Ta,{coord:A3}));function Y5(n,t){const e=we({coordinates:[],whens:[]},P3,n,t);if(!e)return;const i=[],r=e.coordinates,s=e.whens;for(let a=0,o=Math.min(r.length,s.length);a<o;++a)r[a].length==3&&i.push(r[a][0],r[a][1],r[a][2],s[a]);return new wi(i,"XYZM")}const R3=Dt(Yt,{href:vt(V5)},Dt(Ta,{x:vt(si),y:vt(si),w:vt(si),h:vt(si)}));function I3(n,t){const e=we({},R3,n,t);return e||null}const N3=Dt(Yt,{coordinates:D1(q5)});function G1(n,t){return we(null,N3,n,t)}const Rg=Dt(Yt,{extrude:vt(po),tessellate:vt(po),altitudeMode:vt(ue)});function K5(n,t){const e=we({},Rg,n,t),i=G1(n,t);if(i){const r=new wi(i,"XYZ");return r.setProperties(e,!0),r}}function Z5(n,t){const e=we({},Rg,n,t),i=G1(n,t);if(i){const r=new Ei(i,"XYZ",[i.length]);return r.setProperties(e,!0),r}}const F3=Dt(Yt,{LineString:Rs(K5),LinearRing:Rs(Z5),MultiGeometry:Rs(J5),Point:Rs(Q5),Polygon:Rs(tw)});function J5(n,t){const e=we([],F3,n,t);if(!e)return null;if(e.length===0)return new Ea(e);let i,r=!0;const s=e[0].getType();let a;for(let o=1,l=e.length;o<l;++o)if(a=e[o],a.getType()!=s){r=!1;break}if(r){let o,l;if(s=="Point"){const h=e[0];o=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=e.length;c<u;++c)a=e[c],ze(l,a.getFlatCoordinates());i=new Nu(l,o),rm(i,e)}else if(s=="LineString")i=new Vs(e),rm(i,e);else if(s=="Polygon")i=new $r(e),rm(i,e);else if(s=="GeometryCollection"||s.startsWith("Multi"))i=new Ea(e);else throw new Error("Unknown geometry type found")}else i=new Ea(e);return i}function Q5(n,t){const e=we({},Rg,n,t),i=G1(n,t);if(i){const r=new fi(i,"XYZ");return r.setProperties(e,!0),r}}const k3=Dt(Yt,{innerBoundaryIs:Z3,outerBoundaryIs:Q3});function tw(n,t){const e=we({},Rg,n,t),i=we([null],k3,n,t);if(i&&i[0]){const r=i[0],s=[r.length];for(let o=1,l=i.length;o<l;++o)ze(r,i[o]),s.push(r.length);const a=new Ei(r,"XYZ",s);return a.setProperties(e,!0),a}}const O3=Dt(Yt,{IconStyle:v3,LabelStyle:x3,LineStyle:E3,PolyStyle:L3});function j1(n,t){const e=we({},O3,n,t,this);if(!e)return null;let i="fillStyle"in e?e.fillStyle:cd;const r=e.fill;r!==void 0&&!r&&(i=null);let s;"imageStyle"in e?e.imageStyle!=B1&&(s=e.imageStyle):s=lp;const a="textStyle"in e?e.textStyle:Uo,o="strokeStyle"in e?e.strokeStyle:hp,l=e.outline;return l!==void 0&&!l?[new Zt({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new Ea(d.getGeometriesArrayRecursive().filter(function(g){const p=g.getType();return p!=="Polygon"&&p!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:i,image:s,stroke:o,text:a,zIndex:void 0}),new Zt({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new Ea(d.getGeometriesArrayRecursive().filter(function(g){const p=g.getType();return p==="Polygon"||p==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return c},fill:i,stroke:null,zIndex:void 0})]:[new Zt({fill:i,image:s,stroke:o,text:a,zIndex:void 0})]}function rm(n,t){const e=t.length,i=new Array(t.length),r=new Array(t.length),s=new Array(t.length);let a,o,l;a=!1,o=!1,l=!1;for(let h=0;h<e;++h){const c=t[h];i[h]=c.get("extrude"),r[h]=c.get("tessellate"),s[h]=c.get("altitudeMode"),a=a||i[h]!==void 0,o=o||r[h]!==void 0,l=l||s[h]}a&&n.set("extrude",i),o&&n.set("tessellate",r),l&&n.set("altitudeMode",s)}const D3=Dt(Yt,{displayName:vt(ue),value:vt(ue)});function B3(n,t){const e=n.getAttribute("name");Xh(D3,n,t);const i=t[t.length-1];e&&i.displayName?i[e]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:e!==null?i[e]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const G3=Dt(Yt,{Data:B3,SchemaData:V3});function ew(n,t){Xh(G3,n,t)}function iw(n,t){Xh(U5,n,t)}const j3=Dt(Yt,{Style:vt(j1),key:vt(ue),styleUrl:vt(W5)});function U3(n,t){const e=we({},j3,n,t,this);if(!e)return;const i=e.key;if(i&&i=="normal"){const r=e.styleUrl;r&&(t[t.length-1]=r);const s=e.Style;s&&(t[t.length-1]=s)}}function z3(n,t){const e=$5.call(this,n,t);if(!e)return;const i=t[t.length-1];if(Array.isArray(e))i.Style=e;else if(typeof e=="string")i.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const q3=Dt(Yt,{SimpleData:W3});function V3(n,t){Xh(q3,n,t)}function W3(n,t){const e=n.getAttribute("name");if(e!==null){const i=ue(n),r=t[t.length-1];r[e]=i}}const H3=Dt(Yt,{altitudeMode:vt(ue),minAltitude:vt(si),maxAltitude:vt(si),north:vt(si),south:vt(si),east:vt(si),west:vt(si)});function $3(n,t){const e=we({},H3,n,t);if(!e)return;const i=t[t.length-1],r=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];i.extent=r,i.altitudeMode=e.altitudeMode,i.minAltitude=parseFloat(e.minAltitude),i.maxAltitude=parseFloat(e.maxAltitude)}const X3=Dt(Yt,{minLodPixels:vt(si),maxLodPixels:vt(si),minFadeExtent:vt(si),maxFadeExtent:vt(si)});function Y3(n,t){const e=we({},X3,n,t);if(!e)return;const i=t[t.length-1];i.minLodPixels=parseFloat(e.minLodPixels),i.maxLodPixels=parseFloat(e.maxLodPixels),i.minFadeExtent=parseFloat(e.minFadeExtent),i.maxFadeExtent=parseFloat(e.maxFadeExtent)}const K3=Dt(Yt,{LinearRing:Rs(X5)});function Z3(n,t){const e=we([],K3,n,t);e.length>0&&t[t.length-1].push(...e)}const J3=Dt(Yt,{LinearRing:D1(X5)});function Q3(n,t){const e=we(void 0,J3,n,t);if(e){const i=t[t.length-1];i[0]=e}}function tA(n,t){Xh(o3,n,t)}function eA(n,t){const i=t[t.length-1].whens,r=Ys(n,!1),s=Date.parse(r);i.push(isNaN(s)?0:s)}function Ig(n,t){const e=Hr(t),r=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let s=0;s<4;++s){const a=Math.floor(r[s]).toString(16);r[s]=a.length==1?"0"+a:a}Or(n,r.join(""))}function iA(n,t,e){const i=e[e.length-1],r=i.layout,s=i.stride;let a;if(r=="XY"||r=="XYM")a=2;else if(r=="XYZ"||r=="XYZM")a=3;else throw new Error("Invalid geometry layout");const o=t.length;let l="";if(o>0){l+=t[0];for(let h=1;h<a;++h)l+=","+t[h];for(let h=s;h<o;h+=s){l+=" "+t[h];for(let c=1;c<a;++c)l+=","+t[h+c]}}Or(n,l)}const ud=Dt(Yt,{Data:re(nA),value:re(sA),displayName:re(rA)});function nA(n,t,e){n.setAttribute("name",t.name);const i={node:n},r=t.value;typeof r=="object"?(r!==null&&r.displayName&&Wi(i,ud,qr,[r.displayName],e,["displayName"]),r!==null&&r.value&&Wi(i,ud,qr,[r.value],e,["value"])):Wi(i,ud,qr,[r],e,["value"])}function rA(n,t){Or(n,t)}function sA(n,t){Or(n,t)}const aA=Dt(Yt,{Placemark:re(sw)}),oA=function(n,t,e){const i=t[t.length-1].node;return ku(i.namespaceURI,"Placemark")};function lA(n,t,e){Wi({node:n},aA,oA,t,e,void 0,this)}const hA=Aa("Data");function cA(n,t,e){const i={node:n},r=t.names,s=t.values,a=r.length;for(let o=0;o<a;o++)Wi(i,ud,hA,[{name:r[o],value:s[o]}],e)}const Hy=Dt(Yt,["href"],Dt(Ta,["x","y","w","h"])),$y=Dt(Yt,{href:re(Or)},Dt(Ta,{x:re(jo),y:re(jo),w:re(jo),h:re(jo)})),uA=function(n,t,e){return ku(Ta[0],"gx:"+e)};function fA(n,t,e){const i={node:n},r=e[e.length-1].node;let s=Hy[r.namespaceURI],a=ps(t,s);Wi(i,$y,qr,a,e,s),s=Hy[Ta[0]],a=ps(t,s),Wi(i,$y,uA,a,e,s)}const dA=Dt(Yt,["scale","heading","Icon","color","hotSpot"]),gA=Dt(Yt,{Icon:re(fA),color:re(Ig),heading:re(jo),hotSpot:re(UA),scale:re(ow)});function mA(n,t,e){const i={node:n},r={},s=t.getSrc(),a=t.getSize(),o=t.getImageSize(),l={href:s};if(a){l.w=a[0],l.h=a[1];const w=t.getAnchor(),x=t.getOrigin();if(x&&o&&x[0]!==0&&x[1]!==a[1]&&(l.x=x[0],l.y=o[1]-(x[1]+a[1])),w&&(w[0]!==a[0]/2||w[1]!==a[1]/2)){const b={x:w[0],xunits:"pixels",y:a[1]-w[1],yunits:"pixels"};r.hotSpot=b}}r.Icon=l;let h=t.getScaleArray()[0],c=a;if(c===null&&(c=Kc),c.length==2){const w=qd(c);h=h/w}h!==1&&(r.scale=h);const u=t.getRotation();u!==0&&(r.heading=u);const d=t.getColor();d&&(r.color=d);const g=e[e.length-1].node,p=dA[g.namespaceURI],y=ps(r,p);Wi(i,gA,qr,y,e,p)}const pA=Dt(Yt,["color","scale"]),_A=Dt(Yt,{color:re(Ig),scale:re(ow)});function yA(n,t,e){const i={node:n},r={},s=t.getFill();s&&(r.color=s.getColor());const a=t.getScale();a&&a!==1&&(r.scale=a);const o=e[e.length-1].node,l=pA[o.namespaceURI],h=ps(r,l);Wi(i,_A,qr,h,e,l)}const vA=Dt(Yt,["color","width"]),wA=Dt(Yt,{color:re(Ig),width:re(jo)});function xA(n,t,e){const i={node:n},r={color:t.getColor(),width:Number(t.getWidth())||1},s=e[e.length-1].node,a=vA[s.namespaceURI],o=ps(r,a);Wi(i,wA,qr,o,e,a)}const bA={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},nw=function(n,t,e){if(n){const i=t[t.length-1].node;return ku(i.namespaceURI,bA[n.getType()])}},EA=Aa("Point"),SA=Aa("LineString"),LA=Aa("LinearRing"),CA=Aa("Polygon"),AA=Dt(Yt,{LineString:re(xh),Point:re(xh),Polygon:re(aw),GeometryCollection:re(rw)});function rw(n,t,e){const i={node:n},r=t.getType();let s=[],a;if(r==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(o){const l=o.getType();if(l==="MultiPoint")s=s.concat(o.getPoints());else if(l==="MultiLineString")s=s.concat(o.getLineStrings());else if(l==="MultiPolygon")s=s.concat(o.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")s.push(o);else throw new Error("Unknown geometry type")}),a=nw;else if(r==="MultiPoint")s=t.getPoints(),a=EA;else if(r==="MultiLineString")s=t.getLineStrings(),a=SA;else if(r==="MultiPolygon")s=t.getPolygons(),a=CA;else throw new Error("Unknown geometry type");Wi(i,AA,a,s,e)}const TA=Dt(Yt,{LinearRing:re(xh)});function Xy(n,t,e){Wi({node:n},TA,LA,[t],e)}const sm=Dt(Yt,{ExtendedData:re(cA),MultiGeometry:re(rw),LineString:re(xh),LinearRing:re(xh),Point:re(xh),Polygon:re(aw),Style:re(jA),address:re(Or),description:re(Or),name:re(Or),open:re(Dh),phoneNumber:re(Or),styleUrl:re(Or),visibility:re(Dh)}),MA=Dt(Yt,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),PA=Aa("ExtendedData");function sw(n,t,e){const i={node:n};t.getId()&&n.setAttribute("id",t.getId());const r=t.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[t.getGeometryName()]=1;const a=Object.keys(r||{}).sort().filter(function(g){return!s[g]}),o=t.getStyleFunction();if(o){const g=o(t,0);if(g){const p=Array.isArray(g)?g:[g];let y=p;if(t.getGeometry()&&(y=p.filter(function(w){const x=w.getGeometryFunction()(t);if(x){const b=x.getType();return b==="GeometryCollection"?x.getGeometriesArrayRecursive().filter(function(L){const P=L.getType();return P==="Point"||P==="MultiPoint"}).length:b==="Point"||b==="MultiPoint"}})),this.writeStyles_){let w=p,x=p;t.getGeometry()&&(w=p.filter(function(b){const L=b.getGeometryFunction()(t);if(L){const P=L.getType();return P==="GeometryCollection"?L.getGeometriesArrayRecursive().filter(function(R){const j=R.getType();return j==="LineString"||j==="MultiLineString"}).length:P==="LineString"||P==="MultiLineString"}}),x=p.filter(function(b){const L=b.getGeometryFunction()(t);if(L){const P=L.getType();return P==="GeometryCollection"?L.getGeometriesArrayRecursive().filter(function(R){const j=R.getType();return j==="Polygon"||j==="MultiPolygon"}).length:P==="Polygon"||P==="MultiPolygon"}})),r.Style={pointStyles:y,lineStyles:w,polyStyles:x}}if(y.length&&r.name===void 0){const w=y[0].getText();w&&(r.name=w.getText())}}}const l=e[e.length-1].node,h=MA[l.namespaceURI],c=ps(r,h);if(Wi(i,sm,qr,c,e,h),a.length>0){const g=ps(r,a);Wi(i,sm,PA,[{names:a,values:g}],e)}const u=e[0];let d=t.getGeometry();d&&(d=Fu(d,!0,u)),Wi(i,sm,nw,[d],e)}const RA=Dt(Yt,["extrude","tessellate","altitudeMode","coordinates"]),IA=Dt(Yt,{extrude:re(Dh),tessellate:re(Dh),altitudeMode:re(Or),coordinates:re(iA)});function xh(n,t,e){const i=t.getFlatCoordinates(),r={node:n};r.layout=t.getLayout(),r.stride=t.getStride();const s=t.getProperties();s.coordinates=i;const a=e[e.length-1].node,o=RA[a.namespaceURI],l=ps(s,o);Wi(r,IA,qr,l,e,o)}const NA=Dt(Yt,["color","fill","outline"]),Yy=Dt(Yt,{outerBoundaryIs:re(Xy),innerBoundaryIs:re(Xy)}),FA=Aa("innerBoundaryIs"),kA=Aa("outerBoundaryIs");function aw(n,t,e){const i=t.getLinearRings(),r=i.shift(),s={node:n};Wi(s,Yy,FA,i,e),Wi(s,Yy,kA,[r],e)}const OA=Dt(Yt,{color:re(Ig),fill:re(Dh),outline:re(Dh)});function DA(n,t,e){const i={node:n},r=t.getFill(),s=t.getStroke(),a={color:r?r.getColor():void 0,fill:r?void 0:!1,outline:s?void 0:!1},o=e[e.length-1].node,l=NA[o.namespaceURI],h=ps(a,l);Wi(i,OA,qr,h,e,l)}function ow(n,t){jo(n,Math.round(t*1e6)/1e6)}const BA=Dt(Yt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),GA=Dt(Yt,{IconStyle:re(mA),LabelStyle:re(yA),LineStyle:re(xA),PolyStyle:re(DA)});function jA(n,t,e){const i={node:n},r={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(r.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(r.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(r.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!r.LineStyle&&(r.LineStyle=l),r.PolyStyle=t.polyStyles[0]}const s=e[e.length-1].node,a=BA[s.namespaceURI],o=ps(r,a);Wi(i,GA,qr,o,e,a)}function UA(n,t){n.setAttribute("x",String(t.x)),n.setAttribute("y",String(t.y)),n.setAttribute("xunits",t.xunits),n.setAttribute("yunits",t.yunits)}function zA(n,t){return[[-1/0,-1/0,1/0,1/0]]}function an(n,t){return[n]}const Tn={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class qA extends Ar{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+OS,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Tn.ELEMENT,this.handleElementChanged),this.addChangeListener(Tn.MAP,this.handleMapChanged),this.addChangeListener(Tn.OFFSET,this.handleOffsetChanged),this.addChangeListener(Tn.POSITION,this.handlePositionChanged),this.addChangeListener(Tn.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(Tn.ELEMENT)}getId(){return this.id}getMap(){return this.get(Tn.MAP)||null}getOffset(){return this.get(Tn.OFFSET)}getPosition(){return this.get(Tn.POSITION)}getPositioning(){return this.get(Tn.POSITIONING)}handleElementChanged(){m5(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){var e;this.mapPostrenderListenerKey&&((e=this.element)==null||e.remove(),ai(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=ve(t,ga.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(Tn.ELEMENT,t)}setMap(t){this.set(Tn.MAP,t)}setOffset(t){this.set(Tn.OFFSET,t)}setPosition(t){this.set(Tn.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(Tn.POSITION))return;const i=this.getRect(e.getTargetElement(),e.getSize()),r=this.getElement(),s=this.getRect(r,[BS(r),GS(r)]);t=t||{};const a=t.margin===void 0?20:t.margin;if(!so(i,s)){const o=s[0]-i[0],l=i[2]-s[2],h=s[1]-i[1],c=i[3]-s[3],u=[0,0];if(o<0?u[0]=o-a:l<0&&(u[0]=Math.abs(l)+a),h<0?u[1]=h-a:c<0&&(u[1]=Math.abs(c)+a),u[0]!==0||u[1]!==0){const d=e.getView().getCenterInternal(),g=e.getPixelFromCoordinateInternal(d);if(!g)return;const p=[g[0]+u[0],g[1]+u[1]],y=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(p),duration:y.duration,easing:y.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[r,s,r+e[0],s+e[1]]}setPositioning(t){this.set(Tn.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)}updateRenderedPosition(t,e){const i=this.element.style,r=this.getOffset(),s=this.getPositioning();this.setVisible(!0);const a=Math.round(t[0]+r[0])+"px",o=Math.round(t[1]+r[1])+"px";let l="0%",h="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?l="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(l="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?h="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${a}, ${o})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}const Ng=qA;class lw{drawCustom(t,e,i,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const ee={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Vf=[ee.FILL],lo=[ee.STROKE],zo=[ee.BEGIN_PATH],Ky=[ee.CLOSE_PATH];class Ou extends lw{constructor(t,e,i,r){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates;let a=s.length;for(let o=0,l=t.length;o<l;o+=e)r[0]=t[o],r[1]=t[o+1],mo(i,r)&&(s[a++]=r[0],s[a++]=r[1]);return a}appendFlatLineCoordinates(t,e,i,r,s,a){const o=this.coordinates;let l=o.length;const h=this.getBufferedMaxExtent();a&&(e+=r);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let g=!0,p,y,w;for(p=e+r;p<i;p+=r)d[0]=t[p],d[1]=t[p+1],w=qm(h,d),w!==y?(g&&(o[l++]=c,o[l++]=u,g=!1),o[l++]=d[0],o[l++]=d[1]):w===gn.INTERSECTING?(o[l++]=d[0],o[l++]=d[1],g=!1):g=!0,c=d[0],u=d[1],y=w;return(s&&g||p===e+r)&&(o[l++]=c,o[l++]=u),l}drawCustomCoordinates_(t,e,i,r,s){for(let a=0,o=i.length;a<o;++a){const l=i[a],h=this.appendFlatLineCoordinates(t,e,l,r,!1,!1);s.push(h),e=l}return e}drawCustom(t,e,i,r,s){this.beginGeometry(t,e,s);const a=t.getType(),o=t.getStride(),l=this.coordinates.length;let h,c,u,d,g;switch(a){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const p=t.getEndss();g=0;for(let y=0,w=p.length;y<w;++y){const x=[];g=this.drawCustomCoordinates_(h,g,p[y],o,x),d.push(x)}this.instructions.push([ee.CUSTOM,l,d,t,i,Km,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,d,t,r||i,Km,s]);break;case"Polygon":case"MultiLineString":u=[],h=a=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(h,0,t.getEnds(),o,u),this.instructions.push([ee.CUSTOM,l,u,t,i,lu,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,u,t,r||i,lu,s]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,o,!1,!1),this.instructions.push([ee.CUSTOM,l,c,t,i,ao,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,c,t,r||i,ao,s]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,o),c>l&&(this.instructions.push([ee.CUSTOM,l,c,t,i,ao,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,c,t,r||i,ao,s]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([ee.CUSTOM,l,c,t,i,void 0,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,c,t,r||i,void 0,s]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[ee.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ee.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let r,s,a=-1;for(e=0;e<i;++e)r=t[e],s=r[0],s==ee.END_GEOMETRY?a=e:s==ee.BEGIN_GEOMETRY&&(r[2]=e,Qb(this.hitDetectionInstructions,a,e),a=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=Ns(i||lr)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=Ns(i||uu);const r=t.getLineCap();e.lineCap=r!==void 0?r:kh;const s=t.getLineDash();e.lineDash=s?s.slice():xa;const a=t.getLineDashOffset();e.lineDashOffset=a||ba;const o=t.getLineJoin();e.lineJoin=o!==void 0?o:Oh;const l=t.getWidth();e.lineWidth=l!==void 0?l:du;const h=t.getMiterLimit();e.miterLimit=h!==void 0?h:cu,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[ee.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ee.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,r=t.lineCap,s=t.lineDash,a=t.lineDashOffset,o=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=r||s!=t.currentLineDash&&!Hs(t.currentLineDash,s)||t.currentLineDashOffset!=a||t.currentLineJoin!=o||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=r,t.currentLineDash=s,t.currentLineDashOffset=a,t.currentLineJoin=o,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[ee.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ov(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Vr(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class VA extends Ou{constructor(t,e,i,r){super(t,e,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!mo(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),s=t.getStride(),a=this.coordinates.length,o=this.appendFlatPointCoordinates(r,s);this.instructions.push([ee.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ee.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),s=[];for(let l=0,h=r.length;l<h;l+=t.getStride())(!this.maxExtent||mo(this.maxExtent,r.slice(l,l+2)))&&s.push(r[l],r[l+1]);const a=this.coordinates.length,o=this.appendFlatPointCoordinates(s,2);this.instructions.push([ee.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ee.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),r=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const WA=VA;class HA extends Ou{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinates_(t,e,i,r){const s=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,i,r,!1,!1),o=[ee.MOVE_TO_LINE_TO,s,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const r=this.state,s=r.strokeStyle,a=r.lineWidth;if(s===void 0||a===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,xa,ba],zo);const o=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(o,0,o.length,l),this.hitDetectionInstructions.push(lo),this.endGeometry(e)}drawMultiLineString(t,e,i){const r=this.state,s=r.strokeStyle,a=r.lineWidth;if(s===void 0||a===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,xa,ba],zo);const o=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=o.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,o[u],h);this.hitDetectionInstructions.push(lo),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(lo),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(lo),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(zo)}}const $A=HA;class XA extends Ou{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinatess_(t,e,i,r){const s=this.state,a=s.fillStyle!==void 0,o=s.strokeStyle!==void 0,l=i.length;this.instructions.push(zo),this.hitDetectionInstructions.push(zo);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,r,!0,!o),g=[ee.MOVE_TO_LINE_TO,u,d];this.instructions.push(g),this.hitDetectionInstructions.push(g),o&&(this.instructions.push(Ky),this.hitDetectionInstructions.push(Ky)),e=c}return a&&(this.instructions.push(Vf),this.hitDetectionInstructions.push(Vf)),o&&(this.instructions.push(lo),this.hitDetectionInstructions.push(lo)),e}drawCircle(t,e,i){const r=this.state,s=r.fillStyle,a=r.strokeStyle;if(s===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_FILL_STYLE,lr]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,xa,ba]);const o=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,l,!1,!1);const c=[ee.CIRCLE,h];this.instructions.push(zo,c),this.hitDetectionInstructions.push(zo,c),r.fillStyle!==void 0&&(this.instructions.push(Vf),this.hitDetectionInstructions.push(Vf)),r.strokeStyle!==void 0&&(this.instructions.push(lo),this.hitDetectionInstructions.push(lo)),this.endGeometry(e)}drawPolygon(t,e,i){const r=this.state,s=r.fillStyle,a=r.strokeStyle;if(s===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_FILL_STYLE,lr]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,xa,ba]);const o=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,o,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){const r=this.state,s=r.fillStyle,a=r.strokeStyle;if(s===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_FILL_STYLE,lr]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,xa,ba]);const o=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=o.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,o[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,r=e.length;i<r;++i)e[i]=No(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const Zy=XA;function YA(n,t,e,i,r){const s=[];let a=e,o=0,l=t.slice(e,2);for(;o<n&&a+r<i;){const[h,c]=l.slice(-2),u=t[a+r],d=t[a+r+1],g=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(o+=g,o>=n){const p=(n-o+g)/g,y=br(h,u,p),w=br(c,d,p);l.push(y,w),s.push(l),l=[y,w],o==n&&(a+=r),o=0}else if(o<n)l.push(t[a+r],t[a+r+1]),a+=r;else{const p=g-o,y=br(h,u,p/g),w=br(c,d,p/g);l.push(y,w),s.push(l),l=[y,w],o=0,a+=r}}return o>0&&s.push(l),s}function KA(n,t,e,i,r){let s=e,a=e,o=0,l=0,h=e,c,u,d,g,p,y,w,x,b,L;for(u=e;u<i;u+=r){const P=t[u],R=t[u+1];p!==void 0&&(b=P-p,L=R-y,g=Math.sqrt(b*b+L*L),w!==void 0&&(l+=d,c=Math.acos((w*b+x*L)/(d*g)),c>n&&(l>o&&(o=l,s=h,a=u),l=0,h=u-r)),d=g,w=b,x=L),p=P,y=R}return l+=g,l>o?[h,u]:[s,a]}const Vd={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class ZA extends Ou{constructor(t,e,i,r){super(t,e,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[lr]={fillStyle:lr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const r=this.textFillState_,s=this.textStrokeState_,a=this.textState_;if(this.text_===""||!a||!r&&!s)return;const o=this.coordinates;let l=o.length;const h=t.getType();let c=null,u=t.getStride();if(a.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!ki(this.maxExtent,t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const w=t.getEndss();d=[];for(let x=0,b=w.length;x<b;++x)d.push(w[x][0])}this.beginGeometry(t,e,i);const g=a.repeat,p=g?void 0:a.textAlign;let y=0;for(let w=0,x=d.length;w<x;++w){let b;g?b=YA(g*this.resolution,c,y,d[w],u):b=[c.slice(y,d[w])];for(let L=0,P=b.length;L<P;++L){const R=b[L];let j=0,k=R.length;if(p==null){const q=KA(a.maxAngle,R,0,R.length,2);j=q[0],k=q[1]}for(let q=j;q<k;q+=u)o.push(R[q],R[q+1]);const T=o.length;y=d[w],this.drawChars_(l,T),l=T}}this.endGeometry(e)}else{let d=a.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),a.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const P=t.getFlatInteriorPoints();c=[];for(let R=0,j=P.length;R<j;R+=3)a.overflow||d.push(P[R+2]/this.resolution),c.push(P[R],P[R+1]);if(c.length===0)return;u=2;break}const g=this.appendFlatPointCoordinates(c,u);if(g===l)return;if(d&&(g-l)/2!==c.length/u){let P=l/2;d=d.filter((R,j)=>{const k=o[(P+j)*2]===c[j*u]&&o[(P+j)*2+1]===c[j*u+1];return k||--P,k})}this.saveTextStates_();const p=a.backgroundFill?this.createFill(this.fillStyleToState(a.backgroundFill)):null,y=a.backgroundStroke?this.createStroke(this.strokeStyleToState(a.backgroundStroke)):null;this.beginGeometry(t,e,i);let w=a.padding;if(w!=Go&&(a.scale[0]<0||a.scale[1]<0)){let P=a.padding[0],R=a.padding[1],j=a.padding[2],k=a.padding[3];a.scale[0]<0&&(R=-R,k=-k),a.scale[1]<0&&(P=-P,j=-j),w=[P,R,j,k]}const x=this.pixelRatio;this.instructions.push([ee.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,w==Go?Go:w.map(function(P){return P*x}),p,y,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const b=1/x,L=p?p.slice(0):null;L&&(L[1]=lr),this.hitDetectionInstructions.push([ee.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[b,b],NaN,this.declutterMode_,this.declutterImageWithText_,w,L,y,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?lr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||fu,justify:e.justify,textBaseline:e.textBaseline||kd,scale:e.scale});const a=this.fillKey_;i&&(a in this.fillStates||(this.fillStates[a]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,a=this.textKey_,o=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=Vd[r.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([ee.DRAW_CHARS,t,e,h,r.overflow,o,r.maxAngle,l,c,s,d*l,u,a,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([ee.DRAW_CHARS,t,e,h,r.overflow,o&&lr,r.maxAngle,l,c,s,d*l,u,a,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,r,s;if(!t)this.text_="";else{const a=t.getFill();a?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=Ns(a.getColor()||lr)):(r=null,this.textFillState_=r);const o=t.getStroke();if(!o)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const y=o.getLineDash(),w=o.getLineDashOffset(),x=o.getWidth(),b=o.getMiterLimit();s.lineCap=o.getLineCap()||kh,s.lineDash=y?y.slice():xa,s.lineDashOffset=w===void 0?ba:w,s.lineJoin=o.getLineJoin()||Oh,s.lineWidth=x===void 0?du:x,s.miterLimit=b===void 0?cu:b,s.strokeStyle=Ns(o.getColor()||uu)}i=this.textState_;const l=t.getFont()||T5;nC(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||kd,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Go,i.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),g=t.getKeepUpright(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=g===void 0?!0:g,this.textRotation_=p===void 0?0:p,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Ht(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Ht(r.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const JA={Circle:Zy,Default:Ou,Image:WA,LineString:$A,Polygon:Zy,Text:ZA};class hw{constructor(t,e,i,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const r in i){const s=i[r].finish();t[e][r]=s}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let s=r[e];if(s===void 0){const a=JA[e];s=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=s}return s}}function QA(n,t,e,i,r,s,a,o,l,h,c,u,d=!0){let g=n[t],p=n[t+1],y=0,w=0,x=0,b=0;function L(){y=g,w=p,t+=i,g=n[t],p=n[t+1],b+=x,x=Math.sqrt((g-y)*(g-y)+(p-w)*(p-w))}do L();while(t<e-i&&b+x<s);let P=x===0?0:(s-b)/x;const R=br(y,g,P),j=br(w,p,P),k=t-i,T=b,q=s+o*l(h,r,c);for(;t<e-i&&b+x<q;)L();P=x===0?0:(q-b)/x;const W=br(y,g,P),F=br(w,p,P);let M=!1;if(d)if(u){const it=[R,j,W,F];t1(it,0,4,2,u,it,it),M=it[0]>it[2]}else M=R>W;const O=Math.PI,G=[],tt=k+i===t;t=k,x=0,b=T,g=n[t],p=n[t+1];let Z;if(tt){L(),Z=Math.atan2(p-w,g-y),M&&(Z+=Z>0?-O:O);const it=(W+R)/2,J=(F+j)/2;return G[0]=[it,J,(q-s)/2,Z,r],G}r=r.replace(/\n/g," ");for(let it=0,J=r.length;it<J;){L();let lt=Math.atan2(p-w,g-y);if(M&&(lt+=lt>0?-O:O),Z!==void 0){let K=lt-Z;if(K+=K>O?-2*O:K<-O?2*O:0,Math.abs(K)>a)return null}Z=lt;const ct=it;let Et=0;for(;it<J;++it){const K=M?J-it-1:it,st=o*l(h,r[K],c);if(t+i<e&&b+x<s+Et+st/2)break;Et+=st}if(it===ct)continue;const S=M?r.substring(J-ct,J-it):r.substring(ct,it);P=x===0?0:(s+Et/2-b)/x;const U=br(y,g,P),H=br(w,p,P);G.push([U,H,Et/2,lt,S]),s+=Et}return G}class U1{constructor(){sy(this,"pushMethodArgs_",(...t)=>(this.push_(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Nd(),{get:(t,e)=>{if(typeof Nd()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,i)=>(this.push_(e,i),!0)})}push_(...t){const e=this.instructions_,i=this.zIndex+this.offset_;e[i]||(e[i]=[]),e[i].push(...t)}pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,r=e.length;i<r;++i){const s=e[i];if(typeof s=="function"){s(t);continue}const a=e[++i];if(typeof t[s]=="function")t[s](...a);else{if(typeof a=="function"){t[s]=a(t);continue}t[s]=a}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Vl=Bn(),$a=[],la=[],ha=[],Xa=[];function Jy(n){return n[3].declutterBox}const Qy=new RegExp("[-----]");function am(n,t){return t==="start"?t=Qy.test(n)?"right":"left":t==="end"&&(t=Qy.test(n)?"left":"right"),Vd[t]}function tT(n,t,e){return e>0&&n.push(`
`,""),n.push(t,""),n}function eT(n,t,e){return e%2===0&&(n+=t),n}class iT{constructor(t,e,i,r,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Zi(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new U1:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,r){const s=t+e+i+r;if(this.labels_[s])return this.labels_[s];const a=r?this.strokeStates[r]:null,o=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?Vd[l.justify]:am(Array.isArray(t)?t[0]:t,l.textAlign||fu),d=r&&a.lineWidth?a.lineWidth:0,g=Array.isArray(t)?t:String(t).split(`
`).reduce(tT,[]),{width:p,height:y,widths:w,heights:x,lineWidths:b}=sC(l,g),L=p+d,P=[],R=(L+2)*c[0],j=(y+d)*c[1],k={width:R<0?Math.floor(R):Math.ceil(R),height:j<0?Math.floor(j):Math.ceil(j),contextInstructions:P};(c[0]!=1||c[1]!=1)&&P.push("scale",c),r&&(P.push("strokeStyle",a.strokeStyle),P.push("lineWidth",d),P.push("lineCap",a.lineCap),P.push("lineJoin",a.lineJoin),P.push("miterLimit",a.miterLimit),P.push("setLineDash",[a.lineDash]),P.push("lineDashOffset",a.lineDashOffset)),i&&P.push("fillStyle",o.fillStyle),P.push("textBaseline","middle"),P.push("textAlign","center");const T=.5-u;let q=u*L+T*d;const W=[],F=[];let M=0,O=0,G=0,tt=0,Z;for(let it=0,J=g.length;it<J;it+=2){const lt=g[it];if(lt===`
`){O+=M,M=0,q=u*L+T*d,++tt;continue}const ct=g[it+1]||l.font;ct!==Z&&(r&&W.push("font",ct),i&&F.push("font",ct),Z=ct),M=Math.max(M,x[G]);const Et=[lt,q+T*w[G]+u*(w[G]-b[tt]),.5*(d+M)+O];q+=w[G],r&&W.push("strokeText",Et),i&&F.push("fillText",Et),++G}return Array.prototype.push.apply(P,W),Array.prototype.push.apply(P,F),this.labels_[s]=k,k}replayTextBackground_(t,e,i,r,s,a,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,r),t.lineTo.apply(t,s),t.lineTo.apply(t,e),a&&(this.alignAndScaleFill_=a[2],t.fillStyle=a[1],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,r,s,a,o,l,h,c,u,d,g,p,y,w){o*=d[0],l*=d[1];let x=i-o,b=r-l;const L=s+h>t?t-h:s,P=a+c>e?e-c:a,R=p[3]+L*d[0]+p[1],j=p[0]+P*d[1]+p[2],k=x-p[3],T=b-p[0];(y||u!==0)&&($a[0]=k,Xa[0]=k,$a[1]=T,la[1]=T,la[0]=k+R,ha[0]=la[0],ha[1]=T+j,Xa[1]=ha[1]);let q;return u!==0?(q=Wr(Zi(),i,r,1,1,u,-i,-r),Pi(q,$a),Pi(q,la),Pi(q,ha),Pi(q,Xa),zs(Math.min($a[0],la[0],ha[0],Xa[0]),Math.min($a[1],la[1],ha[1],Xa[1]),Math.max($a[0],la[0],ha[0],Xa[0]),Math.max($a[1],la[1],ha[1],Xa[1]),Vl)):zs(Math.min(k,k+R),Math.min(T,T+j),Math.max(k,k+R),Math.max(T,T+j),Vl),g&&(x=Math.round(x),b=Math.round(b)),{drawImageX:x,drawImageY:b,drawImageW:L,drawImageH:P,originX:h,originY:c,declutterBox:{minX:Vl[0],minY:Vl[1],maxX:Vl[2],maxY:Vl[3],value:w},canvasTransform:q,scale:d}}replayImageOrLabel_(t,e,i,r,s,a,o){const l=!!(a||o),h=r.declutterBox,c=o?o[2]*r.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,$a,la,ha,Xa,a,o),aC(t,r.canvasTransform,s,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=Pi(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(i[0]%r,i[1]%r),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,r){const s=this.textStates[e],a=this.createLabel(t,e,r,i),o=this.strokeStates[i],l=this.pixelRatio,h=am(Array.isArray(t)?t[0]:t,s.textAlign||fu),c=Vd[s.textBaseline||kd],u=o&&o.lineWidth?o.lineWidth:0,d=a.width/l-2*s.scale[0],g=h*d+2*(.5-h)*u,p=c*a.height/l+2*(.5-c)*u;return{label:a,anchorX:g,anchorY:p}}execute_(t,e,i,r,s,a,o,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&Hs(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Bs(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),t5(this.renderedTransform_,i));let u=0;const d=r.length;let g=0,p,y,w,x,b,L,P,R,j,k,T,q,W,F=0,M=0;const O=this.coordinateCache_,G=this.viewRotation_,tt=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,Z={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:G},it=this.instructions!=r||this.overlaps?0:200;let J,lt,ct,Et;for(;u<d;){const S=r[u];switch(S[0]){case ee.BEGIN_GEOMETRY:J=S[1],Et=S[3],J.getGeometry()?o!==void 0&&!ki(o,Et.getExtent())?u=S[2]+1:++u:u=S[2],h&&(h.zIndex=S[4]);break;case ee.BEGIN_PATH:F>it&&(this.fill_(t),F=0),M>it&&(t.stroke(),M=0),!F&&!M&&(t.beginPath(),b=NaN,L=NaN),++u;break;case ee.CIRCLE:g=S[1];const H=c[g],K=c[g+1],st=c[g+2],ht=c[g+3],gt=st-H,mt=ht-K,Lt=Math.sqrt(gt*gt+mt*mt);t.moveTo(H+Lt,K),t.arc(H,K,Lt,0,2*Math.PI,!0),++u;break;case ee.CLOSE_PATH:t.closePath(),++u;break;case ee.CUSTOM:g=S[1],p=S[2];const Tt=S[3],Bt=S[4],Gt=S[5];Z.geometry=Tt,Z.feature=J,u in O||(O[u]=[]);const Jt=O[u];Gt?Gt(c,g,p,2,Jt):(Jt[0]=c[g],Jt[1]=c[g+1],Jt.length=2),h&&(h.zIndex=S[6]),Bt(Jt,Z),++u;break;case ee.DRAW_IMAGE:g=S[1],p=S[2],j=S[3],y=S[4],w=S[5];let pt=S[6];const Y=S[7],se=S[8],Wt=S[9],Ct=S[10];let Pt=S[11];const Nt=S[12];let Rt=S[13];x=S[14]||"declutter";const Ut=S[15];if(!j&&S.length>=20){k=S[19],T=S[20],q=S[21],W=S[22];const Se=this.drawLabelWithPointPlacement_(k,T,q,W);j=Se.label,S[3]=j;const jn=S[23];y=(Se.anchorX-jn)*this.pixelRatio,S[4]=y;const Ze=S[24];w=(Se.anchorY-Ze)*this.pixelRatio,S[5]=w,pt=j.height,S[6]=pt,Rt=j.width,S[13]=Rt}let ce;S.length>25&&(ce=S[25]);let _e,Ee,Pe;S.length>17?(_e=S[16],Ee=S[17],Pe=S[18]):(_e=Go,Ee=null,Pe=null),Ct&&tt?Pt+=G:!Ct&&!tt&&(Pt-=G);let Ye=0;for(;g<p;g+=2){if(ce&&ce[Ye++]<Rt/this.pixelRatio)continue;const Se=this.calculateImageOrLabelDimensions_(j.width,j.height,c[g],c[g+1],Rt,pt,y,w,se,Wt,Pt,Nt,s,_e,!!Ee||!!Pe,J),jn=[t,e,j,Se,Y,Ee,Pe];if(l){let Ze,Di,Ci;if(Ut){const je=p-g;if(!Ut[je]){Ut[je]={args:jn,declutterMode:x};continue}const Je=Ut[je];Ze=Je.args,Di=Je.declutterMode,delete Ut[je],Ci=Jy(Ze)}let Kt,Bi;if(Ze&&(Di!=="declutter"||!l.collides(Ci))&&(Kt=!0),(x!=="declutter"||!l.collides(Se.declutterBox))&&(Bi=!0),Di==="declutter"&&x==="declutter"){const je=Kt&&Bi;Kt=je,Bi=je}Kt&&(Di!=="none"&&l.insert(Ci),this.replayImageOrLabel_.apply(this,Ze)),Bi&&(x!=="none"&&l.insert(Se.declutterBox),this.replayImageOrLabel_.apply(this,jn))}else this.replayImageOrLabel_.apply(this,jn)}++u;break;case ee.DRAW_CHARS:const ae=S[1],Te=S[2],kt=S[3],ln=S[4];W=S[5];const Oe=S[6],tr=S[7],Ke=S[8];q=S[9];const hi=S[10];k=S[11],Array.isArray(k)&&(k=k.reduce(eT,"")),T=S[12];const pr=[S[13],S[13]];x=S[14]||"declutter";const qe=S[15],Xr=this.textStates[T],ci=Xr.font,wn=[Xr.scale[0]*tr,Xr.scale[1]*tr];let Gn;ci in this.widths_?Gn=this.widths_[ci]:(Gn={},this.widths_[ci]=Gn);const xi=N1(c,ae,Te,2),de=Math.abs(wn[0])*Ny(ci,k,Gn);if(ln||de<=xi){const Se=this.textStates[T].textAlign,jn=(xi-de)*am(k,Se),Ze=QA(c,ae,Te,2,k,jn,Oe,Math.abs(wn[0]),Ny,ci,Gn,tt?0:this.viewRotation_,qe);t:if(Ze){const Di=[];let Ci,Kt,Bi,je,Je;if(q)for(Ci=0,Kt=Ze.length;Ci<Kt;++Ci){Je=Ze[Ci],Bi=Je[4],je=this.createLabel(Bi,T,"",q),y=Je[2]+(wn[0]<0?-hi:hi),w=kt*je.height+(.5-kt)*2*hi*wn[1]/wn[0]-Ke;const ii=this.calculateImageOrLabelDimensions_(je.width,je.height,Je[0],Je[1],je.width,je.height,y,w,0,0,Je[3],pr,!1,Go,!1,J);if(l&&x==="declutter"&&l.collides(ii.declutterBox))break t;Di.push([t,e,je,ii,1,null,null])}if(W)for(Ci=0,Kt=Ze.length;Ci<Kt;++Ci){Je=Ze[Ci],Bi=Je[4],je=this.createLabel(Bi,T,W,""),y=Je[2],w=kt*je.height-Ke;const ii=this.calculateImageOrLabelDimensions_(je.width,je.height,Je[0],Je[1],je.width,je.height,y,w,0,0,Je[3],pr,!1,Go,!1,J);if(l&&x==="declutter"&&l.collides(ii.declutterBox))break t;Di.push([t,e,je,ii,1,null,null])}l&&x!=="none"&&l.load(Di.map(Jy));for(let ii=0,Ri=Di.length;ii<Ri;++ii)this.replayImageOrLabel_.apply(this,Di[ii])}}++u;break;case ee.END_GEOMETRY:if(a!==void 0){J=S[1];const Se=a(J,Et,x);if(Se)return Se}++u;break;case ee.FILL:it?F++:this.fill_(t),++u;break;case ee.MOVE_TO_LINE_TO:for(g=S[1],p=S[2],lt=c[g],ct=c[g+1],t.moveTo(lt,ct),b=lt+.5|0,L=ct+.5|0,g+=2;g<p;g+=2)lt=c[g],ct=c[g+1],P=lt+.5|0,R=ct+.5|0,(g==p-2||P!==b||R!==L)&&(t.lineTo(lt,ct),b=P,L=R);++u;break;case ee.SET_FILL_STYLE:this.alignAndScaleFill_=S[2],F&&(this.fill_(t),F=0,M&&(t.stroke(),M=0)),t.fillStyle=S[1],++u;break;case ee.SET_STROKE_STYLE:M&&(t.stroke(),M=0),this.setStrokeStyle_(t,S),++u;break;case ee.STROKE:it?M++:t.stroke(),++u;break;default:++u;break}}F&&this.fill_(t),M&&t.stroke()}execute(t,e,i,r,s,a){this.viewRotation_=r,this.execute_(t,e,i,this.instructions,s,void 0,void 0,a)}executeHitDetection(t,e,i,r,s){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,r,s)}}const hh=["Polygon","Circle","LineString","Image","Text","Default"],Wd=["Image","Text"],nT=hh.filter(n=>!Wd.includes(n));class cw{constructor(t,e,i,r,s,a,o){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Zi(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const s=t[i];for(const a in s){const o=s[a];r[a]=new iT(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let r=0,s=t.length;r<s;++r)if(t[r]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,r,s,a){r=Math.round(r);const o=r*2+1,l=Wr(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Ji(o,o));const c=this.hitDetectionContext_;c.canvas.width!==o||c.canvas.height!==o?(c.canvas.width=o,c.canvas.height=o):h||c.clearRect(0,0,o,o);let u;this.renderBuffer_!==void 0&&(u=Bn(),Wc(u,t),Vr(u,e*(this.renderBuffer_+r),u));const d=rT(r);let g;function p(R,j,k){const T=c.getImageData(0,0,o,o).data;for(let q=0,W=d.length;q<W;q++)if(T[d[q]]>0){if(!a||k==="none"||g!=="Image"&&g!=="Text"||a.includes(R)){const F=(d[q]-3)/4,M=r-F%o,O=r-(F/o|0),G=s(R,j,M*M+O*O);if(G)return G}c.clearRect(0,0,o,o);break}}const y=Object.keys(this.executorsByZIndex_).map(Number);y.sort(Ds);let w,x,b,L,P;for(w=y.length-1;w>=0;--w){const R=y[w].toString();for(b=this.executorsByZIndex_[R],x=hh.length-1;x>=0;--x)if(g=hh[x],L=b[g],L!==void 0&&(P=L.executeHitDetection(c,l,i,p,u),P))return P}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],r=e[1],s=e[2],a=e[3],o=[i,r,i,a,s,a,s,r];return Bs(o,0,8,2,t,o),o}isEmpty(){return Xo(this.executorsByZIndex_)}execute(t,e,i,r,s,a,o){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(o?Jb:Ds),a=a||hh;const h=hh.length;for(let c=0,u=l.length;c<u;++c){const d=l[c].toString(),g=this.executorsByZIndex_[d];for(let p=0,y=a.length;p<y;++p){const w=a[p],x=g[w];if(x!==void 0){const b=o===null?void 0:x.getZIndexContext(),L=b?b.getContext():t,P=this.maxExtent_&&w!=="Image"&&w!=="Text";if(P&&(L.save(),this.clip(L,i)),!b||w==="Text"||w==="Image"?x.execute(L,e,i,r,s,o):b.pushFunction(R=>x.execute(R,e,i,r,s,o)),P&&L.restore(),b){b.offset();const R=l[c]*h+p;this.deferredZIndexContexts_[R]||(this.deferredZIndexContexts_[R]=[]),this.deferredZIndexContexts_[R].push(b)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Ds);for(let i=0,r=e.length;i<r;++i)t[e[i]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),t[e[i]].length=0}}const om={};function rT(n){if(om[n]!==void 0)return om[n];const t=n*2+1,e=n*n,i=new Array(e+1);for(let s=0;s<=n;++s)for(let a=0;a<=n;++a){const o=s*s+a*a;if(o>e)break;let l=i[o];l||(l=[],i[o]=l),l.push(((n+s)*t+(n+a))*4+3),s>0&&l.push(((n-s)*t+(n+a))*4+3),a>0&&(l.push(((n+s)*t+(n-a))*4+3),s>0&&l.push(((n-s)*t+(n-a))*4+3))}const r=[];for(let s=0,a=i.length;s<a;++s)i[s]&&r.push(...i[s]);return om[n]=r,r}class sT extends lw{constructor(t,e,i,r,s,a,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=r,this.transformRotation_=r?qh(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Zi()}drawImages_(t,e,i,r){if(!this.image_)return;const s=Bs(t,e,i,r,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,l=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=s.length;c<u;c+=2){const d=s[c]-this.imageAnchorX_,g=s[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=d+this.imageAnchorX_,y=g+this.imageAnchorY_;Wr(o,p,y,1,1,h,-p,-y),a.save(),a.transform.apply(a,o),a.translate(p,y),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=l)}drawText_(t,e,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Bs(t,e,i,r,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=r){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(l-this.textOffsetX_,h-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,l,h),this.textFillState_&&a.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,r,s){const a=this.context_,o=Bs(t,e,i,r,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let l=o.length;s&&(l-=2);for(let h=2;h<l;h+=2)a.lineTo(o[h],o[h+1]);return s&&a.closePath(),i}drawRings_(t,e,i,r){for(let s=0,a=i.length;s<a;++s)e=this.moveToLineTo_(t,e,i[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ki(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=fS(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(i*i+r*r),a=this.context_;a.beginPath(),a.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ki(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ki(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=t.getFlatCoordinates();let s=0;const a=t.getEnds(),o=t.getStride();i.beginPath();for(let l=0,h=a.length;l<h;++l)s=this.moveToLineTo_(r,s,a[l],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ki(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ki(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),a=t.getStride();e.beginPath();for(let o=0,l=s.length;o<l;++o){const h=s[o];r=this.drawRings_(i,r,h,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Hs(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:fu;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=r&&(i.textAlign=r,e.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:Ns(i||lr)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),a=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=s||xa;this.strokeState_={lineCap:r!==void 0?r:kh,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(a||ba)*this.pixelRatio_,lineJoin:o!==void 0?o:Oh,lineWidth:(l!==void 0?l:du)*this.pixelRatio_,miterLimit:h!==void 0?h:cu,strokeStyle:Ns(i||uu)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/i,a[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:Ns(g||lr)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const g=i.getColor(),p=i.getLineCap(),y=i.getLineDash(),w=i.getLineDashOffset(),x=i.getLineJoin(),b=i.getWidth(),L=i.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:kh,lineDash:y||xa,lineDashOffset:w||ba,lineJoin:x!==void 0?x:Oh,lineWidth:b!==void 0?b:du,miterLimit:L!==void 0?L:cu,strokeStyle:Ns(g||uu)}}const r=t.getFont(),s=t.getOffsetX(),a=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:r!==void 0?r:T5,textAlign:u!==void 0?u:fu,textBaseline:d!==void 0?d:kd},this.text_=c!==void 0?Array.isArray(c)?c.reduce((g,p,y)=>g+=y%2?" ":p,""):c:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const aT=sT,Er=.5;function uw(n,t,e,i,r,s,a,o,l){const h=l?yg(r):r,c=n[0]*Er,u=n[1]*Er,d=Ji(c,u);d.imageSmoothingEnabled=!1;const g=d.canvas,p=new aT(d,Er,r,null,a,o,l?Au(Jv(),l):null),y=e.length,w=Math.floor((256*256*256-1)/y),x={};for(let L=1;L<=y;++L){const P=e[L-1],R=P.getStyleFunction()||i;if(!R)continue;let j=R(P,s);if(!j)continue;Array.isArray(j)||(j=[j]);const T=(L*w).toString(16).padStart(7,"#00000");for(let q=0,W=j.length;q<W;++q){const F=j[q],M=F.getGeometryFunction()(P);if(!M||!ki(h,M.getExtent()))continue;const O=F.clone(),G=O.getFill();G&&G.setColor(T);const tt=O.getStroke();tt&&(tt.setColor(T),tt.setLineDash(null)),O.setText(void 0);const Z=F.getImage();if(Z){const ct=Z.getImageSize();if(!ct)continue;const Et=Ji(ct[0],ct[1],void 0,{alpha:!1}),S=Et.canvas;Et.fillStyle=T,Et.fillRect(0,0,S.width,S.height),O.setImage(new vn({img:S,anchor:Z.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Z.getOrigin(),opacity:1,size:Z.getSize(),scale:Z.getScale(),rotation:Z.getRotation(),rotateWithView:Z.getRotateWithView()}))}const it=O.getZIndex()||0;let J=x[it];J||(J={},x[it]=J,J.Polygon=[],J.Circle=[],J.LineString=[],J.Point=[]);const lt=M.getType();if(lt==="GeometryCollection"){const ct=M.getGeometriesArrayRecursive();for(let Et=0,S=ct.length;Et<S;++Et){const U=ct[Et];J[U.getType().replace("Multi","")].push(U,O)}}else J[lt.replace("Multi","")].push(M,O)}}const b=Object.keys(x).map(Number).sort(Ds);for(let L=0,P=b.length;L<P;++L){const R=x[b[L]];for(const j in R){const k=R[j];for(let T=0,q=k.length;T<q;T+=2){p.setStyle(k[T+1]);for(let W=0,F=t.length;W<F;++W)p.setTransform(t[W]),p.drawGeometry(k[T])}}}return d.getImageData(0,0,g.width,g.height)}function fw(n,t,e){const i=[];if(e){const r=Math.floor(Math.round(n[0])*Er),s=Math.floor(Math.round(n[1])*Er),a=(pi(r,0,e.width-1)+pi(s,0,e.height-1)*e.width)*4,o=e.data[a],l=e.data[a+1],c=e.data[a+2]+256*(l+256*o),u=Math.floor((256*256*256-1)/t.length);c&&c%u===0&&i.push(t[c/u-1])}return i}const oT=.5,dw={Point:mT,LineString:fT,Polygon:_T,MultiPoint:pT,MultiLineString:dT,MultiPolygon:gT,GeometryCollection:uT,Circle:hT};function lT(n,t){return parseInt(Ht(n),10)-parseInt(Ht(t),10)}function fp(n,t){const e=gw(n,t);return e*e}function gw(n,t){return oT*n/t}function hT(n,t,e,i,r){const s=e.getFill(),a=e.getStroke();if(s||a){const l=n.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,a),l.drawCircle(t,i,r)}const o=e.getText();if(o&&o.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i)}}function Hd(n,t,e,i,r,s,a,o){const l=[],h=e.getImage();if(h){let d=!0;const g=h.getImageState();g==me.LOADED||g==me.ERROR?d=!1:g==me.IDLE&&h.load(),d&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>r(null)),cT(n,t,e,i,s,a,o),u}function cT(n,t,e,i,r,s,a){const o=e.getGeometryFunction()(t);if(!o)return;const l=o.simplifyTransformed(i,r);if(e.getRenderer())mw(n,l,e,t,a);else{const c=dw[l.getType()];c(n,l,e,t,a,s)}}function mw(n,t,e,i,r){if(t.getType()=="GeometryCollection"){const a=t.getGeometries();for(let o=0,l=a.length;o<l;++o)mw(n,a[o],e,i,r);return}n.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),r)}function uT(n,t,e,i,r,s){const a=t.getGeometriesArray();let o,l;for(o=0,l=a.length;o<l;++o){const h=dw[a[o].getType()];h(n,a[o],e,i,r,s)}}function fT(n,t,e,i,r){const s=e.getStroke();if(s){const o=n.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(t,i,r)}const a=e.getText();if(a&&a.getText()){const o=n.getBuilder(e.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,i,r)}}function dT(n,t,e,i,r){const s=e.getStroke();if(s){const o=n.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(t,i,r)}const a=e.getText();if(a&&a.getText()){const o=n.getBuilder(e.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,i,r)}}function gT(n,t,e,i,r){const s=e.getFill(),a=e.getStroke();if(a||s){const l=n.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,a),l.drawMultiPolygon(t,i,r)}const o=e.getText();if(o&&o.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,r)}}function mT(n,t,e,i,r,s){const a=e.getImage(),o=e.getText(),l=o&&o.getText(),h=s&&a&&l?{}:void 0;if(a){if(a.getImageState()!=me.LOADED)return;const c=n.getBuilder(e.getZIndex(),"Image");c.setImageStyle(a,h),c.drawPoint(t,i,r)}if(l){const c=n.getBuilder(e.getZIndex(),"Text");c.setTextStyle(o,h),c.drawText(t,i,r)}}function pT(n,t,e,i,r,s){const a=e.getImage(),o=a&&a.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=s&&o&&h?{}:void 0;if(o){if(a.getImageState()!=me.LOADED)return;const u=n.getBuilder(e.getZIndex(),"Image");u.setImageStyle(a,c),u.drawMultiPoint(t,i,r)}if(h){const u=n.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,i,r)}}function _T(n,t,e,i,r){const s=e.getFill(),a=e.getStroke();if(s||a){const l=n.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,a),l.drawPolygon(t,i,r)}const o=e.getText();if(o&&o.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,r)}}const yT=5;class pw extends Lu{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=yT}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return he()}getData(t){return null}prepareFrame(t){return he()}renderFrame(t,e){return he()}forEachFeatureAtCoordinate(t,e,i,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===me.LOADED||e.getState()===me.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=me.LOADED&&e!=me.ERROR&&t.addEventListener(ie.CHANGE,this.boundHandleImageChange_),e==me.IDLE&&(t.load(),e=t.getState()),e==me.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const t2=[];let ih=null;function vT(){ih=Ji(1,1,void 0,{willReadFrequently:!0})}class z1 extends pw{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Zi(),this.pixelTransform=Zi(),this.inversePixelTransform=Zi(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,i){ih||vT(),ih.clearRect(0,0,1,1);let r;try{ih.drawImage(t,e,i,1,1,0,0,1,1),r=ih.getImageData(0,0,1,1).data}catch{return ih=null,null}return r}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const r=this.getLayer().getClassName();let s,a;if(t&&t.className===r&&(!i||t&&t.style.backgroundColor&&Hs(Hr(t.style.backgroundColor),Hr(i)))){const o=t.firstElementChild;o instanceof HTMLCanvasElement&&(a=o.getContext("2d"))}if(a&&lS(a.canvas.style.transform,e)?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let o=s.style;o.position="absolute",o.width="100%",o.height="100%",a=Ji();const l=a.canvas;s.appendChild(l),o=l.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=s,this.context=a}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const r=xo(i),s=cg(i),a=hg(i),o=lg(i);Pi(e.coordinateToPixelTransform,r),Pi(e.coordinateToPixelTransform,s),Pi(e.coordinateToPixelTransform,a),Pi(e.coordinateToPixelTransform,o);const l=this.inversePixelTransform;Pi(l,r),Pi(l,s),Pi(l,a),Pi(l,o),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}prepareContainer(t,e){const i=t.extent,r=t.viewState.resolution,s=t.viewState.rotation,a=t.pixelRatio,o=Math.round(ke(i)/r*a),l=Math.round(_n(i)/r*a);Wr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,s,-o/2,-l/2),ou(this.inversePixelTransform,this.pixelTransform);const h=oS(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=o||c.height!=l?(c.width=o,c.height=l):this.context.clearRect(0,0,o,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){const s=new $c(t,this.inversePixelTransform,i,e);r.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(pn.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(pn.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new U1),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(pn.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(pn.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,r,s,a,o){const l=s/2,h=a/2,c=r/e,u=-c,d=-t[0]+o,g=-t[1];return Wr(this.tempTransform,l,h,c,u,-i,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class wT extends z1{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Bn(),this.wrappedRenderedExtent_=Bn(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const r=e.extent,s=e.viewState,a=s.center,o=s.resolution,l=s.projection,h=s.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),g=e.pixelRatio,p=e.viewHints,y=!(p[vi.ANIMATING]||p[vi.INTERACTING]),w=this.context,x=Math.round(ke(r)/o*g),b=Math.round(_n(r)/o*g),L=u.getWrapX()&&l.canWrapX(),P=L?ke(c):null,R=L?Math.ceil((r[2]-c[2])/P)+1:1;let j=L?Math.floor((r[0]-c[0])/P):0;do{let k=this.getRenderTransform(a,o,0,g,x,b,j*P);e.declutter&&(k=k.slice(0)),t.execute(w,[w.canvas.width,w.canvas.height],k,h,y,i===void 0?hh:i?Wd:nT,i?d&&e.declutter[d]:void 0)}while(++j<R)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Ji(this.context.canvas.width,this.context.canvas.height,t2))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Eg(this.context),t2.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const r=t.viewState;this.prepareContainer(t,e);const s=this.context,a=this.replayGroup_;let o=a&&!a.isEmpty();if(!o&&!(this.getLayer().hasListener(pn.PRERENDER)||this.getLayer().hasListener(pn.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(s,t),r.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const l=Gr(i.extent);o=ki(l,t.extent),this.clipped_=o&&!so(l,t.extent),this.clipped_&&this.clipUnrotated(s,t,l)}return o&&this.renderWorlds(a,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&s.restore(),this.postRender(s,t),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),r=this.renderedCenter_,s=this.renderedResolution_,a=this.renderedRotation_,o=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*Er,d=i[1]*Er;c.push(this.getRenderTransform(r,s,a,Er,u,d,0).slice());const g=h.getSource(),p=o.getExtent();if(g.getWrapX()&&o.canWrapX()&&!so(p,l)){let y=l[0];const w=ke(p);let x=0,b;for(;y<p[0];)--x,b=w*x,c.push(this.getRenderTransform(r,s,a,Er,u,d,b).slice()),y+=w;for(x=0,y=l[2];y>p[2];)++x,b=w*x,c.push(this.getRenderTransform(r,s,a,Er,u,d,b).slice()),y-=w}this.hitDetectionImageData_=uw(i,c,this.renderedFeatures_,h.getStyleFunction(),l,s,a,fp(s,this.renderedPixelRatio_),null)}e(fw(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,r,s){var d,g;if(!this.replayGroup_)return;const a=e.viewState.resolution,o=e.viewState.rotation,l=this.getLayer(),h={},c=function(p,y,w){const x=Ht(p),b=h[x];if(b){if(b!==!0&&w<b.distanceSq){if(w===0)return h[x]=!0,s.splice(s.lastIndexOf(b),1),r(p,l,y);b.geometry=y,b.distanceSq=w}}else{if(w===0)return h[x]=!0,r(p,l,y);s.push(h[x]={feature:p,layer:l,geometry:y,distanceSq:w,callback:r})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,a,o,i,c,u?(g=(d=e.declutter)==null?void 0:d[u])==null?void 0:g.all().map(p=>p.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const r=t.viewHints[vi.ANIMATING],s=t.viewHints[vi.INTERACTING],a=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!a&&r||!o&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,g=e.getRevision(),p=e.getRenderBuffer();let y=e.getRenderOrder();y===void 0&&(y=lT);const w=h.center.slice(),x=Vr(l,p*u),b=x.slice(),L=[x.slice()],P=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!so(P,t.extent)){const G=ke(P),tt=Math.max(ke(x)/2,G);x[0]=P[0]-tt,x[2]=P[2]+tt,ug(w,c);const Z=Gv(L[0],c);Z[0]<P[0]&&Z[2]<P[2]?L.push([Z[0]+G,Z[1],Z[2]+G,Z[3]]):Z[0]>P[0]&&Z[2]>P[2]&&L.push([Z[0]-G,Z[1],Z[2]-G,Z[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==y&&this.renderedFrameDeclutter_===!!t.declutter&&so(this.wrappedRenderedExtent_,x))return Hs(this.renderedExtent_,b)||(this.hitDetectionImageData_=null,this.renderedExtent_=b),this.renderedCenter_=w,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const R=new hw(gw(u,d),x,u,d);let j;for(let G=0,tt=L.length;G<tt;++G)i.loadFeatures(L[G],u,c);const k=fp(u,d);let T=!0;const q=(G,tt)=>{let Z;const it=G.getStyleFunction()||e.getStyleFunction();if(it&&(Z=it(G,u)),Z){const J=this.renderFeature(G,k,Z,R,j,this.getLayer().getDeclutter(),tt);T=T&&!J}},W=yg(x),F=i.getFeaturesInExtent(W);y&&F.sort(y);for(let G=0,tt=F.length;G<tt;++G)q(F[G],G);this.renderedFeatures_=F,this.ready=T;const M=R.finish(),O=new cw(x,u,d,i.getOverlaps(),M,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=y,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=b,this.wrappedRenderedExtent_=x,this.renderedCenter_=w,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=O,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,r,s,a,o){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=Hd(r,t,i[h],e,this.boundHandleStyleImageChange_,s,a,o)||l;else l=Hd(r,t,i,e,this.boundHandleStyleImageChange_,s,a,o);return l}}class xT extends Iu{constructor(t){super(t)}createRenderer(){return new wT(this)}}const Ge=xT;let bT=!1;function ET(n,t,e,i,r,s,a){const o=new XMLHttpRequest;o.open("GET",typeof n=="function"?n(e,i,r):n,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=bT,o.onload=function(l){if(!o.status||o.status>=200&&o.status<300){const h=t.getType();try{let c;h=="text"||h=="json"?c=o.responseText:h=="xml"?c=o.responseXML||o.responseText:h=="arraybuffer"&&(c=o.response),c?s(t.readFeatures(c,{extent:e,featureProjection:r}),t.readProjection(c)):a()}catch{a()}}else a()},o.onerror=a,o.send()}function e2(n,t){return function(e,i,r,s,a){ET(n,t,e,i,r,(o,l)=>{this.addFeatures(o),s!==void 0&&s(o)},()=>{this.changed(),a!==void 0&&a()})}}class dp{constructor(t){this.rbush_=new S5(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[Ht(e)]=i}load(t,e){const i=new Array(e.length);for(let r=0,s=e.length;r<s;r++){const a=t[r],o=e[r],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:o};i[r]=l,this.items_[Ht(o)]=l}this.rbush_.load(i)}remove(t){const e=Ht(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[Ht(e)],r=[i.minX,i.minY,i.maxX,i.maxY];Ko(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(r){return r.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let r=0,s=t.length;r<s;r++)if(i=e(t[r]),i)return i;return i}isEmpty(){return Xo(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return zs(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class q1 extends Ar{constructor(t){super(),this.projection=di(t.projection),this.attributions_=i2(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,r){e.viewResolver=i,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=i2(t),this.changed()}setState(t){this.state_=t,this.changed()}}function i2(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),t=>n):null}const dn={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Ya extends Cr{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Fe extends q1{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=ru,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Be(this.format_,"`format` must be set when `url` is set"),this.loader_=e2(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:zA;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new dp:null,this.loadedExtentsRtree_=new dp,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(t.features)?r=t.features:t.features&&(i=t.features,r=i.getArray()),!e&&i===void 0&&(i=new On(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Ht(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Ya(dn.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof hr||(this.featureChangeKeys_[t]=[ve(e,ie.CHANGE,this.handleFeatureChange_,this),ve(e,Ph.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof hr){const s=this.idIndex_[r];s instanceof hr?Array.isArray(s)?s.push(e):this.idIndex_[r]=[s,e]:i=!1}else i=!1}return i&&(Be(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],r=[];for(let s=0,a=t.length;s<a;s++){const o=t[s],l=Ht(o);this.addToIndex_(l,o)&&i.push(o)}for(let s=0,a=i.length;s<a;s++){const o=i[s],l=Ht(o);this.setupChangeEvents_(l,o);const h=o.getGeometry();if(h){const c=h.getExtent();e.push(c),r.push(o)}else this.nullGeometryFeatures_[l]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(dn.ADDFEATURE))for(let s=0,a=i.length;s<a;s++)this.dispatchEvent(new Ya(dn.ADDFEATURE,i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(dn.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(dn.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(Ki.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(Ki.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(ai);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Ya(dn.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(r){const s=r.getGeometry();if(s instanceof hr||s.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const r=i.getGeometry();if(r instanceof hr||r.intersectsExtent(t)){const s=e(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Xo(this.nullGeometryFeatures_)||ze(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const r=jv(t,e);return[].concat(...r.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],r=t[1];let s=null;const a=[NaN,NaN];let o=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Sa,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=o;if(o=c instanceof hr?0:c.closestPointXY(i,r,a,o),o<u){s=h;const d=Math.sqrt(o);l[0]=i-d,l[1]=r-d,l[2]=i+d,l[3]=r+d}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=Ht(e),r=e.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const a=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}const s=e.getId();if(s!==void 0){const a=s.toString();this.idIndex_[a]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[a]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Ya(dn.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Ht(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Xo(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const r=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let a=0,o=s.length;a<o;++a){const l=s[a];r.forEachInExtent(l,function(c){return so(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Ya(dn.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ya(dn.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ya(dn.FEATURESLOADERROR))}),r.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(r){if(Ko(r.extent,t))return r});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,r=t.length;i<r;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Ht(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(ai),delete this.featureChangeKeys_[e];const r=t.getId();if(r!==void 0){const s=r.toString(),a=this.idIndex_[s];a===t?delete this.idIndex_[s]:Array.isArray(a)&&(a.splice(a.indexOf(t),1),a.length===1&&(this.idIndex_[s]=a[0]))}return delete this.uidIndex_[e],this.hasListener(dn.REMOVEFEATURE)&&this.dispatchEvent(new Ya(dn.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Be(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(e2(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}const Wf={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Hf extends Cr{constructor(t,e){super(t),this.feature=e}}function ST(n,t){const e=[];for(let i=0;i<t.length;++i){const s=t[i].getGeometry();_w(n,s,e)}return e}function $f(n,t){return va(n[0],n[1],t[0],t[1])}function ch(n,t){const e=n.length;return t<0?n[t+e]:t>=e?n[t-e]:n[t]}function Xf(n,t,e){let i,r;t<e?(i=t,r=e):(i=e,r=t);const s=Math.ceil(i),a=Math.floor(r);if(s>a){const l=uh(n,i),h=uh(n,r);return $f(l,h)}let o=0;if(i<s){const l=uh(n,i),h=ch(n,s);o+=$f(l,h)}if(a<r){const l=ch(n,a),h=uh(n,r);o+=$f(l,h)}for(let l=s;l<a-1;++l){const h=ch(n,l),c=ch(n,l+1);o+=$f(h,c)}return o}function _w(n,t,e){if(t instanceof wi){Yf(n,t.getCoordinates(),!1,e);return}if(t instanceof Vs){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r)Yf(n,i[r],!1,e);return}if(t instanceof Ei){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r)Yf(n,i[r],!0,e);return}if(t instanceof $r){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,l=a.length;o<l;++o)Yf(n,a[o],!0,e)}return}if(t instanceof Ea){const i=t.getGeometries();for(let r=0;r<i.length;++r)_w(n,i[r],e);return}}const lm={index:-1,endIndex:NaN};function LT(n,t,e,i){const r=n[0],s=n[1];let a=1/0,o=-1,l=NaN;for(let u=0;u<t.targets.length;++u){const d=t.targets[u],g=d.coordinates;let p=1/0,y;for(let w=0;w<g.length-1;++w){const x=g[w],b=g[w+1],L=yw(r,s,x,b);L.squaredDistance<p&&(p=L.squaredDistance,y=w+L.along)}p<a&&(a=p,d.ring&&t.targetIndex===u&&(d.endIndex>d.startIndex?y<d.startIndex&&(y+=g.length):d.endIndex<d.startIndex&&y>d.startIndex&&(y-=g.length)),l=y,o=u)}const h=t.targets[o];let c=h.ring;if(t.targetIndex===o&&c){const u=uh(h.coordinates,l),d=e.getPixelFromCoordinate(u);Cd(d,t.startPx)>i&&(c=!1)}if(c){const u=h.coordinates,d=u.length,g=h.startIndex,p=l;if(g<p){const y=Xf(u,g,p);Xf(u,g,p-d)<y&&(l-=d)}else{const y=Xf(u,g,p);Xf(u,g,p+d)<y&&(l+=d)}}return lm.index=o,lm.endIndex=l,lm}function Yf(n,t,e,i){const r=n[0],s=n[1];for(let a=0,o=t.length-1;a<o;++a){const l=t[a],h=t[a+1],c=yw(r,s,l,h);if(c.squaredDistance===0){const u=a+c.along;i.push({coordinates:t,ring:e,startIndex:u,endIndex:u});return}}}const hm={along:0,squaredDistance:0};function yw(n,t,e,i){const r=e[0],s=e[1],a=i[0],o=i[1],l=a-r,h=o-s;let c=0,u=r,d=s;return(l!==0||h!==0)&&(c=pi(((n-r)*l+(t-s)*h)/(l*l+h*h),0,1),u+=l*c,d+=h*c),hm.along=c,hm.squaredDistance=qh(va(n,t,u,d),10),hm}function uh(n,t){const e=n.length;let i=Math.floor(t);const r=t-i;i>=e?i-=e:i<0&&(i+=e);let s=i+1;s>=e&&(s-=e);const a=n[i],o=a[0],l=a[1],h=n[s],c=h[0]-o,u=h[1]-l;return[o+c*r,l+u*r]}class CT extends $s{constructor(t){const e=t;e.stopDown||(e.stopDown=zh),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=TT(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:Sa,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const r=this.mode_;if(r==="Circle")i=(s,a,o)=>{const l=a||new tl([NaN,NaN]),h=Mi(s[0]),c=Rh(h,Mi(s[s.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let s;r==="Point"?s=fi:r==="LineString"?s=wi:r==="Polygon"&&(s=Ei),i=(a,o,l)=>(o?r==="Polygon"?a[0].length?o.setCoordinates([a[0].concat([a[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(a,this.geometryLayout_):o=new s(a,this.geometryLayout_),o)}}this.geometryFunction_=i,this.dragVertexDelay_=t.dragVertexDelay!==void 0?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Ge({source:new Fe({useSpatialIndex:!1,wrapX:t.wrapX?t.wrapX:!1}),style:t.style?t.style:AT(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:y1,this.freehandCondition_,t.freehand?this.freehandCondition_=hu:this.freehandCondition_=t.freehandCondition?t.freehandCondition:Pu,this.traceCondition_,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(Jm.ACTIVE,this.updateState_)}setTrace(t){let e;t?t===!0?e=hu:e=t:e=tp,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===ie.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(t);let e=t.type===Ie.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===Ie.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===Ie.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===Ie.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===Ie.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):(t.originalEvent.pointerType==="mouse"||t.type===Ie.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(t)):t.type===Ie.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Ms(Ie.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))},this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active){this.deactivateTrace_();return}const e=this.getMap(),i=e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),r=e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_]),s=bn([i,r]),a=this.traceSource_.getFeaturesInExtent(s);if(a.length===0)return;const o=ST(t.coordinate,a);o.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex,r=t.startIndex<=e;i===r?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const r=Math.ceil(t);let s=Math.floor(e);s===e&&(s-=1),i=s-r+1}else{const r=Math.floor(t);let s=Math.ceil(e);s===e&&(s+=1),i=r-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const r=[];if(e<i){const s=Math.ceil(e);let a=Math.floor(i);a===i&&(a-=1);for(let o=s;o<=a;++o)r.push(ch(t.coordinates,o))}else{const s=Math.floor(e);let a=Math.ceil(i);a===i&&(a+=1);for(let o=s;o>=a;--o)r.push(ch(t.coordinates,o))}r.length&&this.appendCoordinates(r)}updateTrace_(t){const e=this.traceState_;if(!e.active||e.targetIndex===-1&&Cd(e.startPx,t.pixel)<this.snapTolerance_)return;const i=LT(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(e.targetIndex!==-1){const l=e.targets[e.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const o=e.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}e.targetIndex=i.index;const r=e.targets[e.targetIndex];r.endIndex=i.endIndex;const s=uh(r.coordinates,r.endIndex),a=this.getMap().getPixelFromCoordinate(s);t.coordinate=s,t.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(t){let e=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(t.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,r=e[0]-i[0],s=e[1]-i[1],a=r*r+s*s;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(t.coordinate.slice());return}this.updateTrace_(t),this.modifyDrawing_(t.coordinate)}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let r=!1,s=[this.finishCoordinate_];const a=this.mode_;if(a==="Point")i=!0;else if(a==="Circle")i=this.sketchCoords_.length===2;else if(a==="LineString")r=!e&&this.sketchCoords_.length>this.minPoints_;else if(a==="Polygon"){const o=this.sketchCoords_;r=o[0].length>this.minPoints_,s=[o[0][0],o[0][o[0].length-2]],e?s=[o[0][0]]:s=[o[0][0],o[0][o[0].length-2]]}if(r){const o=this.getMap();for(let l=0,h=s.length;l<h;l++){const c=s[l],u=o.getPixelFromCoordinate(c),d=t[0]-u[0],g=t[1]-u[1],p=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+g*g)<=p,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new ei(new fi(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new ei);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new wi(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=Rd(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,this.mode_==="Point"?this.sketchCoords_=t.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new ei(new wi(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new ei,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new Hf(Wf.DRAWSTART,this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),r=e.getView().getProjection(),s=Rd(this.geometryLayout_);let a,o;for(;t.length<s;)t.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(a=this.sketchCoords_[0],o=a[a.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(a=this.sketchCoords_,o=a[a.length-1]),o[0]=t[0],o[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,s;const a=this.mode_;return a==="LineString"||a==="Circle"?(this.finishCoordinate_=t.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(t.slice()),this.geometryFunction_(s,e,i)):a==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(t.slice()),r&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let s=0;s<t;++s){let a;if(r==="LineString"||r==="Circle"){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const o=this.finishCoordinate_.slice();a[a.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(a,e,i),e.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(r==="Polygon"){a=this.sketchCoords_[0],a.splice(-2,1);const o=this.sketchLine_.getGeometry();if(a.length>=2){const l=a[a.length-2].slice();a[a.length-1]=l,this.createOrUpdateSketchPoint_(l)}o.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,e,i)}if(a.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return null;let e=this.sketchCoords_;const i=t.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(e.pop(),this.geometryFunction_(e,i,r)):this.mode_==="Polygon"&&(e[0].pop(),this.geometryFunction_(e,i,r),e=i.getCoordinates()),this.type_==="MultiPoint"?t.setGeometry(new Nu([e])):this.type_==="MultiLineString"?t.setGeometry(new Vs([e])):this.type_==="MultiPolygon"&&t.setGeometry(new $r([e])),this.dispatchEvent(new Hf(Wf.DRAWEND,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t),t}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new Hf(Wf.DRAWABORT,t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(t[0]);let r;if(e==="LineString"||e==="Circle")r=this.sketchCoords_;else if(e==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&r.shift(),r.pop();for(let a=0;a<t.length;a++)this.addToDrawing_(t[a]);const s=t[t.length-1];this.sketchFeature_=this.addToDrawing_(s),this.modifyDrawing_(s)}extend(t){const i=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new ei(new fi(r)),this.updateSketchFeatures_(),this.dispatchEvent(new Hf(Wf.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}}function AT(){const n=P1();return function(t,e){return n[t.getGeometry().getType()]}}function TT(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const io=CT,MT="modulepreload",PT=function(n){return"/"+n},n2={},gp=function(t,e,i){let r=Promise.resolve();if(e&&e.length>0){const s=document.getElementsByTagName("link");r=Promise.all(e.map(a=>{if(a=PT(a),a in n2)return;n2[a]=!0;const o=a.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!i)for(let u=s.length-1;u>=0;u--){const d=s[u];if(d.href===a&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":MT,o||(c.as="script",c.crossOrigin=""),c.href=a,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${a}`)))})}))}return r.then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};function oi(n){"@babel/helpers - typeof";return oi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oi(n)}var Hn=Uint8Array,$n=Uint16Array,pu=Uint32Array,Fg=new Hn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kg=new Hn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),mp=new Hn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vw=function(n,t){for(var e=new $n(31),i=0;i<31;++i)e[i]=t+=1<<n[i-1];for(var r=new pu(e[30]),i=1;i<30;++i)for(var s=e[i];s<e[i+1];++s)r[s]=s-e[i]<<5|i;return[e,r]},ww=vw(Fg,2),xw=ww[0],pp=ww[1];xw[28]=258,pp[258]=28;var bw=vw(kg,0),RT=bw[0],r2=bw[1],_p=new $n(32768);for(var bi=0;bi<32768;++bi){var Ka=(bi&43690)>>>1|(bi&21845)<<1;Ka=(Ka&52428)>>>2|(Ka&13107)<<2,Ka=(Ka&61680)>>>4|(Ka&3855)<<4,_p[bi]=((Ka&65280)>>>8|(Ka&255)<<8)>>>1}var Gs=function(n,t,e){for(var i=n.length,r=0,s=new $n(t);r<i;++r)++s[n[r]-1];var a=new $n(t);for(r=0;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;var o;if(e){o=new $n(1<<t);var l=15-t;for(r=0;r<i;++r)if(n[r])for(var h=r<<4|n[r],c=t-n[r],u=a[n[r]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)o[_p[u]>>>l]=h}else for(o=new $n(i),r=0;r<i;++r)o[r]=_p[a[n[r]-1]++]>>>15-n[r];return o},_o=new Hn(288);for(var bi=0;bi<144;++bi)_o[bi]=8;for(var bi=144;bi<256;++bi)_o[bi]=9;for(var bi=256;bi<280;++bi)_o[bi]=7;for(var bi=280;bi<288;++bi)_o[bi]=8;var _u=new Hn(32);for(var bi=0;bi<32;++bi)_u[bi]=5;var IT=Gs(_o,9,0),NT=Gs(_o,9,1),FT=Gs(_u,5,0),kT=Gs(_u,5,1),cm=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},ls=function(n,t,e){var i=t/8>>0;return(n[i]|n[i+1]<<8)>>>(t&7)&e},um=function(n,t){var e=t/8>>0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>>(t&7)},V1=function(n){return(n/8>>0)+(n&7&&1)},Ew=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var i=new(n instanceof $n?$n:n instanceof pu?pu:Hn)(e-t);return i.set(n.subarray(t,e)),i},OT=function(n,t,e){var i=n.length,r=!t||e,s=!e||e.i;e||(e={}),t||(t=new Hn(i*3));var a=function(st){var ht=t.length;if(st>ht){var gt=new Hn(Math.max(ht*2,st));gt.set(t),t=gt}},o=e.f||0,l=e.p||0,h=e.b||0,c=e.l,u=e.d,d=e.m,g=e.n,p=i*8;do{if(!c){e.f=o=ls(n,l,1);var y=ls(n,l+1,3);if(l+=3,y)if(y==1)c=NT,u=kT,d=9,g=5;else if(y==2){var L=ls(n,l,31)+257,P=ls(n,l+10,15)+4,R=L+ls(n,l+5,31)+1;l+=14;for(var j=new Hn(R),k=new Hn(19),T=0;T<P;++T)k[mp[T]]=ls(n,l+T*3,7);l+=P*3;var q=cm(k),W=(1<<q)-1;if(!s&&l+R*(q+7)>p)break;for(var F=Gs(k,q,1),T=0;T<R;){var M=F[ls(n,l,W)];l+=M&15;var w=M>>>4;if(w<16)j[T++]=w;else{var O=0,G=0;for(w==16?(G=3+ls(n,l,3),l+=2,O=j[T-1]):w==17?(G=3+ls(n,l,7),l+=3):w==18&&(G=11+ls(n,l,127),l+=7);G--;)j[T++]=O}}var tt=j.subarray(0,L),Z=j.subarray(L);d=cm(tt),g=cm(Z),c=Gs(tt,d,1),u=Gs(Z,g,1)}else throw"invalid block type";else{var w=V1(l)+4,x=n[w-4]|n[w-3]<<8,b=w+x;if(b>i){if(s)throw"unexpected EOF";break}r&&a(h+x),t.set(n.subarray(w,b),h),e.b=h+=x,e.p=l=b*8;continue}if(l>p)throw"unexpected EOF"}r&&a(h+131072);for(var it=(1<<d)-1,J=(1<<g)-1,lt=d+g+18;s||l+lt<p;){var O=c[um(n,l)&it],ct=O>>>4;if(l+=O&15,l>p)throw"unexpected EOF";if(!O)throw"invalid length/literal";if(ct<256)t[h++]=ct;else if(ct==256){c=null;break}else{var Et=ct-254;if(ct>264){var T=ct-257,S=Fg[T];Et=ls(n,l,(1<<S)-1)+xw[T],l+=S}var U=u[um(n,l)&J],H=U>>>4;if(!U)throw"invalid distance";l+=U&15;var Z=RT[H];if(H>3){var S=kg[H];Z+=um(n,l)&(1<<S)-1,l+=S}if(l>p)throw"unexpected EOF";r&&a(h+131072);for(var K=h+Et;h<K;h+=4)t[h]=t[h-Z],t[h+1]=t[h+1-Z],t[h+2]=t[h+2-Z],t[h+3]=t[h+3-Z];h=K}}e.l=c,e.p=l,e.b=h,c&&(o=1,e.m=d,e.d=u,e.n=g)}while(!o);return h==t.length?t:Ew(t,0,h)},ca=function(n,t,e){e<<=t&7;var i=t/8>>0;n[i]|=e,n[i+1]|=e>>>8},Pc=function(n,t,e){e<<=t&7;var i=t/8>>0;n[i]|=e,n[i+1]|=e>>>8,n[i+2]|=e>>>16},fm=function(n,t){for(var e=[],i=0;i<n.length;++i)n[i]&&e.push({s:i,f:n[i]});var r=e.length,s=e.slice();if(!r)return[new Hn(0),0];if(r==1){var a=new Hn(e[0].s+1);return a[e[0].s]=1,[a,1]}e.sort(function(R,j){return R.f-j.f}),e.push({s:-1,f:25001});var o=e[0],l=e[1],h=0,c=1,u=2;for(e[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=r-1;)o=e[e[h].f<e[u].f?h++:u++],l=e[h!=c&&e[h].f<e[u].f?h++:u++],e[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var d=s[0].s,i=1;i<r;++i)s[i].s>d&&(d=s[i].s);var g=new $n(d+1),p=yp(e[c-1],g,0);if(p>t){var i=0,y=0,w=p-t,x=1<<w;for(s.sort(function(j,k){return g[k.s]-g[j.s]||j.f-k.f});i<r;++i){var b=s[i].s;if(g[b]>t)y+=x-(1<<p-g[b]),g[b]=t;else break}for(y>>>=w;y>0;){var L=s[i].s;g[L]<t?y-=1<<t-g[L]++-1:++i}for(;i>=0&&y;--i){var P=s[i].s;g[P]==t&&(--g[P],++y)}p=t}return[new Hn(g),p]},yp=function(n,t,e){return n.s==-1?Math.max(yp(n.l,t,e+1),yp(n.r,t,e+1)):t[n.s]=e},s2=function(n){for(var t=n.length;t&&!n[--t];);for(var e=new $n(++t),i=0,r=n[0],s=1,a=function(l){e[i++]=l},o=1;o<=t;++o)if(n[o]==r&&o!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(r),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(r);s=1,r=n[o]}return[e.subarray(0,i),t]},Rc=function(n,t){for(var e=0,i=0;i<t.length;++i)e+=n[i]*t[i];return e},fd=function(n,t,e){var i=e.length,r=V1(t+2);n[r]=i&255,n[r+1]=i>>>8,n[r+2]=n[r]^255,n[r+3]=n[r+1]^255;for(var s=0;s<i;++s)n[r+s+4]=e[s];return(r+4+i)*8},a2=function(n,t,e,i,r,s,a,o,l,h,c){ca(t,c++,e),++r[256];for(var u=fm(r,15),d=u[0],g=u[1],p=fm(s,15),y=p[0],w=p[1],x=s2(d),b=x[0],L=x[1],P=s2(y),R=P[0],j=P[1],k=new $n(19),T=0;T<b.length;++T)k[b[T]&31]++;for(var T=0;T<R.length;++T)k[R[T]&31]++;for(var q=fm(k,7),W=q[0],F=q[1],M=19;M>4&&!W[mp[M-1]];--M);var O=h+5<<3,G=Rc(r,_o)+Rc(s,_u)+a,tt=Rc(r,d)+Rc(s,y)+a+14+3*M+Rc(k,W)+(2*k[16]+3*k[17]+7*k[18]);if(O<=G&&O<=tt)return fd(t,c,n.subarray(l,l+h));var Z,it,J,lt;if(ca(t,c,1+(tt<G)),c+=2,tt<G){Z=Gs(d,g,0),it=d,J=Gs(y,w,0),lt=y;var ct=Gs(W,F,0);ca(t,c,L-257),ca(t,c+5,j-1),ca(t,c+10,M-4),c+=14;for(var T=0;T<M;++T)ca(t,c+3*T,W[mp[T]]);c+=3*M;for(var Et=[b,R],S=0;S<2;++S)for(var U=Et[S],T=0;T<U.length;++T){var H=U[T]&31;ca(t,c,ct[H]),c+=W[H],H>15&&(ca(t,c,U[T]>>>5&127),c+=U[T]>>>12)}}else Z=IT,it=_o,J=FT,lt=_u;for(var T=0;T<o;++T)if(i[T]>255){var H=i[T]>>>18&31;Pc(t,c,Z[H+257]),c+=it[H+257],H>7&&(ca(t,c,i[T]>>>23&31),c+=Fg[H]);var K=i[T]&31;Pc(t,c,J[K]),c+=lt[K],K>3&&(Pc(t,c,i[T]>>>5&8191),c+=kg[K])}else Pc(t,c,Z[i[T]]),c+=it[i[T]];return Pc(t,c,Z[256]),c+it[256]},DT=new pu([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),BT=new Hn(0),GT=function(n,t,e,i,r,s){var a=n.length,o=new Hn(i+a+5*(1+Math.floor(a/7e3))+r),l=o.subarray(i,o.length-r),h=0;if(!t||a<8)for(var c=0;c<=a;c+=65535){var u=c+65535;u<a?h=fd(l,h,n.subarray(c,u)):(l[c]=s,h=fd(l,h,n.subarray(c,a)))}else{for(var d=DT[t-1],g=d>>>13,p=d&8191,y=(1<<e)-1,w=new $n(32768),x=new $n(y+1),b=Math.ceil(e/3),L=2*b,P=function(Jt){return(n[Jt]^n[Jt+1]<<b^n[Jt+2]<<L)&y},R=new pu(25e3),j=new $n(288),k=new $n(32),T=0,q=0,c=0,W=0,F=0,M=0;c<a;++c){var O=P(c),G=c&32767,tt=x[O];if(w[G]=tt,x[O]=G,F<=c){var Z=a-c;if((T>7e3||W>24576)&&Z>423){h=a2(n,l,0,R,j,k,q,W,M,c-M,h),W=T=q=0,M=c;for(var it=0;it<286;++it)j[it]=0;for(var it=0;it<30;++it)k[it]=0}var J=2,lt=0,ct=p,Et=G-tt&32767;if(Z>2&&O==P(c-Et))for(var S=Math.min(g,Z)-1,U=Math.min(32767,c),H=Math.min(258,Z);Et<=U&&--ct&&G!=tt;){if(n[c+J]==n[c+J-Et]){for(var K=0;K<H&&n[c+K]==n[c+K-Et];++K);if(K>J){if(J=K,lt=Et,K>S)break;for(var st=Math.min(Et,K-2),ht=0,it=0;it<st;++it){var gt=c-Et+it+32768&32767,mt=w[gt],Lt=gt-mt+32768&32767;Lt>ht&&(ht=Lt,tt=gt)}}}G=tt,tt=w[G],Et+=G-tt+32768&32767}if(lt){R[W++]=268435456|pp[J]<<18|r2[lt];var Tt=pp[J]&31,Bt=r2[lt]&31;q+=Fg[Tt]+kg[Bt],++j[257+Tt],++k[Bt],F=c+J,++T}else R[W++]=n[c],++j[n[c]]}}h=a2(n,l,s,R,j,k,q,W,M,c-M,h),s||(h=fd(l,h,BT))}return Ew(o,0,i+V1(h)+r)},jT=function(){var n=1,t=0;return{p:function(e){for(var i=n,r=t,s=e.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)i+=e[a],r+=i;i%=65521,r%=65521}n=i,t=r},d:function(){return(n>>>8<<16|(t&255)<<8|t>>>8)+((n&255)<<23)*2}}},UT=function(n,t,e,i,r){return GT(n,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+t.mem,e,i,!r)},zT=function(n,t,e){for(;e;++t)n[t]=e,e>>>=8},qT=function(n,t){var e=t.level,i=e==0?0:e<6?1:e==9?3:2;n[0]=120,n[1]=i<<6|(i?32-2*i:1)},VT=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function vp(n,t){t===void 0&&(t={});var e=jT();e.p(n);var i=UT(n,t,2,4);return qT(i,t),zT(i,i.length-4,e.d()),i}function WT(n,t){return OT((VT(n),n.subarray(2,-4)),t)}var le=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function dm(){le.console&&typeof le.console.log=="function"&&le.console.log.apply(le.console,arguments)}var mi={log:dm,warn:function(n){le.console&&(typeof le.console.warn=="function"?le.console.warn.apply(le.console,arguments):dm.call(null,arguments))},error:function(n){le.console&&(typeof le.console.error=="function"?le.console.error.apply(le.console,arguments):dm(n))}};function gm(n,t,e){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){Fo(i.response,t,e)},i.onerror=function(){mi.error("could not download file")},i.send()}function o2(n){var t=new XMLHttpRequest;t.open("HEAD",n,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Kf(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}}var Zc,wp,Fo=le.saveAs||((typeof window>"u"?"undefined":oi(window))!=="object"||window!==le?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,t,e){var i=le.URL||le.webkitURL,r=document.createElement("a");t=t||n.name||"download",r.download=t,r.rel="noopener",typeof n=="string"?(r.href=n,r.origin!==location.origin?o2(r.href)?gm(n,t,e):Kf(r,r.target="_blank"):Kf(r)):(r.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(r.href)},4e4),setTimeout(function(){Kf(r)},0))}:"msSaveOrOpenBlob"in navigator?function(n,t,e){if(t=t||n.name||"download",typeof n=="string")if(o2(n))gm(n,t,e);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){Kf(i)})}else navigator.msSaveOrOpenBlob(function(r,s){return s===void 0?s={autoBom:!1}:oi(s)!=="object"&&(mi.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r}(n,e),t)}:function(n,t,e,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return gm(n,t,e);var r=n.type==="application/octet-stream",s=/constructor/i.test(le.HTMLElement)||le.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||r&&s)&&(typeof FileReader>"u"?"undefined":oi(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var c=o.result;c=a?c:c.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=c:location=c,i=null},o.readAsDataURL(n)}else{var l=le.URL||le.webkitURL,h=l.createObjectURL(n);i?i.location=h:location.href=h,i=null,setTimeout(function(){l.revokeObjectURL(h)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Sw(n){var t;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],i=0;i<e.length;i++){var r=e[i].re,s=e[i].process,a=r.exec(n);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),l=this.g.toString(16),h=this.b.toString(16);return o.length==1&&(o="0"+o),l.length==1&&(l="0"+l),h.length==1&&(h="0"+h),"#"+o+l+h}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function mm(n,t){var e=n[0],i=n[1],r=n[2],s=n[3];e=Mn(e,i,r,s,t[0],7,-680876936),s=Mn(s,e,i,r,t[1],12,-389564586),r=Mn(r,s,e,i,t[2],17,606105819),i=Mn(i,r,s,e,t[3],22,-1044525330),e=Mn(e,i,r,s,t[4],7,-176418897),s=Mn(s,e,i,r,t[5],12,1200080426),r=Mn(r,s,e,i,t[6],17,-1473231341),i=Mn(i,r,s,e,t[7],22,-45705983),e=Mn(e,i,r,s,t[8],7,1770035416),s=Mn(s,e,i,r,t[9],12,-1958414417),r=Mn(r,s,e,i,t[10],17,-42063),i=Mn(i,r,s,e,t[11],22,-1990404162),e=Mn(e,i,r,s,t[12],7,1804603682),s=Mn(s,e,i,r,t[13],12,-40341101),r=Mn(r,s,e,i,t[14],17,-1502002290),e=Pn(e,i=Mn(i,r,s,e,t[15],22,1236535329),r,s,t[1],5,-165796510),s=Pn(s,e,i,r,t[6],9,-1069501632),r=Pn(r,s,e,i,t[11],14,643717713),i=Pn(i,r,s,e,t[0],20,-373897302),e=Pn(e,i,r,s,t[5],5,-701558691),s=Pn(s,e,i,r,t[10],9,38016083),r=Pn(r,s,e,i,t[15],14,-660478335),i=Pn(i,r,s,e,t[4],20,-405537848),e=Pn(e,i,r,s,t[9],5,568446438),s=Pn(s,e,i,r,t[14],9,-1019803690),r=Pn(r,s,e,i,t[3],14,-187363961),i=Pn(i,r,s,e,t[8],20,1163531501),e=Pn(e,i,r,s,t[13],5,-1444681467),s=Pn(s,e,i,r,t[2],9,-51403784),r=Pn(r,s,e,i,t[7],14,1735328473),e=Rn(e,i=Pn(i,r,s,e,t[12],20,-1926607734),r,s,t[5],4,-378558),s=Rn(s,e,i,r,t[8],11,-2022574463),r=Rn(r,s,e,i,t[11],16,1839030562),i=Rn(i,r,s,e,t[14],23,-35309556),e=Rn(e,i,r,s,t[1],4,-1530992060),s=Rn(s,e,i,r,t[4],11,1272893353),r=Rn(r,s,e,i,t[7],16,-155497632),i=Rn(i,r,s,e,t[10],23,-1094730640),e=Rn(e,i,r,s,t[13],4,681279174),s=Rn(s,e,i,r,t[0],11,-358537222),r=Rn(r,s,e,i,t[3],16,-722521979),i=Rn(i,r,s,e,t[6],23,76029189),e=Rn(e,i,r,s,t[9],4,-640364487),s=Rn(s,e,i,r,t[12],11,-421815835),r=Rn(r,s,e,i,t[15],16,530742520),e=In(e,i=Rn(i,r,s,e,t[2],23,-995338651),r,s,t[0],6,-198630844),s=In(s,e,i,r,t[7],10,1126891415),r=In(r,s,e,i,t[14],15,-1416354905),i=In(i,r,s,e,t[5],21,-57434055),e=In(e,i,r,s,t[12],6,1700485571),s=In(s,e,i,r,t[3],10,-1894986606),r=In(r,s,e,i,t[10],15,-1051523),i=In(i,r,s,e,t[1],21,-2054922799),e=In(e,i,r,s,t[8],6,1873313359),s=In(s,e,i,r,t[15],10,-30611744),r=In(r,s,e,i,t[6],15,-1560198380),i=In(i,r,s,e,t[13],21,1309151649),e=In(e,i,r,s,t[4],6,-145523070),s=In(s,e,i,r,t[11],10,-1120210379),r=In(r,s,e,i,t[2],15,718787259),i=In(i,r,s,e,t[9],21,-343485551),n[0]=ho(e,n[0]),n[1]=ho(i,n[1]),n[2]=ho(r,n[2]),n[3]=ho(s,n[3])}function Og(n,t,e,i,r,s){return t=ho(ho(t,n),ho(i,s)),ho(t<<r|t>>>32-r,e)}function Mn(n,t,e,i,r,s,a){return Og(t&e|~t&i,n,t,r,s,a)}function Pn(n,t,e,i,r,s,a){return Og(t&i|e&~i,n,t,r,s,a)}function Rn(n,t,e,i,r,s,a){return Og(t^e^i,n,t,r,s,a)}function In(n,t,e,i,r,s,a){return Og(e^(t|~i),n,t,r,s,a)}function Lw(n){var t,e=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=n.length;t+=64)mm(i,HT(n.substring(t-64,t)));n=n.substring(t-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n.length;t++)r[t>>2]|=n.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(mm(i,r),t=0;t<16;t++)r[t]=0;return r[14]=8*e,mm(i,r),i}function HT(n){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=n.charCodeAt(t)+(n.charCodeAt(t+1)<<8)+(n.charCodeAt(t+2)<<16)+(n.charCodeAt(t+3)<<24);return e}Zc=le.atob.bind(le),wp=le.btoa.bind(le);var l2="0123456789abcdef".split("");function $T(n){for(var t="",e=0;e<4;e++)t+=l2[n>>8*e+4&15]+l2[n>>8*e&15];return t}function XT(n){return String.fromCharCode((255&n)>>0,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function xp(n){return Lw(n).map(XT).join("")}var YT=function(n){for(var t=0;t<n.length;t++)n[t]=$T(n[t]);return n.join("")}(Lw("hello"))!="5d41402abc4b2a76b9719d911017c592";function ho(n,t){if(YT){var e=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(e>>16)<<16|65535&e}return n+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function bp(n,t){var e,i,r,s;if(n!==e){for(var a=(r=n,s=1+(256/n.length>>0),new Array(s+1).join(r)),o=[],l=0;l<256;l++)o[l]=l;var h=0;for(l=0;l<256;l++){var c=o[l];h=(h+c+a.charCodeAt(l))%256,o[l]=o[h],o[h]=c}e=n,i=o}else o=i;var u=t.length,d=0,g=0,p="";for(l=0;l<u;l++)g=(g+(c=o[d=(d+1)%256]))%256,o[d]=o[g],o[g]=c,a=o[(o[d]+o[g])%256],p+=String.fromCharCode(t.charCodeAt(l)^a);return p}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var h2={print:4,modify:8,copy:16,"annot-forms":32};function nh(n,t,e,i){this.v=1,this.r=2;var r=192;n.forEach(function(o){if(h2.perm!==void 0)throw new Error("Invalid permission: "+o);r+=h2[o]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(t+this.padding).substr(0,32),a=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^r)),this.encryptionKey=xp(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=bp(this.encryptionKey,this.padding)}function rh(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var t="",e=n.length,i=0;i<e;i++){var r=n.charCodeAt(i);r<33||r===35||r===37||r===40||r===41||r===47||r===60||r===62||r===91||r===93||r===123||r===125||r>126?t+="#"+("0"+r.toString(16)).slice(-2):t+=n[i]}return t}function c2(n){if(oi(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,i,r){if(r=r||!1,typeof e!="string"||typeof i!="function"||typeof r!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[i,!!r],s},this.unsubscribe=function(e){for(var i in t)if(t[i][e])return delete t[i][e],Object.keys(t[i]).length===0&&delete t[i],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var i=Array.prototype.slice.call(arguments,1),r=[];for(var s in t[e]){var a=t[e][s];try{a[0].apply(n,i)}catch(o){le.console&&mi.error("jsPDF PubSub Error",o.message,o)}a[1]&&r.push(s)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function $d(n){if(!(this instanceof $d))return new $d(n);var t="opacity,stroke-opacity".split(",");for(var e in n)n.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=n[e]);this.id="",this.objectNumber=-1}function Cw(n,t){this.gState=n,this.matrix=t,this.id="",this.objectNumber=-1}function ko(n,t,e,i,r){if(!(this instanceof ko))return new ko(n,t,e,i,r);this.type=n==="axial"?2:3,this.coords=t,this.colors=e,Cw.call(this,i,r)}function fh(n,t,e,i,r){if(!(this instanceof fh))return new fh(n,t,e,i,r);this.boundingBox=n,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,Cw.call(this,i,r)}function oe(n){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],r=arguments[2],s=arguments[3],a=[],o=1,l=16,h="S",c=null;oi(n=n||{})==="object"&&(e=n.orientation,i=n.unit||i,r=n.format||r,s=n.compress||n.compressPdf||s,(c=n.encryption||null)!==null&&(c.userPassword=c.userPassword||"",c.ownerPassword=c.ownerPassword||"",c.userPermissions=c.userPermissions||[]),o=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(t=n.precision),n.floatPrecision!==void 0&&(l=n.floatPrecision),h=n.defaultPathOperation||"S"),a=n.filters||(s===!0?["FlateEncode"]:a),i=i||"mm",e=(""+(e||"P")).toLowerCase();var u=n.putOnlyUsedFonts||!1,d={},g={internal:{},__private__:{}};g.__private__.PubSub=c2;var p="1.3",y=g.__private__.getPdfVersion=function(){return p};g.__private__.setPdfVersion=function(_){p=_};var w={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};g.__private__.getPageFormats=function(){return w};var x=g.__private__.getPageFormat=function(_){return w[_]};r=r||"a4";var b={COMPAT:"compat",ADVANCED:"advanced"},L=b.COMPAT;function P(){this.saveGraphicsState(),Y(new Kt(kt,0,0,-kt,0,Na()*kt).toString()+" cm"),this.setFontSize(this.getFontSize()/kt),h="n",L=b.ADVANCED}function R(){this.restoreGraphicsState(),h="S",L=b.COMPAT}var j=g.__private__.combineFontStyleAndFontWeight=function(_,A){if(_=="bold"&&A=="normal"||_=="bold"&&A==400||_=="normal"&&A=="italic"||_=="bold"&&A=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return A&&(_=A==400||A==="normal"?_==="italic"?"italic":"normal":A!=700&&A!=="bold"||_!=="normal"?(A==700?"bold":A)+""+_:"bold"),_};g.advancedAPI=function(_){var A=L===b.COMPAT;return A&&P.call(this),typeof _!="function"||(_(this),A&&R.call(this)),this},g.compatAPI=function(_){var A=L===b.ADVANCED;return A&&R.call(this),typeof _!="function"||(_(this),A&&P.call(this)),this},g.isAdvancedAPI=function(){return L===b.ADVANCED};var k,T=function(_){if(L!==b.ADVANCED)throw new Error(_+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},q=g.roundToPrecision=g.__private__.roundToPrecision=function(_,A){var V=t||A;if(isNaN(_)||isNaN(V))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return _.toFixed(V).replace(/0+$/,"")};k=g.hpf=g.__private__.hpf=typeof l=="number"?function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.hpf");return q(_,l)}:l==="smart"?function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.hpf");return q(_,_>-1&&_<1?16:5)}:function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.hpf");return q(_,16)};var W=g.f2=g.__private__.f2=function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.f2");return q(_,2)},F=g.__private__.f3=function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.f3");return q(_,3)},M=g.scale=g.__private__.scale=function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.scale");return L===b.COMPAT?_*kt:L===b.ADVANCED?_:void 0},O=function(_){return L===b.COMPAT?Na()-_:L===b.ADVANCED?_:void 0},G=function(_){return M(O(_))};g.__private__.setPrecision=g.setPrecision=function(_){typeof parseInt(_,10)=="number"&&(t=parseInt(_,10))};var tt,Z="00000000000000000000000000000000",it=g.__private__.getFileId=function(){return Z},J=g.__private__.setFileId=function(_){return Z=_!==void 0&&/^[a-fA-F0-9]{32}$/.test(_)?_.toUpperCase():Z.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),c!==null&&(Cn=new nh(c.userPermissions,c.userPassword,c.ownerPassword,Z)),Z};g.setFileId=function(_){return J(_),this},g.getFileId=function(){return it()};var lt=g.__private__.convertDateToPDFDate=function(_){var A=_.getTimezoneOffset(),V=A<0?"+":"-",Q=Math.floor(Math.abs(A/60)),ot=Math.abs(A%60),yt=[V,H(Q),"'",H(ot),"'"].join("");return["D:",_.getFullYear(),H(_.getMonth()+1),H(_.getDate()),H(_.getHours()),H(_.getMinutes()),H(_.getSeconds()),yt].join("")},ct=g.__private__.convertPDFDateToDate=function(_){var A=parseInt(_.substr(2,4),10),V=parseInt(_.substr(6,2),10)-1,Q=parseInt(_.substr(8,2),10),ot=parseInt(_.substr(10,2),10),yt=parseInt(_.substr(12,2),10),At=parseInt(_.substr(14,2),10);return new Date(A,V,Q,ot,yt,At,0)},Et=g.__private__.setCreationDate=function(_){var A;if(_===void 0&&(_=new Date),_ instanceof Date)A=lt(_);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(_))throw new Error("Invalid argument passed to jsPDF.setCreationDate");A=_}return tt=A},S=g.__private__.getCreationDate=function(_){var A=tt;return _==="jsDate"&&(A=ct(tt)),A};g.setCreationDate=function(_){return Et(_),this},g.getCreationDate=function(_){return S(_)};var U,H=g.__private__.padd2=function(_){return("0"+parseInt(_)).slice(-2)},K=g.__private__.padd2Hex=function(_){return("00"+(_=_.toString())).substr(_.length)},st=0,ht=[],gt=[],mt=0,Lt=[],Tt=[],Bt=!1,Gt=gt,Jt=function(){st=0,mt=0,gt=[],ht=[],Lt=[],Zs=Ri(),Yr=Ri()};g.__private__.setCustomOutputDestination=function(_){Bt=!0,Gt=_};var pt=function(_){Bt||(Gt=_)};g.__private__.resetCustomOutputDestination=function(){Bt=!1,Gt=gt};var Y=g.__private__.out=function(_){return _=_.toString(),mt+=_.length+1,Gt.push(_),Gt},se=g.__private__.write=function(_){return Y(arguments.length===1?_.toString():Array.prototype.join.call(arguments," "))},Wt=g.__private__.getArrayBuffer=function(_){for(var A=_.length,V=new ArrayBuffer(A),Q=new Uint8Array(V);A--;)Q[A]=_.charCodeAt(A);return V},Ct=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];g.__private__.getStandardFonts=function(){return Ct};var Pt=n.fontSize||16;g.__private__.setFontSize=g.setFontSize=function(_){return Pt=L===b.ADVANCED?_/kt:_,this};var Nt,Rt=g.__private__.getFontSize=g.getFontSize=function(){return L===b.COMPAT?Pt:Pt*kt},Ut=n.R2L||!1;g.__private__.setR2L=g.setR2L=function(_){return Ut=_,this},g.__private__.getR2L=g.getR2L=function(){return Ut};var ce,_e=g.__private__.setZoomMode=function(_){var A=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(_))Nt=_;else if(isNaN(_)){if(A.indexOf(_)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+_+'" is not recognized.');Nt=_}else Nt=parseInt(_,10)};g.__private__.getZoomMode=function(){return Nt};var Ee,Pe=g.__private__.setPageMode=function(_){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(_)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+_+'" is not recognized.');ce=_};g.__private__.getPageMode=function(){return ce};var Ye=g.__private__.setLayoutMode=function(_){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(_)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+_+'" is not recognized.');Ee=_};g.__private__.getLayoutMode=function(){return Ee},g.__private__.setDisplayMode=g.setDisplayMode=function(_,A,V){return _e(_),Ye(A),Pe(V),this};var ae={title:"",subject:"",author:"",keywords:"",creator:""};g.__private__.getDocumentProperty=function(_){if(Object.keys(ae).indexOf(_)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ae[_]},g.__private__.getDocumentProperties=function(){return ae},g.__private__.setDocumentProperties=g.setProperties=g.setDocumentProperties=function(_){for(var A in ae)ae.hasOwnProperty(A)&&_[A]&&(ae[A]=_[A]);return this},g.__private__.setDocumentProperty=function(_,A){if(Object.keys(ae).indexOf(_)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ae[_]=A};var Te,kt,ln,Oe,tr,Ke={},hi={},pr=[],qe={},Xr={},ci={},wn={},Gn=null,xi=0,de=[],Se=new c2(g),jn=n.hotfixes||[],Ze={},Di={},Ci=[],Kt=function _(A,V,Q,ot,yt,At){if(!(this instanceof _))return new _(A,V,Q,ot,yt,At);isNaN(A)&&(A=1),isNaN(V)&&(V=0),isNaN(Q)&&(Q=0),isNaN(ot)&&(ot=1),isNaN(yt)&&(yt=0),isNaN(At)&&(At=0),this._matrix=[A,V,Q,ot,yt,At]};Object.defineProperty(Kt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(_){this._matrix[0]=_}}),Object.defineProperty(Kt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(_){this._matrix[1]=_}}),Object.defineProperty(Kt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(_){this._matrix[2]=_}}),Object.defineProperty(Kt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(_){this._matrix[3]=_}}),Object.defineProperty(Kt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(_){this._matrix[4]=_}}),Object.defineProperty(Kt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(_){this._matrix[5]=_}}),Object.defineProperty(Kt.prototype,"a",{get:function(){return this._matrix[0]},set:function(_){this._matrix[0]=_}}),Object.defineProperty(Kt.prototype,"b",{get:function(){return this._matrix[1]},set:function(_){this._matrix[1]=_}}),Object.defineProperty(Kt.prototype,"c",{get:function(){return this._matrix[2]},set:function(_){this._matrix[2]=_}}),Object.defineProperty(Kt.prototype,"d",{get:function(){return this._matrix[3]},set:function(_){this._matrix[3]=_}}),Object.defineProperty(Kt.prototype,"e",{get:function(){return this._matrix[4]},set:function(_){this._matrix[4]=_}}),Object.defineProperty(Kt.prototype,"f",{get:function(){return this._matrix[5]},set:function(_){this._matrix[5]=_}}),Object.defineProperty(Kt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Kt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Kt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Kt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Kt.prototype.join=function(_){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(k).join(_)},Kt.prototype.multiply=function(_){var A=_.sx*this.sx+_.shy*this.shx,V=_.sx*this.shy+_.shy*this.sy,Q=_.shx*this.sx+_.sy*this.shx,ot=_.shx*this.shy+_.sy*this.sy,yt=_.tx*this.sx+_.ty*this.shx+this.tx,At=_.tx*this.shy+_.ty*this.sy+this.ty;return new Kt(A,V,Q,ot,yt,At)},Kt.prototype.decompose=function(){var _=this.sx,A=this.shy,V=this.shx,Q=this.sy,ot=this.tx,yt=this.ty,At=Math.sqrt(_*_+A*A),zt=(_/=At)*V+(A/=At)*Q;V-=_*zt,Q-=A*zt;var te=Math.sqrt(V*V+Q*Q);return zt/=te,_*(Q/=te)<A*(V/=te)&&(_=-_,A=-A,zt=-zt,At=-At),{scale:new Kt(At,0,0,te,0,0),translate:new Kt(1,0,0,1,ot,yt),rotate:new Kt(_,A,-A,_,0,0),skew:new Kt(1,0,zt,1,0,0)}},Kt.prototype.toString=function(_){return this.join(" ")},Kt.prototype.inversed=function(){var _=this.sx,A=this.shy,V=this.shx,Q=this.sy,ot=this.tx,yt=this.ty,At=1/(_*Q-A*V),zt=Q*At,te=-A*At,Le=-V*At,Me=_*At;return new Kt(zt,te,Le,Me,-zt*ot-Le*yt,-te*ot-Me*yt)},Kt.prototype.applyToPoint=function(_){var A=_.x*this.sx+_.y*this.shx+this.tx,V=_.x*this.shy+_.y*this.sy+this.ty;return new Ll(A,V)},Kt.prototype.applyToRectangle=function(_){var A=this.applyToPoint(_),V=this.applyToPoint(new Ll(_.x+_.w,_.y+_.h));return new oc(A.x,A.y,V.x-A.x,V.y-A.y)},Kt.prototype.clone=function(){var _=this.sx,A=this.shy,V=this.shx,Q=this.sy,ot=this.tx,yt=this.ty;return new Kt(_,A,V,Q,ot,yt)},g.Matrix=Kt;var Bi=g.matrixMult=function(_,A){return A.multiply(_)},je=new Kt(1,0,0,1,0,0);g.unitMatrix=g.identityMatrix=je;var Je=function(_,A){if(!Xr[_]){var V=(A instanceof ko?"Sh":"P")+(Object.keys(qe).length+1).toString(10);A.id=V,Xr[_]=V,qe[V]=A,Se.publish("addPattern",A)}};g.ShadingPattern=ko,g.TilingPattern=fh,g.addShadingPattern=function(_,A){return T("addShadingPattern()"),Je(_,A),this},g.beginTilingPattern=function(_){T("beginTilingPattern()"),lf(_.boundingBox[0],_.boundingBox[1],_.boundingBox[2]-_.boundingBox[0],_.boundingBox[3]-_.boundingBox[1],_.matrix)},g.endTilingPattern=function(_,A){T("endTilingPattern()"),A.stream=Tt[U].join(`
`),Je(_,A),Se.publish("endTilingPattern",A),Ci.pop().restore()};var ii=g.__private__.newObject=function(){var _=Ri();return _r(_,!0),_},Ri=g.__private__.newObjectDeferred=function(){return st++,ht[st]=function(){return mt},st},_r=function(_,A){return A=typeof A=="boolean"&&A,ht[_]=mt,A&&Y(_+" 0 obj"),_},fl=g.__private__.newAdditionalObject=function(){var _={objId:Ri(),content:""};return Lt.push(_),_},Zs=Ri(),Yr=Ri(),Kr=g.__private__.decodeColorString=function(_){var A=_.split(" ");if(A.length!==2||A[1]!=="g"&&A[1]!=="G")A.length===5&&(A[4]==="k"||A[4]==="K")&&(A=[(1-A[0])*(1-A[3]),(1-A[1])*(1-A[3]),(1-A[2])*(1-A[3]),"r"]);else{var V=parseFloat(A[0]);A=[V,V,V,"r"]}for(var Q="#",ot=0;ot<3;ot++)Q+=("0"+Math.floor(255*parseFloat(A[ot])).toString(16)).slice(-2);return Q},Zr=g.__private__.encodeColorString=function(_){var A;typeof _=="string"&&(_={ch1:_});var V=_.ch1,Q=_.ch2,ot=_.ch3,yt=_.ch4,At=_.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof V=="string"&&V.charAt(0)!=="#"){var zt=new Sw(V);if(zt.ok)V=zt.toHex();else if(!/^\d*\.?\d*$/.test(V))throw new Error('Invalid color "'+V+'" passed to jsPDF.encodeColorString.')}if(typeof V=="string"&&/^#[0-9A-Fa-f]{3}$/.test(V)&&(V="#"+V[1]+V[1]+V[2]+V[2]+V[3]+V[3]),typeof V=="string"&&/^#[0-9A-Fa-f]{6}$/.test(V)){var te=parseInt(V.substr(1),16);V=te>>16&255,Q=te>>8&255,ot=255&te}if(Q===void 0||yt===void 0&&V===Q&&Q===ot)if(typeof V=="string")A=V+" "+At[0];else switch(_.precision){case 2:A=W(V/255)+" "+At[0];break;case 3:default:A=F(V/255)+" "+At[0]}else if(yt===void 0||oi(yt)==="object"){if(yt&&!isNaN(yt.a)&&yt.a===0)return A=["1.","1.","1.",At[1]].join(" ");if(typeof V=="string")A=[V,Q,ot,At[1]].join(" ");else switch(_.precision){case 2:A=[W(V/255),W(Q/255),W(ot/255),At[1]].join(" ");break;default:case 3:A=[F(V/255),F(Q/255),F(ot/255),At[1]].join(" ")}}else if(typeof V=="string")A=[V,Q,ot,yt,At[2]].join(" ");else switch(_.precision){case 2:A=[W(V),W(Q),W(ot),W(yt),At[2]].join(" ");break;case 3:default:A=[F(V),F(Q),F(ot),F(yt),At[2]].join(" ")}return A},ws=g.__private__.getFilters=function(){return a},Tr=g.__private__.putStream=function(_){var A=(_=_||{}).data||"",V=_.filters||ws(),Q=_.alreadyAppliedFilters||[],ot=_.addLength1||!1,yt=A.length,At=_.objectId,zt=function(An){return An};if(c!==null&&At===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");c!==null&&(zt=Cn.encryptor(At,0));var te={};V===!0&&(V=["FlateEncode"]);var Le=_.additionalKeyValues||[],Me=(te=oe.API.processDataByFilters!==void 0?oe.API.processDataByFilters(A,V):{data:A,reverseChain:[]}).reverseChain+(Array.isArray(Q)?Q.join(" "):Q.toString());if(te.data.length!==0&&(Le.push({key:"Length",value:te.data.length}),ot===!0&&Le.push({key:"Length1",value:yt})),Me.length!=0)if(Me.split("/").length-1==1)Le.push({key:"Filter",value:Me});else{Le.push({key:"Filter",value:"["+Me+"]"});for(var De=0;De<Le.length;De+=1)if(Le[De].key==="DecodeParms"){for(var Ai=[],Ii=0;Ii<te.reverseChain.split("/").length-1;Ii+=1)Ai.push("null");Ai.push(Le[De].value),Le[De].value="["+Ai.join(" ")+"]"}}Y("<<");for(var Hi=0;Hi<Le.length;Hi++)Y("/"+Le[Hi].key+" "+Le[Hi].value);Y(">>"),te.data.length!==0&&(Y("stream"),Y(zt(te.data)),Y("endstream"))},xs=g.__private__.putPage=function(_){var A=_.number,V=_.data,Q=_.objId,ot=_.contentsObjId;_r(Q,!0),Y("<</Type /Page"),Y("/Parent "+_.rootDictionaryObjId+" 0 R"),Y("/Resources "+_.resourceDictionaryObjId+" 0 R"),Y("/MediaBox ["+parseFloat(k(_.mediaBox.bottomLeftX))+" "+parseFloat(k(_.mediaBox.bottomLeftY))+" "+k(_.mediaBox.topRightX)+" "+k(_.mediaBox.topRightY)+"]"),_.cropBox!==null&&Y("/CropBox ["+k(_.cropBox.bottomLeftX)+" "+k(_.cropBox.bottomLeftY)+" "+k(_.cropBox.topRightX)+" "+k(_.cropBox.topRightY)+"]"),_.bleedBox!==null&&Y("/BleedBox ["+k(_.bleedBox.bottomLeftX)+" "+k(_.bleedBox.bottomLeftY)+" "+k(_.bleedBox.topRightX)+" "+k(_.bleedBox.topRightY)+"]"),_.trimBox!==null&&Y("/TrimBox ["+k(_.trimBox.bottomLeftX)+" "+k(_.trimBox.bottomLeftY)+" "+k(_.trimBox.topRightX)+" "+k(_.trimBox.topRightY)+"]"),_.artBox!==null&&Y("/ArtBox ["+k(_.artBox.bottomLeftX)+" "+k(_.artBox.bottomLeftY)+" "+k(_.artBox.topRightX)+" "+k(_.artBox.topRightY)+"]"),typeof _.userUnit=="number"&&_.userUnit!==1&&Y("/UserUnit "+_.userUnit),Se.publish("putPage",{objId:Q,pageContext:de[A],pageNumber:A,page:V}),Y("/Contents "+ot+" 0 R"),Y(">>"),Y("endobj");var yt=V.join(`
`);return L===b.ADVANCED&&(yt+=`
Q`),_r(ot,!0),Tr({data:yt,filters:ws(),objectId:ot}),Y("endobj"),Q},Eo=g.__private__.putPages=function(){var _,A,V=[];for(_=1;_<=xi;_++)de[_].objId=Ri(),de[_].contentsObjId=Ri();for(_=1;_<=xi;_++)V.push(xs({number:_,data:Tt[_],objId:de[_].objId,contentsObjId:de[_].contentsObjId,mediaBox:de[_].mediaBox,cropBox:de[_].cropBox,bleedBox:de[_].bleedBox,trimBox:de[_].trimBox,artBox:de[_].artBox,userUnit:de[_].userUnit,rootDictionaryObjId:Zs,resourceDictionaryObjId:Yr}));_r(Zs,!0),Y("<</Type /Pages");var Q="/Kids [";for(A=0;A<xi;A++)Q+=V[A]+" 0 R ";Y(Q+"]"),Y("/Count "+xi),Y(">>"),Y("endobj"),Se.publish("postPutPages")},dl=function(_){Se.publish("putFont",{font:_,out:Y,newObject:ii,putStream:Tr}),_.isAlreadyPutted!==!0&&(_.objectNumber=ii(),Y("<<"),Y("/Type /Font"),Y("/BaseFont /"+rh(_.postScriptName)),Y("/Subtype /Type1"),typeof _.encoding=="string"&&Y("/Encoding /"+_.encoding),Y("/FirstChar 32"),Y("/LastChar 255"),Y(">>"),Y("endobj"))},gl=function(){for(var _ in Ke)Ke.hasOwnProperty(_)&&(u===!1||u===!0&&d.hasOwnProperty(_))&&dl(Ke[_])},ml=function(_){_.objectNumber=ii();var A=[];A.push({key:"Type",value:"/XObject"}),A.push({key:"Subtype",value:"/Form"}),A.push({key:"BBox",value:"["+[k(_.x),k(_.y),k(_.x+_.width),k(_.y+_.height)].join(" ")+"]"}),A.push({key:"Matrix",value:"["+_.matrix.toString()+"]"});var V=_.pages[1].join(`
`);Tr({data:V,additionalKeyValues:A,objectId:_.objectNumber}),Y("endobj")},pl=function(){for(var _ in Ze)Ze.hasOwnProperty(_)&&ml(Ze[_])},qu=function(_,A){var V,Q=[],ot=1/(A-1);for(V=0;V<1;V+=ot)Q.push(V);if(Q.push(1),_[0].offset!=0){var yt={offset:0,color:_[0].color};_.unshift(yt)}if(_[_.length-1].offset!=1){var At={offset:1,color:_[_.length-1].color};_.push(At)}for(var zt="",te=0,Le=0;Le<Q.length;Le++){for(V=Q[Le];V>_[te+1].offset;)te++;var Me=_[te].offset,De=(V-Me)/(_[te+1].offset-Me),Ai=_[te].color,Ii=_[te+1].color;zt+=K(Math.round((1-De)*Ai[0]+De*Ii[0]).toString(16))+K(Math.round((1-De)*Ai[1]+De*Ii[1]).toString(16))+K(Math.round((1-De)*Ai[2]+De*Ii[2]).toString(16))}return zt.trim()},Wg=function(_,A){A||(A=21);var V=ii(),Q=qu(_.colors,A),ot=[];ot.push({key:"FunctionType",value:"0"}),ot.push({key:"Domain",value:"[0.0 1.0]"}),ot.push({key:"Size",value:"["+A+"]"}),ot.push({key:"BitsPerSample",value:"8"}),ot.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ot.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Tr({data:Q,additionalKeyValues:ot,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:V}),Y("endobj"),_.objectNumber=ii(),Y("<< /ShadingType "+_.type),Y("/ColorSpace /DeviceRGB");var yt="/Coords ["+k(parseFloat(_.coords[0]))+" "+k(parseFloat(_.coords[1]))+" ";_.type===2?yt+=k(parseFloat(_.coords[2]))+" "+k(parseFloat(_.coords[3])):yt+=k(parseFloat(_.coords[2]))+" "+k(parseFloat(_.coords[3]))+" "+k(parseFloat(_.coords[4]))+" "+k(parseFloat(_.coords[5])),Y(yt+="]"),_.matrix&&Y("/Matrix ["+_.matrix.toString()+"]"),Y("/Function "+V+" 0 R"),Y("/Extend [true true]"),Y(">>"),Y("endobj")},Hg=function(_,A){var V=Ri(),Q=ii();A.push({resourcesOid:V,objectOid:Q}),_.objectNumber=Q;var ot=[];ot.push({key:"Type",value:"/Pattern"}),ot.push({key:"PatternType",value:"1"}),ot.push({key:"PaintType",value:"1"}),ot.push({key:"TilingType",value:"1"}),ot.push({key:"BBox",value:"["+_.boundingBox.map(k).join(" ")+"]"}),ot.push({key:"XStep",value:k(_.xStep)}),ot.push({key:"YStep",value:k(_.yStep)}),ot.push({key:"Resources",value:V+" 0 R"}),_.matrix&&ot.push({key:"Matrix",value:"["+_.matrix.toString()+"]"}),Tr({data:_.stream,additionalKeyValues:ot,objectId:_.objectNumber}),Y("endobj")},_l=function(_){var A;for(A in qe)qe.hasOwnProperty(A)&&(qe[A]instanceof ko?Wg(qe[A]):qe[A]instanceof fh&&Hg(qe[A],_))},Vu=function(_){for(var A in _.objectNumber=ii(),Y("<<"),_)switch(A){case"opacity":Y("/ca "+W(_[A]));break;case"stroke-opacity":Y("/CA "+W(_[A]))}Y(">>"),Y("endobj")},$g=function(){var _;for(_ in ci)ci.hasOwnProperty(_)&&Vu(ci[_])},Zh=function(){for(var _ in Y("/XObject <<"),Ze)Ze.hasOwnProperty(_)&&Ze[_].objectNumber>=0&&Y("/"+_+" "+Ze[_].objectNumber+" 0 R");Se.publish("putXobjectDict"),Y(">>")},Xg=function(){Cn.oid=ii(),Y("<<"),Y("/Filter /Standard"),Y("/V "+Cn.v),Y("/R "+Cn.r),Y("/U <"+Cn.toHexString(Cn.U)+">"),Y("/O <"+Cn.toHexString(Cn.O)+">"),Y("/P "+Cn.P),Y(">>"),Y("endobj")},Wu=function(){for(var _ in Y("/Font <<"),Ke)Ke.hasOwnProperty(_)&&(u===!1||u===!0&&d.hasOwnProperty(_))&&Y("/"+_+" "+Ke[_].objectNumber+" 0 R");Y(">>")},Yg=function(){if(Object.keys(qe).length>0){for(var _ in Y("/Shading <<"),qe)qe.hasOwnProperty(_)&&qe[_]instanceof ko&&qe[_].objectNumber>=0&&Y("/"+_+" "+qe[_].objectNumber+" 0 R");Se.publish("putShadingPatternDict"),Y(">>")}},yl=function(_){if(Object.keys(qe).length>0){for(var A in Y("/Pattern <<"),qe)qe.hasOwnProperty(A)&&qe[A]instanceof g.TilingPattern&&qe[A].objectNumber>=0&&qe[A].objectNumber<_&&Y("/"+A+" "+qe[A].objectNumber+" 0 R");Se.publish("putTilingPatternDict"),Y(">>")}},Kg=function(){if(Object.keys(ci).length>0){var _;for(_ in Y("/ExtGState <<"),ci)ci.hasOwnProperty(_)&&ci[_].objectNumber>=0&&Y("/"+_+" "+ci[_].objectNumber+" 0 R");Se.publish("putGStateDict"),Y(">>")}},Gi=function(_){_r(_.resourcesOid,!0),Y("<<"),Y("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Wu(),Yg(),yl(_.objectOid),Kg(),Zh(),Y(">>"),Y("endobj")},Hu=function(){var _=[];gl(),$g(),pl(),_l(_),Se.publish("putResources"),_.forEach(Gi),Gi({resourcesOid:Yr,objectOid:Number.MAX_SAFE_INTEGER}),Se.publish("postPutResources")},$u=function(){Se.publish("putAdditionalObjects");for(var _=0;_<Lt.length;_++){var A=Lt[_];_r(A.objId,!0),Y(A.content),Y("endobj")}Se.publish("postPutAdditionalObjects")},Xu=function(_){hi[_.fontName]=hi[_.fontName]||{},hi[_.fontName][_.fontStyle]=_.id},Jh=function(_,A,V,Q,ot){var yt={id:"F"+(Object.keys(Ke).length+1).toString(10),postScriptName:_,fontName:A,fontStyle:V,encoding:Q,isStandardFont:ot||!1,metadata:{}};return Se.publish("addFont",{font:yt,instance:this}),Ke[yt.id]=yt,Xu(yt),yt.id},Zg=function(_){for(var A=0,V=Ct.length;A<V;A++){var Q=Jh.call(this,_[A][0],_[A][1],_[A][2],Ct[A][3],!0);u===!1&&(d[Q]=!0);var ot=_[A][0].split("-");Xu({id:Q,fontName:ot[0],fontStyle:ot[1]||""})}Se.publish("addFonts",{fonts:Ke,dictionary:hi})},Jr=function(_){return _.foo=function(){try{return _.apply(this,arguments)}catch(Q){var A=Q.stack||"";~A.indexOf(" at ")&&(A=A.split(" at ")[1]);var V="Error in function "+A.split(`
`)[0].split("<")[0]+": "+Q.message;if(!le.console)throw new Error(V);le.console.error(V,Q),le.alert&&alert(V)}},_.foo.bar=_,_.foo},vl=function(_,A){var V,Q,ot,yt,At,zt,te,Le,Me;if(ot=(A=A||{}).sourceEncoding||"Unicode",At=A.outputEncoding,(A.autoencode||At)&&Ke[Te].metadata&&Ke[Te].metadata[ot]&&Ke[Te].metadata[ot].encoding&&(yt=Ke[Te].metadata[ot].encoding,!At&&Ke[Te].encoding&&(At=Ke[Te].encoding),!At&&yt.codePages&&(At=yt.codePages[0]),typeof At=="string"&&(At=yt[At]),At)){for(te=!1,zt=[],V=0,Q=_.length;V<Q;V++)(Le=At[_.charCodeAt(V)])?zt.push(String.fromCharCode(Le)):zt.push(_[V]),zt[V].charCodeAt(0)>>8&&(te=!0);_=zt.join("")}for(V=_.length;te===void 0&&V!==0;)_.charCodeAt(V-1)>>8&&(te=!0),V--;if(!te)return _;for(zt=A.noBOM?[]:[254,255],V=0,Q=_.length;V<Q;V++){if((Me=(Le=_.charCodeAt(V))>>8)>>8)throw new Error("Character at position "+V+" of string '"+_+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");zt.push(Me),zt.push(Le-(Me<<8))}return String.fromCharCode.apply(void 0,zt)},er=g.__private__.pdfEscape=g.pdfEscape=function(_,A){return vl(_,A).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Qh=g.__private__.beginPage=function(_){Tt[++xi]=[],de[xi]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(_[0]),topRightY:Number(_[1])}},Ku(xi),pt(Tt[U])},Yu=function(_,A){var V,Q,ot;switch(e=A||e,typeof _=="string"&&(V=x(_.toLowerCase()),Array.isArray(V)&&(Q=V[0],ot=V[1])),Array.isArray(_)&&(Q=_[0]*kt,ot=_[1]*kt),isNaN(Q)&&(Q=r[0],ot=r[1]),(Q>14400||ot>14400)&&(mi.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Q=Math.min(14400,Q),ot=Math.min(14400,ot)),r=[Q,ot],e.substr(0,1)){case"l":ot>Q&&(r=[ot,Q]);break;case"p":Q>ot&&(r=[ot,Q])}Qh(r),nf(nc),Y(Qr),sc!==0&&Y(sc+" J"),ac!==0&&Y(ac+" j"),Se.publish("addPage",{pageNumber:xi})},Jg=function(_){_>0&&_<=xi&&(Tt.splice(_,1),de.splice(_,1),xi--,U>xi&&(U=xi),this.setPage(U))},Ku=function(_){_>0&&_<=xi&&(U=_)},Qg=g.__private__.getNumberOfPages=g.getNumberOfPages=function(){return Tt.length-1},Zu=function(_,A,V){var Q,ot=void 0;return V=V||{},_=_!==void 0?_:Ke[Te].fontName,A=A!==void 0?A:Ke[Te].fontStyle,Q=_.toLowerCase(),hi[Q]!==void 0&&hi[Q][A]!==void 0?ot=hi[Q][A]:hi[_]!==void 0&&hi[_][A]!==void 0?ot=hi[_][A]:V.disableWarning===!1&&mi.warn("Unable to look up font label for font '"+_+"', '"+A+"'. Refer to getFontList() for available fonts."),ot||V.noFallback||(ot=hi.times[A])==null&&(ot=hi.times.normal),ot},t0=g.__private__.putInfo=function(){var _=ii(),A=function(Q){return Q};for(var V in c!==null&&(A=Cn.encryptor(_,0)),Y("<<"),Y("/Producer ("+er(A("jsPDF "+oe.version))+")"),ae)ae.hasOwnProperty(V)&&ae[V]&&Y("/"+V.substr(0,1).toUpperCase()+V.substr(1)+" ("+er(A(ae[V]))+")");Y("/CreationDate ("+er(A(tt))+")"),Y(">>"),Y("endobj")},tc=g.__private__.putCatalog=function(_){var A=(_=_||{}).rootDictionaryObjId||Zs;switch(ii(),Y("<<"),Y("/Type /Catalog"),Y("/Pages "+A+" 0 R"),Nt||(Nt="fullwidth"),Nt){case"fullwidth":Y("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Y("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Y("/OpenAction [3 0 R /Fit]");break;case"original":Y("/OpenAction [3 0 R /XYZ null null 1]");break;default:var V=""+Nt;V.substr(V.length-1)==="%"&&(Nt=parseInt(Nt)/100),typeof Nt=="number"&&Y("/OpenAction [3 0 R /XYZ null null "+W(Nt)+"]")}switch(Ee||(Ee="continuous"),Ee){case"continuous":Y("/PageLayout /OneColumn");break;case"single":Y("/PageLayout /SinglePage");break;case"two":case"twoleft":Y("/PageLayout /TwoColumnLeft");break;case"tworight":Y("/PageLayout /TwoColumnRight")}ce&&Y("/PageMode /"+ce),Se.publish("putCatalog"),Y(">>"),Y("endobj")},e0=g.__private__.putTrailer=function(){Y("trailer"),Y("<<"),Y("/Size "+(st+1)),Y("/Root "+st+" 0 R"),Y("/Info "+(st-1)+" 0 R"),c!==null&&Y("/Encrypt "+Cn.oid+" 0 R"),Y("/ID [ <"+Z+"> <"+Z+"> ]"),Y(">>")},i0=g.__private__.putHeader=function(){Y("%PDF-"+p),Y("%")},n0=g.__private__.putXRef=function(){var _="0000000000";Y("xref"),Y("0 "+(st+1)),Y("0000000000 65535 f ");for(var A=1;A<=st;A++)typeof ht[A]=="function"?Y((_+ht[A]()).slice(-10)+" 00000 n "):ht[A]!==void 0?Y((_+ht[A]).slice(-10)+" 00000 n "):Y("0000000000 00000 n ")},Js=g.__private__.buildDocument=function(){Jt(),pt(gt),Se.publish("buildDocument"),i0(),Eo(),$u(),Hu(),c!==null&&Xg(),t0(),tc();var _=mt;return n0(),e0(),Y("startxref"),Y(""+_),Y("%%EOF"),pt(Tt[U]),gt.join(`
`)},wl=g.__private__.getBlob=function(_){return new Blob([Wt(_)],{type:"application/pdf"})},xl=g.output=g.__private__.output=Jr(function(_,A){switch(typeof(A=A||{})=="string"?A={filename:A}:A.filename=A.filename||"generated.pdf",_){case void 0:return Js();case"save":g.save(A.filename);break;case"arraybuffer":return Wt(Js());case"blob":return wl(Js());case"bloburi":case"bloburl":if(le.URL!==void 0&&typeof le.URL.createObjectURL=="function")return le.URL&&le.URL.createObjectURL(wl(Js()))||void 0;mi.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var V="",Q=Js();try{V=wp(Q)}catch{V=wp(unescape(encodeURIComponent(Q)))}return"data:application/pdf;filename="+A.filename+";base64,"+V;case"pdfobjectnewwindow":if(Object.prototype.toString.call(le)==="[object Window]"){var ot="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",yt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';A.pdfObjectUrl&&(ot=A.pdfObjectUrl,yt="");var At='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+ot+'"'+yt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(A)+");<\/script></body></html>",zt=le.open();return zt!==null&&zt.document.write(At),zt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(le)==="[object Window]"){var te='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(A.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+A.filename+'" width="500px" height="400px" /></body></html>',Le=le.open();if(Le!==null){Le.document.write(te);var Me=this;Le.document.documentElement.querySelector("#pdfViewer").onload=function(){Le.document.title=A.filename,Le.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Me.output("bloburl"))}}return Le}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(le)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var De='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",A)+'"></iframe></body></html>',Ai=le.open();if(Ai!==null&&(Ai.document.write(De),Ai.document.title=A.filename),Ai||typeof safari>"u")return Ai;break;case"datauri":case"dataurl":return le.document.location.href=this.output("datauristring",A);default:return null}}),Ju=function(_){return Array.isArray(jn)===!0&&jn.indexOf(_)>-1};switch(i){case"pt":kt=1;break;case"mm":kt=72/25.4;break;case"cm":kt=72/2.54;break;case"in":kt=72;break;case"px":kt=Ju("px_scaling")==1?.75:96/72;break;case"pc":case"em":kt=12;break;case"ex":kt=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);kt=i}var Cn=null;Et(),J();var r0=function(_){return c!==null?Cn.encryptor(_,0):function(A){return A}},Qu=g.__private__.getPageInfo=g.getPageInfo=function(_){if(isNaN(_)||_%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:de[_].objId,pageNumber:_,pageContext:de[_]}},ye=g.__private__.getPageInfoByObjId=function(_){if(isNaN(_)||_%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var A in de)if(de[A].objId===_)break;return Qu(A)},s0=g.__private__.getCurrentPageInfo=g.getCurrentPageInfo=function(){return{objId:de[U].objId,pageNumber:U,pageContext:de[U]}};g.addPage=function(){return Yu.apply(this,arguments),this},g.setPage=function(){return Ku.apply(this,arguments),pt.call(this,Tt[U]),this},g.insertPage=function(_){return this.addPage(),this.movePage(U,_),this},g.movePage=function(_,A){var V,Q;if(_>A){V=Tt[_],Q=de[_];for(var ot=_;ot>A;ot--)Tt[ot]=Tt[ot-1],de[ot]=de[ot-1];Tt[A]=V,de[A]=Q,this.setPage(A)}else if(_<A){V=Tt[_],Q=de[_];for(var yt=_;yt<A;yt++)Tt[yt]=Tt[yt+1],de[yt]=de[yt+1];Tt[A]=V,de[A]=Q,this.setPage(A)}return this},g.deletePage=function(){return Jg.apply(this,arguments),this},g.__private__.text=g.text=function(_,A,V,Q,ot){var yt,At,zt,te,Le,Me,De,Ai,Ii,Hi=(Q=Q||{}).scope||this;if(typeof _=="number"&&typeof A=="number"&&(typeof V=="string"||Array.isArray(V))){var An=V;V=A,A=_,_=An}if(arguments[3]instanceof Kt?(T("The transform parameter of text() with a Matrix value"),Ii=ot):(zt=arguments[4],te=arguments[5],oi(De=arguments[3])==="object"&&De!==null||(typeof zt=="string"&&(te=zt,zt=null),typeof De=="string"&&(te=De,De=null),typeof De=="number"&&(zt=De,De=null),Q={flags:De,angle:zt,align:te})),isNaN(A)||isNaN(V)||_==null)throw new Error("Invalid arguments passed to jsPDF.text");if(_.length===0)return Hi;var hn="",ts=!1,yr=typeof Q.lineHeightFactor=="number"?Q.lineHeightFactor:Lo,ta=Hi.internal.scaleFactor;function hf(_i){return _i=_i.split("	").join(Array(Q.TabLen||9).join(" ")),er(_i,De)}function uc(_i){for(var yi,ji=_i.concat(),tn=[],ra=ji.length;ra--;)typeof(yi=ji.shift())=="string"?tn.push(yi):Array.isArray(_i)&&(yi.length===1||yi[1]===void 0&&yi[2]===void 0)?tn.push(yi[0]):tn.push([yi[0],yi[1],yi[2]]);return tn}function fc(_i,yi){var ji;if(typeof _i=="string")ji=yi(_i)[0];else if(Array.isArray(_i)){for(var tn,ra,Ba=_i.concat(),kl=[],uf=Ba.length;uf--;)typeof(tn=Ba.shift())=="string"?kl.push(yi(tn)[0]):Array.isArray(tn)&&typeof tn[0]=="string"&&(ra=yi(tn[0],tn[1],tn[2]),kl.push([ra[0],ra[1],ra[2]]));ji=kl}return ji}var Al=!1,dc=!0;if(typeof _=="string")Al=!0;else if(Array.isArray(_)){var gc=_.concat();At=[];for(var Tl,ir=gc.length;ir--;)(typeof(Tl=gc.shift())!="string"||Array.isArray(Tl)&&typeof Tl[0]!="string")&&(dc=!1);Al=dc}if(Al===!1)throw new Error('Type of text must be string or Array. "'+_+'" is not recognized.');typeof _=="string"&&(_=_.match(/[\r?\n]/)?_.split(/\r\n|\r|\n/g):[_]);var Ml=Pt/Hi.internal.scaleFactor,Pl=Ml*(yr-1);switch(Q.baseline){case"bottom":V-=Pl;break;case"top":V+=Ml-Pl;break;case"hanging":V+=Ml-2*Pl;break;case"middle":V+=Ml/2-Pl}if((Me=Q.maxWidth||0)>0&&(typeof _=="string"?_=Hi.splitTextToSize(_,Me):Object.prototype.toString.call(_)==="[object Array]"&&(_=_.reduce(function(_i,yi){return _i.concat(Hi.splitTextToSize(yi,Me))},[]))),yt={text:_,x:A,y:V,options:Q,mutex:{pdfEscape:er,activeFontKey:Te,fonts:Ke,activeFontSize:Pt}},Se.publish("preProcessText",yt),_=yt.text,zt=(Q=yt.options).angle,!(Ii instanceof Kt)&&zt&&typeof zt=="number"){zt*=Math.PI/180,Q.rotationDirection===0&&(zt=-zt),L===b.ADVANCED&&(zt=-zt);var Rl=Math.cos(zt),mc=Math.sin(zt);Ii=new Kt(Rl,mc,-mc,Rl,0,0)}else zt&&zt instanceof Kt&&(Ii=zt);L!==b.ADVANCED||Ii||(Ii=je),(Le=Q.charSpace||Sl)!==void 0&&(hn+=k(M(Le))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Ai=Q.horizontalScale)!==void 0&&(hn+=k(100*Ai)+` Tz
`),Q.lang;var nr=-1,m0=Q.renderingMode!==void 0?Q.renderingMode:Q.stroke,pc=Hi.internal.getCurrentPageInfo().pageContext;switch(m0){case 0:case!1:case"fill":nr=0;break;case 1:case!0:case"stroke":nr=1;break;case 2:case"fillThenStroke":nr=2;break;case 3:case"invisible":nr=3;break;case 4:case"fillAndAddForClipping":nr=4;break;case 5:case"strokeAndAddPathForClipping":nr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":nr=6;break;case 7:case"addToPathForClipping":nr=7}var cf=pc.usedRenderingMode!==void 0?pc.usedRenderingMode:-1;nr!==-1?hn+=nr+` Tr
`:cf!==-1&&(hn+=`0 Tr
`),nr!==-1&&(pc.usedRenderingMode=nr),te=Q.align||"left";var es,_c=Pt*yr,p0=Hi.internal.pageSize.getWidth(),_0=Ke[Te];Le=Q.charSpace||Sl,Me=Q.maxWidth||0,De=Object.assign({autoencode:!0,noBOM:!0},Q.flags);var Fa=[];if(Object.prototype.toString.call(_)==="[object Array]"){var Mr;At=uc(_),te!=="left"&&(es=At.map(function(_i){return Hi.getStringUnitWidth(_i,{font:_0,charSpace:Le,fontSize:Pt,doKerning:!1})*Pt/ta}));var is,ka=0;if(te==="right"){A-=es[0],_=[],ir=At.length;for(var Es=0;Es<ir;Es++)Es===0?(is=Qs(A),Mr=Ra(V)):(is=M(ka-es[Es]),Mr=-_c),_.push([At[Es],is,Mr]),ka=es[Es]}else if(te==="center"){A-=es[0]/2,_=[],ir=At.length;for(var ea=0;ea<ir;ea++)ea===0?(is=Qs(A),Mr=Ra(V)):(is=M((ka-es[ea])/2),Mr=-_c),_.push([At[ea],is,Mr]),ka=es[ea]}else if(te==="left"){_=[],ir=At.length;for(var Il=0;Il<ir;Il++)_.push(At[Il])}else{if(te!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');_=[],ir=At.length,Me=Me!==0?Me:p0;for(var ns=0;ns<ir;ns++)Mr=ns===0?Ra(V):-_c,is=ns===0?Qs(A):0,ns<ir-1?Fa.push(k(M((Me-es[ns])/(At[ns].split(" ").length-1)))):Fa.push(0),_.push([At[ns],is,Mr])}}var Nl=typeof Q.R2L=="boolean"?Q.R2L:Ut;Nl===!0&&(_=fc(_,function(_i,yi,ji){return[_i.split("").reverse().join(""),yi,ji]})),yt={text:_,x:A,y:V,options:Q,mutex:{pdfEscape:er,activeFontKey:Te,fonts:Ke,activeFontSize:Pt}},Se.publish("postProcessText",yt),_=yt.text,ts=yt.mutex.isHex||!1;var yc=Ke[Te].encoding;yc!=="WinAnsiEncoding"&&yc!=="StandardEncoding"||(_=fc(_,function(_i,yi,ji){return[hf(_i),yi,ji]})),At=uc(_),_=[];for(var Oa,rs,ia,To=0,Fl=1,Mo=Array.isArray(At[0])?Fl:To,Da="",vc=function(_i,yi,ji){var tn="";return ji instanceof Kt?(ji=typeof Q.angle=="number"?Bi(ji,new Kt(1,0,0,1,_i,yi)):Bi(new Kt(1,0,0,1,_i,yi),ji),L===b.ADVANCED&&(ji=Bi(new Kt(1,0,0,-1,0,0),ji)),tn=ji.join(" ")+` Tm
`):tn=k(_i)+" "+k(yi)+` Td
`,tn},Pr=0;Pr<At.length;Pr++){switch(Da="",Mo){case Fl:ia=(ts?"<":"(")+At[Pr][0]+(ts?">":")"),Oa=parseFloat(At[Pr][1]),rs=parseFloat(At[Pr][2]);break;case To:ia=(ts?"<":"(")+At[Pr]+(ts?">":")"),Oa=Qs(A),rs=Ra(V)}Fa!==void 0&&Fa[Pr]!==void 0&&(Da=Fa[Pr]+` Tw
`),Pr===0?_.push(Da+vc(Oa,rs,Ii)+ia):Mo===To?_.push(Da+ia):Mo===Fl&&_.push(Da+vc(Oa,rs,Ii)+ia)}_=Mo===To?_.join(` Tj
T* `):_.join(` Tj
`),_+=` Tj
`;var na=`BT
/`;return na+=Te+" "+Pt+` Tf
`,na+=k(Pt*yr)+` TL
`,na+=Co+`
`,na+=hn,na+=_,Y(na+="ET"),d[Te]=!0,Hi};var a0=g.__private__.clip=g.clip=function(_){return Y(_==="evenodd"?"W*":"W"),this};g.clipEvenOdd=function(){return a0("evenodd")},g.__private__.discardPath=g.discardPath=function(){return Y("n"),this};var bs=g.__private__.isValidStyle=function(_){var A=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(_)!==-1&&(A=!0),A};g.__private__.setDefaultPathOperation=g.setDefaultPathOperation=function(_){return bs(_)&&(h=_),this};var tf=g.__private__.getStyle=g.getStyle=function(_){var A=h;switch(_){case"D":case"S":A="S";break;case"F":A="f";break;case"FD":case"DF":A="B";break;case"f":case"f*":case"B":case"B*":A=_}return A},ef=g.close=function(){return Y("h"),this};g.stroke=function(){return Y("S"),this},g.fill=function(_){return bl("f",_),this},g.fillEvenOdd=function(_){return bl("f*",_),this},g.fillStroke=function(_){return bl("B",_),this},g.fillStrokeEvenOdd=function(_){return bl("B*",_),this};var bl=function(_,A){oi(A)==="object"?l0(A,_):Y(_)},ec=function(_){_===null||L===b.ADVANCED&&_===void 0||(_=tf(_),Y(_))};function o0(_,A,V,Q,ot){var yt=new fh(A||this.boundingBox,V||this.xStep,Q||this.yStep,this.gState,ot||this.matrix);yt.stream=this.stream;var At=_+"$$"+this.cloneIndex+++"$$";return Je(At,yt),yt}var l0=function(_,A){var V=Xr[_.key],Q=qe[V];if(Q instanceof ko)Y("q"),Y(h0(A)),Q.gState&&g.setGState(Q.gState),Y(_.matrix.toString()+" cm"),Y("/"+V+" sh"),Y("Q");else if(Q instanceof fh){var ot=new Kt(1,0,0,-1,0,Na());_.matrix&&(ot=ot.multiply(_.matrix||je),V=o0.call(Q,_.key,_.boundingBox,_.xStep,_.yStep,ot).id),Y("q"),Y("/Pattern cs"),Y("/"+V+" scn"),Q.gState&&g.setGState(Q.gState),Y(A),Y("Q")}},h0=function(_){switch(_){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},ic=g.moveTo=function(_,A){return Y(k(M(_))+" "+k(G(A))+" m"),this},So=g.lineTo=function(_,A){return Y(k(M(_))+" "+k(G(A))+" l"),this},Pa=g.curveTo=function(_,A,V,Q,ot,yt){return Y([k(M(_)),k(G(A)),k(M(V)),k(G(Q)),k(M(ot)),k(G(yt)),"c"].join(" ")),this};g.__private__.line=g.line=function(_,A,V,Q,ot){if(isNaN(_)||isNaN(A)||isNaN(V)||isNaN(Q)||!bs(ot))throw new Error("Invalid arguments passed to jsPDF.line");return L===b.COMPAT?this.lines([[V-_,Q-A]],_,A,[1,1],ot||"S"):this.lines([[V-_,Q-A]],_,A,[1,1]).stroke()},g.__private__.lines=g.lines=function(_,A,V,Q,ot,yt){var At,zt,te,Le,Me,De,Ai,Ii,Hi,An,hn,ts;if(typeof _=="number"&&(ts=V,V=A,A=_,_=ts),Q=Q||[1,1],yt=yt||!1,isNaN(A)||isNaN(V)||!Array.isArray(_)||!Array.isArray(Q)||!bs(ot)||typeof yt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(ic(A,V),At=Q[0],zt=Q[1],Le=_.length,An=A,hn=V,te=0;te<Le;te++)(Me=_[te]).length===2?(An=Me[0]*At+An,hn=Me[1]*zt+hn,So(An,hn)):(De=Me[0]*At+An,Ai=Me[1]*zt+hn,Ii=Me[2]*At+An,Hi=Me[3]*zt+hn,An=Me[4]*At+An,hn=Me[5]*zt+hn,Pa(De,Ai,Ii,Hi,An,hn));return yt&&ef(),ec(ot),this},g.path=function(_){for(var A=0;A<_.length;A++){var V=_[A],Q=V.c;switch(V.op){case"m":ic(Q[0],Q[1]);break;case"l":So(Q[0],Q[1]);break;case"c":Pa.apply(this,Q);break;case"h":ef()}}return this},g.__private__.rect=g.rect=function(_,A,V,Q,ot){if(isNaN(_)||isNaN(A)||isNaN(V)||isNaN(Q)||!bs(ot))throw new Error("Invalid arguments passed to jsPDF.rect");return L===b.COMPAT&&(Q=-Q),Y([k(M(_)),k(G(A)),k(M(V)),k(M(Q)),"re"].join(" ")),ec(ot),this},g.__private__.triangle=g.triangle=function(_,A,V,Q,ot,yt,At){if(isNaN(_)||isNaN(A)||isNaN(V)||isNaN(Q)||isNaN(ot)||isNaN(yt)||!bs(At))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[V-_,Q-A],[ot-V,yt-Q],[_-ot,A-yt]],_,A,[1,1],At,!0),this},g.__private__.roundedRect=g.roundedRect=function(_,A,V,Q,ot,yt,At){if(isNaN(_)||isNaN(A)||isNaN(V)||isNaN(Q)||isNaN(ot)||isNaN(yt)||!bs(At))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var zt=4/3*(Math.SQRT2-1);return ot=Math.min(ot,.5*V),yt=Math.min(yt,.5*Q),this.lines([[V-2*ot,0],[ot*zt,0,ot,yt-yt*zt,ot,yt],[0,Q-2*yt],[0,yt*zt,-ot*zt,yt,-ot,yt],[2*ot-V,0],[-ot*zt,0,-ot,-yt*zt,-ot,-yt],[0,2*yt-Q],[0,-yt*zt,ot*zt,-yt,ot,-yt]],_+ot,A,[1,1],At,!0),this},g.__private__.ellipse=g.ellipse=function(_,A,V,Q,ot){if(isNaN(_)||isNaN(A)||isNaN(V)||isNaN(Q)||!bs(ot))throw new Error("Invalid arguments passed to jsPDF.ellipse");var yt=4/3*(Math.SQRT2-1)*V,At=4/3*(Math.SQRT2-1)*Q;return ic(_+V,A),Pa(_+V,A-At,_+yt,A-Q,_,A-Q),Pa(_-yt,A-Q,_-V,A-At,_-V,A),Pa(_-V,A+At,_-yt,A+Q,_,A+Q),Pa(_+yt,A+Q,_+V,A+At,_+V,A),ec(ot),this},g.__private__.circle=g.circle=function(_,A,V,Q){if(isNaN(_)||isNaN(A)||isNaN(V)||!bs(Q))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(_,A,V,V,Q)},g.setFont=function(_,A,V){return V&&(A=j(A,V)),Te=Zu(_,A,{disableWarning:!1}),this};var c0=g.__private__.getFont=g.getFont=function(){return Ke[Zu.apply(g,arguments)]};g.__private__.getFontList=g.getFontList=function(){var _,A,V={};for(_ in hi)if(hi.hasOwnProperty(_))for(A in V[_]=[],hi[_])hi[_].hasOwnProperty(A)&&V[_].push(A);return V},g.addFont=function(_,A,V,Q,ot){var yt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&yt.indexOf(arguments[3])!==-1?ot=arguments[3]:arguments[3]&&yt.indexOf(arguments[3])==-1&&(V=j(V,Q)),ot=ot||"Identity-H",Jh.call(this,_,A,V,ot)};var Lo,nc=n.lineWidth||.200025,El=g.__private__.getLineWidth=g.getLineWidth=function(){return nc},nf=g.__private__.setLineWidth=g.setLineWidth=function(_){return nc=_,Y(k(M(_))+" w"),this};g.__private__.setLineDash=oe.API.setLineDash=oe.API.setLineDashPattern=function(_,A){if(_=_||[],A=A||0,isNaN(A)||!Array.isArray(_))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return _=_.map(function(V){return k(M(V))}).join(" "),A=k(M(A)),Y("["+_+"] "+A+" d"),this};var rf=g.__private__.getLineHeight=g.getLineHeight=function(){return Pt*Lo};g.__private__.getLineHeight=g.getLineHeight=function(){return Pt*Lo};var sf=g.__private__.setLineHeightFactor=g.setLineHeightFactor=function(_){return typeof(_=_||1.15)=="number"&&(Lo=_),this},af=g.__private__.getLineHeightFactor=g.getLineHeightFactor=function(){return Lo};sf(n.lineHeight);var Qs=g.__private__.getHorizontalCoordinate=function(_){return M(_)},Ra=g.__private__.getVerticalCoordinate=function(_){return L===b.ADVANCED?_:de[U].mediaBox.topRightY-de[U].mediaBox.bottomLeftY-M(_)},u0=g.__private__.getHorizontalCoordinateString=g.getHorizontalCoordinateString=function(_){return k(Qs(_))},Ia=g.__private__.getVerticalCoordinateString=g.getVerticalCoordinateString=function(_){return k(Ra(_))},Qr=n.strokeColor||"0 G";g.__private__.getStrokeColor=g.getDrawColor=function(){return Kr(Qr)},g.__private__.setStrokeColor=g.setDrawColor=function(_,A,V,Q){return Qr=Zr({ch1:_,ch2:A,ch3:V,ch4:Q,pdfColorType:"draw",precision:2}),Y(Qr),this};var rc=n.fillColor||"0 g";g.__private__.getFillColor=g.getFillColor=function(){return Kr(rc)},g.__private__.setFillColor=g.setFillColor=function(_,A,V,Q){return rc=Zr({ch1:_,ch2:A,ch3:V,ch4:Q,pdfColorType:"fill",precision:2}),Y(rc),this};var Co=n.textColor||"0 g",f0=g.__private__.getTextColor=g.getTextColor=function(){return Kr(Co)};g.__private__.setTextColor=g.setTextColor=function(_,A,V,Q){return Co=Zr({ch1:_,ch2:A,ch3:V,ch4:Q,pdfColorType:"text",precision:3}),this};var Sl=n.charSpace,d0=g.__private__.getCharSpace=g.getCharSpace=function(){return parseFloat(Sl||0)};g.__private__.setCharSpace=g.setCharSpace=function(_){if(isNaN(_))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Sl=_,this};var sc=0;g.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},g.__private__.setLineCap=g.setLineCap=function(_){var A=g.CapJoinStyles[_];if(A===void 0)throw new Error("Line cap style of '"+_+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return sc=A,Y(A+" J"),this};var ac=0;g.__private__.setLineJoin=g.setLineJoin=function(_){var A=g.CapJoinStyles[_];if(A===void 0)throw new Error("Line join style of '"+_+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ac=A,Y(A+" j"),this},g.__private__.setLineMiterLimit=g.__private__.setMiterLimit=g.setLineMiterLimit=g.setMiterLimit=function(_){if(_=_||0,isNaN(_))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Y(k(M(_))+" M"),this},g.GState=$d,g.setGState=function(_){(_=typeof _=="string"?ci[wn[_]]:of(null,_)).equals(Gn)||(Y("/"+_.id+" gs"),Gn=_)};var of=function(_,A){if(!_||!wn[_]){var V=!1;for(var Q in ci)if(ci.hasOwnProperty(Q)&&ci[Q].equals(A)){V=!0;break}if(V)A=ci[Q];else{var ot="GS"+(Object.keys(ci).length+1).toString(10);ci[ot]=A,A.id=ot}return _&&(wn[_]=A.id),Se.publish("addGState",A),A}};g.addGState=function(_,A){return of(_,A),this},g.saveGraphicsState=function(){return Y("q"),pr.push({key:Te,size:Pt,color:Co}),this},g.restoreGraphicsState=function(){Y("Q");var _=pr.pop();return Te=_.key,Pt=_.size,Co=_.color,Gn=null,this},g.setCurrentTransformationMatrix=function(_){return Y(_.toString()+" cm"),this},g.comment=function(_){return Y("#"+_),this};var Ll=function(_,A){var V=_||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return V},set:function(yt){isNaN(yt)||(V=parseFloat(yt))}});var Q=A||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Q},set:function(yt){isNaN(yt)||(Q=parseFloat(yt))}});var ot="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return ot},set:function(yt){ot=yt.toString()}}),this},oc=function(_,A,V,Q){Ll.call(this,_,A),this.type="rect";var ot=V||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return ot},set:function(At){isNaN(At)||(ot=parseFloat(At))}});var yt=Q||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return yt},set:function(At){isNaN(At)||(yt=parseFloat(At))}}),this},lc=function(){this.page=xi,this.currentPage=U,this.pages=Tt.slice(0),this.pagesContext=de.slice(0),this.x=ln,this.y=Oe,this.matrix=tr,this.width=Ao(U),this.height=Na(U),this.outputDestination=Gt,this.id="",this.objectNumber=-1};lc.prototype.restore=function(){xi=this.page,U=this.currentPage,de=this.pagesContext,Tt=this.pages,ln=this.x,Oe=this.y,tr=this.matrix,hc(U,this.width),cc(U,this.height),Gt=this.outputDestination};var lf=function(_,A,V,Q,ot){Ci.push(new lc),xi=U=0,Tt=[],ln=_,Oe=A,tr=ot,Qh([V,Q])},g0=function(_){if(Di[_])Ci.pop().restore();else{var A=new lc,V="Xo"+(Object.keys(Ze).length+1).toString(10);A.id=V,Di[_]=V,Ze[V]=A,Se.publish("addFormObject",A),Ci.pop().restore()}};for(var Cl in g.beginFormObject=function(_,A,V,Q,ot){return lf(_,A,V,Q,ot),this},g.endFormObject=function(_){return g0(_),this},g.doFormObject=function(_,A){var V=Ze[Di[_]];return Y("q"),Y(A.toString()+" cm"),Y("/"+V.id+" Do"),Y("Q"),this},g.getFormObject=function(_){var A=Ze[Di[_]];return{x:A.x,y:A.y,width:A.width,height:A.height,matrix:A.matrix}},g.save=function(_,A){return _=_||"generated.pdf",(A=A||{}).returnPromise=A.returnPromise||!1,A.returnPromise===!1?(Fo(wl(Js()),_),typeof Fo.unload=="function"&&le.setTimeout&&setTimeout(Fo.unload,911),this):new Promise(function(V,Q){try{var ot=Fo(wl(Js()),_);typeof Fo.unload=="function"&&le.setTimeout&&setTimeout(Fo.unload,911),V(ot)}catch(yt){Q(yt.message)}})},oe.API)oe.API.hasOwnProperty(Cl)&&(Cl==="events"&&oe.API.events.length?function(_,A){var V,Q,ot;for(ot=A.length-1;ot!==-1;ot--)V=A[ot][0],Q=A[ot][1],_.subscribe.apply(_,[V].concat(typeof Q=="function"?[Q]:Q))}(Se,oe.API.events):g[Cl]=oe.API[Cl]);var Ao=g.getPageWidth=function(_){return(de[_=_||U].mediaBox.topRightX-de[_].mediaBox.bottomLeftX)/kt},hc=g.setPageWidth=function(_,A){de[_].mediaBox.topRightX=A*kt+de[_].mediaBox.bottomLeftX},Na=g.getPageHeight=function(_){return(de[_=_||U].mediaBox.topRightY-de[_].mediaBox.bottomLeftY)/kt},cc=g.setPageHeight=function(_,A){de[_].mediaBox.topRightY=A*kt+de[_].mediaBox.bottomLeftY};return g.internal={pdfEscape:er,getStyle:tf,getFont:c0,getFontSize:Rt,getCharSpace:d0,getTextColor:f0,getLineHeight:rf,getLineHeightFactor:af,getLineWidth:El,write:se,getHorizontalCoordinate:Qs,getVerticalCoordinate:Ra,getCoordinateString:u0,getVerticalCoordinateString:Ia,collections:{},newObject:ii,newAdditionalObject:fl,newObjectDeferred:Ri,newObjectDeferredBegin:_r,getFilters:ws,putStream:Tr,events:Se,scaleFactor:kt,pageSize:{getWidth:function(){return Ao(U)},setWidth:function(_){hc(U,_)},getHeight:function(){return Na(U)},setHeight:function(_){cc(U,_)}},encryptionOptions:c,encryption:Cn,getEncryptor:r0,output:xl,getNumberOfPages:Qg,pages:Tt,out:Y,f2:W,f3:F,getPageInfo:Qu,getPageInfoByObjId:ye,getCurrentPageInfo:s0,getPDFVersion:y,Point:Ll,Rectangle:oc,Matrix:Kt,hasHotfix:Ju},Object.defineProperty(g.internal.pageSize,"width",{get:function(){return Ao(U)},set:function(_){hc(U,_)},enumerable:!0,configurable:!0}),Object.defineProperty(g.internal.pageSize,"height",{get:function(){return Na(U)},set:function(_){cc(U,_)},enumerable:!0,configurable:!0}),Zg.call(g,Ct),Te="F1",Yu(r,e),Se.publish("initialized"),g}nh.prototype.lsbFirstWord=function(n){return String.fromCharCode(n>>0&255,n>>8&255,n>>16&255,n>>24&255)},nh.prototype.toHexString=function(n){return n.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},nh.prototype.hexToBytes=function(n){for(var t=[],e=0;e<n.length;e+=2)t.push(String.fromCharCode(parseInt(n.substr(e,2),16)));return t.join("")},nh.prototype.processOwnerPassword=function(n,t){return bp(xp(t).substr(0,5),n)},nh.prototype.encryptor=function(n,t){var e=xp(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&t,t>>8&255)).substr(0,10);return function(i){return bp(e,i)}},$d.prototype.equals=function(n){var t,e="id,objectNumber,equals";if(!n||oi(n)!==oi(this))return!1;var i=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!n.hasOwnProperty(t)||this[t]!==n[t])return!1;i++}for(t in n)n.hasOwnProperty(t)&&e.indexOf(t)<0&&i--;return i===0},oe.API={events:[]},oe.version="2.5.1";var Fi=oe.API,W1=1,cl=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Wl=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},be=function(n){return n.toFixed(2)},Za=function(n){return n.toFixed(5)};Fi.__acroform__={};var gr=function(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n},u2=function(n){return n*W1},Ts=function(n){var t=new Tw,e=$t.internal.getHeight(n)||0,i=$t.internal.getWidth(n)||0;return t.BBox=[0,0,Number(be(i)),Number(be(e))],t},KT=Fi.__acroform__.setBit=function(n,t){if(n=n||0,t=t||0,isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|=1<<t},ZT=Fi.__acroform__.clearBit=function(n,t){if(n=n||0,t=t||0,isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&=~(1<<t)},JT=Fi.__acroform__.getBit=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<t?1:0},zi=Fi.__acroform__.getBitForPdf=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return JT(n,t-1)},qi=Fi.__acroform__.setBitForPdf=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return KT(n,t-1)},Vi=Fi.__acroform__.clearBitForPdf=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return ZT(n,t-1)},QT=Fi.__acroform__.calculateCoordinates=function(n,t){var e=t.internal.getHorizontalCoordinate,i=t.internal.getVerticalCoordinate,r=n[0],s=n[1],a=n[2],o=n[3],l={};return l.lowerLeft_X=e(r)||0,l.lowerLeft_Y=i(s+o)||0,l.upperRight_X=e(r+a)||0,l.upperRight_Y=i(s)||0,[Number(be(l.lowerLeft_X)),Number(be(l.lowerLeft_Y)),Number(be(l.upperRight_X)),Number(be(l.upperRight_Y))]},tM=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var t=[],e=n._V||n.DV,i=Ep(n,e),r=n.scope.internal.getFont(n.fontName,n.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(n.scope.__private__.encodeColorString(n.color)),t.push("/"+r+" "+be(i.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(i.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=Ts(n);return s.scope=n.scope,s.stream=t.join(`
`),s}},Ep=function(n,t){var e=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},r=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");r=n.multiline?r.map(function(F){return F.split(`
`)}):r.map(function(F){return[F]});var s=e,a=$t.internal.getHeight(n)||0;a=a<0?-a:a;var o=$t.internal.getWidth(n)||0;o=o<0?-o:o;var l=function(F,M,O){if(F+1<r.length){var G=M+" "+r[F+1][0];return Zf(G,n,O).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var h,c,u=Zf("3",n,s).height,d=n.multiline?a-s:(a-u)/2,g=d+=2,p=0,y=0,w=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+Zf(t,n,s=12).width+", FieldWidth:"+o+`
`;break}for(var x="",b=0,L=0;L<r.length;L++)if(r.hasOwnProperty(L)){var P=!1;if(r[L].length!==1&&w!==r[L].length-1){if((u+2)*(b+2)+2>a)continue t;x+=r[L][w],P=!0,y=L,L--}else{x=(x+=r[L][w]+" ").substr(x.length-1)==" "?x.substr(0,x.length-1):x;var R=parseInt(L),j=l(R,x,s),k=L>=r.length-1;if(j&&!k){x+=" ",w=0;continue}if(j||k){if(k)y=R;else if(n.multiline&&(u+2)*(b+2)+2>a)continue t}else{if(!n.multiline||(u+2)*(b+2)+2>a)continue t;y=R}}for(var T="",q=p;q<=y;q++){var W=r[q];if(n.multiline){if(q===y){T+=W[w]+" ",w=(w+1)%W.length;continue}if(q===p){T+=W[W.length-1]+" ";continue}}T+=W[0]+" "}switch(T=T.substr(T.length-1)==" "?T.substr(0,T.length-1):T,c=Zf(T,n,s).width,n.textAlign){case"right":h=o-c-2;break;case"center":h=(o-c)/2;break;case"left":default:h=2}t+=be(h)+" "+be(g)+` Td
`,t+="("+cl(T)+`) Tj
`,t+=-be(h)+` 0 Td
`,g=-(s+2),c=0,p=P?y:y+1,b++,x=""}break}return i.text=t,i.fontSize=s,i},Zf=function(n,t,e){var i=t.scope.internal.getFont(t.fontName,t.fontStyle),r=t.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:r}},eM={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},iM=function(n,t){var e={type:"reference",object:n};t.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===e.type&&i.object===e.object})===void 0&&t.internal.getPageInfo(n.page).pageContext.annotations.push(e)},nM=function(n,t){for(var e in n)if(n.hasOwnProperty(e)){var i=e,r=n[e];t.internal.newObjectDeferredBegin(r.objId,!0),oi(r)==="object"&&typeof r.putStream=="function"&&r.putStream(),delete n[i]}},rM=function(n,t){if(t.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(ys.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(eM)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");W1=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new Mw,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in i)if(i.hasOwnProperty(r)){var s=i[r];s.objId=void 0,s.hasAnnotation&&iM(s,e)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(e){(function(i,r){var s=!i;for(var a in i||(r.internal.newObjectDeferredBegin(r.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),r.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||r.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(a)){var o=i[a],l=[],h=o.Rect;if(o.Rect&&(o.Rect=QT(o.Rect,r)),r.internal.newObjectDeferredBegin(o.objId,!0),o.DA=$t.createDefaultAppearanceStream(o),oi(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(l=o.getKeyValueListForStream()),o.Rect=h,o.hasAppearanceStream&&!o.appearanceStreamContent){var c=tM(o);l.push({key:"AP",value:"<</N "+c+">>"}),r.internal.acroformPlugin.xForms.push(c)}if(o.appearanceStreamContent){var u="";for(var d in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(d)){var g=o.appearanceStreamContent[d];if(u+="/"+d+" ",u+="<<",Object.keys(g).length>=1||Array.isArray(g)){for(var a in g)if(g.hasOwnProperty(a)){var p=g[a];typeof p=="function"&&(p=p.call(r,o)),u+="/"+a+" "+p+" ",r.internal.acroformPlugin.xForms.indexOf(p)>=0||r.internal.acroformPlugin.xForms.push(p)}}else typeof(p=g)=="function"&&(p=p.call(r,o)),u+="/"+a+" "+p,r.internal.acroformPlugin.xForms.indexOf(p)>=0||r.internal.acroformPlugin.xForms.push(p);u+=">>"}l.push({key:"AP",value:`<<
`+u+">>"})}r.internal.putStream({additionalKeyValues:l,objectId:o.objId}),r.internal.out("endobj")}s&&nM(r.internal.acroformPlugin.xForms,r)})(e,n)}),n.internal.acroformPlugin.isInitialized=!0}},Aw=Fi.__acroform__.arrayToPdfArray=function(n,t,e){var i=function(a){return a};if(Array.isArray(n)){for(var r="[",s=0;s<n.length;s++)switch(s!==0&&(r+=" "),oi(n[s])){case"boolean":case"number":case"object":r+=n[s].toString();break;case"string":n[s].substr(0,1)!=="/"?(t!==void 0&&e&&(i=e.internal.getEncryptor(t)),r+="("+cl(i(n[s].toString()))+")"):r+=n[s].toString()}return r+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},pm=function(n,t,e){var i=function(r){return r};return t!==void 0&&e&&(i=e.internal.getEncryptor(t)),(n=n||"").toString(),n="("+cl(i(n))+")"},Fs=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Fs.prototype.toString=function(){return this.objId+" 0 R"},Fs.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},Fs.prototype.getKeyValueListForStream=function(){var n=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var i=t[e],r=this[i];r&&(Array.isArray(r)?n.push({key:i,value:Aw(r,this.objId,this.scope)}):r instanceof Fs?(r.scope=this.scope,n.push({key:i,value:r.objId+" 0 R"})):typeof r!="function"&&n.push({key:i,value:r}))}return n};var Tw=function(){Fs.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){n=e.trim()},get:function(){return n||null}})};gr(Tw,Fs);var Mw=function(){Fs.call(this);var n,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var e=function(i){return i};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+cl(e(n))+")"}},set:function(e){n=e}})};gr(Mw,Fs);var ys=function n(){Fs.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute F supplied.');t=x}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!zi(t,3)},set:function(x){x?this.F=qi(t,3):this.F=Vi(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute Ff supplied.');e=x}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(x){i=x!==void 0?x:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(x){i[0]=x}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(x){i[1]=x}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(x){i[2]=x}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(x){i[3]=x}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(x){switch(x){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=x;break;default:throw new Error('Invalid value "'+x+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof Xd)return;s="FieldObject"+n.FieldNum++}var x=function(b){return b};return this.scope&&(x=this.scope.internal.getEncryptor(this.objId)),"("+cl(x(s))+")"},set:function(x){s=x.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(x){s=x}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(x){a=x}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(x){o=x}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(x){l=x}});var h=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return h===void 0?50/W1:h},set:function(x){h=x}});var c="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return c},set:function(x){c=x}});var u="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!u||this instanceof Xd||this instanceof Ho))return pm(u,this.objId,this.scope)},set:function(x){x=x.toString(),u=x}});var d=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof mn?d:pm(d,this.objId,this.scope)},set:function(x){x=x.toString(),d=this instanceof mn?x:x.substr(0,1)==="("?Wl(x.substr(1,x.length-2)):Wl(x)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof mn?Wl(d.substr(1,d.length-1)):d},set:function(x){x=x.toString(),d=this instanceof mn?"/"+x:x}});var g=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(g)return g},set:function(x){this.V=x}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(g)return this instanceof mn?g:pm(g,this.objId,this.scope)},set:function(x){x=x.toString(),g=this instanceof mn?x:x.substr(0,1)==="("?Wl(x.substr(1,x.length-2)):Wl(x)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof mn?Wl(g.substr(1,g.length-1)):g},set:function(x){x=x.toString(),g=this instanceof mn?"/"+x:x}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,y=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return y},set:function(x){x=!!x,y=x}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(x){p=x}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,1)},set:function(x){x?this.Ff=qi(this.Ff,1):this.Ff=Vi(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,2)},set:function(x){x?this.Ff=qi(this.Ff,2):this.Ff=Vi(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,3)},set:function(x){x?this.Ff=qi(this.Ff,3):this.Ff=Vi(this.Ff,3)}});var w=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(w!==null)return w},set:function(x){if([0,1,2].indexOf(x)===-1)throw new Error('Invalid value "'+x+'" for attribute Q supplied.');w=x}}),Object.defineProperty(this,"textAlign",{get:function(){var x;switch(w){case 0:default:x="left";break;case 1:x="center";break;case 2:x="right"}return x},configurable:!0,enumerable:!0,set:function(x){switch(x){case"right":case 2:w=2;break;case"center":case 1:w=1;break;case"left":case 0:default:w=0}}})};gr(ys,Fs);var bh=function(){ys.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){n=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Aw(t,this.objId,this.scope)},set:function(e){var i,r;r=[],typeof(i=e)=="string"&&(r=function(s,a,o){o||(o=1);for(var l,h=[];l=a.exec(s);)h.push(l[o]);return h}(i,/\((.*?)\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,i){for(i=i||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,18)},set:function(e){e?this.Ff=qi(this.Ff,18):this.Ff=Vi(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=qi(this.Ff,19):this.Ff=Vi(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,20)},set:function(e){e?(this.Ff=qi(this.Ff,20),t.sort()):this.Ff=Vi(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,22)},set:function(e){e?this.Ff=qi(this.Ff,22):this.Ff=Vi(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,23)},set:function(e){e?this.Ff=qi(this.Ff,23):this.Ff=Vi(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,27)},set:function(e){e?this.Ff=qi(this.Ff,27):this.Ff=Vi(this.Ff,27)}}),this.hasAppearanceStream=!1};gr(bh,ys);var Eh=function(){bh.call(this),this.fontName="helvetica",this.combo=!1};gr(Eh,bh);var Sh=function(){Eh.call(this),this.combo=!0};gr(Sh,Eh);var dd=function(){Sh.call(this),this.edit=!0};gr(dd,Sh);var mn=function(){ys.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,15)},set:function(e){e?this.Ff=qi(this.Ff,15):this.Ff=Vi(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,16)},set:function(e){e?this.Ff=qi(this.Ff,16):this.Ff=Vi(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,17)},set:function(e){e?this.Ff=qi(this.Ff,17):this.Ff=Vi(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,26)},set:function(e){e?this.Ff=qi(this.Ff,26):this.Ff=Vi(this.Ff,26)}});var n,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var i,r=[];for(i in r.push("<<"),t)r.push("/"+i+" ("+cl(e(t[i]))+")");return r.push(">>"),r.join(`
`)}},set:function(e){oi(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}})};gr(mn,ys);var gd=function(){mn.call(this),this.pushButton=!0};gr(gd,mn);var Lh=function(){mn.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t!==void 0?t:[]}})};gr(Lh,mn);var Xd=function(){var n,t;ys.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(r){n=r}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(r){t=r}});var e,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};this.scope&&(r=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),i)a.push("/"+s+" ("+cl(r(i[s]))+")");return a.push(">>"),a.join(`
`)},set:function(r){oi(r)==="object"&&(i=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(r){typeof r=="string"&&(i.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=$t.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};gr(Xd,ys),Lh.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=n.createAppearanceStream(e.optionName),e.caption=n.getCA()}},Lh.prototype.createOption=function(n){var t=new Xd;return t.Parent=this,t.optionName=n,this.Kids.push(t),sM.call(this.scope,t),t};var md=function(){mn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=$t.CheckBox.createAppearanceStream()};gr(md,mn);var Ho=function(){ys.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,13)},set:function(t){t?this.Ff=qi(this.Ff,13):this.Ff=Vi(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,21)},set:function(t){t?this.Ff=qi(this.Ff,21):this.Ff=Vi(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,23)},set:function(t){t?this.Ff=qi(this.Ff,23):this.Ff=Vi(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,24)},set:function(t){t?this.Ff=qi(this.Ff,24):this.Ff=Vi(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,25)},set:function(t){t?this.Ff=qi(this.Ff,25):this.Ff=Vi(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,26)},set:function(t){t?this.Ff=qi(this.Ff,26):this.Ff=Vi(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){Number.isInteger(t)&&(n=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};gr(Ho,ys);var pd=function(){Ho.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!zi(this.Ff,14)},set:function(n){n?this.Ff=qi(this.Ff,14):this.Ff=Vi(this.Ff,14)}}),this.password=!0};gr(pd,Ho);var $t={CheckBox:{createAppearanceStream:function(){return{N:{On:$t.CheckBox.YesNormal},D:{On:$t.CheckBox.YesPushDown,Off:$t.CheckBox.OffPushDown}}},YesPushDown:function(n){var t=Ts(n);t.scope=n.scope;var e=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,r=n.scope.__private__.encodeColorString(n.color),s=Ep(n,n.caption);return e.push("0.749023 g"),e.push("0 0 "+be($t.internal.getWidth(n))+" "+be($t.internal.getHeight(n))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+i+" "+be(s.fontSize)+" Tf "+r),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(n){var t=Ts(n);t.scope=n.scope;var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),r=[],s=$t.internal.getHeight(n),a=$t.internal.getWidth(n),o=Ep(n,n.caption);return r.push("1 g"),r.push("0 0 "+be(a)+" "+be(s)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+be(a-1)+" "+be(s-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+e+" "+be(o.fontSize)+" Tf "+i),r.push(o.text),r.push("ET"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(n){var t=Ts(n);t.scope=n.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+be($t.internal.getWidth(n))+" "+be($t.internal.getHeight(n))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(n){var t={D:{Off:$t.RadioButton.Circle.OffPushDown},N:{}};return t.N[n]=$t.RadioButton.Circle.YesNormal,t.D[n]=$t.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(n){var t=Ts(n);t.scope=n.scope;var e=[],i=$t.internal.getWidth(n)<=$t.internal.getHeight(n)?$t.internal.getWidth(n)/4:$t.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var r=$t.internal.Bezier_C,s=Number((i*r).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+Za($t.internal.getWidth(n)/2)+" "+Za($t.internal.getHeight(n)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(n){var t=Ts(n);t.scope=n.scope;var e=[],i=$t.internal.getWidth(n)<=$t.internal.getHeight(n)?$t.internal.getWidth(n)/4:$t.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var r=Number((2*i).toFixed(5)),s=Number((r*$t.internal.Bezier_C).toFixed(5)),a=Number((i*$t.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Za($t.internal.getWidth(n)/2)+" "+Za($t.internal.getHeight(n)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),e.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),e.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),e.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+Za($t.internal.getWidth(n)/2)+" "+Za($t.internal.getHeight(n)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),e.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),e.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),e.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(n){var t=Ts(n);t.scope=n.scope;var e=[],i=$t.internal.getWidth(n)<=$t.internal.getHeight(n)?$t.internal.getWidth(n)/4:$t.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var r=Number((2*i).toFixed(5)),s=Number((r*$t.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Za($t.internal.getWidth(n)/2)+" "+Za($t.internal.getHeight(n)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),e.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),e.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),e.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(n){var t={D:{Off:$t.RadioButton.Cross.OffPushDown},N:{}};return t.N[n]=$t.RadioButton.Cross.YesNormal,t.D[n]=$t.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(n){var t=Ts(n);t.scope=n.scope;var e=[],i=$t.internal.calculateCross(n);return e.push("q"),e.push("1 1 "+be($t.internal.getWidth(n)-2)+" "+be($t.internal.getHeight(n)-2)+" re"),e.push("W"),e.push("n"),e.push(be(i.x1.x)+" "+be(i.x1.y)+" m"),e.push(be(i.x2.x)+" "+be(i.x2.y)+" l"),e.push(be(i.x4.x)+" "+be(i.x4.y)+" m"),e.push(be(i.x3.x)+" "+be(i.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(n){var t=Ts(n);t.scope=n.scope;var e=$t.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+be($t.internal.getWidth(n))+" "+be($t.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+be($t.internal.getWidth(n)-2)+" "+be($t.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(be(e.x1.x)+" "+be(e.x1.y)+" m"),i.push(be(e.x2.x)+" "+be(e.x2.y)+" l"),i.push(be(e.x4.x)+" "+be(e.x4.y)+" m"),i.push(be(e.x3.x)+" "+be(e.x3.y)+" l"),i.push("s"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(n){var t=Ts(n);t.scope=n.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+be($t.internal.getWidth(n))+" "+be($t.internal.getHeight(n))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(n){var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,e=n.scope.__private__.encodeColorString(n.color);return"/"+t+" "+n.fontSize+" Tf "+e}};$t.internal={Bezier_C:.551915024494,calculateCross:function(n){var t=$t.internal.getWidth(n),e=$t.internal.getHeight(n),i=Math.min(t,e);return{x1:{x:(t-i)/2,y:(e-i)/2+i},x2:{x:(t-i)/2+i,y:(e-i)/2},x3:{x:(t-i)/2,y:(e-i)/2},x4:{x:(t-i)/2+i,y:(e-i)/2+i}}}},$t.internal.getWidth=function(n){var t=0;return oi(n)==="object"&&(t=u2(n.Rect[2])),t},$t.internal.getHeight=function(n){var t=0;return oi(n)==="object"&&(t=u2(n.Rect[3])),t};var sM=Fi.addField=function(n){if(rM(this,n),!(n instanceof ys))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=n).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};Fi.AcroFormChoiceField=bh,Fi.AcroFormListBox=Eh,Fi.AcroFormComboBox=Sh,Fi.AcroFormEditBox=dd,Fi.AcroFormButton=mn,Fi.AcroFormPushButton=gd,Fi.AcroFormRadioButton=Lh,Fi.AcroFormCheckBox=md,Fi.AcroFormTextField=Ho,Fi.AcroFormPasswordField=pd,Fi.AcroFormAppearance=$t,Fi.AcroForm={ChoiceField:bh,ListBox:Eh,ComboBox:Sh,EditBox:dd,Button:mn,PushButton:gd,RadioButton:Lh,CheckBox:md,TextField:Ho,PasswordField:pd,Appearance:$t},oe.AcroForm={ChoiceField:bh,ListBox:Eh,ComboBox:Sh,EditBox:dd,Button:mn,PushButton:gd,RadioButton:Lh,CheckBox:md,TextField:Ho,PasswordField:pd,Appearance:$t};function Pw(n){return n.reduce(function(t,e,i){return t[e]=i,t},{})}(function(n){n.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=n.__addimage__.getImageFileTypeByImageData=function(F,M){var O,G,tt,Z,it,J=t;if((M=M||t)==="RGBA"||F.data!==void 0&&F.data instanceof Uint8ClampedArray&&"height"in F&&"width"in F)return"RGBA";if(j(F))for(it in e)for(tt=e[it],O=0;O<tt.length;O+=1){for(Z=!0,G=0;G<tt[O].length;G+=1)if(tt[O][G]!==void 0&&tt[O][G]!==F[G]){Z=!1;break}if(Z===!0){J=it;break}}else for(it in e)for(tt=e[it],O=0;O<tt.length;O+=1){for(Z=!0,G=0;G<tt[O].length;G+=1)if(tt[O][G]!==void 0&&tt[O][G]!==F.charCodeAt(G)){Z=!1;break}if(Z===!0){J=it;break}}return J===t&&M!==t&&(J=M),J},r=function F(M){for(var O=this.internal.write,G=this.internal.putStream,tt=(0,this.internal.getFilters)();tt.indexOf("FlateEncode")!==-1;)tt.splice(tt.indexOf("FlateEncode"),1);M.objectId=this.internal.newObject();var Z=[];if(Z.push({key:"Type",value:"/XObject"}),Z.push({key:"Subtype",value:"/Image"}),Z.push({key:"Width",value:M.width}),Z.push({key:"Height",value:M.height}),M.colorSpace===w.INDEXED?Z.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(M.palette.length/3-1)+" "+("sMask"in M&&M.sMask!==void 0?M.objectId+2:M.objectId+1)+" 0 R]"}):(Z.push({key:"ColorSpace",value:"/"+M.colorSpace}),M.colorSpace===w.DEVICE_CMYK&&Z.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Z.push({key:"BitsPerComponent",value:M.bitsPerComponent}),"decodeParameters"in M&&M.decodeParameters!==void 0&&Z.push({key:"DecodeParms",value:"<<"+M.decodeParameters+">>"}),"transparency"in M&&Array.isArray(M.transparency)){for(var it="",J=0,lt=M.transparency.length;J<lt;J++)it+=M.transparency[J]+" "+M.transparency[J]+" ";Z.push({key:"Mask",value:"["+it+"]"})}M.sMask!==void 0&&Z.push({key:"SMask",value:M.objectId+1+" 0 R"});var ct=M.filter!==void 0?["/"+M.filter]:void 0;if(G({data:M.data,additionalKeyValues:Z,alreadyAppliedFilters:ct,objectId:M.objectId}),O("endobj"),"sMask"in M&&M.sMask!==void 0){var Et="/Predictor "+M.predictor+" /Colors 1 /BitsPerComponent "+M.bitsPerComponent+" /Columns "+M.width,S={width:M.width,height:M.height,colorSpace:"DeviceGray",bitsPerComponent:M.bitsPerComponent,decodeParameters:Et,data:M.sMask};"filter"in M&&(S.filter=M.filter),F.call(this,S)}if(M.colorSpace===w.INDEXED){var U=this.internal.newObject();G({data:T(new Uint8Array(M.palette)),objectId:U}),O("endobj")}},s=function(){var F=this.internal.collections.addImage_images;for(var M in F)r.call(this,F[M])},a=function(){var F,M=this.internal.collections.addImage_images,O=this.internal.write;for(var G in M)O("/I"+(F=M[G]).index,F.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},l=function(){var F=this.internal.collections.addImage_images;return o.call(this),F},h=function(){return Object.keys(this.internal.collections.addImage_images).length},c=function(F){return typeof n["process"+F.toUpperCase()]=="function"},u=function(F){return oi(F)==="object"&&F.nodeType===1},d=function(F,M){if(F.nodeName==="IMG"&&F.hasAttribute("src")){var O=""+F.getAttribute("src");if(O.indexOf("data:image/")===0)return Zc(unescape(O).split("base64,").pop());var G=n.loadFile(O,!0);if(G!==void 0)return G}if(F.nodeName==="CANVAS"){if(F.width===0||F.height===0)throw new Error("Given canvas must have data. Canvas width: "+F.width+", height: "+F.height);var tt;switch(M){case"PNG":tt="image/png";break;case"WEBP":tt="image/webp";break;case"JPEG":case"JPG":default:tt="image/jpeg"}return Zc(F.toDataURL(tt,1).split("base64,").pop())}},g=function(F){var M=this.internal.collections.addImage_images;if(M){for(var O in M)if(F===M[O].alias)return M[O]}},p=function(F,M,O){return F||M||(F=-96,M=-96),F<0&&(F=-1*O.width*72/F/this.internal.scaleFactor),M<0&&(M=-1*O.height*72/M/this.internal.scaleFactor),F===0&&(F=M*O.width/O.height),M===0&&(M=F*O.height/O.width),[F,M]},y=function(F,M,O,G,tt,Z){var it=p.call(this,O,G,tt),J=this.internal.getCoordinateString,lt=this.internal.getVerticalCoordinateString,ct=l.call(this);if(O=it[0],G=it[1],ct[tt.index]=tt,Z){Z*=Math.PI/180;var Et=Math.cos(Z),S=Math.sin(Z),U=function(K){return K.toFixed(4)},H=[U(Et),U(S),U(-1*S),U(Et),0,0,"cm"]}this.internal.write("q"),Z?(this.internal.write([1,"0","0",1,J(F),lt(M+G),"cm"].join(" ")),this.internal.write(H.join(" ")),this.internal.write([J(O),"0","0",J(G),"0","0","cm"].join(" "))):this.internal.write([J(O),"0","0",J(G),J(F),lt(M+G),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+tt.index+" Do"),this.internal.write("Q")},w=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var x=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},b=n.__addimage__.sHashCode=function(F){var M,O,G=0;if(typeof F=="string")for(O=F.length,M=0;M<O;M++)G=(G<<5)-G+F.charCodeAt(M),G|=0;else if(j(F))for(O=F.byteLength/2,M=0;M<O;M++)G=(G<<5)-G+F[M],G|=0;return G},L=n.__addimage__.validateStringAsBase64=function(F){(F=F||"").toString().trim();var M=!0;return F.length===0&&(M=!1),F.length%4!=0&&(M=!1),/^[A-Za-z0-9+/]+$/.test(F.substr(0,F.length-2))===!1&&(M=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(F.substr(-2))===!1&&(M=!1),M},P=n.__addimage__.extractImageFromDataUrl=function(F){var M=(F=F||"").split("base64,"),O=null;if(M.length===2){var G=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(M[0]);Array.isArray(G)&&(O={mimeType:G[1],charset:G[2],data:M[1]})}return O},R=n.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};n.__addimage__.isArrayBuffer=function(F){return R()&&F instanceof ArrayBuffer};var j=n.__addimage__.isArrayBufferView=function(F){return R()&&typeof Uint32Array<"u"&&(F instanceof Int8Array||F instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&F instanceof Uint8ClampedArray||F instanceof Int16Array||F instanceof Uint16Array||F instanceof Int32Array||F instanceof Uint32Array||F instanceof Float32Array||F instanceof Float64Array)},k=n.__addimage__.binaryStringToUint8Array=function(F){for(var M=F.length,O=new Uint8Array(M),G=0;G<M;G++)O[G]=F.charCodeAt(G);return O},T=n.__addimage__.arrayBufferToBinaryString=function(F){for(var M="",O=j(F)?F:new Uint8Array(F),G=0;G<O.length;G+=8192)M+=String.fromCharCode.apply(null,O.subarray(G,G+8192));return M};n.addImage=function(){var F,M,O,G,tt,Z,it,J,lt;if(typeof arguments[1]=="number"?(M=t,O=arguments[1],G=arguments[2],tt=arguments[3],Z=arguments[4],it=arguments[5],J=arguments[6],lt=arguments[7]):(M=arguments[1],O=arguments[2],G=arguments[3],tt=arguments[4],Z=arguments[5],it=arguments[6],J=arguments[7],lt=arguments[8]),oi(F=arguments[0])==="object"&&!u(F)&&"imageData"in F){var ct=F;F=ct.imageData,M=ct.format||M||t,O=ct.x||O||0,G=ct.y||G||0,tt=ct.w||ct.width||tt,Z=ct.h||ct.height||Z,it=ct.alias||it,J=ct.compression||J,lt=ct.rotation||ct.angle||lt}var Et=this.internal.getFilters();if(J===void 0&&Et.indexOf("FlateEncode")!==-1&&(J="SLOW"),isNaN(O)||isNaN(G))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var S=q.call(this,F,M,it,J);return y.call(this,O,G,tt,Z,S,lt),this};var q=function(F,M,O,G){var tt,Z,it;if(typeof F=="string"&&i(F)===t){F=unescape(F);var J=W(F,!1);(J!==""||(J=n.loadFile(F,!0))!==void 0)&&(F=J)}if(u(F)&&(F=d(F,M)),M=i(F,M),!c(M))throw new Error("addImage does not support files of type '"+M+"', please ensure that a plugin for '"+M+"' support is added.");if(((it=O)==null||it.length===0)&&(O=function(lt){return typeof lt=="string"||j(lt)?b(lt):j(lt.data)?b(lt.data):null}(F)),(tt=g.call(this,O))||(R()&&(F instanceof Uint8Array||M==="RGBA"||(Z=F,F=k(F))),tt=this["process"+M.toUpperCase()](F,h.call(this),O,function(lt){return lt&&typeof lt=="string"&&(lt=lt.toUpperCase()),lt in n.image_compression?lt:x.NONE}(G),Z)),!tt)throw new Error("An unknown error occurred whilst processing the image.");return tt},W=n.__addimage__.convertBase64ToBinaryString=function(F,M){var O;M=typeof M!="boolean"||M;var G,tt="";if(typeof F=="string"){G=(O=P(F))!==null?O.data:F;try{tt=Zc(G)}catch(Z){if(M)throw L(G)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Z.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return tt};n.getImageProperties=function(F){var M,O,G="";if(u(F)&&(F=d(F)),typeof F=="string"&&i(F)===t&&((G=W(F,!1))===""&&(G=n.loadFile(F)||""),F=G),O=i(F),!c(O))throw new Error("addImage does not support files of type '"+O+"', please ensure that a plugin for '"+O+"' support is added.");if(!R()||F instanceof Uint8Array||(F=k(F)),!(M=this["process"+O.toUpperCase()](F)))throw new Error("An unknown error occurred whilst processing the image");return M.fileType=O,M}})(oe.API),function(n){var t=function(e){if(e!==void 0&&e!="")return!0};oe.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(e){for(var i,r,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,l=this.internal.getPageInfoByObjId(e.objId),h=e.pageContext.annotations,c=!1,u=0;u<h.length&&!c;u++)switch((i=h[u]).type){case"link":(t(i.options.url)||t(i.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(c!=0){this.internal.write("/Annots [");for(var d=0;d<h.length;d++){i=h[d];var g=this.internal.pdfEscape,p=this.internal.getEncryptor(e.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var y=this.internal.newAdditionalObject(),w=this.internal.newAdditionalObject(),x=this.internal.getEncryptor(y.objId),b=i.title||"Note";s="<</Type /Annot /Subtype /Text "+(r="/Rect ["+a(i.bounds.x)+" "+o(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w)+" "+o(i.bounds.y)+"] ")+"/Contents ("+g(x(i.contents))+")",s+=" /Popup "+w.objId+" 0 R",s+=" /P "+l.objId+" 0 R",s+=" /T ("+g(x(b))+") >>",y.content=s;var L=y.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+a(i.bounds.x+30)+" "+o(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w+30)+" "+o(i.bounds.y)+"] ")+" /Parent "+L,i.open&&(s+=" /Open true"),s+=" >>",w.content=s,this.internal.write(y.objId,"0 R",w.objId,"0 R");break;case"freetext":r="/Rect ["+a(i.bounds.x)+" "+o(i.bounds.y)+" "+a(i.bounds.x+i.bounds.w)+" "+o(i.bounds.y+i.bounds.h)+"] ";var P=i.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+g(p(i.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+P+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(i.options.name){var R=this.annotations._nameMap[i.options.name];i.options.pageNumber=R.page,i.options.top=R.y}else i.options.top||(i.options.top=0);if(r="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",s="",i.options.url)s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+g(p(i.options.url))+") >>";else if(i.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,s+=" /FitV "+i.options.left+"]";break;case"XYZ":default:var j=o(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),s+=" /XYZ "+i.options.left+" "+j+" "+i.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),n.createAnnotation=function(e){var i=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":i.pageContext.annotations.push(e)}},n.link=function(e,i,r,s,a){var o=this.internal.getCurrentPageInfo(),l=this.internal.getCoordinateString,h=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:l(e),y:h(i),w:l(e+r),h:h(i+s)},options:a,type:"link"})},n.textWithLink=function(e,i,r,s){var a,o,l=this.getTextWidth(e),h=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var c=this.splitTextToSize(e,o).length;a=Math.ceil(h*c)}else o=l,a=h;return this.text(e,i,r,s),r+=.2*h,s.align==="center"&&(i-=l/2),s.align==="right"&&(i-=l),this.link(i,r-h,o,a,s),l},n.getTextWidth=function(e){var i=this.internal.getFontSize();return this.getStringUnitWidth(e)*i/this.internal.scaleFactor}}(oe.API),function(n){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];n.__arabicParser__={};var s=n.__arabicParser__.isInArabicSubstitutionA=function(y){return t[y.charCodeAt(0)]!==void 0},a=n.__arabicParser__.isArabicLetter=function(y){return typeof y=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(y)},o=n.__arabicParser__.isArabicEndLetter=function(y){return a(y)&&s(y)&&t[y.charCodeAt(0)].length<=2},l=n.__arabicParser__.isArabicAlfLetter=function(y){return a(y)&&r.indexOf(y.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(y){return a(y)&&s(y)&&t[y.charCodeAt(0)].length>=1};var h=n.__arabicParser__.arabicLetterHasFinalForm=function(y){return a(y)&&s(y)&&t[y.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(y){return a(y)&&s(y)&&t[y.charCodeAt(0)].length>=3};var c=n.__arabicParser__.arabicLetterHasMedialForm=function(y){return a(y)&&s(y)&&t[y.charCodeAt(0)].length==4},u=n.__arabicParser__.resolveLigatures=function(y){var w=0,x=e,b="",L=0;for(w=0;w<y.length;w+=1)x[y.charCodeAt(w)]!==void 0?(L++,typeof(x=x[y.charCodeAt(w)])=="number"&&(b+=String.fromCharCode(x),x=e,L=0),w===y.length-1&&(x=e,b+=y.charAt(w-(L-1)),w-=L-1,L=0)):(x=e,b+=y.charAt(w-L),w-=L,L=0);return b};n.__arabicParser__.isArabicDiacritic=function(y){return y!==void 0&&i[y.charCodeAt(0)]!==void 0};var d=n.__arabicParser__.getCorrectForm=function(y,w,x){return a(y)?s(y)===!1?-1:!h(y)||!a(w)&&!a(x)||!a(x)&&o(w)||o(y)&&!a(w)||o(y)&&l(w)||o(y)&&o(w)?0:c(y)&&a(w)&&!o(w)&&a(x)&&h(x)?3:o(y)||!a(x)?1:2:-1},g=function(y){var w=0,x=0,b=0,L="",P="",R="",j=(y=y||"").split("\\s+"),k=[];for(w=0;w<j.length;w+=1){for(k.push(""),x=0;x<j[w].length;x+=1)L=j[w][x],P=j[w][x-1],R=j[w][x+1],a(L)?(b=d(L,P,R),k[w]+=b!==-1?String.fromCharCode(t[L.charCodeAt(0)][b]):L):k[w]+=L;k[w]=u(k[w])}return k.join(" ")},p=n.__arabicParser__.processArabic=n.processArabic=function(){var y,w=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,x=[];if(Array.isArray(w)){var b=0;for(x=[],b=0;b<w.length;b+=1)Array.isArray(w[b])?x.push([g(w[b][0]),w[b][1],w[b][2]]):x.push([g(w[b])]);y=x}else y=g(w);return typeof arguments[0]=="string"?y:(arguments[0].text=y,arguments[0])};n.events.push(["preProcessText",p])}(oe.API),oe.API.autoPrint=function(n){var t;switch((n=n||{}).variant=n.variant||"non-conform",n.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(n){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(o){r=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,i){var r;if((e=e||"2d")!=="2d")return null;for(r in i)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=i[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(oe.API),function(n){var t={left:0,top:0,bottom:0,right:0},e=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var l=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return l},set:function(y){l=y}});var h=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return h},set:function(y){h=y}});var c=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return c},set:function(y){c=y}});var u=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return u},set:function(y){u=y}});var d=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return d},set:function(y){d=y}});var g=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return g},set:function(y){g=y}});var p=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return p},set:function(y){p=y}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(l){return i.call(this),this.internal.__cell__.headerFunction=typeof l=="function"?l:void 0,this},n.getTextDimensions=function(l,h){i.call(this);var c=(h=h||{}).fontSize||this.getFontSize(),u=h.font||this.getFont(),d=h.scaleFactor||this.internal.scaleFactor,g=0,p=0,y=0,w=this;if(!Array.isArray(l)&&typeof l!="string"){if(typeof l!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");l=String(l)}var x=h.maxWidth;x>0?typeof l=="string"?l=this.splitTextToSize(l,x):Object.prototype.toString.call(l)==="[object Array]"&&(l=l.reduce(function(L,P){return L.concat(w.splitTextToSize(P,x))},[])):l=Array.isArray(l)?l:[l];for(var b=0;b<l.length;b++)g<(y=this.getStringUnitWidth(l[b],{font:u})*c)&&(g=y);return g!==0&&(p=l.length),{w:g/=d,h:Math.max((p*c*this.getLineHeightFactor()-c*(this.getLineHeightFactor()-1))/d,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var l=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(l.left,l.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=n.cell=function(){var l;l=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var h=this.internal.__cell__.lastCell,c=this.internal.__cell__.padding,u=this.internal.__cell__.margins||t,d=this.internal.__cell__.tableHeaderRow,g=this.internal.__cell__.printHeaders;return h.lineNumber!==void 0&&(h.lineNumber===l.lineNumber?(l.x=(h.x||0)+(h.width||0),l.y=h.y||0):h.y+h.height+l.height+u.bottom>this.getPageHeight()?(this.cellAddPage(),l.y=u.top,g&&d&&(this.printHeaderRow(l.lineNumber,!0),l.y+=d[0].height)):l.y=h.y+h.height||l.y),l.text[0]!==void 0&&(this.rect(l.x,l.y,l.width,l.height,e===!0?"FD":void 0),l.align==="right"?this.text(l.text,l.x+l.width-c,l.y+c,{align:"right",baseline:"top"}):l.align==="center"?this.text(l.text,l.x+l.width/2,l.y+c,{align:"center",baseline:"top",maxWidth:l.width-c-c}):this.text(l.text,l.x+c,l.y+c,{align:"left",baseline:"top",maxWidth:l.width-c-c})),this.internal.__cell__.lastCell=l,this};n.table=function(l,h,c,u,d){if(i.call(this),!c)throw new Error("No data for PDF table.");var g,p,y,w,x=[],b=[],L=[],P={},R={},j=[],k=[],T=(d=d||{}).autoSize||!1,q=d.printHeaders!==!1,W=d.css&&d.css["font-size"]!==void 0?16*d.css["font-size"]:d.fontSize||12,F=d.margins||Object.assign({width:this.getPageWidth()},t),M=typeof d.padding=="number"?d.padding:3,O=d.headerBackgroundColor||"#c8c8c8",G=d.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=q,this.internal.__cell__.margins=F,this.internal.__cell__.table_font_size=W,this.internal.__cell__.padding=M,this.internal.__cell__.headerBackgroundColor=O,this.internal.__cell__.headerTextColor=G,this.setFontSize(W),u==null)b=x=Object.keys(c[0]),L=x.map(function(){return"left"});else if(Array.isArray(u)&&oi(u[0])==="object")for(x=u.map(function(ct){return ct.name}),b=u.map(function(ct){return ct.prompt||ct.name||""}),L=u.map(function(ct){return ct.align||"left"}),g=0;g<u.length;g+=1)R[u[g].name]=u[g].width*(19.049976/25.4);else Array.isArray(u)&&typeof u[0]=="string"&&(b=x=u,L=x.map(function(){return"left"}));if(T||Array.isArray(u)&&typeof u[0]=="string")for(g=0;g<x.length;g+=1){for(P[w=x[g]]=c.map(function(ct){return ct[w]}),this.setFont(void 0,"bold"),j.push(this.getTextDimensions(b[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),p=P[w],this.setFont(void 0,"normal"),y=0;y<p.length;y+=1)j.push(this.getTextDimensions(p[y],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);R[w]=Math.max.apply(null,j)+M+M,j=[]}if(q){var tt={};for(g=0;g<x.length;g+=1)tt[x[g]]={},tt[x[g]].text=b[g],tt[x[g]].align=L[g];var Z=o.call(this,tt,R);k=x.map(function(ct){return new s(l,h,R[ct],Z,tt[ct].text,void 0,tt[ct].align)}),this.setTableHeaderRow(k),this.printHeaderRow(1,!1)}var it=u.reduce(function(ct,Et){return ct[Et.name]=Et.align,ct},{});for(g=0;g<c.length;g+=1){"rowStart"in d&&d.rowStart instanceof Function&&d.rowStart({row:g,data:c[g]},this);var J=o.call(this,c[g],R);for(y=0;y<x.length;y+=1){var lt=c[g][x[y]];"cellStart"in d&&d.cellStart instanceof Function&&d.cellStart({row:g,col:y,data:lt},this),a.call(this,new s(l,h,R[x[y]],J,lt,g+2,it[x[y]]))}}return this.internal.__cell__.table_x=l,this.internal.__cell__.table_y=h,this};var o=function(l,h){var c=this.internal.__cell__.padding,u=this.internal.__cell__.table_font_size,d=this.internal.scaleFactor;return Object.keys(l).map(function(g){var p=l[g];return this.splitTextToSize(p.hasOwnProperty("text")?p.text:p,h[g]-c-c)},this).map(function(g){return this.getLineHeightFactor()*g.length*u/d+c+c},this).reduce(function(g,p){return Math.max(g,p)},0)};n.setTableHeaderRow=function(l){i.call(this),this.internal.__cell__.tableHeaderRow=l},n.printHeaderRow=function(l,h){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var c;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var u=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(u[0],u[1],u[2],u[3],void 0,-1)}this.setFont(void 0,"bold");for(var d=[],g=0;g<this.internal.__cell__.tableHeaderRow.length;g+=1){c=this.internal.__cell__.tableHeaderRow[g].clone(),h&&(c.y=this.internal.__cell__.margins.top||0,d.push(c)),c.lineNumber=l;var p=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,c),this.setTextColor(p)}d.length>0&&this.setTableHeaderRow(d),this.setFont(void 0,"normal"),e=!1}}(oe.API);var Rw={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Iw=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Sp=Pw(Iw),Nw=[100,200,300,400,500,600,700,800,900],aM=Pw(Nw);function Lp(n){var t=n.family.replace(/"|'/g,"").toLowerCase(),e=function(s){return Rw[s=s||"normal"]?s:"normal"}(n.style),i=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(n.weight),r=function(s){return typeof Sp[s=s||"normal"]=="number"?s:"normal"}(n.stretch);return{family:t,style:e,weight:i,stretch:r,src:n.src||[],ref:n.ref||{name:t,style:[r,e,i].join(" ")}}}function f2(n,t,e,i){var r;for(r=e;r>=0&&r<t.length;r+=i)if(n[t[r]])return n[t[r]];for(r=e;r>=0&&r<t.length;r-=i)if(n[t[r]])return n[t[r]]}var oM={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},d2={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function g2(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function lM(n,t,e){for(var i=(e=e||{}).defaultFontFamily||"times",r=Object.assign({},oM,e.genericFontFamilies||{}),s=null,a=null,o=0;o<t.length;++o)if(r[(s=Lp(t[o])).family]&&(s.family=r[s.family]),n.hasOwnProperty(s.family)){a=n[s.family];break}if(!(a=a||n[i]))throw new Error("Could not find a font-family for the rule '"+g2(s)+"' and default family '"+i+"'.");if(a=function(l,h){if(h[l])return h[l];var c=Sp[l],u=c<=Sp.normal?-1:1,d=f2(h,Iw,c,u);if(!d)throw new Error("Could not find a matching font-stretch value for "+l);return d}(s.stretch,a),a=function(l,h){if(h[l])return h[l];for(var c=Rw[l],u=0;u<c.length;++u)if(h[c[u]])return h[c[u]];throw new Error("Could not find a matching font-style for "+l)}(s.style,a),!(a=function(l,h){if(h[l])return h[l];if(l===400&&h[500])return h[500];if(l===500&&h[400])return h[400];var c=aM[l],u=f2(h,Nw,c,l<400?-1:1);if(!u)throw new Error("Could not find a matching font-weight for value "+l);return u}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+g2(s)+"'.");return a}function m2(n){return n.trimLeft()}function hM(n,t){for(var e=0;e<n.length;){if(n.charAt(e)===t)return[n.substring(0,e),n.substring(e+1)];e+=1}return null}function cM(n){var t=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],n.substring(t[0].length)]}var Jf,p2,_2,_m=["times"];(function(n){var t,e,i,r,s,a,o,l,h,c=function(S){return S=S||{},this.isStrokeTransparent=S.isStrokeTransparent||!1,this.strokeOpacity=S.strokeOpacity||1,this.strokeStyle=S.strokeStyle||"#000000",this.fillStyle=S.fillStyle||"#000000",this.isFillTransparent=S.isFillTransparent||!1,this.fillOpacity=S.fillOpacity||1,this.font=S.font||"10px sans-serif",this.textBaseline=S.textBaseline||"alphabetic",this.textAlign=S.textAlign||"left",this.lineWidth=S.lineWidth||1,this.lineJoin=S.lineJoin||"miter",this.lineCap=S.lineCap||"butt",this.path=S.path||[],this.transform=S.transform!==void 0?S.transform.clone():new l,this.globalCompositeOperation=S.globalCompositeOperation||"normal",this.globalAlpha=S.globalAlpha||1,this.clip_path=S.clip_path||[],this.currentPoint=S.currentPoint||new a,this.miterLimit=S.miterLimit||10,this.lastPoint=S.lastPoint||new a,this.lineDashOffset=S.lineDashOffset||0,this.lineDash=S.lineDash||[],this.margin=S.margin||[0,0,0,0],this.prevPageLastElemOffset=S.prevPageLastElemOffset||0,this.ignoreClearRect=typeof S.ignoreClearRect!="boolean"||S.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new u(this),t=this.internal.f2,e=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,h=new c}]);var u=function(S){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var U=S;Object.defineProperty(this,"pdf",{get:function(){return U}});var H=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return H},set:function(pt){H=!!pt}});var K=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return K},set:function(pt){K=!!pt}});var st=0;Object.defineProperty(this,"posX",{get:function(){return st},set:function(pt){isNaN(pt)||(st=pt)}});var ht=0;Object.defineProperty(this,"posY",{get:function(){return ht},set:function(pt){isNaN(pt)||(ht=pt)}}),Object.defineProperty(this,"margin",{get:function(){return h.margin},set:function(pt){var Y;typeof pt=="number"?Y=[pt,pt,pt,pt]:((Y=new Array(4))[0]=pt[0],Y[1]=pt.length>=2?pt[1]:Y[0],Y[2]=pt.length>=3?pt[2]:Y[0],Y[3]=pt.length>=4?pt[3]:Y[1]),h.margin=Y}});var gt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return gt},set:function(pt){gt=pt}});var mt=0;Object.defineProperty(this,"lastBreak",{get:function(){return mt},set:function(pt){mt=pt}});var Lt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Lt},set:function(pt){Lt=pt}}),Object.defineProperty(this,"ctx",{get:function(){return h},set:function(pt){pt instanceof c&&(h=pt)}}),Object.defineProperty(this,"path",{get:function(){return h.path},set:function(pt){h.path=pt}});var Tt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Tt},set:function(pt){Tt=pt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(pt){var Y;Y=d(pt),this.ctx.fillStyle=Y.style,this.ctx.isFillTransparent=Y.a===0,this.ctx.fillOpacity=Y.a,this.pdf.setFillColor(Y.r,Y.g,Y.b,{a:Y.a}),this.pdf.setTextColor(Y.r,Y.g,Y.b,{a:Y.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(pt){var Y=d(pt);this.ctx.strokeStyle=Y.style,this.ctx.isStrokeTransparent=Y.a===0,this.ctx.strokeOpacity=Y.a,Y.a===0?this.pdf.setDrawColor(255,255,255):(Y.a,this.pdf.setDrawColor(Y.r,Y.g,Y.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(pt){["butt","round","square"].indexOf(pt)!==-1&&(this.ctx.lineCap=pt,this.pdf.setLineCap(pt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(pt){isNaN(pt)||(this.ctx.lineWidth=pt,this.pdf.setLineWidth(pt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(pt){["bevel","round","miter"].indexOf(pt)!==-1&&(this.ctx.lineJoin=pt,this.pdf.setLineJoin(pt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(pt){isNaN(pt)||(this.ctx.miterLimit=pt,this.pdf.setMiterLimit(pt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(pt){this.ctx.textBaseline=pt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(pt){["right","end","center","left","start"].indexOf(pt)!==-1&&(this.ctx.textAlign=pt)}});var Bt=null;function Gt(pt,Y){if(Bt===null){var se=function(Wt){var Ct=[];return Object.keys(Wt).forEach(function(Pt){Wt[Pt].forEach(function(Nt){var Rt=null;switch(Nt){case"bold":Rt={family:Pt,weight:"bold"};break;case"italic":Rt={family:Pt,style:"italic"};break;case"bolditalic":Rt={family:Pt,weight:"bold",style:"italic"};break;case"":case"normal":Rt={family:Pt}}Rt!==null&&(Rt.ref={name:Pt,style:Nt},Ct.push(Rt))})}),Ct}(pt.getFontList());Bt=function(Wt){for(var Ct={},Pt=0;Pt<Wt.length;++Pt){var Nt=Lp(Wt[Pt]),Rt=Nt.family,Ut=Nt.stretch,ce=Nt.style,_e=Nt.weight;Ct[Rt]=Ct[Rt]||{},Ct[Rt][Ut]=Ct[Rt][Ut]||{},Ct[Rt][Ut][ce]=Ct[Rt][Ut][ce]||{},Ct[Rt][Ut][ce][_e]=Nt}return Ct}(se.concat(Y))}return Bt}var Jt=null;Object.defineProperty(this,"fontFaces",{get:function(){return Jt},set:function(pt){Bt=null,Jt=pt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(pt){var Y;if(this.ctx.font=pt,(Y=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(pt))!==null){var se=Y[1],Wt=(Y[2],Y[3]),Ct=Y[4],Pt=(Y[5],Y[6]),Nt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Ct)[2];Ct=Math.floor(Nt==="px"?parseFloat(Ct)*this.pdf.internal.scaleFactor:Nt==="em"?parseFloat(Ct)*this.pdf.getFontSize():parseFloat(Ct)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Ct);var Rt=function(ae){var Te,kt,ln=[],Oe=ae.trim();if(Oe==="")return _m;if(Oe in d2)return[d2[Oe]];for(;Oe!=="";){switch(kt=null,Te=(Oe=m2(Oe)).charAt(0)){case'"':case"'":kt=hM(Oe.substring(1),Te);break;default:kt=cM(Oe)}if(kt===null||(ln.push(kt[0]),(Oe=m2(kt[1]))!==""&&Oe.charAt(0)!==","))return _m;Oe=Oe.replace(/^,/,"")}return ln}(Pt);if(this.fontFaces){var Ut=lM(Gt(this.pdf,this.fontFaces),Rt.map(function(ae){return{family:ae,stretch:"normal",weight:Wt,style:se}}));this.pdf.setFont(Ut.ref.name,Ut.ref.style)}else{var ce="";(Wt==="bold"||parseInt(Wt,10)>=700||se==="bold")&&(ce="bold"),se==="italic"&&(ce+="italic"),ce.length===0&&(ce="normal");for(var _e="",Ee={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Pe=0;Pe<Rt.length;Pe++){if(this.pdf.internal.getFont(Rt[Pe],ce,{noFallback:!0,disableWarning:!0})!==void 0){_e=Rt[Pe];break}if(ce==="bolditalic"&&this.pdf.internal.getFont(Rt[Pe],"bold",{noFallback:!0,disableWarning:!0})!==void 0)_e=Rt[Pe],ce="bold";else if(this.pdf.internal.getFont(Rt[Pe],"normal",{noFallback:!0,disableWarning:!0})!==void 0){_e=Rt[Pe],ce="normal";break}}if(_e===""){for(var Ye=0;Ye<Rt.length;Ye++)if(Ee[Rt[Ye]]){_e=Ee[Rt[Ye]];break}}_e=_e===""?"Times":_e,this.pdf.setFont(_e,ce)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(pt){this.ctx.globalCompositeOperation=pt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(pt){this.ctx.globalAlpha=pt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(pt){this.ctx.lineDashOffset=pt,Et.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(pt){this.ctx.lineDash=pt,Et.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(pt){this.ctx.ignoreClearRect=!!pt}})};u.prototype.setLineDash=function(S){this.lineDash=S},u.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},u.prototype.fill=function(){P.call(this,"fill",!1)},u.prototype.stroke=function(){P.call(this,"stroke",!1)},u.prototype.beginPath=function(){this.path=[{type:"begin"}]},u.prototype.moveTo=function(S,U){if(isNaN(S)||isNaN(U))throw mi.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var H=this.ctx.transform.applyToPoint(new a(S,U));this.path.push({type:"mt",x:H.x,y:H.y}),this.ctx.lastPoint=new a(S,U)},u.prototype.closePath=function(){var S=new a(0,0),U=0;for(U=this.path.length-1;U!==-1;U--)if(this.path[U].type==="begin"&&oi(this.path[U+1])==="object"&&typeof this.path[U+1].x=="number"){S=new a(this.path[U+1].x,this.path[U+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(S.x,S.y)},u.prototype.lineTo=function(S,U){if(isNaN(S)||isNaN(U))throw mi.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var H=this.ctx.transform.applyToPoint(new a(S,U));this.path.push({type:"lt",x:H.x,y:H.y}),this.ctx.lastPoint=new a(H.x,H.y)},u.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),P.call(this,null,!0)},u.prototype.quadraticCurveTo=function(S,U,H,K){if(isNaN(H)||isNaN(K)||isNaN(S)||isNaN(U))throw mi.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var st=this.ctx.transform.applyToPoint(new a(H,K)),ht=this.ctx.transform.applyToPoint(new a(S,U));this.path.push({type:"qct",x1:ht.x,y1:ht.y,x:st.x,y:st.y}),this.ctx.lastPoint=new a(st.x,st.y)},u.prototype.bezierCurveTo=function(S,U,H,K,st,ht){if(isNaN(st)||isNaN(ht)||isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K))throw mi.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var gt=this.ctx.transform.applyToPoint(new a(st,ht)),mt=this.ctx.transform.applyToPoint(new a(S,U)),Lt=this.ctx.transform.applyToPoint(new a(H,K));this.path.push({type:"bct",x1:mt.x,y1:mt.y,x2:Lt.x,y2:Lt.y,x:gt.x,y:gt.y}),this.ctx.lastPoint=new a(gt.x,gt.y)},u.prototype.arc=function(S,U,H,K,st,ht){if(isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K)||isNaN(st))throw mi.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ht=!!ht,!this.ctx.transform.isIdentity){var gt=this.ctx.transform.applyToPoint(new a(S,U));S=gt.x,U=gt.y;var mt=this.ctx.transform.applyToPoint(new a(0,H)),Lt=this.ctx.transform.applyToPoint(new a(0,0));H=Math.sqrt(Math.pow(mt.x-Lt.x,2)+Math.pow(mt.y-Lt.y,2))}Math.abs(st-K)>=2*Math.PI&&(K=0,st=2*Math.PI),this.path.push({type:"arc",x:S,y:U,radius:H,startAngle:K,endAngle:st,counterclockwise:ht})},u.prototype.arcTo=function(S,U,H,K,st){throw new Error("arcTo not implemented.")},u.prototype.rect=function(S,U,H,K){if(isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K))throw mi.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(S,U),this.lineTo(S+H,U),this.lineTo(S+H,U+K),this.lineTo(S,U+K),this.lineTo(S,U),this.lineTo(S+H,U),this.lineTo(S,U)},u.prototype.fillRect=function(S,U,H,K){if(isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K))throw mi.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!g.call(this)){var st={};this.lineCap!=="butt"&&(st.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(st.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(S,U,H,K),this.fill(),st.hasOwnProperty("lineCap")&&(this.lineCap=st.lineCap),st.hasOwnProperty("lineJoin")&&(this.lineJoin=st.lineJoin)}},u.prototype.strokeRect=function(S,U,H,K){if(isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K))throw mi.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");p.call(this)||(this.beginPath(),this.rect(S,U,H,K),this.stroke())},u.prototype.clearRect=function(S,U,H,K){if(isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K))throw mi.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(S,U,H,K))},u.prototype.save=function(S){S=typeof S!="boolean"||S;for(var U=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("q");if(this.pdf.setPage(U),S){this.ctx.fontSize=this.pdf.internal.getFontSize();var K=new c(this.ctx);this.ctxStack.push(this.ctx),this.ctx=K}},u.prototype.restore=function(S){S=typeof S!="boolean"||S;for(var U=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("Q");this.pdf.setPage(U),S&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},u.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var d=function(S){var U,H,K,st;if(S.isCanvasGradient===!0&&(S=S.getColor()),!S)return{r:0,g:0,b:0,a:0,style:S};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(S))U=0,H=0,K=0,st=0;else{var ht=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(S);if(ht!==null)U=parseInt(ht[1]),H=parseInt(ht[2]),K=parseInt(ht[3]),st=1;else if((ht=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(S))!==null)U=parseInt(ht[1]),H=parseInt(ht[2]),K=parseInt(ht[3]),st=parseFloat(ht[4]);else{if(st=1,typeof S=="string"&&S.charAt(0)!=="#"){var gt=new Sw(S);S=gt.ok?gt.toHex():"#000000"}S.length===4?(U=S.substring(1,2),U+=U,H=S.substring(2,3),H+=H,K=S.substring(3,4),K+=K):(U=S.substring(1,3),H=S.substring(3,5),K=S.substring(5,7)),U=parseInt(U,16),H=parseInt(H,16),K=parseInt(K,16)}}return{r:U,g:H,b:K,a:st,style:S}},g=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},p=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};u.prototype.fillText=function(S,U,H,K){if(isNaN(U)||isNaN(H)||typeof S!="string")throw mi.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(K=isNaN(K)?void 0:K,!g.call(this)){var st=J(this.ctx.transform.rotation),ht=this.ctx.transform.scaleX;M.call(this,{text:S,x:U,y:H,scale:ht,angle:st,align:this.textAlign,maxWidth:K})}},u.prototype.strokeText=function(S,U,H,K){if(isNaN(U)||isNaN(H)||typeof S!="string")throw mi.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!p.call(this)){K=isNaN(K)?void 0:K;var st=J(this.ctx.transform.rotation),ht=this.ctx.transform.scaleX;M.call(this,{text:S,x:U,y:H,scale:ht,renderingMode:"stroke",angle:st,align:this.textAlign,maxWidth:K})}},u.prototype.measureText=function(S){if(typeof S!="string")throw mi.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var U=this.pdf,H=this.pdf.internal.scaleFactor,K=U.internal.getFontSize(),st=U.getStringUnitWidth(S)*K/U.internal.scaleFactor,ht=function(gt){var mt=(gt=gt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return mt}}),this};return new ht({width:st*=Math.round(96*H/72*1e4)/1e4})},u.prototype.scale=function(S,U){if(isNaN(S)||isNaN(U))throw mi.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var H=new l(S,0,0,U,0,0);this.ctx.transform=this.ctx.transform.multiply(H)},u.prototype.rotate=function(S){if(isNaN(S))throw mi.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var U=new l(Math.cos(S),Math.sin(S),-Math.sin(S),Math.cos(S),0,0);this.ctx.transform=this.ctx.transform.multiply(U)},u.prototype.translate=function(S,U){if(isNaN(S)||isNaN(U))throw mi.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var H=new l(1,0,0,1,S,U);this.ctx.transform=this.ctx.transform.multiply(H)},u.prototype.transform=function(S,U,H,K,st,ht){if(isNaN(S)||isNaN(U)||isNaN(H)||isNaN(K)||isNaN(st)||isNaN(ht))throw mi.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var gt=new l(S,U,H,K,st,ht);this.ctx.transform=this.ctx.transform.multiply(gt)},u.prototype.setTransform=function(S,U,H,K,st,ht){S=isNaN(S)?1:S,U=isNaN(U)?0:U,H=isNaN(H)?0:H,K=isNaN(K)?1:K,st=isNaN(st)?0:st,ht=isNaN(ht)?0:ht,this.ctx.transform=new l(S,U,H,K,st,ht)};var y=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};u.prototype.drawImage=function(S,U,H,K,st,ht,gt,mt,Lt){var Tt=this.pdf.getImageProperties(S),Bt=1,Gt=1,Jt=1,pt=1;K!==void 0&&mt!==void 0&&(Jt=mt/K,pt=Lt/st,Bt=Tt.width/K*mt/K,Gt=Tt.height/st*Lt/st),ht===void 0&&(ht=U,gt=H,U=0,H=0),K!==void 0&&mt===void 0&&(mt=K,Lt=st),K===void 0&&mt===void 0&&(mt=Tt.width,Lt=Tt.height);for(var Y,se=this.ctx.transform.decompose(),Wt=J(se.rotate.shx),Ct=new l,Pt=(Ct=(Ct=(Ct=Ct.multiply(se.translate)).multiply(se.skew)).multiply(se.scale)).applyToRectangle(new o(ht-U*Jt,gt-H*pt,K*Bt,st*Gt)),Nt=w.call(this,Pt),Rt=[],Ut=0;Ut<Nt.length;Ut+=1)Rt.indexOf(Nt[Ut])===-1&&Rt.push(Nt[Ut]);if(L(Rt),this.autoPaging)for(var ce=Rt[0],_e=Rt[Rt.length-1],Ee=ce;Ee<_e+1;Ee++){this.pdf.setPage(Ee);var Pe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ye=Ee===1?this.posY+this.margin[0]:this.margin[0],ae=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Te=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],kt=Ee===1?0:ae+(Ee-2)*Te;if(this.ctx.clip_path.length!==0){var ln=this.path;Y=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(Y,this.posX+this.margin[3],-kt+Ye+this.ctx.prevPageLastElemOffset),R.call(this,"fill",!0),this.path=ln}var Oe=JSON.parse(JSON.stringify(Pt));Oe=b([Oe],this.posX+this.margin[3],-kt+Ye+this.ctx.prevPageLastElemOffset)[0];var tr=(Ee>ce||Ee<_e)&&y.call(this);tr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Pe,Te,null).clip().discardPath()),this.pdf.addImage(S,"JPEG",Oe.x,Oe.y,Oe.w,Oe.h,null,null,Wt),tr&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(S,"JPEG",Pt.x,Pt.y,Pt.w,Pt.h,null,null,Wt)};var w=function(S,U,H){var K=[];U=U||this.pdf.internal.pageSize.width,H=H||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var st=this.posY+this.ctx.prevPageLastElemOffset;switch(S.type){default:case"mt":case"lt":K.push(Math.floor((S.y+st)/H)+1);break;case"arc":K.push(Math.floor((S.y+st-S.radius)/H)+1),K.push(Math.floor((S.y+st+S.radius)/H)+1);break;case"qct":var ht=lt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,S.x1,S.y1,S.x,S.y);K.push(Math.floor((ht.y+st)/H)+1),K.push(Math.floor((ht.y+ht.h+st)/H)+1);break;case"bct":var gt=ct(this.ctx.lastPoint.x,this.ctx.lastPoint.y,S.x1,S.y1,S.x2,S.y2,S.x,S.y);K.push(Math.floor((gt.y+st)/H)+1),K.push(Math.floor((gt.y+gt.h+st)/H)+1);break;case"rect":K.push(Math.floor((S.y+st)/H)+1),K.push(Math.floor((S.y+S.h+st)/H)+1)}for(var mt=0;mt<K.length;mt+=1)for(;this.pdf.internal.getNumberOfPages()<K[mt];)x.call(this);return K},x=function(){var S=this.fillStyle,U=this.strokeStyle,H=this.font,K=this.lineCap,st=this.lineWidth,ht=this.lineJoin;this.pdf.addPage(),this.fillStyle=S,this.strokeStyle=U,this.font=H,this.lineCap=K,this.lineWidth=st,this.lineJoin=ht},b=function(S,U,H){for(var K=0;K<S.length;K++)switch(S[K].type){case"bct":S[K].x2+=U,S[K].y2+=H;case"qct":S[K].x1+=U,S[K].y1+=H;case"mt":case"lt":case"arc":default:S[K].x+=U,S[K].y+=H}return S},L=function(S){return S.sort(function(U,H){return U-H})},P=function(S,U){for(var H,K,st=this.fillStyle,ht=this.strokeStyle,gt=this.lineCap,mt=this.lineWidth,Lt=Math.abs(mt*this.ctx.transform.scaleX),Tt=this.lineJoin,Bt=JSON.parse(JSON.stringify(this.path)),Gt=JSON.parse(JSON.stringify(this.path)),Jt=[],pt=0;pt<Gt.length;pt++)if(Gt[pt].x!==void 0)for(var Y=w.call(this,Gt[pt]),se=0;se<Y.length;se+=1)Jt.indexOf(Y[se])===-1&&Jt.push(Y[se]);for(var Wt=0;Wt<Jt.length;Wt++)for(;this.pdf.internal.getNumberOfPages()<Jt[Wt];)x.call(this);if(L(Jt),this.autoPaging)for(var Ct=Jt[0],Pt=Jt[Jt.length-1],Nt=Ct;Nt<Pt+1;Nt++){this.pdf.setPage(Nt),this.fillStyle=st,this.strokeStyle=ht,this.lineCap=gt,this.lineWidth=Lt,this.lineJoin=Tt;var Rt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ut=Nt===1?this.posY+this.margin[0]:this.margin[0],ce=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],_e=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ee=Nt===1?0:ce+(Nt-2)*_e;if(this.ctx.clip_path.length!==0){var Pe=this.path;H=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(H,this.posX+this.margin[3],-Ee+Ut+this.ctx.prevPageLastElemOffset),R.call(this,S,!0),this.path=Pe}if(K=JSON.parse(JSON.stringify(Bt)),this.path=b(K,this.posX+this.margin[3],-Ee+Ut+this.ctx.prevPageLastElemOffset),U===!1||Nt===0){var Ye=(Nt>Ct||Nt<Pt)&&y.call(this);Ye&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Rt,_e,null).clip().discardPath()),R.call(this,S,U),Ye&&this.pdf.restoreGraphicsState()}this.lineWidth=mt}else this.lineWidth=Lt,R.call(this,S,U),this.lineWidth=mt;this.path=Bt},R=function(S,U){if((S!=="stroke"||U||!p.call(this))&&(S==="stroke"||U||!g.call(this))){for(var H,K,st=[],ht=this.path,gt=0;gt<ht.length;gt++){var mt=ht[gt];switch(mt.type){case"begin":st.push({begin:!0});break;case"close":st.push({close:!0});break;case"mt":st.push({start:mt,deltas:[],abs:[]});break;case"lt":var Lt=st.length;if(ht[gt-1]&&!isNaN(ht[gt-1].x)&&(H=[mt.x-ht[gt-1].x,mt.y-ht[gt-1].y],Lt>0)){for(;Lt>=0;Lt--)if(st[Lt-1].close!==!0&&st[Lt-1].begin!==!0){st[Lt-1].deltas.push(H),st[Lt-1].abs.push(mt);break}}break;case"bct":H=[mt.x1-ht[gt-1].x,mt.y1-ht[gt-1].y,mt.x2-ht[gt-1].x,mt.y2-ht[gt-1].y,mt.x-ht[gt-1].x,mt.y-ht[gt-1].y],st[st.length-1].deltas.push(H);break;case"qct":var Tt=ht[gt-1].x+2/3*(mt.x1-ht[gt-1].x),Bt=ht[gt-1].y+2/3*(mt.y1-ht[gt-1].y),Gt=mt.x+2/3*(mt.x1-mt.x),Jt=mt.y+2/3*(mt.y1-mt.y),pt=mt.x,Y=mt.y;H=[Tt-ht[gt-1].x,Bt-ht[gt-1].y,Gt-ht[gt-1].x,Jt-ht[gt-1].y,pt-ht[gt-1].x,Y-ht[gt-1].y],st[st.length-1].deltas.push(H);break;case"arc":st.push({deltas:[],abs:[],arc:!0}),Array.isArray(st[st.length-1].abs)&&st[st.length-1].abs.push(mt)}}K=U?null:S==="stroke"?"stroke":"fill";for(var se=!1,Wt=0;Wt<st.length;Wt++)if(st[Wt].arc)for(var Ct=st[Wt].abs,Pt=0;Pt<Ct.length;Pt++){var Nt=Ct[Pt];Nt.type==="arc"?T.call(this,Nt.x,Nt.y,Nt.radius,Nt.startAngle,Nt.endAngle,Nt.counterclockwise,void 0,U,!se):O.call(this,Nt.x,Nt.y),se=!0}else if(st[Wt].close===!0)this.pdf.internal.out("h"),se=!1;else if(st[Wt].begin!==!0){var Rt=st[Wt].start.x,Ut=st[Wt].start.y;G.call(this,st[Wt].deltas,Rt,Ut),se=!0}K&&q.call(this,K),U&&W.call(this)}},j=function(S){var U=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,H=U*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return S-H;case"top":return S+U-H;case"hanging":return S+U-2*H;case"middle":return S+U/2-H;case"ideographic":return S;case"alphabetic":default:return S}},k=function(S){return S+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};u.prototype.createLinearGradient=function(){var S=function(){};return S.colorStops=[],S.addColorStop=function(U,H){this.colorStops.push([U,H])},S.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},S.isCanvasGradient=!0,S},u.prototype.createPattern=function(){return this.createLinearGradient()},u.prototype.createRadialGradient=function(){return this.createLinearGradient()};var T=function(S,U,H,K,st,ht,gt,mt,Lt){for(var Tt=Z.call(this,H,K,st,ht),Bt=0;Bt<Tt.length;Bt++){var Gt=Tt[Bt];Bt===0&&(Lt?F.call(this,Gt.x1+S,Gt.y1+U):O.call(this,Gt.x1+S,Gt.y1+U)),tt.call(this,S,U,Gt.x2,Gt.y2,Gt.x3,Gt.y3,Gt.x4,Gt.y4)}mt?W.call(this):q.call(this,gt)},q=function(S){switch(S){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},W=function(){this.pdf.clip(),this.pdf.discardPath()},F=function(S,U){this.pdf.internal.out(e(S)+" "+i(U)+" m")},M=function(S){var U;switch(S.align){case"right":case"end":U="right";break;case"center":U="center";break;case"left":case"start":default:U="left"}var H=this.pdf.getTextDimensions(S.text),K=j.call(this,S.y),st=k.call(this,K)-H.h,ht=this.ctx.transform.applyToPoint(new a(S.x,K)),gt=this.ctx.transform.decompose(),mt=new l;mt=(mt=(mt=mt.multiply(gt.translate)).multiply(gt.skew)).multiply(gt.scale);for(var Lt,Tt,Bt,Gt=this.ctx.transform.applyToRectangle(new o(S.x,K,H.w,H.h)),Jt=mt.applyToRectangle(new o(S.x,st,H.w,H.h)),pt=w.call(this,Jt),Y=[],se=0;se<pt.length;se+=1)Y.indexOf(pt[se])===-1&&Y.push(pt[se]);if(L(Y),this.autoPaging)for(var Wt=Y[0],Ct=Y[Y.length-1],Pt=Wt;Pt<Ct+1;Pt++){this.pdf.setPage(Pt);var Nt=Pt===1?this.posY+this.margin[0]:this.margin[0],Rt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ut=this.pdf.internal.pageSize.height-this.margin[2],ce=Ut-this.margin[0],_e=this.pdf.internal.pageSize.width-this.margin[1],Ee=_e-this.margin[3],Pe=Pt===1?0:Rt+(Pt-2)*ce;if(this.ctx.clip_path.length!==0){var Ye=this.path;Lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(Lt,this.posX+this.margin[3],-1*Pe+Nt),R.call(this,"fill",!0),this.path=Ye}var ae=b([JSON.parse(JSON.stringify(Jt))],this.posX+this.margin[3],-Pe+Nt+this.ctx.prevPageLastElemOffset)[0];S.scale>=.01&&(Tt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Tt*S.scale),Bt=this.lineWidth,this.lineWidth=Bt*S.scale);var Te=this.autoPaging!=="text";if(Te||ae.y+ae.h<=Ut){if(Te||ae.y>=Nt&&ae.x<=_e){var kt=Te?S.text:this.pdf.splitTextToSize(S.text,S.maxWidth||_e-ae.x)[0],ln=b([JSON.parse(JSON.stringify(Gt))],this.posX+this.margin[3],-Pe+Nt+this.ctx.prevPageLastElemOffset)[0],Oe=Te&&(Pt>Wt||Pt<Ct)&&y.call(this);Oe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ee,ce,null).clip().discardPath()),this.pdf.text(kt,ln.x,ln.y,{angle:S.angle,align:U,renderingMode:S.renderingMode}),Oe&&this.pdf.restoreGraphicsState()}}else ae.y<Ut&&(this.ctx.prevPageLastElemOffset+=Ut-ae.y);S.scale>=.01&&(this.pdf.setFontSize(Tt),this.lineWidth=Bt)}else S.scale>=.01&&(Tt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Tt*S.scale),Bt=this.lineWidth,this.lineWidth=Bt*S.scale),this.pdf.text(S.text,ht.x+this.posX,ht.y+this.posY,{angle:S.angle,align:U,renderingMode:S.renderingMode,maxWidth:S.maxWidth}),S.scale>=.01&&(this.pdf.setFontSize(Tt),this.lineWidth=Bt)},O=function(S,U,H,K){H=H||0,K=K||0,this.pdf.internal.out(e(S+H)+" "+i(U+K)+" l")},G=function(S,U,H){return this.pdf.lines(S,U,H,null,null)},tt=function(S,U,H,K,st,ht,gt,mt){this.pdf.internal.out([t(r(H+S)),t(s(K+U)),t(r(st+S)),t(s(ht+U)),t(r(gt+S)),t(s(mt+U)),"c"].join(" "))},Z=function(S,U,H,K){for(var st=2*Math.PI,ht=Math.PI/2;U>H;)U-=st;var gt=Math.abs(H-U);gt<st&&K&&(gt=st-gt);for(var mt=[],Lt=K?-1:1,Tt=U;gt>1e-5;){var Bt=Tt+Lt*Math.min(gt,ht);mt.push(it.call(this,S,Tt,Bt)),gt-=Math.abs(Bt-Tt),Tt=Bt}return mt},it=function(S,U,H){var K=(H-U)/2,st=S*Math.cos(K),ht=S*Math.sin(K),gt=st,mt=-ht,Lt=gt*gt+mt*mt,Tt=Lt+gt*st+mt*ht,Bt=4/3*(Math.sqrt(2*Lt*Tt)-Tt)/(gt*ht-mt*st),Gt=gt-Bt*mt,Jt=mt+Bt*gt,pt=Gt,Y=-Jt,se=K+U,Wt=Math.cos(se),Ct=Math.sin(se);return{x1:S*Math.cos(U),y1:S*Math.sin(U),x2:Gt*Wt-Jt*Ct,y2:Gt*Ct+Jt*Wt,x3:pt*Wt-Y*Ct,y3:pt*Ct+Y*Wt,x4:S*Math.cos(H),y4:S*Math.sin(H)}},J=function(S){return 180*S/Math.PI},lt=function(S,U,H,K,st,ht){var gt=S+.5*(H-S),mt=U+.5*(K-U),Lt=st+.5*(H-st),Tt=ht+.5*(K-ht),Bt=Math.min(S,st,gt,Lt),Gt=Math.max(S,st,gt,Lt),Jt=Math.min(U,ht,mt,Tt),pt=Math.max(U,ht,mt,Tt);return new o(Bt,Jt,Gt-Bt,pt-Jt)},ct=function(S,U,H,K,st,ht,gt,mt){var Lt,Tt,Bt,Gt,Jt,pt,Y,se,Wt,Ct,Pt,Nt,Rt,Ut,ce=H-S,_e=K-U,Ee=st-H,Pe=ht-K,Ye=gt-st,ae=mt-ht;for(Tt=0;Tt<41;Tt++)Wt=(Y=(Bt=S+(Lt=Tt/40)*ce)+Lt*((Jt=H+Lt*Ee)-Bt))+Lt*(Jt+Lt*(st+Lt*Ye-Jt)-Y),Ct=(se=(Gt=U+Lt*_e)+Lt*((pt=K+Lt*Pe)-Gt))+Lt*(pt+Lt*(ht+Lt*ae-pt)-se),Tt==0?(Pt=Wt,Nt=Ct,Rt=Wt,Ut=Ct):(Pt=Math.min(Pt,Wt),Nt=Math.min(Nt,Ct),Rt=Math.max(Rt,Wt),Ut=Math.max(Ut,Ct));return new o(Math.round(Pt),Math.round(Nt),Math.round(Rt-Pt),Math.round(Ut-Nt))},Et=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var S,U,H=(S=this.ctx.lineDash,U=this.ctx.lineDashOffset,JSON.stringify({lineDash:S,lineDashOffset:U}));this.prevLineDash!==H&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=H)}}})(oe.API),function(n){var t=function(s){var a,o,l,h,c,u,d,g,p,y;for(o=[],l=0,h=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;h>l;l+=4)(c=(s.charCodeAt(l)<<24)+(s.charCodeAt(l+1)<<16)+(s.charCodeAt(l+2)<<8)+s.charCodeAt(l+3))!==0?(u=(c=((c=((c=((c=(c-(y=c%85))/85)-(p=c%85))/85)-(g=c%85))/85)-(d=c%85))/85)%85,o.push(u+33,d+33,g+33,p+33,y+33)):o.push(122);return function(w,x){for(var b=x;b>0;b--)w.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},e=function(s){var a,o,l,h,c,u=String,d="length",g=255,p="charCodeAt",y="slice",w="replace";for(s[y](-2),s=s[y](0,-2)[w](/\s/g,"")[w]("z","!!!!!"),l=[],h=0,c=(s+=a="uuuuu"[y](s[d]%5||5))[d];c>h;h+=5)o=52200625*(s[p](h)-33)+614125*(s[p](h+1)-33)+7225*(s[p](h+2)-33)+85*(s[p](h+3)-33)+(s[p](h+4)-33),l.push(g&o>>24,g&o>>16,g&o>>8,g&o);return function(x,b){for(var L=b;L>0;L--)x.pop()}(l,a[d]),u.fromCharCode.apply(u,l)},i=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",l=0;l<s.length;l+=2)o+=String.fromCharCode("0x"+(s[l]+s[l+1]));return o},r=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=vp(a)).reduce(function(l,h){return l+String.fromCharCode(h)},"")};n.processDataByFilters=function(s,a){var o=0,l=s||"",h=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":l=e(l),h.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=t(l),h.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=i(l),h.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=l.split("").map(function(c){return("0"+c.charCodeAt().toString(16)).slice(-2)}).join("")+">",h.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=r(l),h.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:l,reverseChain:h.reverse().join(" ")}}}(oe.API),function(n){n.loadFile=function(t,e,i){return function(r,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(l,h,c){var u=new XMLHttpRequest,d=0,g=function(p){var y=p.length,w=[],x=String.fromCharCode;for(d=0;d<y;d+=1)w.push(x(255&p.charCodeAt(d)));return w.join("")};if(u.open("GET",l,!h),u.overrideMimeType("text/plain; charset=x-user-defined"),h===!1&&(u.onload=function(){u.status===200?c(g(this.responseText)):c(void 0)}),u.send(null),h&&u.status===200)return g(u.responseText)}(r,s,a)}catch{}return o}(t,e,i)},n.loadImageFile=n.loadFile}(oe.API),function(n){function t(){return(le.html2canvas?Promise.resolve(le.html2canvas):gp(()=>import("./html2canvas.esm-Ry1SfrtC.js"),__vite__mapDeps([]))).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function e(){return(le.DOMPurify?Promise.resolve(le.DOMPurify):gp(()=>import("./purify.es-zHtM-7sw.js"),__vite__mapDeps([]))).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var i=function(a){var o=oi(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},r=function(a,o){var l=document.createElement(a);for(var h in o.className&&(l.className=o.className),o.innerHTML&&o.dompurify&&(l.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)l.style[h]=o.style[h];return l},s=function a(o){var l=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),h=a.convert(Promise.resolve(),l);return h=(h=h.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(l){switch(i(l)){case"string":return"string";case"element":return l.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(e).then(function(l){return this.set({src:r("div",{innerHTML:a,dompurify:l})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function l(h,c){for(var u=h.nodeType===3?document.createTextNode(h.nodeValue):h.cloneNode(!1),d=h.firstChild;d;d=d.nextSibling)c!==!0&&d.nodeType===1&&d.nodeName==="SCRIPT"||u.appendChild(l(d,c));return h.nodeType===1&&(h.nodeName==="CANVAS"?(u.width=h.width,u.height=h.height,u.getContext("2d").drawImage(h,0,0)):h.nodeName!=="TEXTAREA"&&h.nodeName!=="SELECT"||(u.value=h.value),u.addEventListener("load",function(){u.scrollTop=h.scrollTop,u.scrollLeft=h.scrollLeft},!0)),u}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=r("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=r("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(r("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var l=Object.assign({},this.opt.html2canvas);return delete l.onrendered,o(this.prop.container,l)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var l=this.opt.jsPDF,h=this.opt.fontFaces,c=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,u=Object.assign({async:!0,allowTaint:!0,scale:c,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete u.onrendered,l.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,l.context2d.posX=this.opt.x,l.context2d.posY=this.opt.y,l.context2d.margin=this.opt.margin,l.context2d.fontFaces=h,h)for(var d=0;d<h.length;++d){var g=h[d],p=g.src.find(function(y){return y.format==="truetype"});p&&l.addFont(p.url,g.ref.name,g.ref.style)}return u.windowHeight=u.windowHeight||0,u.windowHeight=u.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):u.windowHeight,l.context2d.save(!0),o(this.prop.container,u)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,l){return(l=l||"pdf").toLowerCase()==="img"||l.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(i(a)!=="object")return this;var o=Object.keys(a||{}).map(function(l){if(l in s.template.prop)return function(){this.prop[l]=a[l]};switch(l){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[l]=a[l]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var l=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(l):l})},s.prototype.setMargin=function(a){return this.then(function(){switch(i(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(l,h){return Math.floor(l*h/72*96)}return this.then(function(){(a=a||oe.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,l,h){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),l!=null&&(this.progress.n=l),h!=null&&(this.progress.stack=h),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,l,h){return this.setProgress(a?this.progress.val+a:null,o||null,l?this.progress.n+l:null,h?this.progress.stack.concat(h):null)},s.prototype.then=function(a,o){var l=this;return this.thenCore(a,o,function(h,c){return l.updateProgress(null,null,1,[h]),Promise.prototype.then.call(this,function(u){return l.updateProgress(null,h),u}).then(h,c).then(function(u){return l.updateProgress(1),u})})},s.prototype.thenCore=function(a,o,l){l=l||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var h=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),c=l.call(h,a,o);return s.convert(c,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(l){o=o.thenCore(l)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,oe.getPageSize=function(a,o,l){if(oi(a)==="object"){var h=a;a=h.orientation,o=h.unit||o,l=h.format||l}o=o||"mm",l=l||"a4",a=(""+(a||"P")).toLowerCase();var c,u=(""+l).toLowerCase(),d={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":c=1;break;case"mm":c=72/25.4;break;case"cm":c=72/2.54;break;case"in":c=72;break;case"px":c=.75;break;case"pc":case"em":c=12;break;case"ex":c=6;break;default:throw"Invalid unit: "+o}var g,p=0,y=0;if(d.hasOwnProperty(u))p=d[u][1]/c,y=d[u][0]/c;else try{p=l[1],y=l[0]}catch{throw new Error("Invalid format: "+l)}if(a==="p"||a==="portrait")a="p",y>p&&(g=y,y=p,p=g);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",p>y&&(g=y,y=p,p=g)}return{width:y,height:p,unit:o,k:c,orientation:a}},n.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(Lp):null;var l=new s(o);return o.worker?l:l.from(a).doCallback()}}(oe.API),oe.API.addJS=function(n){return _2=n,this.internal.events.subscribe("postPutResources",function(){Jf=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Jf+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),p2=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+_2+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Jf!==void 0&&p2!==void 0&&this.internal.out("/Names <</JavaScript "+Jf+" 0 R>>")}),this},function(n){var t;n.events.push(["postPutResources",function(){var e=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),s=0;s<r.length;s++){var a=r[s],o=i.exec(a);if(o!=null){var l=o[1];e.internal.newObjectDeferredBegin(l,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var h=this.internal.pages.length,c=[];for(s=0;s<h;s++){var u=e.internal.newObject();c.push(u);var d=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+d.objId+" 0 R /XYZ null null null]>> endobj")}var g=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<c.length;s++)e.internal.write("(page_"+(s+1)+")"+c[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+g+" 0 R"),e.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),n.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(i,r,s){var a={title:r,options:s,children:[]};return i==null&&(i=this.root),i.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(i){i.id=e.internal.newObjectDeferred();for(var r=0;r<i.children.length;r++)this.genIds_r(i.children[r])},e.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},e.outline.renderItems=function(i){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<i.children.length;s++){var a=i.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(i)),s>0&&this.line("/Prev "+this.makeRef(i.children[s-1])),s<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var l=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+l.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var h=0;h<i.children.length;h++)this.renderItems(i.children[h])},e.outline.line=function(i){this.ctx.val+=i+`\r
`},e.outline.makeRef=function(i){return i.id+" 0 R"},e.outline.makeString=function(i){return"("+e.internal.pdfEscape(i)+")"},e.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(i,r){for(var s=0;s<r.children.length;s++)i.count++,this.count_r(i,r.children[s]);return i.count}}])}(oe.API),function(n){var t=[192,193,194,195,196,197,198,199];n.processJPEG=function(e,i,r,s,a,o){var l,h=this.decode.DCT_DECODE,c=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(l=function(u){for(var d,g=256*u.charCodeAt(4)+u.charCodeAt(5),p=u.length,y={width:0,height:0,numcomponents:1},w=4;w<p;w+=2){if(w+=g,t.indexOf(u.charCodeAt(w+1))!==-1){d=256*u.charCodeAt(w+5)+u.charCodeAt(w+6),y={width:256*u.charCodeAt(w+7)+u.charCodeAt(w+8),height:d,numcomponents:u.charCodeAt(w+9)};break}g=256*u.charCodeAt(w+2)+u.charCodeAt(w+3)}return y}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}c={data:e,width:l.width,height:l.height,colorSpace:o,bitsPerComponent:8,filter:h,index:i,alias:r}}return c}}(oe.API);var Hl,Qf,y2,v2,w2,uM=function(){var n,t,e;function i(s){var a,o,l,h,c,u,d,g,p,y,w,x,b,L;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},u=null;;){switch(a=this.readUInt32(),p=(function(){var P,R;for(R=[],P=0;P<4;++P)R.push(String.fromCharCode(this.data[this.pos++]));return R}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":u&&this.animation.frames.push(u),this.pos+=4,u={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},c=this.readUInt16(),h=this.readUInt16()||100,u.delay=1e3*c/h,u.disposeOp=this.data[this.pos++],u.blendOp=this.data[this.pos++],u.data=[];break;case"IDAT":case"fdAT":for(p==="fdAT"&&(this.pos+=4,a-=4),s=(u!=null?u.data:void 0)||this.imgData,x=0;0<=a?x<a:x>a;0<=a?++x:--x)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(l=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>l)throw new Error("More transparent colors than palette size");if((y=l-this.transparency.indexed.length)>0)for(b=0;0<=y?b<y:b>y;0<=y?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":d=(w=this.read(a)).indexOf(0),g=String.fromCharCode.apply(String,w.slice(0,d)),this.text[g]=String.fromCharCode.apply(String,w.slice(d+1));break;case"IEND":return u&&this.animation.frames.push(u),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(L=this.colorType)===4||L===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}i.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),l=0,h=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function c(u,d,g,p){var y,w,x,b,L,P,R,j,k,T,q,W,F,M,O,G,tt,Z,it,J,lt,ct=Math.ceil((h.width-u)/g),Et=Math.ceil((h.height-d)/p),S=h.width==ct&&h.height==Et;for(M=a*ct,W=S?o:new Uint8Array(M*Et),P=s.length,F=0,w=0;F<Et&&l<P;){switch(s[l++]){case 0:for(b=tt=0;tt<M;b=tt+=1)W[w++]=s[l++];break;case 1:for(b=Z=0;Z<M;b=Z+=1)y=s[l++],L=b<a?0:W[w-a],W[w++]=(y+L)%256;break;case 2:for(b=it=0;it<M;b=it+=1)y=s[l++],x=(b-b%a)/a,O=F&&W[(F-1)*M+x*a+b%a],W[w++]=(O+y)%256;break;case 3:for(b=J=0;J<M;b=J+=1)y=s[l++],x=(b-b%a)/a,L=b<a?0:W[w-a],O=F&&W[(F-1)*M+x*a+b%a],W[w++]=(y+Math.floor((L+O)/2))%256;break;case 4:for(b=lt=0;lt<M;b=lt+=1)y=s[l++],x=(b-b%a)/a,L=b<a?0:W[w-a],F===0?O=G=0:(O=W[(F-1)*M+x*a+b%a],G=x&&W[(F-1)*M+(x-1)*a+b%a]),R=L+O-G,j=Math.abs(R-L),T=Math.abs(R-O),q=Math.abs(R-G),k=j<=T&&j<=q?L:T<=q?O:G,W[w++]=(y+k)%256;break;default:throw new Error("Invalid filter algorithm: "+s[l-1])}if(!S){var U=((d+F*p)*h.width+u)*a,H=F*M;for(b=0;b<ct;b+=1){for(var K=0;K<a;K+=1)o[U++]=W[H++];U+=(g-1)*a}}F++}}return s=WT(s),h.interlaceMethod==1?(c(0,0,8,8),c(4,0,8,8),c(0,4,4,8),c(2,0,4,4),c(0,2,2,4),c(1,0,2,2),c(0,1,1,2)):c(0,0,1,1),o},i.prototype.decodePalette=function(){var s,a,o,l,h,c,u,d,g;for(o=this.palette,c=this.transparency.indexed||[],h=new Uint8Array((c.length||0)+o.length),l=0,s=0,a=u=0,d=o.length;u<d;a=u+=3)h[l++]=o[a],h[l++]=o[a+1],h[l++]=o[a+2],h[l++]=(g=c[s++])!=null?g:255;return h},i.prototype.copyToImageData=function(s,a){var o,l,h,c,u,d,g,p,y,w,x;if(l=this.colors,y=null,o=this.hasAlphaChannel,this.palette.length&&(y=(x=this._decodedPalette)!=null?x:this._decodedPalette=this.decodePalette(),l=4,o=!0),p=(h=s.data||s).length,u=y||a,c=d=0,l===1)for(;c<p;)g=y?4*a[c/4]:d,w=u[g++],h[c++]=w,h[c++]=w,h[c++]=w,h[c++]=o?u[g++]:255,d=g;else for(;c<p;)g=y?4*a[c/4]:d,h[c++]=u[g++],h[c++]=u[g++],h[c++]=u[g++],h[c++]=o?u[g++]:255,d=g},i.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var r=function(){if(Object.prototype.toString.call(le)==="[object Window]"){try{t=le.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return r(),n=function(s){var a;if(r()===!0)return e.width=s.width,e.height=s.height,e.clearRect(0,0,s.width,s.height),e.putImageData(s,0,0),(a=new Image).src=t.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},i.prototype.decodeFrames=function(s){var a,o,l,h,c,u,d,g;if(this.animation){for(g=[],o=c=0,u=(d=this.animation.frames).length;c<u;o=++c)a=d[o],l=s.createImageData(a.width,a.height),h=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(l,h),a.imageData=l,g.push(a.image=n(l));return g}},i.prototype.renderFrame=function(s,a){var o,l,h;return o=(l=this.animation.frames)[a],h=l[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(h!=null?h.disposeOp:void 0)===1?s.clearRect(h.xOffset,h.yOffset,h.width,h.height):(h!=null?h.disposeOp:void 0)===2&&s.putImageData(h.imageData,h.xOffset,h.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},i.prototype.animate=function(s){var a,o,l,h,c,u,d=this;return o=0,u=this.animation,h=u.numFrames,l=u.frames,c=u.numPlays,(a=function(){var g,p;if(g=o++%h,p=l[g],d.renderFrame(s,g),h>1&&o/h<c)return d.animation._timeout=setTimeout(a,p.delay)})()},i.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},i.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},i}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function fM(n){var t=0;if(n[t++]!==71||n[t++]!==73||n[t++]!==70||n[t++]!==56||(n[t++]+1&253)!=56||n[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=n[t++]|n[t++]<<8,i=n[t++]|n[t++]<<8,r=n[t++],s=r>>7,a=1<<(7&r)+1;n[t++],n[t++];var o=null,l=null;s&&(o=t,l=a,t+=3*a);var h=!0,c=[],u=0,d=null,g=0,p=null;for(this.width=e,this.height=i;h&&t<n.length;)switch(n[t++]){case 33:switch(n[t++]){case 255:if(n[t]!==11||n[t+1]==78&&n[t+2]==69&&n[t+3]==84&&n[t+4]==83&&n[t+5]==67&&n[t+6]==65&&n[t+7]==80&&n[t+8]==69&&n[t+9]==50&&n[t+10]==46&&n[t+11]==48&&n[t+12]==3&&n[t+13]==1&&n[t+16]==0)t+=14,p=n[t++]|n[t++]<<8,t++;else for(t+=12;;){if(!((F=n[t++])>=0))throw Error("Invalid block size");if(F===0)break;t+=F}break;case 249:if(n[t++]!==4||n[t+4]!==0)throw new Error("Invalid graphics extension block.");var y=n[t++];u=n[t++]|n[t++]<<8,d=n[t++],!(1&y)&&(d=null),g=y>>2&7,t++;break;case 254:for(;;){if(!((F=n[t++])>=0))throw Error("Invalid block size");if(F===0)break;t+=F}break;default:throw new Error("Unknown graphic control label: 0x"+n[t-1].toString(16))}break;case 44:var w=n[t++]|n[t++]<<8,x=n[t++]|n[t++]<<8,b=n[t++]|n[t++]<<8,L=n[t++]|n[t++]<<8,P=n[t++],R=P>>6&1,j=1<<(7&P)+1,k=o,T=l,q=!1;P>>7&&(q=!0,k=t,T=j,t+=3*j);var W=t;for(t++;;){var F;if(!((F=n[t++])>=0))throw Error("Invalid block size");if(F===0)break;t+=F}c.push({x:w,y:x,width:b,height:L,has_local_palette:q,palette_offset:k,palette_size:T,data_offset:W,data_length:t-W,transparent_index:d,interlaced:!!R,delay:u,disposal:g});break;case 59:h=!1;break;default:throw new Error("Unknown gif block: 0x"+n[t-1].toString(16))}this.numFrames=function(){return c.length},this.loopCount=function(){return p},this.frameInfo=function(M){if(M<0||M>=c.length)throw new Error("Frame index out of range.");return c[M]},this.decodeAndBlitFrameBGRA=function(M,O){var G=this.frameInfo(M),tt=G.width*G.height,Z=new Uint8Array(tt);x2(n,G.data_offset,Z,tt);var it=G.palette_offset,J=G.transparent_index;J===null&&(J=256);var lt=G.width,ct=e-lt,Et=lt,S=4*(G.y*e+G.x),U=4*((G.y+G.height)*e+G.x),H=S,K=4*ct;G.interlaced===!0&&(K+=4*e*7);for(var st=8,ht=0,gt=Z.length;ht<gt;++ht){var mt=Z[ht];if(Et===0&&(Et=lt,(H+=K)>=U&&(K=4*ct+4*e*(st-1),H=S+(lt+ct)*(st<<1),st>>=1)),mt===J)H+=4;else{var Lt=n[it+3*mt],Tt=n[it+3*mt+1],Bt=n[it+3*mt+2];O[H++]=Bt,O[H++]=Tt,O[H++]=Lt,O[H++]=255}--Et}},this.decodeAndBlitFrameRGBA=function(M,O){var G=this.frameInfo(M),tt=G.width*G.height,Z=new Uint8Array(tt);x2(n,G.data_offset,Z,tt);var it=G.palette_offset,J=G.transparent_index;J===null&&(J=256);var lt=G.width,ct=e-lt,Et=lt,S=4*(G.y*e+G.x),U=4*((G.y+G.height)*e+G.x),H=S,K=4*ct;G.interlaced===!0&&(K+=4*e*7);for(var st=8,ht=0,gt=Z.length;ht<gt;++ht){var mt=Z[ht];if(Et===0&&(Et=lt,(H+=K)>=U&&(K=4*ct+4*e*(st-1),H=S+(lt+ct)*(st<<1),st>>=1)),mt===J)H+=4;else{var Lt=n[it+3*mt],Tt=n[it+3*mt+1],Bt=n[it+3*mt+2];O[H++]=Lt,O[H++]=Tt,O[H++]=Bt,O[H++]=255}--Et}}}function x2(n,t,e,i){for(var r=n[t++],s=1<<r,a=s+1,o=a+1,l=r+1,h=(1<<l)-1,c=0,u=0,d=0,g=n[t++],p=new Int32Array(4096),y=null;;){for(;c<16&&g!==0;)u|=n[t++]<<c,c+=8,g===1?g=n[t++]:--g;if(c<l)break;var w=u&h;if(u>>=l,c-=l,w!==s){if(w===a)break;for(var x=w<o?w:y,b=0,L=x;L>s;)L=p[L]>>8,++b;var P=L;if(d+b+(x!==w?1:0)>i)return void mi.log("Warning, gif stream longer than expected.");e[d++]=P;var R=d+=b;for(x!==w&&(e[d++]=P),L=x;b--;)L=p[L],e[--R]=255&L,L>>=8;y!==null&&o<4096&&(p[o++]=y<<8|P,o>=h+1&&l<12&&(++l,h=h<<1|1)),y=w}else o=a+1,h=(1<<(l=r+1))-1,y=null}return d!==i&&mi.log("Warning, gif stream shorter than expected."),e}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function ym(n){var t,e,i,r,s,a=Math.floor,o=new Array(64),l=new Array(64),h=new Array(64),c=new Array(64),u=new Array(65535),d=new Array(65535),g=new Array(64),p=new Array(64),y=[],w=0,x=7,b=new Array(64),L=new Array(64),P=new Array(64),R=new Array(256),j=new Array(2048),k=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],T=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],q=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],F=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],M=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],G=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],tt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Z(S,U){for(var H=0,K=0,st=new Array,ht=1;ht<=16;ht++){for(var gt=1;gt<=S[ht];gt++)st[U[K]]=[],st[U[K]][0]=H,st[U[K]][1]=ht,K++,H++;H*=2}return st}function it(S){for(var U=S[0],H=S[1]-1;H>=0;)U&1<<H&&(w|=1<<x),H--,--x<0&&(w==255?(J(255),J(0)):J(w),x=7,w=0)}function J(S){y.push(S)}function lt(S){J(S>>8&255),J(255&S)}function ct(S,U,H,K,st){for(var ht,gt=st[0],mt=st[240],Lt=function(Ct,Pt){var Nt,Rt,Ut,ce,_e,Ee,Pe,Ye,ae,Te,kt=0;for(ae=0;ae<8;++ae){Nt=Ct[kt],Rt=Ct[kt+1],Ut=Ct[kt+2],ce=Ct[kt+3],_e=Ct[kt+4],Ee=Ct[kt+5],Pe=Ct[kt+6];var ln=Nt+(Ye=Ct[kt+7]),Oe=Nt-Ye,tr=Rt+Pe,Ke=Rt-Pe,hi=Ut+Ee,pr=Ut-Ee,qe=ce+_e,Xr=ce-_e,ci=ln+qe,wn=ln-qe,Gn=tr+hi,xi=tr-hi;Ct[kt]=ci+Gn,Ct[kt+4]=ci-Gn;var de=.707106781*(xi+wn);Ct[kt+2]=wn+de,Ct[kt+6]=wn-de;var Se=.382683433*((ci=Xr+pr)-(xi=Ke+Oe)),jn=.5411961*ci+Se,Ze=1.306562965*xi+Se,Di=.707106781*(Gn=pr+Ke),Ci=Oe+Di,Kt=Oe-Di;Ct[kt+5]=Kt+jn,Ct[kt+3]=Kt-jn,Ct[kt+1]=Ci+Ze,Ct[kt+7]=Ci-Ze,kt+=8}for(kt=0,ae=0;ae<8;++ae){Nt=Ct[kt],Rt=Ct[kt+8],Ut=Ct[kt+16],ce=Ct[kt+24],_e=Ct[kt+32],Ee=Ct[kt+40],Pe=Ct[kt+48];var Bi=Nt+(Ye=Ct[kt+56]),je=Nt-Ye,Je=Rt+Pe,ii=Rt-Pe,Ri=Ut+Ee,_r=Ut-Ee,fl=ce+_e,Zs=ce-_e,Yr=Bi+fl,Kr=Bi-fl,Zr=Je+Ri,ws=Je-Ri;Ct[kt]=Yr+Zr,Ct[kt+32]=Yr-Zr;var Tr=.707106781*(ws+Kr);Ct[kt+16]=Kr+Tr,Ct[kt+48]=Kr-Tr;var xs=.382683433*((Yr=Zs+_r)-(ws=ii+je)),Eo=.5411961*Yr+xs,dl=1.306562965*ws+xs,gl=.707106781*(Zr=_r+ii),ml=je+gl,pl=je-gl;Ct[kt+40]=pl+Eo,Ct[kt+24]=pl-Eo,Ct[kt+8]=ml+dl,Ct[kt+56]=ml-dl,kt++}for(ae=0;ae<64;++ae)Te=Ct[ae]*Pt[ae],g[ae]=Te>0?Te+.5|0:Te-.5|0;return g}(S,U),Tt=0;Tt<64;++Tt)p[k[Tt]]=Lt[Tt];var Bt=p[0]-H;H=p[0],Bt==0?it(K[0]):(it(K[d[ht=32767+Bt]]),it(u[ht]));for(var Gt=63;Gt>0&&p[Gt]==0;)Gt--;if(Gt==0)return it(gt),H;for(var Jt,pt=1;pt<=Gt;){for(var Y=pt;p[pt]==0&&pt<=Gt;)++pt;var se=pt-Y;if(se>=16){Jt=se>>4;for(var Wt=1;Wt<=Jt;++Wt)it(mt);se&=15}ht=32767+p[pt],it(st[(se<<4)+d[ht]]),it(u[ht]),pt++}return Gt!=63&&it(gt),H}function Et(S){S=Math.min(Math.max(S,1),100),s!=S&&(function(U){for(var H=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],K=0;K<64;K++){var st=a((H[K]*U+50)/100);st=Math.min(Math.max(st,1),255),o[k[K]]=st}for(var ht=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],gt=0;gt<64;gt++){var mt=a((ht[gt]*U+50)/100);mt=Math.min(Math.max(mt,1),255),l[k[gt]]=mt}for(var Lt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Tt=0,Bt=0;Bt<8;Bt++)for(var Gt=0;Gt<8;Gt++)h[Tt]=1/(o[k[Tt]]*Lt[Bt]*Lt[Gt]*8),c[Tt]=1/(l[k[Tt]]*Lt[Bt]*Lt[Gt]*8),Tt++}(S<50?Math.floor(5e3/S):Math.floor(200-2*S)),s=S)}this.encode=function(S,U){U&&Et(U),y=new Array,w=0,x=7,lt(65496),lt(65504),lt(16),J(74),J(70),J(73),J(70),J(0),J(1),J(1),J(0),lt(1),lt(1),J(0),J(0),function(){lt(65499),lt(132),J(0);for(var Rt=0;Rt<64;Rt++)J(o[Rt]);J(1);for(var Ut=0;Ut<64;Ut++)J(l[Ut])}(),function(Rt,Ut){lt(65472),lt(17),J(8),lt(Ut),lt(Rt),J(3),J(1),J(17),J(0),J(2),J(17),J(1),J(3),J(17),J(1)}(S.width,S.height),function(){lt(65476),lt(418),J(0);for(var Rt=0;Rt<16;Rt++)J(T[Rt+1]);for(var Ut=0;Ut<=11;Ut++)J(q[Ut]);J(16);for(var ce=0;ce<16;ce++)J(W[ce+1]);for(var _e=0;_e<=161;_e++)J(F[_e]);J(1);for(var Ee=0;Ee<16;Ee++)J(M[Ee+1]);for(var Pe=0;Pe<=11;Pe++)J(O[Pe]);J(17);for(var Ye=0;Ye<16;Ye++)J(G[Ye+1]);for(var ae=0;ae<=161;ae++)J(tt[ae])}(),lt(65498),lt(12),J(3),J(1),J(0),J(2),J(17),J(3),J(17),J(0),J(63),J(0);var H=0,K=0,st=0;w=0,x=7,this.encode.displayName="_encode_";for(var ht,gt,mt,Lt,Tt,Bt,Gt,Jt,pt,Y=S.data,se=S.width,Wt=S.height,Ct=4*se,Pt=0;Pt<Wt;){for(ht=0;ht<Ct;){for(Tt=Ct*Pt+ht,Gt=-1,Jt=0,pt=0;pt<64;pt++)Bt=Tt+(Jt=pt>>3)*Ct+(Gt=4*(7&pt)),Pt+Jt>=Wt&&(Bt-=Ct*(Pt+1+Jt-Wt)),ht+Gt>=Ct&&(Bt-=ht+Gt-Ct+4),gt=Y[Bt++],mt=Y[Bt++],Lt=Y[Bt++],b[pt]=(j[gt]+j[mt+256>>0]+j[Lt+512>>0]>>16)-128,L[pt]=(j[gt+768>>0]+j[mt+1024>>0]+j[Lt+1280>>0]>>16)-128,P[pt]=(j[gt+1280>>0]+j[mt+1536>>0]+j[Lt+1792>>0]>>16)-128;H=ct(b,h,H,t,i),K=ct(L,c,K,e,r),st=ct(P,c,st,e,r),ht+=32}Pt+=8}if(x>=0){var Nt=[];Nt[1]=x+1,Nt[0]=(1<<x+1)-1,it(Nt)}return lt(65497),new Uint8Array(y)},n=n||50,function(){for(var S=String.fromCharCode,U=0;U<256;U++)R[U]=S(U)}(),t=Z(T,q),e=Z(M,O),i=Z(W,F),r=Z(G,tt),function(){for(var S=1,U=2,H=1;H<=15;H++){for(var K=S;K<U;K++)d[32767+K]=H,u[32767+K]=[],u[32767+K][1]=H,u[32767+K][0]=K;for(var st=-(U-1);st<=-S;st++)d[32767+st]=H,u[32767+st]=[],u[32767+st][1]=H,u[32767+st][0]=U-1+st;S<<=1,U<<=1}}(),function(){for(var S=0;S<256;S++)j[S]=19595*S,j[S+256>>0]=38470*S,j[S+512>>0]=7471*S+32768,j[S+768>>0]=-11059*S,j[S+1024>>0]=-21709*S,j[S+1280>>0]=32768*S+8421375,j[S+1536>>0]=-27439*S,j[S+1792>>0]=-5329*S}(),Et(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function hs(n,t){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function b2(n){function t(T){if(!T)throw Error("assert :P")}function e(T,q,W){for(var F=0;4>F;F++)if(T[q+F]!=W.charCodeAt(F))return!0;return!1}function i(T,q,W,F,M){for(var O=0;O<M;O++)T[q+O]=W[F+O]}function r(T,q,W,F){for(var M=0;M<F;M++)T[q+M]=W}function s(T){return new Int32Array(T)}function a(T,q){for(var W=[],F=0;F<T;F++)W.push(new q);return W}function o(T,q){var W=[];return function F(M,O,G){for(var tt=G[O],Z=0;Z<tt&&(M.push(G.length>O+1?[]:new q),!(G.length<O+1));Z++)F(M[Z],O+1,G)}(W,0,T),W}var l=function(){var T=this;function q(f,m){for(var v=1<<m-1>>>0;f&v;)v>>>=1;return v?(f&v-1)+v:f}function W(f,m,v,E,C){t(!(E%v));do f[m+(E-=v)]=C;while(0<E)}function F(f,m,v,E,C){if(t(2328>=C),512>=C)var I=s(512);else if((I=s(C))==null)return 0;return function(N,D,B,z,et,ft){var dt,at,bt=D,_t=1<<B,nt=s(16),rt=s(16);for(t(et!=0),t(z!=null),t(N!=null),t(0<B),at=0;at<et;++at){if(15<z[at])return 0;++nt[z[at]]}if(nt[0]==et)return 0;for(rt[1]=0,dt=1;15>dt;++dt){if(nt[dt]>1<<dt)return 0;rt[dt+1]=rt[dt]+nt[dt]}for(at=0;at<et;++at)dt=z[at],0<z[at]&&(ft[rt[dt]++]=at);if(rt[15]==1)return(z=new M).g=0,z.value=ft[0],W(N,bt,1,_t,z),_t;var wt,St=-1,xt=_t-1,qt=0,Ft=1,ne=1,Ot=1<<B;for(at=0,dt=1,et=2;dt<=B;++dt,et<<=1){if(Ft+=ne<<=1,0>(ne-=nt[dt]))return 0;for(;0<nt[dt];--nt[dt])(z=new M).g=dt,z.value=ft[at++],W(N,bt+qt,et,Ot,z),qt=q(qt,dt)}for(dt=B+1,et=2;15>=dt;++dt,et<<=1){if(Ft+=ne<<=1,0>(ne-=nt[dt]))return 0;for(;0<nt[dt];--nt[dt]){if(z=new M,(qt&xt)!=St){for(bt+=Ot,wt=1<<(St=dt)-B;15>St&&!(0>=(wt-=nt[St]));)++St,wt<<=1;_t+=Ot=1<<(wt=St-B),N[D+(St=qt&xt)].g=wt+B,N[D+St].value=bt-D-St}z.g=dt-B,z.value=ft[at++],W(N,bt+(qt>>B),et,Ot,z),qt=q(qt,dt)}}return Ft!=2*rt[15]-1?0:_t}(f,m,v,E,C,I)}function M(){this.value=this.g=0}function O(){this.value=this.g=0}function G(){this.G=a(5,M),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(ir,O)}function tt(f,m,v,E){t(f!=null),t(m!=null),t(2147483648>E),f.Ca=254,f.I=0,f.b=-8,f.Ka=0,f.oa=m,f.pa=v,f.Jd=m,f.Yc=v+E,f.Zc=4<=E?v+E-4+1:v,ht(f)}function Z(f,m){for(var v=0;0<m--;)v|=mt(f,128)<<m;return v}function it(f,m){var v=Z(f,m);return gt(f)?-v:v}function J(f,m,v,E){var C,I=0;for(t(f!=null),t(m!=null),t(4294967288>E),f.Sb=E,f.Ra=0,f.u=0,f.h=0,4<E&&(E=4),C=0;C<E;++C)I+=m[v+C]<<8*C;f.Ra=I,f.bb=E,f.oa=m,f.pa=v}function lt(f){for(;8<=f.u&&f.bb<f.Sb;)f.Ra>>>=8,f.Ra+=f.oa[f.pa+f.bb]<<Rl-8>>>0,++f.bb,f.u-=8;H(f)&&(f.h=1,f.u=0)}function ct(f,m){if(t(0<=m),!f.h&&m<=Pl){var v=U(f)&Ml[m];return f.u+=m,lt(f),v}return f.h=1,f.u=0}function Et(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function S(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function U(f){return f.Ra>>>(f.u&Rl-1)>>>0}function H(f){return t(f.bb<=f.Sb),f.h||f.bb==f.Sb&&f.u>Rl}function K(f,m){f.u=m,f.h=H(f)}function st(f){f.u>=mc&&(t(f.u>=mc),lt(f))}function ht(f){t(f!=null&&f.oa!=null),f.pa<f.Zc?(f.I=(f.oa[f.pa++]|f.I<<8)>>>0,f.b+=8):(t(f!=null&&f.oa!=null),f.pa<f.Yc?(f.b+=8,f.I=f.oa[f.pa++]|f.I<<8):f.Ka?f.b=0:(f.I<<=8,f.b+=8,f.Ka=1))}function gt(f){return Z(f,1)}function mt(f,m){var v=f.Ca;0>f.b&&ht(f);var E=f.b,C=v*m>>>8,I=(f.I>>>E>C)+0;for(I?(v-=C,f.I-=C+1<<E>>>0):v=C+1,E=v,C=0;256<=E;)C+=8,E>>=8;return E=7^C+nr[E],f.b-=E,f.Ca=(v<<E)-1,I}function Lt(f,m,v){f[m+0]=v>>24&255,f[m+1]=v>>16&255,f[m+2]=v>>8&255,f[m+3]=v>>0&255}function Tt(f,m){return f[m+0]<<0|f[m+1]<<8}function Bt(f,m){return Tt(f,m)|f[m+2]<<16}function Gt(f,m){return Tt(f,m)|Tt(f,m+2)<<16}function Jt(f,m){var v=1<<m;return t(f!=null),t(0<m),f.X=s(v),f.X==null?0:(f.Mb=32-m,f.Xa=m,1)}function pt(f,m){t(f!=null),t(m!=null),t(f.Xa==m.Xa),i(m.X,0,f.X,0,1<<m.Xa)}function Y(){this.X=[],this.Xa=this.Mb=0}function se(f,m,v,E){t(v!=null),t(E!=null);var C=v[0],I=E[0];return C==0&&(C=(f*I+m/2)/m),I==0&&(I=(m*C+f/2)/f),0>=C||0>=I?0:(v[0]=C,E[0]=I,1)}function Wt(f,m){return f+(1<<m)-1>>>m}function Ct(f,m){return((4278255360&f)+(4278255360&m)>>>0&4278255360)+((16711935&f)+(16711935&m)>>>0&16711935)>>>0}function Pt(f,m){T[m]=function(v,E,C,I,N,D,B){var z;for(z=0;z<N;++z){var et=T[f](D[B+z-1],C,I+z);D[B+z]=Ct(v[E+z],et)}}}function Nt(){this.ud=this.hd=this.jd=0}function Rt(f,m){return((4278124286&(f^m))>>>1)+(f&m)>>>0}function Ut(f){return 0<=f&&256>f?f:0>f?0:255<f?255:void 0}function ce(f,m){return Ut(f+(f-m+.5>>1))}function _e(f,m,v){return Math.abs(m-v)-Math.abs(f-v)}function Ee(f,m,v,E,C,I,N){for(E=I[N-1],v=0;v<C;++v)I[N+v]=E=Ct(f[m+v],E)}function Pe(f,m,v,E,C){var I;for(I=0;I<v;++I){var N=f[m+I],D=N>>8&255,B=16711935&(B=(B=16711935&N)+((D<<16)+D));E[C+I]=(4278255360&N)+B>>>0}}function Ye(f,m){m.jd=f>>0&255,m.hd=f>>8&255,m.ud=f>>16&255}function ae(f,m,v,E,C,I){var N;for(N=0;N<E;++N){var D=m[v+N],B=D>>>8,z=D,et=255&(et=(et=D>>>16)+((f.jd<<24>>24)*(B<<24>>24)>>>5));z=255&(z=(z=z+((f.hd<<24>>24)*(B<<24>>24)>>>5))+((f.ud<<24>>24)*(et<<24>>24)>>>5)),C[I+N]=(4278255360&D)+(et<<16)+z}}function Te(f,m,v,E,C){T[m]=function(I,N,D,B,z,et,ft,dt,at){for(B=ft;B<dt;++B)for(ft=0;ft<at;++ft)z[et++]=C(D[E(I[N++])])},T[f]=function(I,N,D,B,z,et,ft){var dt=8>>I.b,at=I.Ea,bt=I.K[0],_t=I.w;if(8>dt)for(I=(1<<I.b)-1,_t=(1<<dt)-1;N<D;++N){var nt,rt=0;for(nt=0;nt<at;++nt)nt&I||(rt=E(B[z++])),et[ft++]=C(bt[rt&_t]),rt>>=dt}else T["VP8LMapColor"+v](B,z,bt,_t,et,ft,N,D,at)}}function kt(f,m,v,E,C){for(v=m+v;m<v;){var I=f[m++];E[C++]=I>>16&255,E[C++]=I>>8&255,E[C++]=I>>0&255}}function ln(f,m,v,E,C){for(v=m+v;m<v;){var I=f[m++];E[C++]=I>>16&255,E[C++]=I>>8&255,E[C++]=I>>0&255,E[C++]=I>>24&255}}function Oe(f,m,v,E,C){for(v=m+v;m<v;){var I=(N=f[m++])>>16&240|N>>12&15,N=N>>0&240|N>>28&15;E[C++]=I,E[C++]=N}}function tr(f,m,v,E,C){for(v=m+v;m<v;){var I=(N=f[m++])>>16&248|N>>13&7,N=N>>5&224|N>>3&31;E[C++]=I,E[C++]=N}}function Ke(f,m,v,E,C){for(v=m+v;m<v;){var I=f[m++];E[C++]=I>>0&255,E[C++]=I>>8&255,E[C++]=I>>16&255}}function hi(f,m,v,E,C,I){if(I==0)for(v=m+v;m<v;)Lt(E,((I=f[m++])[0]>>24|I[1]>>8&65280|I[2]<<8&16711680|I[3]<<24)>>>0),C+=32;else i(E,C,f,m,v)}function pr(f,m){T[m][0]=T[f+"0"],T[m][1]=T[f+"1"],T[m][2]=T[f+"2"],T[m][3]=T[f+"3"],T[m][4]=T[f+"4"],T[m][5]=T[f+"5"],T[m][6]=T[f+"6"],T[m][7]=T[f+"7"],T[m][8]=T[f+"8"],T[m][9]=T[f+"9"],T[m][10]=T[f+"10"],T[m][11]=T[f+"11"],T[m][12]=T[f+"12"],T[m][13]=T[f+"13"],T[m][14]=T[f+"0"],T[m][15]=T[f+"0"]}function qe(f){return f==w0||f==x0||f==_f||f==b0}function Xr(){this.eb=[],this.size=this.A=this.fb=0}function ci(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function wn(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Xr,this.f.kb=new ci,this.sd=null}function Gn(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function xi(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function de(f){return alert("todo:WebPSamplerProcessPlane"),f.T}function Se(f,m){var v=f.T,E=m.ba.f.RGBA,C=E.eb,I=E.fb+f.ka*E.A,N=Ir[m.ba.S],D=f.y,B=f.O,z=f.f,et=f.N,ft=f.ea,dt=f.W,at=m.cc,bt=m.dc,_t=m.Mc,nt=m.Nc,rt=f.ka,wt=f.ka+f.T,St=f.U,xt=St+1>>1;for(rt==0?N(D,B,null,null,z,et,ft,dt,z,et,ft,dt,C,I,null,null,St):(N(m.ec,m.fc,D,B,at,bt,_t,nt,z,et,ft,dt,C,I-E.A,C,I,St),++v);rt+2<wt;rt+=2)at=z,bt=et,_t=ft,nt=dt,et+=f.Rc,dt+=f.Rc,I+=2*E.A,N(D,(B+=2*f.fa)-f.fa,D,B,at,bt,_t,nt,z,et,ft,dt,C,I-E.A,C,I,St);return B+=f.fa,f.j+wt<f.o?(i(m.ec,m.fc,D,B,St),i(m.cc,m.dc,z,et,xt),i(m.Mc,m.Nc,ft,dt,xt),v--):1&wt||N(D,B,null,null,z,et,ft,dt,z,et,ft,dt,C,I+E.A,null,null,St),v}function jn(f,m,v){var E=f.F,C=[f.J];if(E!=null){var I=f.U,N=m.ba.S,D=N==pf||N==_f;m=m.ba.f.RGBA;var B=[0],z=f.ka;B[0]=f.T,f.Kb&&(z==0?--B[0]:(--z,C[0]-=f.width),f.j+f.ka+f.T==f.o&&(B[0]=f.o-f.j-z));var et=m.eb;z=m.fb+z*m.A,f=uf(E,C[0],f.width,I,B,et,z+(D?0:3),m.A),t(v==B),f&&qe(N)&&Ba(et,z,D,I,B,m.A)}return 0}function Ze(f){var m=f.ma,v=m.ba.S,E=11>v,C=v==gf||v==mf||v==pf||v==v0||v==12||qe(v);if(m.memory=null,m.Ib=null,m.Jb=null,m.Nd=null,!dc(m.Oa,f,C?11:12))return 0;if(C&&qe(v)&&At(),f.da)alert("todo:use_scaling");else{if(E){if(m.Ib=de,f.Kb){if(v=f.U+1>>1,m.memory=s(f.U+2*v),m.memory==null)return 0;m.ec=m.memory,m.fc=0,m.cc=m.ec,m.dc=m.fc+f.U,m.Mc=m.cc,m.Nc=m.dc+v,m.Ib=Se,At()}}else alert("todo:EmitYUV");C&&(m.Jb=jn,E&&ot())}if(E&&!U_){for(f=0;256>f;++f)Pb[f]=89858*(f-128)+vf>>yf,Nb[f]=-22014*(f-128)+vf,Ib[f]=-45773*(f-128),Rb[f]=113618*(f-128)+vf>>yf;for(f=xc;f<L0;++f)m=76283*(f-16)+vf>>yf,Fb[f-xc]=yr(m,255),kb[f-xc]=yr(m+8>>4,15);U_=1}return 1}function Di(f){var m=f.ma,v=f.U,E=f.T;return t(!(1&f.ka)),0>=v||0>=E?0:(v=m.Ib(f,m),m.Jb!=null&&m.Jb(f,m,v),m.Dc+=v,1)}function Ci(f){f.ma.memory=null}function Kt(f,m,v,E){return ct(f,8)!=47?0:(m[0]=ct(f,14)+1,v[0]=ct(f,14)+1,E[0]=ct(f,1),ct(f,3)!=0?0:!f.h)}function Bi(f,m){if(4>f)return f+1;var v=f-2>>1;return(2+(1&f)<<v)+ct(m,v)+1}function je(f,m){return 120<m?m-120:1<=(v=((v=pb[m-1])>>4)*f+(8-(15&v)))?v:1;var v}function Je(f,m,v){var E=U(v),C=f[m+=255&E].g-8;return 0<C&&(K(v,v.u+8),E=U(v),m+=f[m].value,m+=E&(1<<C)-1),K(v,v.u+f[m].g),f[m].value}function ii(f,m,v){return v.g+=f.g,v.value+=f.value<<m>>>0,t(8>=v.g),f.g}function Ri(f,m,v){var E=f.xc;return t((m=E==0?0:f.vc[f.md*(v>>E)+(m>>E)])<f.Wb),f.Ya[m]}function _r(f,m,v,E){var C=f.ab,I=f.c*m,N=f.C;m=N+m;var D=v,B=E;for(E=f.Ta,v=f.Ua;0<C--;){var z=f.gc[C],et=N,ft=m,dt=D,at=B,bt=(B=E,D=v,z.Ea);switch(t(et<ft),t(ft<=z.nc),z.hc){case 2:cf(dt,at,(ft-et)*bt,B,D);break;case 0:var _t=et,nt=ft,rt=B,wt=D,St=(Ot=z).Ea;_t==0&&(m0(dt,at,null,null,1,rt,wt),Ee(dt,at+1,0,0,St-1,rt,wt+1),at+=St,wt+=St,++_t);for(var xt=1<<Ot.b,qt=xt-1,Ft=Wt(St,Ot.b),ne=Ot.K,Ot=Ot.w+(_t>>Ot.b)*Ft;_t<nt;){var We=ne,ni=Ot,Ue=1;for(pc(dt,at,rt,wt-St,1,rt,wt);Ue<St;){var Re=(Ue&~qt)+xt;Re>St&&(Re=St),(0,Fa[We[ni++]>>8&15])(dt,at+ +Ue,rt,wt+Ue-St,Re-Ue,rt,wt+Ue),Ue=Re}at+=St,wt+=St,++_t&qt||(Ot+=Ft)}ft!=z.nc&&i(B,D-bt,B,D+(ft-et-1)*bt,bt);break;case 1:for(bt=dt,nt=at,St=(dt=z.Ea)-(wt=dt&~(rt=(at=1<<z.b)-1)),_t=Wt(dt,z.b),xt=z.K,z=z.w+(et>>z.b)*_t;et<ft;){for(qt=xt,Ft=z,ne=new Nt,Ot=nt+wt,We=nt+dt;nt<Ot;)Ye(qt[Ft++],ne),Mr(ne,bt,nt,at,B,D),nt+=at,D+=at;nt<We&&(Ye(qt[Ft++],ne),Mr(ne,bt,nt,St,B,D),nt+=St,D+=St),++et&rt||(z+=_t)}break;case 3:if(dt==B&&at==D&&0<z.b){for(nt=B,dt=bt=D+(ft-et)*bt-(wt=(ft-et)*Wt(z.Ea,z.b)),at=B,rt=D,_t=[],wt=(St=wt)-1;0<=wt;--wt)_t[wt]=at[rt+wt];for(wt=St-1;0<=wt;--wt)nt[dt+wt]=_t[wt];es(z,et,ft,B,bt,B,D)}else es(z,et,ft,dt,at,B,D)}D=E,B=v}B!=v&&i(E,v,D,B,I)}function fl(f,m){var v=f.V,E=f.Ba+f.c*f.C,C=m-f.C;if(t(m<=f.l.o),t(16>=C),0<C){var I=f.l,N=f.Ta,D=f.Ua,B=I.width;if(_r(f,C,v,E),C=D=[D],t((v=f.C)<(E=m)),t(I.v<I.va),E>I.o&&(E=I.o),v<I.j){var z=I.j-v;v=I.j,C[0]+=z*B}if(v>=E?v=0:(C[0]+=4*I.v,I.ka=v-I.j,I.U=I.va-I.v,I.T=E-v,v=1),v){if(D=D[0],11>(v=f.ca).S){var et=v.f.RGBA,ft=(E=v.S,C=I.U,I=I.T,z=et.eb,et.A),dt=I;for(et=et.fb+f.Ma*et.A;0<dt--;){var at=N,bt=D,_t=C,nt=z,rt=et;switch(E){case df:is(at,bt,_t,nt,rt);break;case gf:ka(at,bt,_t,nt,rt);break;case w0:ka(at,bt,_t,nt,rt),Ba(nt,rt,0,_t,1,0);break;case R_:Il(at,bt,_t,nt,rt);break;case mf:hi(at,bt,_t,nt,rt,1);break;case x0:hi(at,bt,_t,nt,rt,1),Ba(nt,rt,0,_t,1,0);break;case pf:hi(at,bt,_t,nt,rt,0);break;case _f:hi(at,bt,_t,nt,rt,0),Ba(nt,rt,1,_t,1,0);break;case v0:Es(at,bt,_t,nt,rt);break;case b0:Es(at,bt,_t,nt,rt),kl(nt,rt,_t,1,0);break;case I_:ea(at,bt,_t,nt,rt);break;default:t(0)}D+=B,et+=ft}f.Ma+=I}else alert("todo:EmitRescaledRowsYUVA");t(f.Ma<=v.height)}}f.C=m,t(f.C<=f.i)}function Zs(f){var m;if(0<f.ua)return 0;for(m=0;m<f.Wb;++m){var v=f.Ya[m].G,E=f.Ya[m].H;if(0<v[1][E[1]+0].g||0<v[2][E[2]+0].g||0<v[3][E[3]+0].g)return 0}return 1}function Yr(f,m,v,E,C,I){if(f.Z!=0){var N=f.qd,D=f.rd;for(t(ja[f.Z]!=null);m<v;++m)ja[f.Z](N,D,E,C,E,C,I),N=E,D=C,C+=I;f.qd=N,f.rd=D}}function Kr(f,m){var v=f.l.ma,E=v.Z==0||v.Z==1?f.l.j:f.C;if(E=f.C<E?E:f.C,t(m<=f.l.o),m>E){var C=f.l.width,I=v.ca,N=v.tb+C*E,D=f.V,B=f.Ba+f.c*E,z=f.gc;t(f.ab==1),t(z[0].hc==3),p0(z[0],E,m,D,B,I,N),Yr(v,E,m,I,N,C)}f.C=f.Ma=m}function Zr(f,m,v,E,C,I,N){var D=f.$/E,B=f.$%E,z=f.m,et=f.s,ft=v+f.$,dt=ft;C=v+E*C;var at=v+E*I,bt=280+et.ua,_t=f.Pb?D:16777216,nt=0<et.ua?et.Wa:null,rt=et.wc,wt=ft<at?Ri(et,B,D):null;t(f.C<I),t(at<=C);var St=!1;t:for(;;){for(;St||ft<at;){var xt=0;if(D>=_t){var qt=ft-v;t((_t=f).Pb),_t.wd=_t.m,_t.xd=qt,0<_t.s.ua&&pt(_t.s.Wa,_t.s.vb),_t=D+yb}if(B&rt||(wt=Ri(et,B,D)),t(wt!=null),wt.Qb&&(m[ft]=wt.qb,St=!0),!St)if(st(z),wt.jc){xt=z,qt=m;var Ft=ft,ne=wt.pd[U(xt)&ir-1];t(wt.jc),256>ne.g?(K(xt,xt.u+ne.g),qt[Ft]=ne.value,xt=0):(K(xt,xt.u+ne.g-256),t(256<=ne.value),xt=ne.value),xt==0&&(St=!0)}else xt=Je(wt.G[0],wt.H[0],z);if(z.h)break;if(St||256>xt){if(!St)if(wt.nd)m[ft]=(wt.qb|xt<<8)>>>0;else{if(st(z),St=Je(wt.G[1],wt.H[1],z),st(z),qt=Je(wt.G[2],wt.H[2],z),Ft=Je(wt.G[3],wt.H[3],z),z.h)break;m[ft]=(Ft<<24|St<<16|xt<<8|qt)>>>0}if(St=!1,++ft,++B>=E&&(B=0,++D,N!=null&&D<=I&&!(D%16)&&N(f,D),nt!=null))for(;dt<ft;)xt=m[dt++],nt.X[(506832829*xt&4294967295)>>>nt.Mb]=xt}else if(280>xt){if(xt=Bi(xt-256,z),qt=Je(wt.G[4],wt.H[4],z),st(z),qt=je(E,qt=Bi(qt,z)),z.h)break;if(ft-v<qt||C-ft<xt)break t;for(Ft=0;Ft<xt;++Ft)m[ft+Ft]=m[ft+Ft-qt];for(ft+=xt,B+=xt;B>=E;)B-=E,++D,N!=null&&D<=I&&!(D%16)&&N(f,D);if(t(ft<=C),B&rt&&(wt=Ri(et,B,D)),nt!=null)for(;dt<ft;)xt=m[dt++],nt.X[(506832829*xt&4294967295)>>>nt.Mb]=xt}else{if(!(xt<bt))break t;for(St=xt-280,t(nt!=null);dt<ft;)xt=m[dt++],nt.X[(506832829*xt&4294967295)>>>nt.Mb]=xt;xt=ft,t(!(St>>>(qt=nt).Xa)),m[xt]=qt.X[St],St=!0}St||t(z.h==H(z))}if(f.Pb&&z.h&&ft<C)t(f.m.h),f.a=5,f.m=f.wd,f.$=f.xd,0<f.s.ua&&pt(f.s.vb,f.s.Wa);else{if(z.h)break t;N!=null&&N(f,D>I?I:D),f.a=0,f.$=ft-v}return 1}return f.a=3,0}function ws(f){t(f!=null),f.vc=null,f.yc=null,f.Ya=null;var m=f.Wa;m!=null&&(m.X=null),f.vb=null,t(f!=null)}function Tr(){var f=new g0;return f==null?null:(f.a=0,f.xb=k_,pr("Predictor","VP8LPredictors"),pr("Predictor","VP8LPredictors_C"),pr("PredictorAdd","VP8LPredictorsAdd"),pr("PredictorAdd","VP8LPredictorsAdd_C"),cf=Pe,Mr=ae,is=kt,ka=ln,Es=Oe,ea=tr,Il=Ke,T.VP8LMapColor32b=_c,T.VP8LMapColor8b=_0,f)}function xs(f,m,v,E,C){var I=1,N=[f],D=[m],B=E.m,z=E.s,et=null,ft=0;t:for(;;){if(v)for(;I&&ct(B,1);){var dt=N,at=D,bt=E,_t=1,nt=bt.m,rt=bt.gc[bt.ab],wt=ct(nt,2);if(bt.Oc&1<<wt)I=0;else{switch(bt.Oc|=1<<wt,rt.hc=wt,rt.Ea=dt[0],rt.nc=at[0],rt.K=[null],++bt.ab,t(4>=bt.ab),wt){case 0:case 1:rt.b=ct(nt,3)+2,_t=xs(Wt(rt.Ea,rt.b),Wt(rt.nc,rt.b),0,bt,rt.K),rt.K=rt.K[0];break;case 3:var St,xt=ct(nt,8)+1,qt=16<xt?0:4<xt?1:2<xt?2:3;if(dt[0]=Wt(rt.Ea,qt),rt.b=qt,St=_t=xs(xt,1,0,bt,rt.K)){var Ft,ne=xt,Ot=rt,We=1<<(8>>Ot.b),ni=s(We);if(ni==null)St=0;else{var Ue=Ot.K[0],Re=Ot.w;for(ni[0]=Ot.K[0][0],Ft=1;Ft<1*ne;++Ft)ni[Ft]=Ct(Ue[Re+Ft],ni[Ft-1]);for(;Ft<4*We;++Ft)ni[Ft]=0;Ot.K[0]=null,Ot.K[0]=ni,St=1}}_t=St;break;case 2:break;default:t(0)}I=_t}}if(N=N[0],D=D[0],I&&ct(B,1)&&!(I=1<=(ft=ct(B,4))&&11>=ft)){E.a=3;break t}var gi;if(gi=I)e:{var ui,Ce,$i,rr=E,Xi=N,sr=D,ri=ft,wr=v,xr=rr.m,cn=rr.s,xn=[null],Un=1,Nr=0,Ss=_b[ri];i:for(;;){if(wr&&ct(xr,1)){var un=ct(xr,3)+2,aa=Wt(Xi,un),Po=Wt(sr,un),Ol=aa*Po;if(!xs(aa,Po,0,rr,xn))break i;for(xn=xn[0],cn.xc=un,ui=0;ui<Ol;++ui){var Ua=xn[ui]>>8&65535;xn[ui]=Ua,Ua>=Un&&(Un=Ua+1)}}if(xr.h)break i;for(Ce=0;5>Ce;++Ce){var Ni=N_[Ce];!Ce&&0<ri&&(Ni+=1<<ri),Nr<Ni&&(Nr=Ni)}var C0=a(Un*Ss,M),V_=Un,W_=a(V_,G);if(W_==null)var xf=null;else t(65536>=V_),xf=W_;var bc=s(Nr);if(xf==null||bc==null||C0==null){rr.a=1;break i}var bf=C0;for(ui=$i=0;ui<Un;++ui){var as=xf[ui],Dl=as.G,Bl=as.H,H_=0,Ef=1,$_=0;for(Ce=0;5>Ce;++Ce){Ni=N_[Ce],Dl[Ce]=bf,Bl[Ce]=$i,!Ce&&0<ri&&(Ni+=1<<ri);r:{var Sf,A0=Ni,Lf=rr,Ec=bc,Bb=bf,Gb=$i,T0=0,za=Lf.m,jb=ct(za,1);if(r(Ec,0,0,A0),jb){var Ub=ct(za,1)+1,zb=ct(za,1),X_=ct(za,zb==0?1:8);Ec[X_]=1,Ub==2&&(Ec[X_=ct(za,8)]=1);var Cf=1}else{var Y_=s(19),K_=ct(za,4)+4;if(19<K_){Lf.a=3;var Af=0;break r}for(Sf=0;Sf<K_;++Sf)Y_[mb[Sf]]=ct(za,3);var M0=void 0,Sc=void 0,Z_=Lf,qb=Y_,Tf=A0,J_=Ec,P0=0,qa=Z_.m,Q_=8,ty=a(128,M);n:for(;F(ty,0,7,qb,19);){if(ct(qa,1)){var Vb=2+2*ct(qa,3);if((M0=2+ct(qa,Vb))>Tf)break n}else M0=Tf;for(Sc=0;Sc<Tf&&M0--;){st(qa);var ey=ty[0+(127&U(qa))];K(qa,qa.u+ey.g);var Gl=ey.value;if(16>Gl)J_[Sc++]=Gl,Gl!=0&&(Q_=Gl);else{var Wb=Gl==16,iy=Gl-16,Hb=db[iy],ny=ct(qa,fb[iy])+Hb;if(Sc+ny>Tf)break n;for(var $b=Wb?Q_:0;0<ny--;)J_[Sc++]=$b}}P0=1;break n}P0||(Z_.a=3),Cf=P0}(Cf=Cf&&!za.h)&&(T0=F(Bb,Gb,8,Ec,A0)),Cf&&T0!=0?Af=T0:(Lf.a=3,Af=0)}if(Af==0)break i;if(Ef&&gb[Ce]==1&&(Ef=bf[$i].g==0),H_+=bf[$i].g,$i+=Af,3>=Ce){var Lc,R0=bc[0];for(Lc=1;Lc<Ni;++Lc)bc[Lc]>R0&&(R0=bc[Lc]);$_+=R0}}if(as.nd=Ef,as.Qb=0,Ef&&(as.qb=(Dl[3][Bl[3]+0].value<<24|Dl[1][Bl[1]+0].value<<16|Dl[2][Bl[2]+0].value)>>>0,H_==0&&256>Dl[0][Bl[0]+0].value&&(as.Qb=1,as.qb+=Dl[0][Bl[0]+0].value<<8)),as.jc=!as.Qb&&6>$_,as.jc){var Mf,oa=as;for(Mf=0;Mf<ir;++Mf){var Va=Mf,Wa=oa.pd[Va],Pf=oa.G[0][oa.H[0]+Va];256<=Pf.value?(Wa.g=Pf.g+256,Wa.value=Pf.value):(Wa.g=0,Wa.value=0,Va>>=ii(Pf,8,Wa),Va>>=ii(oa.G[1][oa.H[1]+Va],16,Wa),Va>>=ii(oa.G[2][oa.H[2]+Va],0,Wa),ii(oa.G[3][oa.H[3]+Va],24,Wa))}}}cn.vc=xn,cn.Wb=Un,cn.Ya=xf,cn.yc=C0,gi=1;break e}gi=0}if(!(I=gi)){E.a=3;break t}if(0<ft){if(z.ua=1<<ft,!Jt(z.Wa,ft)){E.a=1,I=0;break t}}else z.ua=0;var I0=E,ry=N,Xb=D,N0=I0.s,F0=N0.xc;if(I0.c=ry,I0.i=Xb,N0.md=Wt(ry,F0),N0.wc=F0==0?-1:(1<<F0)-1,v){E.xb=Lb;break t}if((et=s(N*D))==null){E.a=1,I=0;break t}I=(I=Zr(E,et,0,N,D,D,null))&&!B.h;break t}return I?(C!=null?C[0]=et:(t(et==null),t(v)),E.$=0,v||ws(z)):ws(z),I}function Eo(f,m){var v=f.c*f.i,E=v+m+16*m;return t(f.c<=m),f.V=s(E),f.V==null?(f.Ta=null,f.Ua=0,f.a=1,0):(f.Ta=f.V,f.Ua=f.Ba+v+m,1)}function dl(f,m){var v=f.C,E=m-v,C=f.V,I=f.Ba+f.c*v;for(t(m<=f.l.o);0<E;){var N=16<E?16:E,D=f.l.ma,B=f.l.width,z=B*N,et=D.ca,ft=D.tb+B*v,dt=f.Ta,at=f.Ua;_r(f,N,C,I),L_(dt,at,et,ft,z),Yr(D,v,v+N,et,ft,B),E-=N,C+=N*f.c,v+=N}t(v==m),f.C=f.Ma=m}function gl(){this.ub=this.yd=this.td=this.Rb=0}function ml(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function pl(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function qu(){this.Yb=function(){var f=[];return function m(v,E,C){for(var I=C[E],N=0;N<I&&(v.push(C.length>E+1?[]:0),!(C.length<E+1));N++)m(v[N],E+1,C)}(f,0,[3,11]),f}()}function Wg(){this.jb=s(3),this.Wc=o([4,8],qu),this.Xc=o([4,17],qu)}function Hg(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function _l(){this.ld=this.La=this.dd=this.tc=0}function Vu(){this.Na=this.la=0}function $g(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Zh(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Xg(){this.uc=this.M=this.Nb=0,this.wa=Array(new _l),this.Y=0,this.ya=Array(new Zh),this.aa=0,this.l=new yl}function Wu(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Yg(){this.cb=this.a=0,this.sc="",this.m=new Et,this.Od=new gl,this.Kc=new ml,this.ed=new Hg,this.Qa=new pl,this.Ic=this.$c=this.Aa=0,this.D=new Xg,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,Et),this.ia=0,this.pb=a(4,$g),this.Pa=new Wg,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Wu),this.Hd=0,this.rb=Array(new Vu),this.sb=0,this.wa=Array(new _l),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Zh),this.L=this.aa=0,this.gd=o([4,2],_l),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function yl(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Kg(){var f=new Yg;return f!=null&&(f.a=0,f.sc="OK",f.cb=0,f.Xb=0,wc||(wc=Xu)),f}function Gi(f,m,v){return f.a==0&&(f.a=m,f.sc=v,f.cb=0),0}function Hu(f,m,v){return 3<=v&&f[m+0]==157&&f[m+1]==1&&f[m+2]==42}function $u(f,m){if(f==null)return 0;if(f.a=0,f.sc="OK",m==null)return Gi(f,2,"null VP8Io passed to VP8GetHeaders()");var v=m.data,E=m.w,C=m.ha;if(4>C)return Gi(f,7,"Truncated header.");var I=v[E+0]|v[E+1]<<8|v[E+2]<<16,N=f.Od;if(N.Rb=!(1&I),N.td=I>>1&7,N.yd=I>>4&1,N.ub=I>>5,3<N.td)return Gi(f,3,"Incorrect keyframe parameters.");if(!N.yd)return Gi(f,4,"Frame not displayable.");E+=3,C-=3;var D=f.Kc;if(N.Rb){if(7>C)return Gi(f,7,"cannot parse picture header");if(!Hu(v,E,C))return Gi(f,3,"Bad code word");D.c=16383&(v[E+4]<<8|v[E+3]),D.Td=v[E+4]>>6,D.i=16383&(v[E+6]<<8|v[E+5]),D.Ud=v[E+6]>>6,E+=7,C-=7,f.za=D.c+15>>4,f.Ub=D.i+15>>4,m.width=D.c,m.height=D.i,m.Da=0,m.j=0,m.v=0,m.va=m.width,m.o=m.height,m.da=0,m.ib=m.width,m.hb=m.height,m.U=m.width,m.T=m.height,r((I=f.Pa).jb,0,255,I.jb.length),t((I=f.Qa)!=null),I.Cb=0,I.Bb=0,I.Fb=1,r(I.Zb,0,0,I.Zb.length),r(I.Lb,0,0,I.Lb)}if(N.ub>C)return Gi(f,7,"bad partition length");tt(I=f.m,v,E,N.ub),E+=N.ub,C-=N.ub,N.Rb&&(D.Ld=gt(I),D.Kd=gt(I)),D=f.Qa;var B,z=f.Pa;if(t(I!=null),t(D!=null),D.Cb=gt(I),D.Cb){if(D.Bb=gt(I),gt(I)){for(D.Fb=gt(I),B=0;4>B;++B)D.Zb[B]=gt(I)?it(I,7):0;for(B=0;4>B;++B)D.Lb[B]=gt(I)?it(I,6):0}if(D.Bb)for(B=0;3>B;++B)z.jb[B]=gt(I)?Z(I,8):255}else D.Bb=0;if(I.Ka)return Gi(f,3,"cannot parse segment header");if((D=f.ed).zd=gt(I),D.Tb=Z(I,6),D.wb=Z(I,3),D.Pc=gt(I),D.Pc&&gt(I)){for(z=0;4>z;++z)gt(I)&&(D.vd[z]=it(I,6));for(z=0;4>z;++z)gt(I)&&(D.od[z]=it(I,6))}if(f.L=D.Tb==0?0:D.zd?1:2,I.Ka)return Gi(f,3,"cannot parse filter header");var et=C;if(C=B=E,E=B+et,D=et,f.Xb=(1<<Z(f.m,2))-1,et<3*(z=f.Xb))v=7;else{for(B+=3*z,D-=3*z,et=0;et<z;++et){var ft=v[C+0]|v[C+1]<<8|v[C+2]<<16;ft>D&&(ft=D),tt(f.Jc[+et],v,B,ft),B+=ft,D-=ft,C+=3}tt(f.Jc[+z],v,B,D),v=B<E?0:5}if(v!=0)return Gi(f,v,"cannot parse partitions");for(v=Z(B=f.m,7),C=gt(B)?it(B,4):0,E=gt(B)?it(B,4):0,D=gt(B)?it(B,4):0,z=gt(B)?it(B,4):0,B=gt(B)?it(B,4):0,et=f.Qa,ft=0;4>ft;++ft){if(et.Cb){var dt=et.Zb[ft];et.Fb||(dt+=v)}else{if(0<ft){f.pb[ft]=f.pb[0];continue}dt=v}var at=f.pb[ft];at.Sc[0]=E0[yr(dt+C,127)],at.Sc[1]=S0[yr(dt+0,127)],at.Eb[0]=2*E0[yr(dt+E,127)],at.Eb[1]=101581*S0[yr(dt+D,127)]>>16,8>at.Eb[1]&&(at.Eb[1]=8),at.Qc[0]=E0[yr(dt+z,117)],at.Qc[1]=S0[yr(dt+B,127)],at.lc=dt+B}if(!N.Rb)return Gi(f,4,"Not a key frame.");for(gt(I),N=f.Pa,v=0;4>v;++v){for(C=0;8>C;++C)for(E=0;3>E;++E)for(D=0;11>D;++D)z=mt(I,Eb[v][C][E][D])?Z(I,8):xb[v][C][E][D],N.Wc[v][C].Yb[E][D]=z;for(C=0;17>C;++C)N.Xc[v][C]=N.Wc[v][Sb[C]]}return f.kc=gt(I),f.kc&&(f.Bd=Z(I,8)),f.cb=1}function Xu(f,m,v,E,C,I,N){var D=m[C].Yb[v];for(v=0;16>C;++C){if(!mt(f,D[v+0]))return C;for(;!mt(f,D[v+1]);)if(D=m[++C].Yb[0],v=0,C==16)return 16;var B=m[C+1].Yb;if(mt(f,D[v+2])){var z=f,et=0;if(mt(z,(dt=D)[(ft=v)+3]))if(mt(z,dt[ft+6])){for(D=0,ft=2*(et=mt(z,dt[ft+8]))+(dt=mt(z,dt[ft+9+et])),et=0,dt=vb[ft];dt[D];++D)et+=et+mt(z,dt[D]);et+=3+(8<<ft)}else mt(z,dt[ft+7])?(et=7+2*mt(z,165),et+=mt(z,145)):et=5+mt(z,159);else et=mt(z,dt[ft+4])?3+mt(z,dt[ft+5]):2;D=B[2]}else et=1,D=B[1];B=N+wb[C],0>(z=f).b&&ht(z);var ft,dt=z.b,at=(ft=z.Ca>>1)-(z.I>>dt)>>31;--z.b,z.Ca+=at,z.Ca|=1,z.I-=(ft+1&at)<<dt,I[B]=((et^at)-at)*E[(0<C)+0]}return 16}function Jh(f){var m=f.rb[f.sb-1];m.la=0,m.Na=0,r(f.zc,0,0,f.zc.length),f.ja=0}function Zg(f,m){if(f==null)return 0;if(m==null)return Gi(f,2,"NULL VP8Io parameter in VP8Decode().");if(!f.cb&&!$u(f,m))return 0;if(t(f.cb),m.ac==null||m.ac(m)){m.ob&&(f.L=0);var v=wf[f.L];if(f.L==2?(f.yb=0,f.zb=0):(f.yb=m.v-v>>4,f.zb=m.j-v>>4,0>f.yb&&(f.yb=0),0>f.zb&&(f.zb=0)),f.Va=m.o+15+v>>4,f.Hb=m.va+15+v>>4,f.Hb>f.za&&(f.Hb=f.za),f.Va>f.Ub&&(f.Va=f.Ub),0<f.L){var E=f.ed;for(v=0;4>v;++v){var C;if(f.Qa.Cb){var I=f.Qa.Lb[v];f.Qa.Fb||(I+=E.Tb)}else I=E.Tb;for(C=0;1>=C;++C){var N=f.gd[v][C],D=I;if(E.Pc&&(D+=E.vd[0],C&&(D+=E.od[0])),0<(D=0>D?0:63<D?63:D)){var B=D;0<E.wb&&(B=4<E.wb?B>>2:B>>1)>9-E.wb&&(B=9-E.wb),1>B&&(B=1),N.dd=B,N.tc=2*D+B,N.ld=40<=D?2:15<=D?1:0}else N.tc=0;N.La=C}}}v=0}else Gi(f,6,"Frame setup failed"),v=f.a;if(v=v==0){if(v){f.$c=0,0<f.Aa||(f.Ic=Db);t:{v=f.Ic,E=4*(B=f.za);var z=32*B,et=B+1,ft=0<f.L?B*(0<f.Aa?2:1):0,dt=(f.Aa==2?2:1)*B;if((N=E+832+(C=3*(16*v+wf[f.L])/2*z)+(I=f.Fa!=null&&0<f.Fa.length?f.Kc.c*f.Kc.i:0))!=N)v=0;else{if(N>f.Vb){if(f.Vb=0,f.Ec=s(N),f.Fc=0,f.Ec==null){v=Gi(f,1,"no memory during frame initialization.");break t}f.Vb=N}N=f.Ec,D=f.Fc,f.Ac=N,f.Bc=D,D+=E,f.Gd=a(z,Wu),f.Hd=0,f.rb=a(et+1,Vu),f.sb=1,f.wa=ft?a(ft,_l):null,f.Y=0,f.D.Nb=0,f.D.wa=f.wa,f.D.Y=f.Y,0<f.Aa&&(f.D.Y+=B),t(!0),f.oc=N,f.pc=D,D+=832,f.ya=a(dt,Zh),f.aa=0,f.D.ya=f.ya,f.D.aa=f.aa,f.Aa==2&&(f.D.aa+=B),f.R=16*B,f.B=8*B,B=(z=wf[f.L])*f.R,z=z/2*f.B,f.sa=N,f.ta=D+B,f.qa=f.sa,f.ra=f.ta+16*v*f.R+z,f.Ha=f.qa,f.Ia=f.ra+8*v*f.B+z,f.$c=0,D+=C,f.mb=I?N:null,f.nb=I?D:null,t(D+I<=f.Fc+f.Vb),Jh(f),r(f.Ac,f.Bc,0,E),v=1}}if(v){if(m.ka=0,m.y=f.sa,m.O=f.ta,m.f=f.qa,m.N=f.ra,m.ea=f.Ha,m.Vd=f.Ia,m.fa=f.R,m.Rc=f.B,m.F=null,m.J=0,!P_){for(v=-255;255>=v;++v)C_[255+v]=0>v?-v:v;for(v=-1020;1020>=v;++v)A_[1020+v]=-128>v?-128:127<v?127:v;for(v=-112;112>=v;++v)T_[112+v]=-16>v?-16:15<v?15:v;for(v=-255;510>=v;++v)M_[255+v]=0>v?0:255<v?255:v;P_=1}ns=t0,Nl=Jg,Oa=Ku,rs=Qg,ia=Zu,yc=Yu,To=rc,Fl=Co,Mo=d0,Da=sc,vc=f0,Pr=Sl,na=ac,_i=of,yi=af,ji=Qs,tn=Ra,ra=u0,ss[0]=bs,ss[1]=e0,ss[2]=s0,ss[3]=a0,ss[4]=tf,ss[5]=bl,ss[6]=ef,ss[7]=ec,ss[8]=l0,ss[9]=o0,Ga[0]=Ju,Ga[1]=n0,Ga[2]=Js,Ga[3]=wl,Ga[4]=Cn,Ga[5]=r0,Ga[6]=Qu,sa[0]=Pa,sa[1]=i0,sa[2]=h0,sa[3]=ic,sa[4]=Lo,sa[5]=c0,sa[6]=nc,v=1}else v=0}v&&(v=function(at,bt){for(at.M=0;at.M<at.Va;++at.M){var _t,nt=at.Jc[at.M&at.Xb],rt=at.m,wt=at;for(_t=0;_t<wt.za;++_t){var St=rt,xt=wt,qt=xt.Ac,Ft=xt.Bc+4*_t,ne=xt.zc,Ot=xt.ya[xt.aa+_t];if(xt.Qa.Bb?Ot.$b=mt(St,xt.Pa.jb[0])?2+mt(St,xt.Pa.jb[2]):mt(St,xt.Pa.jb[1]):Ot.$b=0,xt.kc&&(Ot.Ad=mt(St,xt.Bd)),Ot.Za=!mt(St,145)+0,Ot.Za){var We=Ot.Ob,ni=0;for(xt=0;4>xt;++xt){var Ue,Re=ne[0+xt];for(Ue=0;4>Ue;++Ue){Re=bb[qt[Ft+Ue]][Re];for(var gi=F_[mt(St,Re[0])];0<gi;)gi=F_[2*gi+mt(St,Re[gi])];Re=-gi,qt[Ft+Ue]=Re}i(We,ni,qt,Ft,4),ni+=4,ne[0+xt]=Re}}else Re=mt(St,156)?mt(St,128)?1:3:mt(St,163)?2:0,Ot.Ob[0]=Re,r(qt,Ft,Re,4),r(ne,0,Re,4);Ot.Dd=mt(St,142)?mt(St,114)?mt(St,183)?1:3:2:0}if(wt.m.Ka)return Gi(at,7,"Premature end-of-partition0 encountered.");for(;at.ja<at.za;++at.ja){if(wt=nt,St=(rt=at).rb[rt.sb-1],qt=rt.rb[rt.sb+rt.ja],_t=rt.ya[rt.aa+rt.ja],Ft=rt.kc?_t.Ad:0)St.la=qt.la=0,_t.Za||(St.Na=qt.Na=0),_t.Hc=0,_t.Gc=0,_t.ia=0;else{var ui,Ce;if(St=qt,qt=wt,Ft=rt.Pa.Xc,ne=rt.ya[rt.aa+rt.ja],Ot=rt.pb[ne.$b],xt=ne.ad,We=0,ni=rt.rb[rt.sb-1],Re=Ue=0,r(xt,We,0,384),ne.Za)var $i=0,rr=Ft[3];else{gi=s(16);var Xi=St.Na+ni.Na;if(Xi=wc(qt,Ft[1],Xi,Ot.Eb,0,gi,0),St.Na=ni.Na=(0<Xi)+0,1<Xi)ns(gi,0,xt,We);else{var sr=gi[0]+3>>3;for(gi=0;256>gi;gi+=16)xt[We+gi]=sr}$i=1,rr=Ft[0]}var ri=15&St.la,wr=15&ni.la;for(gi=0;4>gi;++gi){var xr=1&wr;for(sr=Ce=0;4>sr;++sr)ri=ri>>1|(xr=(Xi=wc(qt,rr,Xi=xr+(1&ri),Ot.Sc,$i,xt,We))>$i)<<7,Ce=Ce<<2|(3<Xi?3:1<Xi?2:xt[We+0]!=0),We+=16;ri>>=4,wr=wr>>1|xr<<7,Ue=(Ue<<8|Ce)>>>0}for(rr=ri,$i=wr>>4,ui=0;4>ui;ui+=2){for(Ce=0,ri=St.la>>4+ui,wr=ni.la>>4+ui,gi=0;2>gi;++gi){for(xr=1&wr,sr=0;2>sr;++sr)Xi=xr+(1&ri),ri=ri>>1|(xr=0<(Xi=wc(qt,Ft[2],Xi,Ot.Qc,0,xt,We)))<<3,Ce=Ce<<2|(3<Xi?3:1<Xi?2:xt[We+0]!=0),We+=16;ri>>=2,wr=wr>>1|xr<<5}Re|=Ce<<4*ui,rr|=ri<<4<<ui,$i|=(240&wr)<<ui}St.la=rr,ni.la=$i,ne.Hc=Ue,ne.Gc=Re,ne.ia=43690&Re?0:Ot.ia,Ft=!(Ue|Re)}if(0<rt.L&&(rt.wa[rt.Y+rt.ja]=rt.gd[_t.$b][_t.Za],rt.wa[rt.Y+rt.ja].La|=!Ft),wt.Ka)return Gi(at,7,"Premature end-of-file encountered.")}if(Jh(at),rt=bt,wt=1,_t=(nt=at).D,St=0<nt.L&&nt.M>=nt.zb&&nt.M<=nt.Va,nt.Aa==0)t:{if(_t.M=nt.M,_t.uc=St,fc(nt,_t),wt=1,_t=(Ce=nt.D).Nb,St=(Re=wf[nt.L])*nt.R,qt=Re/2*nt.B,gi=16*_t*nt.R,sr=8*_t*nt.B,Ft=nt.sa,ne=nt.ta-St+gi,Ot=nt.qa,xt=nt.ra-qt+sr,We=nt.Ha,ni=nt.Ia-qt+sr,wr=(ri=Ce.M)==0,Ue=ri>=nt.Va-1,nt.Aa==2&&fc(nt,Ce),Ce.uc)for(xr=(Xi=nt).D.M,t(Xi.D.uc),Ce=Xi.yb;Ce<Xi.Hb;++Ce){$i=Ce,rr=xr;var cn=(xn=(Ni=Xi).D).Nb;ui=Ni.R;var xn=xn.wa[xn.Y+$i],Un=Ni.sa,Nr=Ni.ta+16*cn*ui+16*$i,Ss=xn.dd,un=xn.tc;if(un!=0)if(t(3<=un),Ni.L==1)0<$i&&ji(Un,Nr,ui,un+4),xn.La&&ra(Un,Nr,ui,un),0<rr&&yi(Un,Nr,ui,un+4),xn.La&&tn(Un,Nr,ui,un);else{var aa=Ni.B,Po=Ni.qa,Ol=Ni.ra+8*cn*aa+8*$i,Ua=Ni.Ha,Ni=Ni.Ia+8*cn*aa+8*$i;cn=xn.ld,0<$i&&(Fl(Un,Nr,ui,un+4,Ss,cn),Da(Po,Ol,Ua,Ni,aa,un+4,Ss,cn)),xn.La&&(Pr(Un,Nr,ui,un,Ss,cn),_i(Po,Ol,Ua,Ni,aa,un,Ss,cn)),0<rr&&(To(Un,Nr,ui,un+4,Ss,cn),Mo(Po,Ol,Ua,Ni,aa,un+4,Ss,cn)),xn.La&&(vc(Un,Nr,ui,un,Ss,cn),na(Po,Ol,Ua,Ni,aa,un,Ss,cn))}}if(nt.ia&&alert("todo:DitherRow"),rt.put!=null){if(Ce=16*ri,ri=16*(ri+1),wr?(rt.y=nt.sa,rt.O=nt.ta+gi,rt.f=nt.qa,rt.N=nt.ra+sr,rt.ea=nt.Ha,rt.W=nt.Ia+sr):(Ce-=Re,rt.y=Ft,rt.O=ne,rt.f=Ot,rt.N=xt,rt.ea=We,rt.W=ni),Ue||(ri-=Re),ri>rt.o&&(ri=rt.o),rt.F=null,rt.J=null,nt.Fa!=null&&0<nt.Fa.length&&Ce<ri&&(rt.J=cc(nt,rt,Ce,ri-Ce),rt.F=nt.mb,rt.F==null&&rt.F.length==0)){wt=Gi(nt,3,"Could not decode alpha data.");break t}Ce<rt.j&&(Re=rt.j-Ce,Ce=rt.j,t(!(1&Re)),rt.O+=nt.R*Re,rt.N+=nt.B*(Re>>1),rt.W+=nt.B*(Re>>1),rt.F!=null&&(rt.J+=rt.width*Re)),Ce<ri&&(rt.O+=rt.v,rt.N+=rt.v>>1,rt.W+=rt.v>>1,rt.F!=null&&(rt.J+=rt.v),rt.ka=Ce-rt.j,rt.U=rt.va-rt.v,rt.T=ri-Ce,wt=rt.put(rt))}_t+1!=nt.Ic||Ue||(i(nt.sa,nt.ta-St,Ft,ne+16*nt.R,St),i(nt.qa,nt.ra-qt,Ot,xt+8*nt.B,qt),i(nt.Ha,nt.Ia-qt,We,ni+8*nt.B,qt))}if(!wt)return Gi(at,6,"Output aborted.")}return 1}(f,m)),m.bc!=null&&m.bc(m),v&=1}return v?(f.cb=0,v):0}function Jr(f,m,v,E,C){C=f[m+v+32*E]+(C>>3),f[m+v+32*E]=-256&C?0>C?0:255:C}function vl(f,m,v,E,C,I){Jr(f,m,0,v,E+C),Jr(f,m,1,v,E+I),Jr(f,m,2,v,E-I),Jr(f,m,3,v,E-C)}function er(f){return(20091*f>>16)+f}function Qh(f,m,v,E){var C,I=0,N=s(16);for(C=0;4>C;++C){var D=f[m+0]+f[m+8],B=f[m+0]-f[m+8],z=(35468*f[m+4]>>16)-er(f[m+12]),et=er(f[m+4])+(35468*f[m+12]>>16);N[I+0]=D+et,N[I+1]=B+z,N[I+2]=B-z,N[I+3]=D-et,I+=4,m++}for(C=I=0;4>C;++C)D=(f=N[I+0]+4)+N[I+8],B=f-N[I+8],z=(35468*N[I+4]>>16)-er(N[I+12]),Jr(v,E,0,0,D+(et=er(N[I+4])+(35468*N[I+12]>>16))),Jr(v,E,1,0,B+z),Jr(v,E,2,0,B-z),Jr(v,E,3,0,D-et),I++,E+=32}function Yu(f,m,v,E){var C=f[m+0]+4,I=35468*f[m+4]>>16,N=er(f[m+4]),D=35468*f[m+1]>>16;vl(v,E,0,C+N,f=er(f[m+1]),D),vl(v,E,1,C+I,f,D),vl(v,E,2,C-I,f,D),vl(v,E,3,C-N,f,D)}function Jg(f,m,v,E,C){Qh(f,m,v,E),C&&Qh(f,m+16,v,E+4)}function Ku(f,m,v,E){Nl(f,m+0,v,E,1),Nl(f,m+32,v,E+128,1)}function Qg(f,m,v,E){var C;for(f=f[m+0]+4,C=0;4>C;++C)for(m=0;4>m;++m)Jr(v,E,m,C,f)}function Zu(f,m,v,E){f[m+0]&&rs(f,m+0,v,E),f[m+16]&&rs(f,m+16,v,E+4),f[m+32]&&rs(f,m+32,v,E+128),f[m+48]&&rs(f,m+48,v,E+128+4)}function t0(f,m,v,E){var C,I=s(16);for(C=0;4>C;++C){var N=f[m+0+C]+f[m+12+C],D=f[m+4+C]+f[m+8+C],B=f[m+4+C]-f[m+8+C],z=f[m+0+C]-f[m+12+C];I[0+C]=N+D,I[8+C]=N-D,I[4+C]=z+B,I[12+C]=z-B}for(C=0;4>C;++C)N=(f=I[0+4*C]+3)+I[3+4*C],D=I[1+4*C]+I[2+4*C],B=I[1+4*C]-I[2+4*C],z=f-I[3+4*C],v[E+0]=N+D>>3,v[E+16]=z+B>>3,v[E+32]=N-D>>3,v[E+48]=z-B>>3,E+=64}function tc(f,m,v){var E,C=m-32,I=vr,N=255-f[C-1];for(E=0;E<v;++E){var D,B=I,z=N+f[m-1];for(D=0;D<v;++D)f[m+D]=B[z+f[C+D]];m+=32}}function e0(f,m){tc(f,m,4)}function i0(f,m){tc(f,m,8)}function n0(f,m){tc(f,m,16)}function Js(f,m){var v;for(v=0;16>v;++v)i(f,m+32*v,f,m-32,16)}function wl(f,m){var v;for(v=16;0<v;--v)r(f,m,f[m-1],16),m+=32}function xl(f,m,v){var E;for(E=0;16>E;++E)r(m,v+32*E,f,16)}function Ju(f,m){var v,E=16;for(v=0;16>v;++v)E+=f[m-1+32*v]+f[m+v-32];xl(E>>5,f,m)}function Cn(f,m){var v,E=8;for(v=0;16>v;++v)E+=f[m-1+32*v];xl(E>>4,f,m)}function r0(f,m){var v,E=8;for(v=0;16>v;++v)E+=f[m+v-32];xl(E>>4,f,m)}function Qu(f,m){xl(128,f,m)}function ye(f,m,v){return f+2*m+v+2>>2}function s0(f,m){var v,E=m-32;for(E=new Uint8Array([ye(f[E-1],f[E+0],f[E+1]),ye(f[E+0],f[E+1],f[E+2]),ye(f[E+1],f[E+2],f[E+3]),ye(f[E+2],f[E+3],f[E+4])]),v=0;4>v;++v)i(f,m+32*v,E,0,E.length)}function a0(f,m){var v=f[m-1],E=f[m-1+32],C=f[m-1+64],I=f[m-1+96];Lt(f,m+0,16843009*ye(f[m-1-32],v,E)),Lt(f,m+32,16843009*ye(v,E,C)),Lt(f,m+64,16843009*ye(E,C,I)),Lt(f,m+96,16843009*ye(C,I,I))}function bs(f,m){var v,E=4;for(v=0;4>v;++v)E+=f[m+v-32]+f[m-1+32*v];for(E>>=3,v=0;4>v;++v)r(f,m+32*v,E,4)}function tf(f,m){var v=f[m-1+0],E=f[m-1+32],C=f[m-1+64],I=f[m-1-32],N=f[m+0-32],D=f[m+1-32],B=f[m+2-32],z=f[m+3-32];f[m+0+96]=ye(E,C,f[m-1+96]),f[m+1+96]=f[m+0+64]=ye(v,E,C),f[m+2+96]=f[m+1+64]=f[m+0+32]=ye(I,v,E),f[m+3+96]=f[m+2+64]=f[m+1+32]=f[m+0+0]=ye(N,I,v),f[m+3+64]=f[m+2+32]=f[m+1+0]=ye(D,N,I),f[m+3+32]=f[m+2+0]=ye(B,D,N),f[m+3+0]=ye(z,B,D)}function ef(f,m){var v=f[m+1-32],E=f[m+2-32],C=f[m+3-32],I=f[m+4-32],N=f[m+5-32],D=f[m+6-32],B=f[m+7-32];f[m+0+0]=ye(f[m+0-32],v,E),f[m+1+0]=f[m+0+32]=ye(v,E,C),f[m+2+0]=f[m+1+32]=f[m+0+64]=ye(E,C,I),f[m+3+0]=f[m+2+32]=f[m+1+64]=f[m+0+96]=ye(C,I,N),f[m+3+32]=f[m+2+64]=f[m+1+96]=ye(I,N,D),f[m+3+64]=f[m+2+96]=ye(N,D,B),f[m+3+96]=ye(D,B,B)}function bl(f,m){var v=f[m-1+0],E=f[m-1+32],C=f[m-1+64],I=f[m-1-32],N=f[m+0-32],D=f[m+1-32],B=f[m+2-32],z=f[m+3-32];f[m+0+0]=f[m+1+64]=I+N+1>>1,f[m+1+0]=f[m+2+64]=N+D+1>>1,f[m+2+0]=f[m+3+64]=D+B+1>>1,f[m+3+0]=B+z+1>>1,f[m+0+96]=ye(C,E,v),f[m+0+64]=ye(E,v,I),f[m+0+32]=f[m+1+96]=ye(v,I,N),f[m+1+32]=f[m+2+96]=ye(I,N,D),f[m+2+32]=f[m+3+96]=ye(N,D,B),f[m+3+32]=ye(D,B,z)}function ec(f,m){var v=f[m+0-32],E=f[m+1-32],C=f[m+2-32],I=f[m+3-32],N=f[m+4-32],D=f[m+5-32],B=f[m+6-32],z=f[m+7-32];f[m+0+0]=v+E+1>>1,f[m+1+0]=f[m+0+64]=E+C+1>>1,f[m+2+0]=f[m+1+64]=C+I+1>>1,f[m+3+0]=f[m+2+64]=I+N+1>>1,f[m+0+32]=ye(v,E,C),f[m+1+32]=f[m+0+96]=ye(E,C,I),f[m+2+32]=f[m+1+96]=ye(C,I,N),f[m+3+32]=f[m+2+96]=ye(I,N,D),f[m+3+64]=ye(N,D,B),f[m+3+96]=ye(D,B,z)}function o0(f,m){var v=f[m-1+0],E=f[m-1+32],C=f[m-1+64],I=f[m-1+96];f[m+0+0]=v+E+1>>1,f[m+2+0]=f[m+0+32]=E+C+1>>1,f[m+2+32]=f[m+0+64]=C+I+1>>1,f[m+1+0]=ye(v,E,C),f[m+3+0]=f[m+1+32]=ye(E,C,I),f[m+3+32]=f[m+1+64]=ye(C,I,I),f[m+3+64]=f[m+2+64]=f[m+0+96]=f[m+1+96]=f[m+2+96]=f[m+3+96]=I}function l0(f,m){var v=f[m-1+0],E=f[m-1+32],C=f[m-1+64],I=f[m-1+96],N=f[m-1-32],D=f[m+0-32],B=f[m+1-32],z=f[m+2-32];f[m+0+0]=f[m+2+32]=v+N+1>>1,f[m+0+32]=f[m+2+64]=E+v+1>>1,f[m+0+64]=f[m+2+96]=C+E+1>>1,f[m+0+96]=I+C+1>>1,f[m+3+0]=ye(D,B,z),f[m+2+0]=ye(N,D,B),f[m+1+0]=f[m+3+32]=ye(v,N,D),f[m+1+32]=f[m+3+64]=ye(E,v,N),f[m+1+64]=f[m+3+96]=ye(C,E,v),f[m+1+96]=ye(I,C,E)}function h0(f,m){var v;for(v=0;8>v;++v)i(f,m+32*v,f,m-32,8)}function ic(f,m){var v;for(v=0;8>v;++v)r(f,m,f[m-1],8),m+=32}function So(f,m,v){var E;for(E=0;8>E;++E)r(m,v+32*E,f,8)}function Pa(f,m){var v,E=8;for(v=0;8>v;++v)E+=f[m+v-32]+f[m-1+32*v];So(E>>4,f,m)}function c0(f,m){var v,E=4;for(v=0;8>v;++v)E+=f[m+v-32];So(E>>3,f,m)}function Lo(f,m){var v,E=4;for(v=0;8>v;++v)E+=f[m-1+32*v];So(E>>3,f,m)}function nc(f,m){So(128,f,m)}function El(f,m,v){var E=f[m-v],C=f[m+0],I=3*(C-E)+y0[1020+f[m-2*v]-f[m+v]],N=ff[112+(I+4>>3)];f[m-v]=vr[255+E+ff[112+(I+3>>3)]],f[m+0]=vr[255+C-N]}function nf(f,m,v,E){var C=f[m+0],I=f[m+v];return Rr[255+f[m-2*v]-f[m-v]]>E||Rr[255+I-C]>E}function rf(f,m,v,E){return 4*Rr[255+f[m-v]-f[m+0]]+Rr[255+f[m-2*v]-f[m+v]]<=E}function sf(f,m,v,E,C){var I=f[m-3*v],N=f[m-2*v],D=f[m-v],B=f[m+0],z=f[m+v],et=f[m+2*v],ft=f[m+3*v];return 4*Rr[255+D-B]+Rr[255+N-z]>E?0:Rr[255+f[m-4*v]-I]<=C&&Rr[255+I-N]<=C&&Rr[255+N-D]<=C&&Rr[255+ft-et]<=C&&Rr[255+et-z]<=C&&Rr[255+z-B]<=C}function af(f,m,v,E){var C=2*E+1;for(E=0;16>E;++E)rf(f,m+E,v,C)&&El(f,m+E,v)}function Qs(f,m,v,E){var C=2*E+1;for(E=0;16>E;++E)rf(f,m+E*v,1,C)&&El(f,m+E*v,1)}function Ra(f,m,v,E){var C;for(C=3;0<C;--C)af(f,m+=4*v,v,E)}function u0(f,m,v,E){var C;for(C=3;0<C;--C)Qs(f,m+=4,v,E)}function Ia(f,m,v,E,C,I,N,D){for(I=2*I+1;0<C--;){if(sf(f,m,v,I,N))if(nf(f,m,v,D))El(f,m,v);else{var B=f,z=m,et=v,ft=B[z-2*et],dt=B[z-et],at=B[z+0],bt=B[z+et],_t=B[z+2*et],nt=27*(wt=y0[1020+3*(at-dt)+y0[1020+ft-bt]])+63>>7,rt=18*wt+63>>7,wt=9*wt+63>>7;B[z-3*et]=vr[255+B[z-3*et]+wt],B[z-2*et]=vr[255+ft+rt],B[z-et]=vr[255+dt+nt],B[z+0]=vr[255+at-nt],B[z+et]=vr[255+bt-rt],B[z+2*et]=vr[255+_t-wt]}m+=E}}function Qr(f,m,v,E,C,I,N,D){for(I=2*I+1;0<C--;){if(sf(f,m,v,I,N))if(nf(f,m,v,D))El(f,m,v);else{var B=f,z=m,et=v,ft=B[z-et],dt=B[z+0],at=B[z+et],bt=ff[112+((_t=3*(dt-ft))+4>>3)],_t=ff[112+(_t+3>>3)],nt=bt+1>>1;B[z-2*et]=vr[255+B[z-2*et]+nt],B[z-et]=vr[255+ft+_t],B[z+0]=vr[255+dt-bt],B[z+et]=vr[255+at-nt]}m+=E}}function rc(f,m,v,E,C,I){Ia(f,m,v,1,16,E,C,I)}function Co(f,m,v,E,C,I){Ia(f,m,1,v,16,E,C,I)}function f0(f,m,v,E,C,I){var N;for(N=3;0<N;--N)Qr(f,m+=4*v,v,1,16,E,C,I)}function Sl(f,m,v,E,C,I){var N;for(N=3;0<N;--N)Qr(f,m+=4,1,v,16,E,C,I)}function d0(f,m,v,E,C,I,N,D){Ia(f,m,C,1,8,I,N,D),Ia(v,E,C,1,8,I,N,D)}function sc(f,m,v,E,C,I,N,D){Ia(f,m,1,C,8,I,N,D),Ia(v,E,1,C,8,I,N,D)}function ac(f,m,v,E,C,I,N,D){Qr(f,m+4*C,C,1,8,I,N,D),Qr(v,E+4*C,C,1,8,I,N,D)}function of(f,m,v,E,C,I,N,D){Qr(f,m+4,1,C,8,I,N,D),Qr(v,E+4,1,C,8,I,N,D)}function Ll(){this.ba=new wn,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new xi,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function oc(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function lc(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function lf(){this.ua=0,this.Wa=new Y,this.vb=new Y,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new G,this.yc=new M}function g0(){this.xb=this.a=0,this.l=new yl,this.ca=new wn,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new S,this.Pb=0,this.wd=new S,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new lf,this.ab=0,this.gc=a(4,lc),this.Oc=0}function Cl(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new yl,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ao(f,m,v,E,C,I,N){for(f=f==null?0:f[m+0],m=0;m<N;++m)C[I+m]=f+v[E+m]&255,f=C[I+m]}function hc(f,m,v,E,C,I,N){var D;if(f==null)Ao(null,null,v,E,C,I,N);else for(D=0;D<N;++D)C[I+D]=f[m+D]+v[E+D]&255}function Na(f,m,v,E,C,I,N){if(f==null)Ao(null,null,v,E,C,I,N);else{var D,B=f[m+0],z=B,et=B;for(D=0;D<N;++D)z=et+(B=f[m+D])-z,et=v[E+D]+(-256&z?0>z?0:255:z)&255,z=B,C[I+D]=et}}function cc(f,m,v,E){var C=m.width,I=m.o;if(t(f!=null&&m!=null),0>v||0>=E||v+E>I)return null;if(!f.Cc){if(f.ga==null){var N;if(f.ga=new Cl,(N=f.ga==null)||(N=m.width*m.o,t(f.Gb.length==0),f.Gb=s(N),f.Uc=0,f.Gb==null?N=0:(f.mb=f.Gb,f.nb=f.Uc,f.rc=null,N=1),N=!N),!N){N=f.ga;var D=f.Fa,B=f.P,z=f.qc,et=f.mb,ft=f.nb,dt=B+1,at=z-1,bt=N.l;if(t(D!=null&&et!=null&&m!=null),ja[0]=null,ja[1]=Ao,ja[2]=hc,ja[3]=Na,N.ca=et,N.tb=ft,N.c=m.width,N.i=m.height,t(0<N.c&&0<N.i),1>=z)m=0;else if(N.$a=D[B+0]>>0&3,N.Z=D[B+0]>>2&3,N.Lc=D[B+0]>>4&3,B=D[B+0]>>6&3,0>N.$a||1<N.$a||4<=N.Z||1<N.Lc||B)m=0;else if(bt.put=Di,bt.ac=Ze,bt.bc=Ci,bt.ma=N,bt.width=m.width,bt.height=m.height,bt.Da=m.Da,bt.v=m.v,bt.va=m.va,bt.j=m.j,bt.o=m.o,N.$a)t:{t(N.$a==1),m=Tr();e:for(;;){if(m==null){m=0;break t}if(t(N!=null),N.mc=m,m.c=N.c,m.i=N.i,m.l=N.l,m.l.ma=N,m.l.width=N.c,m.l.height=N.i,m.a=0,J(m.m,D,dt,at),!xs(N.c,N.i,1,m,null)||(m.ab==1&&m.gc[0].hc==3&&Zs(m.s)?(N.ic=1,D=m.c*m.i,m.Ta=null,m.Ua=0,m.V=s(D),m.Ba=0,m.V==null?(m.a=1,m=0):m=1):(N.ic=0,m=Eo(m,N.c)),!m))break e;m=1;break t}N.mc=null,m=0}else m=at>=N.c*N.i;N=!m}if(N)return null;f.ga.Lc!=1?f.Ga=0:E=I-v}t(f.ga!=null),t(v+E<=I);t:{if(m=(D=f.ga).c,I=D.l.o,D.$a==0){if(dt=f.rc,at=f.Vc,bt=f.Fa,B=f.P+1+v*m,z=f.mb,et=f.nb+v*m,t(B<=f.P+f.qc),D.Z!=0)for(t(ja[D.Z]!=null),N=0;N<E;++N)ja[D.Z](dt,at,bt,B,z,et,m),dt=z,at=et,et+=m,B+=m;else for(N=0;N<E;++N)i(z,et,bt,B,m),dt=z,at=et,et+=m,B+=m;f.rc=dt,f.Vc=at}else{if(t(D.mc!=null),m=v+E,t((N=D.mc)!=null),t(m<=N.i),N.C>=m)m=1;else if(D.ic||ot(),D.ic){D=N.V,dt=N.Ba,at=N.c;var _t=N.i,nt=(bt=1,B=N.$/at,z=N.$%at,et=N.m,ft=N.s,N.$),rt=at*_t,wt=at*m,St=ft.wc,xt=nt<wt?Ri(ft,z,B):null;t(nt<=rt),t(m<=_t),t(Zs(ft));e:for(;;){for(;!et.h&&nt<wt;){if(z&St||(xt=Ri(ft,z,B)),t(xt!=null),st(et),256>(_t=Je(xt.G[0],xt.H[0],et)))D[dt+nt]=_t,++nt,++z>=at&&(z=0,++B<=m&&!(B%16)&&Kr(N,B));else{if(!(280>_t)){bt=0;break e}_t=Bi(_t-256,et);var qt,Ft=Je(xt.G[4],xt.H[4],et);if(st(et),!(nt>=(Ft=je(at,Ft=Bi(Ft,et)))&&rt-nt>=_t)){bt=0;break e}for(qt=0;qt<_t;++qt)D[dt+nt+qt]=D[dt+nt+qt-Ft];for(nt+=_t,z+=_t;z>=at;)z-=at,++B<=m&&!(B%16)&&Kr(N,B);nt<wt&&z&St&&(xt=Ri(ft,z,B))}t(et.h==H(et))}Kr(N,B>m?m:B);break e}!bt||et.h&&nt<rt?(bt=0,N.a=et.h?5:3):N.$=nt,m=bt}else m=Zr(N,N.V,N.Ba,N.c,N.i,m,dl);if(!m){E=0;break t}}v+E>=I&&(f.Cc=1),E=1}if(!E)return null;if(f.Cc&&((E=f.ga)!=null&&(E.mc=null),f.ga=null,0<f.Ga))return alert("todo:WebPDequantizeLevels"),null}return f.nb+v*C}function _(f,m,v,E,C,I){for(;0<C--;){var N,D=f,B=m+(v?1:0),z=f,et=m+(v?0:3);for(N=0;N<E;++N){var ft=z[et+4*N];ft!=255&&(ft*=32897,D[B+4*N+0]=D[B+4*N+0]*ft>>23,D[B+4*N+1]=D[B+4*N+1]*ft>>23,D[B+4*N+2]=D[B+4*N+2]*ft>>23)}m+=I}}function A(f,m,v,E,C){for(;0<E--;){var I;for(I=0;I<v;++I){var N=f[m+2*I+0],D=15&(z=f[m+2*I+1]),B=4369*D,z=(240&z|z>>4)*B>>16;f[m+2*I+0]=(240&N|N>>4)*B>>16&240|(15&N|N<<4)*B>>16>>4&15,f[m+2*I+1]=240&z|D}m+=C}}function V(f,m,v,E,C,I,N,D){var B,z,et=255;for(z=0;z<C;++z){for(B=0;B<E;++B){var ft=f[m+B];I[N+4*B]=ft,et&=ft}m+=v,N+=D}return et!=255}function Q(f,m,v,E,C){var I;for(I=0;I<C;++I)v[E+I]=f[m+I]>>8}function ot(){Ba=_,kl=A,uf=V,L_=Q}function yt(f,m,v){T[f]=function(E,C,I,N,D,B,z,et,ft,dt,at,bt,_t,nt,rt,wt,St){var xt,qt=St-1>>1,Ft=D[B+0]|z[et+0]<<16,ne=ft[dt+0]|at[bt+0]<<16;t(E!=null);var Ot=3*Ft+ne+131074>>2;for(m(E[C+0],255&Ot,Ot>>16,_t,nt),I!=null&&(Ot=3*ne+Ft+131074>>2,m(I[N+0],255&Ot,Ot>>16,rt,wt)),xt=1;xt<=qt;++xt){var We=D[B+xt]|z[et+xt]<<16,ni=ft[dt+xt]|at[bt+xt]<<16,Ue=Ft+We+ne+ni+524296,Re=Ue+2*(We+ne)>>3;Ot=Re+Ft>>1,Ft=(Ue=Ue+2*(Ft+ni)>>3)+We>>1,m(E[C+2*xt-1],255&Ot,Ot>>16,_t,nt+(2*xt-1)*v),m(E[C+2*xt-0],255&Ft,Ft>>16,_t,nt+(2*xt-0)*v),I!=null&&(Ot=Ue+ne>>1,Ft=Re+ni>>1,m(I[N+2*xt-1],255&Ot,Ot>>16,rt,wt+(2*xt-1)*v),m(I[N+2*xt+0],255&Ft,Ft>>16,rt,wt+(2*xt+0)*v)),Ft=We,ne=ni}1&St||(Ot=3*Ft+ne+131074>>2,m(E[C+St-1],255&Ot,Ot>>16,_t,nt+(St-1)*v),I!=null&&(Ot=3*ne+Ft+131074>>2,m(I[N+St-1],255&Ot,Ot>>16,rt,wt+(St-1)*v)))}}function At(){Ir[df]=Cb,Ir[gf]=O_,Ir[R_]=Ab,Ir[mf]=D_,Ir[pf]=B_,Ir[v0]=G_,Ir[I_]=Tb,Ir[w0]=O_,Ir[x0]=D_,Ir[_f]=B_,Ir[b0]=G_}function zt(f){return f&~Mb?0>f?0:255:f>>j_}function te(f,m){return zt((19077*f>>8)+(26149*m>>8)-14234)}function Le(f,m,v){return zt((19077*f>>8)-(6419*m>>8)-(13320*v>>8)+8708)}function Me(f,m){return zt((19077*f>>8)+(33050*m>>8)-17685)}function De(f,m,v,E,C){E[C+0]=te(f,v),E[C+1]=Le(f,m,v),E[C+2]=Me(f,m)}function Ai(f,m,v,E,C){E[C+0]=Me(f,m),E[C+1]=Le(f,m,v),E[C+2]=te(f,v)}function Ii(f,m,v,E,C){var I=Le(f,m,v);m=I<<3&224|Me(f,m)>>3,E[C+0]=248&te(f,v)|I>>5,E[C+1]=m}function Hi(f,m,v,E,C){var I=240&Me(f,m)|15;E[C+0]=240&te(f,v)|Le(f,m,v)>>4,E[C+1]=I}function An(f,m,v,E,C){E[C+0]=255,De(f,m,v,E,C+1)}function hn(f,m,v,E,C){Ai(f,m,v,E,C),E[C+3]=255}function ts(f,m,v,E,C){De(f,m,v,E,C),E[C+3]=255}function yr(f,m){return 0>f?0:f>m?m:f}function ta(f,m,v){T[f]=function(E,C,I,N,D,B,z,et,ft){for(var dt=et+(-2&ft)*v;et!=dt;)m(E[C+0],I[N+0],D[B+0],z,et),m(E[C+1],I[N+0],D[B+0],z,et+v),C+=2,++N,++B,et+=2*v;1&ft&&m(E[C+0],I[N+0],D[B+0],z,et)}}function hf(f,m,v){return v==0?f==0?m==0?6:5:m==0?4:0:v}function uc(f,m,v,E,C){switch(f>>>30){case 3:Nl(m,v,E,C,0);break;case 2:yc(m,v,E,C);break;case 1:rs(m,v,E,C)}}function fc(f,m){var v,E,C=m.M,I=m.Nb,N=f.oc,D=f.pc+40,B=f.oc,z=f.pc+584,et=f.oc,ft=f.pc+600;for(v=0;16>v;++v)N[D+32*v-1]=129;for(v=0;8>v;++v)B[z+32*v-1]=129,et[ft+32*v-1]=129;for(0<C?N[D-1-32]=B[z-1-32]=et[ft-1-32]=129:(r(N,D-32-1,127,21),r(B,z-32-1,127,9),r(et,ft-32-1,127,9)),E=0;E<f.za;++E){var dt=m.ya[m.aa+E];if(0<E){for(v=-1;16>v;++v)i(N,D+32*v-4,N,D+32*v+12,4);for(v=-1;8>v;++v)i(B,z+32*v-4,B,z+32*v+4,4),i(et,ft+32*v-4,et,ft+32*v+4,4)}var at=f.Gd,bt=f.Hd+E,_t=dt.ad,nt=dt.Hc;if(0<C&&(i(N,D-32,at[bt].y,0,16),i(B,z-32,at[bt].f,0,8),i(et,ft-32,at[bt].ea,0,8)),dt.Za){var rt=N,wt=D-32+16;for(0<C&&(E>=f.za-1?r(rt,wt,at[bt].y[15],4):i(rt,wt,at[bt+1].y,0,4)),v=0;4>v;v++)rt[wt+128+v]=rt[wt+256+v]=rt[wt+384+v]=rt[wt+0+v];for(v=0;16>v;++v,nt<<=2)rt=N,wt=D+z_[v],ss[dt.Ob[v]](rt,wt),uc(nt,_t,16*+v,rt,wt)}else if(rt=hf(E,C,dt.Ob[0]),Ga[rt](N,D),nt!=0)for(v=0;16>v;++v,nt<<=2)uc(nt,_t,16*+v,N,D+z_[v]);for(v=dt.Gc,rt=hf(E,C,dt.Dd),sa[rt](B,z),sa[rt](et,ft),nt=_t,rt=B,wt=z,255&(dt=v>>0)&&(170&dt?Oa(nt,256,rt,wt):ia(nt,256,rt,wt)),dt=et,nt=ft,255&(v>>=8)&&(170&v?Oa(_t,320,dt,nt):ia(_t,320,dt,nt)),C<f.Ub-1&&(i(at[bt].y,0,N,D+480,16),i(at[bt].f,0,B,z+224,8),i(at[bt].ea,0,et,ft+224,8)),v=8*I*f.B,at=f.sa,bt=f.ta+16*E+16*I*f.R,_t=f.qa,dt=f.ra+8*E+v,nt=f.Ha,rt=f.Ia+8*E+v,v=0;16>v;++v)i(at,bt+v*f.R,N,D+32*v,16);for(v=0;8>v;++v)i(_t,dt+v*f.B,B,z+32*v,8),i(nt,rt+v*f.B,et,ft+32*v,8)}}function Al(f,m,v,E,C,I,N,D,B){var z=[0],et=[0],ft=0,dt=B!=null?B.kd:0,at=B??new oc;if(f==null||12>v)return 7;at.data=f,at.w=m,at.ha=v,m=[m],v=[v],at.gb=[at.gb];t:{var bt=m,_t=v,nt=at.gb;if(t(f!=null),t(_t!=null),t(nt!=null),nt[0]=0,12<=_t[0]&&!e(f,bt[0],"RIFF")){if(e(f,bt[0]+8,"WEBP")){nt=3;break t}var rt=Gt(f,bt[0]+4);if(12>rt||4294967286<rt){nt=3;break t}if(dt&&rt>_t[0]-8){nt=7;break t}nt[0]=rt,bt[0]+=12,_t[0]-=12}nt=0}if(nt!=0)return nt;for(rt=0<at.gb[0],v=v[0];;){t:{var wt=f;_t=m,nt=v;var St=z,xt=et,qt=bt=[0];if((Ot=ft=[ft])[0]=0,8>nt[0])nt=7;else{if(!e(wt,_t[0],"VP8X")){if(Gt(wt,_t[0]+4)!=10){nt=3;break t}if(18>nt[0]){nt=7;break t}var Ft=Gt(wt,_t[0]+8),ne=1+Bt(wt,_t[0]+12);if(2147483648<=ne*(wt=1+Bt(wt,_t[0]+15))){nt=3;break t}qt!=null&&(qt[0]=Ft),St!=null&&(St[0]=ne),xt!=null&&(xt[0]=wt),_t[0]+=18,nt[0]-=18,Ot[0]=1}nt=0}}if(ft=ft[0],bt=bt[0],nt!=0)return nt;if(_t=!!(2&bt),!rt&&ft)return 3;if(I!=null&&(I[0]=!!(16&bt)),N!=null&&(N[0]=_t),D!=null&&(D[0]=0),N=z[0],bt=et[0],ft&&_t&&B==null){nt=0;break}if(4>v){nt=7;break}if(rt&&ft||!rt&&!ft&&!e(f,m[0],"ALPH")){v=[v],at.na=[at.na],at.P=[at.P],at.Sa=[at.Sa];t:{Ft=f,nt=m,rt=v;var Ot=at.gb;St=at.na,xt=at.P,qt=at.Sa,ne=22,t(Ft!=null),t(rt!=null),wt=nt[0];var We=rt[0];for(t(St!=null),t(qt!=null),St[0]=null,xt[0]=null,qt[0]=0;;){if(nt[0]=wt,rt[0]=We,8>We){nt=7;break t}var ni=Gt(Ft,wt+4);if(4294967286<ni){nt=3;break t}var Ue=8+ni+1&-2;if(ne+=Ue,0<Ot&&ne>Ot){nt=3;break t}if(!e(Ft,wt,"VP8 ")||!e(Ft,wt,"VP8L")){nt=0;break t}if(We[0]<Ue){nt=7;break t}e(Ft,wt,"ALPH")||(St[0]=Ft,xt[0]=wt+8,qt[0]=ni),wt+=Ue,We-=Ue}}if(v=v[0],at.na=at.na[0],at.P=at.P[0],at.Sa=at.Sa[0],nt!=0)break}v=[v],at.Ja=[at.Ja],at.xa=[at.xa];t:if(Ot=f,nt=m,rt=v,St=at.gb[0],xt=at.Ja,qt=at.xa,Ft=nt[0],wt=!e(Ot,Ft,"VP8 "),ne=!e(Ot,Ft,"VP8L"),t(Ot!=null),t(rt!=null),t(xt!=null),t(qt!=null),8>rt[0])nt=7;else{if(wt||ne){if(Ot=Gt(Ot,Ft+4),12<=St&&Ot>St-12){nt=3;break t}if(dt&&Ot>rt[0]-8){nt=7;break t}xt[0]=Ot,nt[0]+=8,rt[0]-=8,qt[0]=ne}else qt[0]=5<=rt[0]&&Ot[Ft+0]==47&&!(Ot[Ft+4]>>5),xt[0]=rt[0];nt=0}if(v=v[0],at.Ja=at.Ja[0],at.xa=at.xa[0],m=m[0],nt!=0)break;if(4294967286<at.Ja)return 3;if(D==null||_t||(D[0]=at.xa?2:1),N=[N],bt=[bt],at.xa){if(5>v){nt=7;break}D=N,dt=bt,_t=I,f==null||5>v?f=0:5<=v&&f[m+0]==47&&!(f[m+4]>>5)?(rt=[0],Ot=[0],St=[0],J(xt=new S,f,m,v),Kt(xt,rt,Ot,St)?(D!=null&&(D[0]=rt[0]),dt!=null&&(dt[0]=Ot[0]),_t!=null&&(_t[0]=St[0]),f=1):f=0):f=0}else{if(10>v){nt=7;break}D=bt,f==null||10>v||!Hu(f,m+3,v-3)?f=0:(dt=f[m+0]|f[m+1]<<8|f[m+2]<<16,_t=16383&(f[m+7]<<8|f[m+6]),f=16383&(f[m+9]<<8|f[m+8]),1&dt||3<(dt>>1&7)||!(dt>>4&1)||dt>>5>=at.Ja||!_t||!f?f=0:(N&&(N[0]=_t),D&&(D[0]=f),f=1))}if(!f||(N=N[0],bt=bt[0],ft&&(z[0]!=N||et[0]!=bt)))return 3;B!=null&&(B[0]=at,B.offset=m-B.w,t(4294967286>m-B.w),t(B.offset==B.ha-v));break}return nt==0||nt==7&&ft&&B==null?(I!=null&&(I[0]|=at.na!=null&&0<at.na.length),E!=null&&(E[0]=N),C!=null&&(C[0]=bt),0):nt}function dc(f,m,v){var E=m.width,C=m.height,I=0,N=0,D=E,B=C;if(m.Da=f!=null&&0<f.Da,m.Da&&(D=f.cd,B=f.bd,I=f.v,N=f.j,11>v||(I&=-2,N&=-2),0>I||0>N||0>=D||0>=B||I+D>E||N+B>C))return 0;if(m.v=I,m.j=N,m.va=I+D,m.o=N+B,m.U=D,m.T=B,m.da=f!=null&&0<f.da,m.da){if(!se(D,B,v=[f.ib],I=[f.hb]))return 0;m.ib=v[0],m.hb=I[0]}return m.ob=f!=null&&f.ob,m.Kb=f==null||!f.Sd,m.da&&(m.ob=m.ib<3*E/4&&m.hb<3*C/4,m.Kb=0),1}function gc(f){if(f==null)return 2;if(11>f.S){var m=f.f.RGBA;m.fb+=(f.height-1)*m.A,m.A=-m.A}else m=f.f.kb,f=f.height,m.O+=(f-1)*m.fa,m.fa=-m.fa,m.N+=(f-1>>1)*m.Ab,m.Ab=-m.Ab,m.W+=(f-1>>1)*m.Db,m.Db=-m.Db,m.F!=null&&(m.J+=(f-1)*m.lb,m.lb=-m.lb);return 0}function Tl(f,m,v,E){if(E==null||0>=f||0>=m)return 2;if(v!=null){if(v.Da){var C=v.cd,I=v.bd,N=-2&v.v,D=-2&v.j;if(0>N||0>D||0>=C||0>=I||N+C>f||D+I>m)return 2;f=C,m=I}if(v.da){if(!se(f,m,C=[v.ib],I=[v.hb]))return 2;f=C[0],m=I[0]}}E.width=f,E.height=m;t:{var B=E.width,z=E.height;if(f=E.S,0>=B||0>=z||!(f>=df&&13>f))f=2;else{if(0>=E.Rd&&E.sd==null){N=I=C=m=0;var et=(D=B*q_[f])*z;if(11>f||(I=(z+1)/2*(m=(B+1)/2),f==12&&(N=(C=B)*z)),(z=s(et+2*I+N))==null){f=1;break t}E.sd=z,11>f?((B=E.f.RGBA).eb=z,B.fb=0,B.A=D,B.size=et):((B=E.f.kb).y=z,B.O=0,B.fa=D,B.Fd=et,B.f=z,B.N=0+et,B.Ab=m,B.Cd=I,B.ea=z,B.W=0+et+I,B.Db=m,B.Ed=I,f==12&&(B.F=z,B.J=0+et+2*I),B.Tc=N,B.lb=C)}if(m=1,C=E.S,I=E.width,N=E.height,C>=df&&13>C)if(11>C)f=E.f.RGBA,m&=(D=Math.abs(f.A))*(N-1)+I<=f.size,m&=D>=I*q_[C],m&=f.eb!=null;else{f=E.f.kb,D=(I+1)/2,et=(N+1)/2,B=Math.abs(f.fa),z=Math.abs(f.Ab);var ft=Math.abs(f.Db),dt=Math.abs(f.lb),at=dt*(N-1)+I;m&=B*(N-1)+I<=f.Fd,m&=z*(et-1)+D<=f.Cd,m=(m&=ft*(et-1)+D<=f.Ed)&B>=I&z>=D&ft>=D,m&=f.y!=null,m&=f.f!=null,m&=f.ea!=null,C==12&&(m&=dt>=I,m&=at<=f.Tc,m&=f.F!=null)}else m=0;f=m?0:2}}return f!=0||v!=null&&v.fd&&(f=gc(E)),f}var ir=64,Ml=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Pl=24,Rl=32,mc=8,nr=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Pt("Predictor0","PredictorAdd0"),T.Predictor0=function(){return 4278190080},T.Predictor1=function(f){return f},T.Predictor2=function(f,m,v){return m[v+0]},T.Predictor3=function(f,m,v){return m[v+1]},T.Predictor4=function(f,m,v){return m[v-1]},T.Predictor5=function(f,m,v){return Rt(Rt(f,m[v+1]),m[v+0])},T.Predictor6=function(f,m,v){return Rt(f,m[v-1])},T.Predictor7=function(f,m,v){return Rt(f,m[v+0])},T.Predictor8=function(f,m,v){return Rt(m[v-1],m[v+0])},T.Predictor9=function(f,m,v){return Rt(m[v+0],m[v+1])},T.Predictor10=function(f,m,v){return Rt(Rt(f,m[v-1]),Rt(m[v+0],m[v+1]))},T.Predictor11=function(f,m,v){var E=m[v+0];return 0>=_e(E>>24&255,f>>24&255,(m=m[v-1])>>24&255)+_e(E>>16&255,f>>16&255,m>>16&255)+_e(E>>8&255,f>>8&255,m>>8&255)+_e(255&E,255&f,255&m)?E:f},T.Predictor12=function(f,m,v){var E=m[v+0];return(Ut((f>>24&255)+(E>>24&255)-((m=m[v-1])>>24&255))<<24|Ut((f>>16&255)+(E>>16&255)-(m>>16&255))<<16|Ut((f>>8&255)+(E>>8&255)-(m>>8&255))<<8|Ut((255&f)+(255&E)-(255&m)))>>>0},T.Predictor13=function(f,m,v){var E=m[v-1];return(ce((f=Rt(f,m[v+0]))>>24&255,E>>24&255)<<24|ce(f>>16&255,E>>16&255)<<16|ce(f>>8&255,E>>8&255)<<8|ce(f>>0&255,E>>0&255))>>>0};var m0=T.PredictorAdd0;T.PredictorAdd1=Ee,Pt("Predictor2","PredictorAdd2"),Pt("Predictor3","PredictorAdd3"),Pt("Predictor4","PredictorAdd4"),Pt("Predictor5","PredictorAdd5"),Pt("Predictor6","PredictorAdd6"),Pt("Predictor7","PredictorAdd7"),Pt("Predictor8","PredictorAdd8"),Pt("Predictor9","PredictorAdd9"),Pt("Predictor10","PredictorAdd10"),Pt("Predictor11","PredictorAdd11"),Pt("Predictor12","PredictorAdd12"),Pt("Predictor13","PredictorAdd13");var pc=T.PredictorAdd2;Te("ColorIndexInverseTransform","MapARGB","32b",function(f){return f>>8&255},function(f){return f}),Te("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(f){return f},function(f){return f>>8&255});var cf,es=T.ColorIndexInverseTransform,_c=T.MapARGB,p0=T.VP8LColorIndexInverseTransformAlpha,_0=T.MapAlpha,Fa=T.VP8LPredictorsAdd=[];Fa.length=16,(T.VP8LPredictors=[]).length=16,(T.VP8LPredictorsAdd_C=[]).length=16,(T.VP8LPredictors_C=[]).length=16;var Mr,is,ka,Es,ea,Il,ns,Nl,yc,Oa,rs,ia,To,Fl,Mo,Da,vc,Pr,na,_i,yi,ji,tn,ra,Ba,kl,uf,L_,C_=s(511),A_=s(2041),T_=s(225),M_=s(767),P_=0,y0=A_,ff=T_,vr=M_,Rr=C_,df=0,gf=1,R_=2,mf=3,pf=4,v0=5,I_=6,w0=7,x0=8,_f=9,b0=10,fb=[2,3,7],db=[3,3,11],N_=[280,256,256,256,40],gb=[0,1,1,1,0],mb=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],pb=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],_b=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],yb=8,E0=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],S0=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],wc=null,vb=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],wb=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],F_=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],xb=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],bb=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Eb=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Sb=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ga=[],ss=[],sa=[],Lb=1,k_=2,ja=[],Ir=[];yt("UpsampleRgbLinePair",De,3),yt("UpsampleBgrLinePair",Ai,3),yt("UpsampleRgbaLinePair",ts,4),yt("UpsampleBgraLinePair",hn,4),yt("UpsampleArgbLinePair",An,4),yt("UpsampleRgba4444LinePair",Hi,2),yt("UpsampleRgb565LinePair",Ii,2);var Cb=T.UpsampleRgbLinePair,Ab=T.UpsampleBgrLinePair,O_=T.UpsampleRgbaLinePair,D_=T.UpsampleBgraLinePair,B_=T.UpsampleArgbLinePair,G_=T.UpsampleRgba4444LinePair,Tb=T.UpsampleRgb565LinePair,yf=16,vf=1<<yf-1,xc=-227,L0=482,j_=6,Mb=(256<<j_)-1,U_=0,Pb=s(256),Rb=s(256),Ib=s(256),Nb=s(256),Fb=s(L0-xc),kb=s(L0-xc);ta("YuvToRgbRow",De,3),ta("YuvToBgrRow",Ai,3),ta("YuvToRgbaRow",ts,4),ta("YuvToBgraRow",hn,4),ta("YuvToArgbRow",An,4),ta("YuvToRgba4444Row",Hi,2),ta("YuvToRgb565Row",Ii,2);var z_=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],wf=[0,2,8],Ob=[8,7,6,4,4,2,2,2,1,1,1,1],Db=1;this.WebPDecodeRGBA=function(f,m,v,E,C){var I=gf,N=new Ll,D=new wn;N.ba=D,D.S=I,D.width=[D.width],D.height=[D.height];var B=D.width,z=D.height,et=new Gn;if(et==null||f==null)var ft=2;else t(et!=null),ft=Al(f,m,v,et.width,et.height,et.Pd,et.Qd,et.format,null);if(ft!=0?B=0:(B!=null&&(B[0]=et.width[0]),z!=null&&(z[0]=et.height[0]),B=1),B){D.width=D.width[0],D.height=D.height[0],E!=null&&(E[0]=D.width),C!=null&&(C[0]=D.height);t:{if(E=new yl,(C=new oc).data=f,C.w=m,C.ha=v,C.kd=1,m=[0],t(C!=null),((f=Al(C.data,C.w,C.ha,null,null,null,m,null,C))==0||f==7)&&m[0]&&(f=4),(m=f)==0){if(t(N!=null),E.data=C.data,E.w=C.w+C.offset,E.ha=C.ha-C.offset,E.put=Di,E.ac=Ze,E.bc=Ci,E.ma=N,C.xa){if((f=Tr())==null){N=1;break t}if(function(dt,at){var bt=[0],_t=[0],nt=[0];e:for(;;){if(dt==null)return 0;if(at==null)return dt.a=2,0;if(dt.l=at,dt.a=0,J(dt.m,at.data,at.w,at.ha),!Kt(dt.m,bt,_t,nt)){dt.a=3;break e}if(dt.xb=k_,at.width=bt[0],at.height=_t[0],!xs(bt[0],_t[0],1,dt,null))break e;return 1}return t(dt.a!=0),0}(f,E)){if(E=(m=Tl(E.width,E.height,N.Oa,N.ba))==0){e:{E=f;i:for(;;){if(E==null){E=0;break e}if(t(E.s.yc!=null),t(E.s.Ya!=null),t(0<E.s.Wb),t((v=E.l)!=null),t((C=v.ma)!=null),E.xb!=0){if(E.ca=C.ba,E.tb=C.tb,t(E.ca!=null),!dc(C.Oa,v,mf)){E.a=2;break i}if(!Eo(E,v.width)||v.da)break i;if((v.da||qe(E.ca.S))&&ot(),11>E.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),E.ca.f.kb.F!=null&&ot()),E.Pb&&0<E.s.ua&&E.s.vb.X==null&&!Jt(E.s.vb,E.s.Wa.Xa)){E.a=1;break i}E.xb=0}if(!Zr(E,E.V,E.Ba,E.c,E.i,v.o,fl))break i;C.Dc=E.Ma,E=1;break e}t(E.a!=0),E=0}E=!E}E&&(m=f.a)}else m=f.a}else{if((f=new Kg)==null){N=1;break t}if(f.Fa=C.na,f.P=C.P,f.qc=C.Sa,$u(f,E)){if((m=Tl(E.width,E.height,N.Oa,N.ba))==0){if(f.Aa=0,v=N.Oa,t((C=f)!=null),v!=null){if(0<(B=0>(B=v.Md)?0:100<B?255:255*B/100)){for(z=et=0;4>z;++z)12>(ft=C.pb[z]).lc&&(ft.ia=B*Ob[0>ft.lc?0:ft.lc]>>3),et|=ft.ia;et&&(alert("todo:VP8InitRandom"),C.ia=1)}C.Ga=v.Id,100<C.Ga?C.Ga=100:0>C.Ga&&(C.Ga=0)}Zg(f,E)||(m=f.a)}}else m=f.a}m==0&&N.Oa!=null&&N.Oa.fd&&(m=gc(N.ba))}N=m}I=N!=0?null:11>I?D.f.RGBA.eb:D.f.kb.y}else I=null;return I};var q_=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function h(T,q){for(var W="",F=0;F<4;F++)W+=String.fromCharCode(T[q++]);return W}function c(T,q){return(T[q+0]<<0|T[q+1]<<8|T[q+2]<<16)>>>0}function u(T,q){return(T[q+0]<<0|T[q+1]<<8|T[q+2]<<16|T[q+3]<<24)>>>0}new l;var d=[0],g=[0],p=[],y=new l,w=n,x=function(T,q){var W={},F=0,M=!1,O=0,G=0;if(W.frames=[],!function(U,H,K,st){for(var ht=0;ht<st;ht++)if(U[H+ht]!=K.charCodeAt(ht))return!0;return!1}(T,q,"RIFF",4)){var tt,Z;for(u(T,q+=4),q+=8;q<T.length;){var it=h(T,q),J=u(T,q+=4);q+=4;var lt=J+(1&J);switch(it){case"VP8 ":case"VP8L":W.frames[F]===void 0&&(W.frames[F]={}),(S=W.frames[F]).src_off=M?G:q-8,S.src_size=O+J+8,F++,M&&(M=!1,O=0,G=0);break;case"VP8X":(S=W.header={}).feature_flags=T[q];var ct=q+4;S.canvas_width=1+c(T,ct),ct+=3,S.canvas_height=1+c(T,ct),ct+=3;break;case"ALPH":M=!0,O=lt+8,G=q-8;break;case"ANIM":(S=W.header).bgcolor=u(T,q),ct=q+4,S.loop_count=(tt=T)[(Z=ct)+0]<<0|tt[Z+1]<<8,ct+=2;break;case"ANMF":var Et,S;(S=W.frames[F]={}).offset_x=2*c(T,q),q+=3,S.offset_y=2*c(T,q),q+=3,S.width=1+c(T,q),q+=3,S.height=1+c(T,q),q+=3,S.duration=c(T,q),q+=3,Et=T[q++],S.dispose=1&Et,S.blend=Et>>1&1}it!="ANMF"&&(q+=lt)}return W}}(w,0);x.response=w,x.rgbaoutput=!0,x.dataurl=!1;var b=x.header?x.header:null,L=x.frames?x.frames:null;if(b){b.loop_counter=b.loop_count,d=[b.canvas_height],g=[b.canvas_width];for(var P=0;P<L.length&&L[P].blend!=0;P++);}var R=L[0],j=y.WebPDecodeRGBA(w,R.src_off,R.src_size,g,d);R.rgba=j,R.imgwidth=g[0],R.imgheight=d[0];for(var k=0;k<g[0]*d[0]*4;k++)p[k]=j[k];return this.width=g,this.height=d,this.data=p,this}(function(n){var t=function(){return typeof vp=="function"},e=function(d,g,p,y){var w=4,x=a;switch(y){case n.image_compression.FAST:w=1,x=s;break;case n.image_compression.MEDIUM:w=6,x=o;break;case n.image_compression.SLOW:w=9,x=l}d=i(d,g,p,x);var b=vp(d,{level:w});return n.__addimage__.arrayBufferToBinaryString(b)},i=function(d,g,p,y){for(var w,x,b,L=d.length/g,P=new Uint8Array(d.length+L),R=c(),j=0;j<L;j+=1){if(b=j*g,w=d.subarray(b,b+g),y)P.set(y(w,p,x),b+j);else{for(var k,T=R.length,q=[];k<T;k+=1)q[k]=R[k](w,p,x);var W=u(q.concat());P.set(q[W],b+j)}x=w}return P},r=function(d){var g=Array.apply([],d);return g.unshift(0),g},s=function(d,g){var p,y=[],w=d.length;y[0]=1;for(var x=0;x<w;x+=1)p=d[x-g]||0,y[x+1]=d[x]-p+256&255;return y},a=function(d,g,p){var y,w=[],x=d.length;w[0]=2;for(var b=0;b<x;b+=1)y=p&&p[b]||0,w[b+1]=d[b]-y+256&255;return w},o=function(d,g,p){var y,w,x=[],b=d.length;x[0]=3;for(var L=0;L<b;L+=1)y=d[L-g]||0,w=p&&p[L]||0,x[L+1]=d[L]+256-(y+w>>>1)&255;return x},l=function(d,g,p){var y,w,x,b,L=[],P=d.length;L[0]=4;for(var R=0;R<P;R+=1)y=d[R-g]||0,w=p&&p[R]||0,x=p&&p[R-g]||0,b=h(y,w,x),L[R+1]=d[R]-b+256&255;return L},h=function(d,g,p){if(d===g&&g===p)return d;var y=Math.abs(g-p),w=Math.abs(d-p),x=Math.abs(d+g-p-p);return y<=w&&y<=x?d:w<=x?g:p},c=function(){return[r,s,a,o,l]},u=function(d){var g=d.map(function(p){return p.reduce(function(y,w){return y+Math.abs(w)},0)});return g.indexOf(Math.min.apply(null,g))};n.processPNG=function(d,g,p,y){var w,x,b,L,P,R,j,k,T,q,W,F,M,O,G,tt=this.decode.FLATE_DECODE,Z="";if(this.__addimage__.isArrayBuffer(d)&&(d=new Uint8Array(d)),this.__addimage__.isArrayBufferView(d)){if(d=(b=new uM(d)).imgData,x=b.bits,w=b.colorSpace,P=b.colors,[4,6].indexOf(b.colorType)!==-1){if(b.bits===8){T=(k=b.pixelBitlength==32?new Uint32Array(b.decodePixels().buffer):b.pixelBitlength==16?new Uint16Array(b.decodePixels().buffer):new Uint8Array(b.decodePixels().buffer)).length,W=new Uint8Array(T*b.colors),q=new Uint8Array(T);var it,J=b.pixelBitlength-b.bits;for(O=0,G=0;O<T;O++){for(M=k[O],it=0;it<J;)W[G++]=M>>>it&255,it+=b.bits;q[O]=M>>>it&255}}if(b.bits===16){T=(k=new Uint32Array(b.decodePixels().buffer)).length,W=new Uint8Array(T*(32/b.pixelBitlength)*b.colors),q=new Uint8Array(T*(32/b.pixelBitlength)),F=b.colors>1,O=0,G=0;for(var lt=0;O<T;)M=k[O++],W[G++]=M>>>0&255,F&&(W[G++]=M>>>16&255,M=k[O++],W[G++]=M>>>0&255),q[lt++]=M>>>16&255;x=8}y!==n.image_compression.NONE&&t()?(d=e(W,b.width*b.colors,b.colors,y),j=e(q,b.width,1,y)):(d=W,j=q,tt=void 0)}if(b.colorType===3&&(w=this.color_spaces.INDEXED,R=b.palette,b.transparency.indexed)){var ct=b.transparency.indexed,Et=0;for(O=0,T=ct.length;O<T;++O)Et+=ct[O];if((Et/=255)===T-1&&ct.indexOf(0)!==-1)L=[ct.indexOf(0)];else if(Et!==T){for(k=b.decodePixels(),q=new Uint8Array(k.length),O=0,T=k.length;O<T;O++)q[O]=ct[k[O]];j=e(q,b.width,1)}}var S=function(U){var H;switch(U){case n.image_compression.FAST:H=11;break;case n.image_compression.MEDIUM:H=13;break;case n.image_compression.SLOW:H=14;break;default:H=12}return H}(y);return tt===this.decode.FLATE_DECODE&&(Z="/Predictor "+S+" "),Z+="/Colors "+P+" /BitsPerComponent "+x+" /Columns "+b.width,(this.__addimage__.isArrayBuffer(d)||this.__addimage__.isArrayBufferView(d))&&(d=this.__addimage__.arrayBufferToBinaryString(d)),(j&&this.__addimage__.isArrayBuffer(j)||this.__addimage__.isArrayBufferView(j))&&(j=this.__addimage__.arrayBufferToBinaryString(j)),{alias:p,data:d,index:g,filter:tt,decodeParameters:Z,transparency:L,palette:R,sMask:j,predictor:S,width:b.width,height:b.height,bitsPerComponent:x,colorSpace:w}}}})(oe.API),function(n){n.processGIF89A=function(t,e,i,r){var s=new fM(t),a=s.width,o=s.height,l=[];s.decodeAndBlitFrameRGBA(0,l);var h={data:l,width:a,height:o},c=new ym(100).encode(h,100);return n.processJPEG.call(this,c,e,i,r)},n.processGIF87A=n.processGIF89A}(oe.API),hs.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var t=0;t<n;t++){var e=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:r,green:i,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},hs.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[n]()}catch(e){mi.log("bit decode error:"+e)}},hs.prototype.bit1=function(){var n,t=Math.ceil(this.width/8),e=t%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,r=0;r<t;r++)for(var s=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+8*r*4,o=0;o<8&&8*r+o<this.width;o++){var l=this.palette[s>>7-o&1];this.data[a+4*o]=l.blue,this.data[a+4*o+1]=l.green,this.data[a+4*o+2]=l.red,this.data[a+4*o+3]=255}e!==0&&(this.pos+=4-e)}},hs.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),t=n%4,e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,r=0;r<n;r++){var s=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+2*r*4,o=s>>4,l=15&s,h=this.palette[o];if(this.data[a]=h.blue,this.data[a+1]=h.green,this.data[a+2]=h.red,this.data[a+3]=255,2*r+1>=this.width)break;h=this.palette[l],this.data[a+4]=h.blue,this.data[a+4+1]=h.green,this.data[a+4+2]=h.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},hs.prototype.bit8=function(){for(var n=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var r=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*i;if(r<this.palette.length){var a=this.palette[r];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}n!==0&&(this.pos+=4-n)}},hs.prototype.bit15=function(){for(var n=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,l=(s>>10&t)/t*255|0,h=s>>15?255:0,c=i*this.width*4+4*r;this.data[c]=l,this.data[c+1]=o,this.data[c+2]=a,this.data[c+3]=h}this.pos+=n}},hs.prototype.bit16=function(){for(var n=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,l=(a>>5&e)/e*255|0,h=(a>>11)/t*255|0,c=r*this.width*4+4*s;this.data[c]=h,this.data[c+1]=l,this.data[c+2]=o,this.data[c+3]=255}this.pos+=n}},hs.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var t=this.bottom_up?n:this.height-1-n,e=0;e<this.width;e++){var i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*e;this.data[a]=s,this.data[a+1]=r,this.data[a+2]=i,this.data[a+3]=255}this.pos+=this.width%4}},hs.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var t=this.bottom_up?n:this.height-1-n,e=0;e<this.width;e++){var i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=s,this.data[o+1]=r,this.data[o+2]=i,this.data[o+3]=a}},hs.prototype.getData=function(){return this.data},function(n){n.processBMP=function(t,e,i,r){var s=new hs(t,!1),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},h=new ym(100).encode(l,100);return n.processJPEG.call(this,h,e,i,r)}}(oe.API),b2.prototype.getData=function(){return this.data},function(n){n.processWEBP=function(t,e,i,r){var s=new b2(t),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},h=new ym(100).encode(l,100);return n.processJPEG.call(this,h,e,i,r)}}(oe.API),oe.API.processRGBA=function(n,t,e){for(var i=n.data,r=i.length,s=new Uint8Array(r/4*3),a=new Uint8Array(r/4),o=0,l=0,h=0;h<r;h+=4){var c=i[h],u=i[h+1],d=i[h+2],g=i[h+3];s[o++]=c,s[o++]=u,s[o++]=d,a[l++]=g}var p=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:p,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},oe.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Hl=oe.API,Qf=Hl.getCharWidthsArray=function(n,t){var e,i,r=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:r.metadata.Unicode.widths,l=o.fof?o.fof:1,h=t.kerning?t.kerning:r.metadata.Unicode.kerning,c=h.fof?h.fof:1,u=t.doKerning!==!1,d=0,g=n.length,p=0,y=o[0]||l,w=[];for(e=0;e<g;e++)i=n.charCodeAt(e),typeof r.metadata.widthOfString=="function"?w.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(i))+a*(1e3/s)||0)/1e3):(d=u&&oi(h[i])==="object"&&!isNaN(parseInt(h[i][p],10))?h[i][p]/c:0,w.push((o[i]||y)/l+d)),p=i;return w},y2=Hl.getStringUnitWidth=function(n,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),i=t.font||this.internal.getFont(),r=t.charSpace||this.internal.getCharSpace();return Hl.processArabic&&(n=Hl.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,e,r)/e:Qf.apply(this,arguments).reduce(function(s,a){return s+a},0)},v2=function(n,t,e,i){for(var r=[],s=0,a=n.length,o=0;s!==a&&o+t[s]<e;)o+=t[s],s++;r.push(n.slice(0,s));var l=s;for(o=0;s!==a;)o+t[s]>i&&(r.push(n.slice(l,s)),o=0,l=s),o+=t[s],s++;return l!==s&&r.push(n.slice(l,s)),r},w2=function(n,t,e){e||(e={});var i,r,s,a,o,l,h,c=[],u=[c],d=e.textIndent||0,g=0,p=0,y=n.split(" "),w=Qf.apply(this,[" ",e])[0];if(l=e.lineIndent===-1?y[0].length+2:e.lineIndent||0){var x=Array(l).join(" "),b=[];y.map(function(P){(P=P.split(/\s*\n/)).length>1?b=b.concat(P.map(function(R,j){return(j&&R.length?`
`:"")+R})):b.push(P[0])}),y=b,l=y2.apply(this,[x,e])}for(s=0,a=y.length;s<a;s++){var L=0;if(i=y[s],l&&i[0]==`
`&&(i=i.substr(1),L=1),d+g+(p=(r=Qf.apply(this,[i,e])).reduce(function(P,R){return P+R},0))>t||L){if(p>t){for(o=v2.apply(this,[i,r,t-(d+g),t]),c.push(o.shift()),c=[o.pop()];o.length;)u.push([o.shift()]);p=r.slice(i.length-(c[0]?c[0].length:0)).reduce(function(P,R){return P+R},0)}else c=[i];u.push(c),d=p+l,g=w}else c.push(i),d+=g+p,g=w}return h=l?function(P,R){return(R?x:"")+P.join(" ")}:function(P){return P.join(" ")},u.map(h)},Hl.splitTextToSize=function(n,t,e){var i,r=(e=e||{}).fontSize||this.internal.getFontSize(),s=(function(c){if(c.widths&&c.kerning)return{widths:c.widths,kerning:c.kerning};var u=this.internal.getFont(c.fontName,c.fontStyle);return u.metadata.Unicode?{widths:u.metadata.Unicode.widths||{0:1},kerning:u.metadata.Unicode.kerning||{}}:{font:u.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);i=Array.isArray(n)?n:String(n).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/r;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/r:0,s.lineIndent=e.lineIndent;var o,l,h=[];for(o=0,l=i.length;o<l;o++)h=h.concat(w2.apply(this,[i[o],a,s]));return h},function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},i={},r=0;r<t.length;r++)e[t[r]]="0123456789abcdef"[r],i["0123456789abcdef"[r]]=t[r];var s=function(u){return"0x"+parseInt(u,10).toString(16)},a=n.__fontmetrics__.compress=function(u){var d,g,p,y,w=["{"];for(var x in u){if(d=u[x],isNaN(parseInt(x,10))?g="'"+x+"'":(x=parseInt(x,10),g=(g=s(x).slice(2)).slice(0,-1)+i[g.slice(-1)]),typeof d=="number")d<0?(p=s(d).slice(3),y="-"):(p=s(d).slice(2),y=""),p=y+p.slice(0,-1)+i[p.slice(-1)];else{if(oi(d)!=="object")throw new Error("Don't know what to do with value type "+oi(d)+".");p=a(d)}w.push(g+p)}return w.push("}"),w.join("")},o=n.__fontmetrics__.uncompress=function(u){if(typeof u!="string")throw new Error("Invalid argument passed to uncompress.");for(var d,g,p,y,w={},x=1,b=w,L=[],P="",R="",j=u.length-1,k=1;k<j;k+=1)(y=u[k])=="'"?d?(p=d.join(""),d=void 0):d=[]:d?d.push(y):y=="{"?(L.push([b,p]),b={},p=void 0):y=="}"?((g=L.pop())[0][g[1]]=b,p=void 0,b=g[0]):y=="-"?x=-1:p===void 0?e.hasOwnProperty(y)?(P+=e[y],p=parseInt(P,16)*x,x=1,P=""):P+=y:e.hasOwnProperty(y)?(R+=e[y],b[p]=parseInt(R,16)*x,x=1,p=void 0,R=""):R+=y;return w},l={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},h={Unicode:{Courier:l,"Courier-Bold":l,"Courier-BoldOblique":l,"Courier-Oblique":l,Helvetica:l,"Helvetica-Bold":l,"Helvetica-BoldOblique":l,"Helvetica-Oblique":l,"Times-Roman":l,"Times-Bold":l,"Times-BoldItalic":l,"Times-Italic":l}},c={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(u){var d=u.font,g=c.Unicode[d.postScriptName];g&&(d.metadata.Unicode={},d.metadata.Unicode.widths=g.widths,d.metadata.Unicode.kerning=g.kerning);var p=h.Unicode[d.postScriptName];p&&(d.metadata.Unicode.encoding=p,d.encoding=p.codePages[0])}])}(oe.API),function(n){var t=function(e){for(var i=e.length,r=new Uint8Array(i),s=0;s<i;s++)r[s]=e.charCodeAt(s);return r};n.API.events.push(["addFont",function(e){var i=void 0,r=e.font,s=e.instance;if(!r.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if(typeof(i=s.existsFileInVFS(r.postScriptName)===!1?s.loadFile(r.postScriptName):s.getFileFromVFS(r.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(Zc(o)),a.metadata=n.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(r,i)}}])}(oe),function(n){function t(){return(le.canvg?Promise.resolve(le.canvg):gp(()=>import("./index.es-fVStoxLG.js"),__vite__mapDeps([]))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}oe.API.addSvgAsImage=function(e,i,r,s,a,o,l,h){if(isNaN(i)||isNaN(r))throw mi.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw mi.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=s,c.height=a;var u=c.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height);var d={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},g=this;return t().then(function(p){return p.fromString(u,e,d)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(p){return p.render(d)}).then(function(){g.addImage(c.toDataURL("image/jpeg",1),i,r,s,a,l,h)})}}(),oe.API.putTotalPages=function(n){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(n,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var r=0;r<this.internal.pages[i].length;r++)this.internal.pages[i][r]=this.internal.pages[i][r].replace(t,e);return this},oe.API.viewerPreferences=function(n,t){var e;n=n||{},t=t||!1;var i,r,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),l=[],h=0,c=0,u=0;function d(p,y){var w,x=!1;for(w=0;w<p.length;w+=1)p[w]===y&&(x=!0);return x}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,n==="reset"||t===!0){var g=o.length;for(u=0;u<g;u+=1)e[o[u]].value=e[o[u]].defaultValue,e[o[u]].explicitSet=!1}if(oi(n)==="object"){for(r in n)if(s=n[r],d(o,r)&&s!==void 0){if(e[r].type==="boolean"&&typeof s=="boolean")e[r].value=s;else if(e[r].type==="name"&&d(e[r].valueSet,s))e[r].value=s;else if(e[r].type==="integer"&&Number.isInteger(s))e[r].value=s;else if(e[r].type==="array"){for(h=0;h<s.length;h+=1)if(i=!0,s[h].length===1&&typeof s[h][0]=="number")l.push(String(s[h]-1));else if(s[h].length>1){for(c=0;c<s[h].length;c+=1)typeof s[h][c]!="number"&&(i=!1);i===!0&&l.push([s[h][0]-1,s[h][1]-1].join(" "))}e[r].value="["+l.join(" ")+"]"}else e[r].value=e[r].defaultValue;e[r].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var p,y=[];for(p in e)e[p].explicitSet===!0&&(e[p].type==="name"?y.push("/"+p+" /"+e[p].value):y.push("/"+p+" "+e[p].value));y.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+y.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(n){var t=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',r=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(i)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),l=unescape(encodeURIComponent("</x:xmpmeta>")),h=s.length+a.length+o.length+r.length+l.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+h+" >>"),this.internal.write("stream"),this.internal.write(r+s+a+o+l),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,r){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(oe.API),function(n){var t=n.API,e=t.pdfEscape16=function(s,a){for(var o,l=a.metadata.Unicode.widths,h=["","0","00","000","0000"],c=[""],u=0,d=s.length;u<d;++u){if(o=a.metadata.characterToGlyph(s.charCodeAt(u)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(u),l.indexOf(o)==-1&&(l.push(o),l.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return c.join("");o=o.toString(16),c.push(h[4-o.length],o)}return c.join("")},i=function(s){var a,o,l,h,c,u,d;for(c=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,l=[],u=0,d=(o=Object.keys(s).sort(function(g,p){return g-p})).length;u<d;u++)a=o[u],l.length>=100&&(c+=`
`+l.length+` beginbfchar
`+l.join(`
`)+`
endbfchar`,l=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(h=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),l.push("<"+a+"><"+h+">"));return l.length&&(c+=`
`+l.length+` beginbfchar
`+l.join(`
`)+`
endbfchar
`),c+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(a){var o=a.font,l=a.out,h=a.newObject,c=a.putStream;if(o.metadata instanceof n.API.TTFFont&&o.encoding==="Identity-H"){for(var u=o.metadata.Unicode.widths,d=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),g="",p=0;p<d.length;p++)g+=String.fromCharCode(d[p]);var y=h();c({data:g,addLength1:!0,objectId:y}),l("endobj");var w=h();c({data:i(o.metadata.toUnicode),addLength1:!0,objectId:w}),l("endobj");var x=h();l("<<"),l("/Type /FontDescriptor"),l("/FontName /"+rh(o.fontName)),l("/FontFile2 "+y+" 0 R"),l("/FontBBox "+n.API.PDFObject.convert(o.metadata.bbox)),l("/Flags "+o.metadata.flags),l("/StemV "+o.metadata.stemV),l("/ItalicAngle "+o.metadata.italicAngle),l("/Ascent "+o.metadata.ascender),l("/Descent "+o.metadata.decender),l("/CapHeight "+o.metadata.capHeight),l(">>"),l("endobj");var b=h();l("<<"),l("/Type /Font"),l("/BaseFont /"+rh(o.fontName)),l("/FontDescriptor "+x+" 0 R"),l("/W "+n.API.PDFObject.convert(u)),l("/CIDToGIDMap /Identity"),l("/DW 1000"),l("/Subtype /CIDFontType2"),l("/CIDSystemInfo"),l("<<"),l("/Supplement 0"),l("/Registry (Adobe)"),l("/Ordering ("+o.encoding+")"),l(">>"),l(">>"),l("endobj"),o.objectNumber=h(),l("<<"),l("/Type /Font"),l("/Subtype /Type0"),l("/ToUnicode "+w+" 0 R"),l("/BaseFont /"+rh(o.fontName)),l("/Encoding /"+o.encoding),l("/DescendantFonts ["+b+" 0 R]"),l(">>"),l("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,l=a.out,h=a.newObject,c=a.putStream;if(o.metadata instanceof n.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var u=o.metadata.rawData,d="",g=0;g<u.length;g++)d+=String.fromCharCode(u[g]);var p=h();c({data:d,addLength1:!0,objectId:p}),l("endobj");var y=h();c({data:i(o.metadata.toUnicode),addLength1:!0,objectId:y}),l("endobj");var w=h();l("<<"),l("/Descent "+o.metadata.decender),l("/CapHeight "+o.metadata.capHeight),l("/StemV "+o.metadata.stemV),l("/Type /FontDescriptor"),l("/FontFile2 "+p+" 0 R"),l("/Flags 96"),l("/FontBBox "+n.API.PDFObject.convert(o.metadata.bbox)),l("/FontName /"+rh(o.fontName)),l("/ItalicAngle "+o.metadata.italicAngle),l("/Ascent "+o.metadata.ascender),l(">>"),l("endobj"),o.objectNumber=h();for(var x=0;x<o.metadata.hmtx.widths.length;x++)o.metadata.hmtx.widths[x]=parseInt(o.metadata.hmtx.widths[x]*(1e3/o.metadata.head.unitsPerEm));l("<</Subtype/TrueType/Type/Font/ToUnicode "+y+" 0 R/BaseFont/"+rh(o.fontName)+"/FontDescriptor "+w+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),l("endobj"),o.isAlreadyPutted=!0}})(s)}]);var r=function(s){var a,o=s.text||"",l=s.x,h=s.y,c=s.options||{},u=s.mutex||{},d=u.pdfEscape,g=u.activeFontKey,p=u.fonts,y=g,w="",x=0,b="",L=p[y].encoding;if(p[y].encoding!=="Identity-H")return{text:o,x:l,y:h,options:c,mutex:u};for(b=o,y=g,Array.isArray(o)&&(b=o[0]),x=0;x<b.length;x+=1)p[y].metadata.hasOwnProperty("cmap")&&(a=p[y].metadata.cmap.unicode.codeMap[b[x].charCodeAt(0)]),a||b[x].charCodeAt(0)<256&&p[y].metadata.hasOwnProperty("Unicode")?w+=b[x]:w+="";var P="";return parseInt(y.slice(1))<14||L==="WinAnsiEncoding"?P=d(w,y).split("").map(function(R){return R.charCodeAt(0).toString(16)}).join(""):L==="Identity-H"&&(P=e(w,p[y])),u.isHex=!0,{text:P,x:l,y:h,options:c,mutex:u}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],l={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var h=0;for(h=0;h<a.length;h+=1)Array.isArray(a[h])&&a[h].length===3?o.push([r(Object.assign({},l,{text:a[h][0]})).text,a[h][1],a[h][2]]):o.push(r(Object.assign({},l,{text:a[h]})).text);s.text=o}else s.text=r(Object.assign({},l,{text:a})).text}])}(oe),function(n){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},n.addFileToVFS=function(e,i){return t.call(this),this.internal.vFS[e]=i,this},n.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(oe.API),function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var r,s,a,o,l,h,c,u=t,d=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],p={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},y={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},w=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],x=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),b=!1,L=0;this.__bidiEngine__={};var P=function(F){var M=F.charCodeAt(),O=M>>8,G=y[O];return G!==void 0?u[256*G+(255&M)]:O===252||O===253?"AL":x.test(O)?"L":O===8?"R":"N"},R=function(F){for(var M,O=0;O<F.length;O++){if((M=P(F.charAt(O)))==="L")return!1;if(M==="R")return!0}return!1},j=function(F,M,O,G){var tt,Z,it,J,lt=M[G];switch(lt){case"L":case"R":b=!1;break;case"N":case"AN":break;case"EN":b&&(lt="AN");break;case"AL":b=!0,lt="R";break;case"WS":lt="N";break;case"CS":G<1||G+1>=M.length||(tt=O[G-1])!=="EN"&&tt!=="AN"||(Z=M[G+1])!=="EN"&&Z!=="AN"?lt="N":b&&(Z="AN"),lt=Z===tt?Z:"N";break;case"ES":lt=(tt=G>0?O[G-1]:"B")==="EN"&&G+1<M.length&&M[G+1]==="EN"?"EN":"N";break;case"ET":if(G>0&&O[G-1]==="EN"){lt="EN";break}if(b){lt="N";break}for(it=G+1,J=M.length;it<J&&M[it]==="ET";)it++;lt=it<J&&M[it]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(J=M.length,it=G+1;it<J&&M[it]==="NSM";)it++;if(it<J){var ct=F[G],Et=ct>=1425&&ct<=2303||ct===64286;if(tt=M[it],Et&&(tt==="R"||tt==="AL")){lt="R";break}}}lt=G<1||(tt=M[G-1])==="B"?"N":O[G-1];break;case"B":b=!1,r=!0,lt=L;break;case"S":s=!0,lt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":b=!1;break;case"BN":lt="N"}return lt},k=function(F,M,O){var G=F.split("");return O&&T(G,O,{hiLevel:L}),G.reverse(),M&&M.reverse(),G.join("")},T=function(F,M,O){var G,tt,Z,it,J,lt=-1,ct=F.length,Et=0,S=[],U=L?g:d,H=[];for(b=!1,r=!1,s=!1,tt=0;tt<ct;tt++)H[tt]=P(F[tt]);for(Z=0;Z<ct;Z++){if(J=Et,S[Z]=j(F,H,S,Z),G=240&(Et=U[J][p[S[Z]]]),Et&=15,M[Z]=it=U[Et][5],G>0)if(G===16){for(tt=lt;tt<Z;tt++)M[tt]=1;lt=-1}else lt=-1;if(U[Et][6])lt===-1&&(lt=Z);else if(lt>-1){for(tt=lt;tt<Z;tt++)M[tt]=it;lt=-1}H[Z]==="B"&&(M[Z]=0),O.hiLevel|=it}s&&function(K,st,ht){for(var gt=0;gt<ht;gt++)if(K[gt]==="S"){st[gt]=L;for(var mt=gt-1;mt>=0&&K[mt]==="WS";mt--)st[mt]=L}}(H,M,ct)},q=function(F,M,O,G,tt){if(!(tt.hiLevel<F)){if(F===1&&L===1&&!r)return M.reverse(),void(O&&O.reverse());for(var Z,it,J,lt,ct=M.length,Et=0;Et<ct;){if(G[Et]>=F){for(J=Et+1;J<ct&&G[J]>=F;)J++;for(lt=Et,it=J-1;lt<it;lt++,it--)Z=M[lt],M[lt]=M[it],M[it]=Z,O&&(Z=O[lt],O[lt]=O[it],O[it]=Z);Et=J}Et++}}},W=function(F,M,O){var G=F.split(""),tt={hiLevel:L};return O||(O=[]),T(G,O,tt),function(Z,it,J){if(J.hiLevel!==0&&c)for(var lt,ct=0;ct<Z.length;ct++)it[ct]===1&&(lt=w.indexOf(Z[ct]))>=0&&(Z[ct]=w[lt+1])}(G,O,tt),q(2,G,M,O,tt),q(1,G,M,O,tt),G.join("")};return this.__bidiEngine__.doBidiReorder=function(F,M,O){if(function(tt,Z){if(Z)for(var it=0;it<tt.length;it++)Z[it]=it;o===void 0&&(o=R(tt)),h===void 0&&(h=R(tt))}(F,M),a||!l||h)if(a&&l&&o^h)L=o?1:0,F=k(F,M,O);else if(!a&&l&&h)L=o?1:0,F=W(F,M,O),F=k(F,M);else if(!a||o||l||h){if(a&&!l&&o^h)F=k(F,M),o?(L=0,F=W(F,M,O)):(L=1,F=W(F,M,O),F=k(F,M));else if(a&&o&&!l&&h)L=1,F=W(F,M,O),F=k(F,M);else if(!a&&!l&&o^h){var G=c;o?(L=1,F=W(F,M,O),L=0,c=!1,F=W(F,M,O),c=G):(L=0,F=W(F,M,O),F=k(F,M),L=1,c=!1,F=W(F,M,O),c=G,F=k(F,M))}}else L=0,F=W(F,M,O);else L=o?1:0,F=W(F,M,O);return F},this.__bidiEngine__.setOptions=function(F){F&&(a=F.isInputVisual,l=F.isOutputVisual,o=F.isInputRtl,h=F.isOutputRtl,c=F.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var r=i.text,s=(i.x,i.y,i.options||{}),a=(i.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(r)==="[object Array]"){var o=0;for(a=[],o=0;o<r.length;o+=1)Object.prototype.toString.call(r[o])==="[object Array]"?a.push([e.doBidiReorder(r[o][0]),r[o][1],r[o][2]]):a.push([e.doBidiReorder(r[o])]);i.text=a}else i.text=e.doBidiReorder(r);e.setOptions({isInputVisual:!0})}])}(oe),oe.API.TTFFont=function(){function n(t){var e;if(this.rawData=t,e=this.contents=new yo(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new AM(this),this.registerTTF()}return n.open=function(t){return new n(t)},n.prototype.parse=function(){return this.directory=new dM(this.contents),this.head=new mM(this),this.name=new wM(this),this.cmap=new Fw(this),this.toUnicode={},this.hhea=new pM(this),this.maxp=new xM(this),this.hmtx=new bM(this),this.post=new yM(this),this.os2=new _M(this),this.loca=new CM(this),this.glyf=new EM(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var t,e,i,r,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,l,h;for(h=[],a=0,o=(l=this.bbox).length;a<o;a++)t=l[a],h.push(Math.round(t*this.scaleFactor));return h}).call(this),this.stemV=0,this.post.exists?(i=255&(r=this.post.italic_angle),32768&(e=r>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},n.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},n.prototype.widthOfString=function(t,e,i){var r,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)r=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(r))+i*(1e3/e)||0;return a*(e/1e3)},n.prototype.lineHeight=function(t,e){var i;return e==null&&(e=!1),i=e?this.lineGap:0,(this.ascender+i-this.decender)/1e3*t},n}();var vs,yo=function(){function n(t){this.data=t??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(t){return this.data[this.pos++]=t},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},n.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},n.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},n.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},n.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},n.prototype.readString=function(t){var e,i;for(i=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)i[e]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(t){var e,i,r;for(r=[],e=0,i=t.length;0<=i?e<i:e>i;e=0<=i?++e:--e)r.push(this.writeByte(t.charCodeAt(e)));return r},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(t){return this.writeInt16(t)},n.prototype.readLongLong=function(){var t,e,i,r,s,a,o,l;return t=this.readByte(),e=this.readByte(),i=this.readByte(),r=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),l=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^i)+4294967296*(255^r)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^l)+1):72057594037927940*t+281474976710656*e+1099511627776*i+4294967296*r+16777216*s+65536*a+256*o+l},n.prototype.writeLongLong=function(t){var e,i;return e=Math.floor(t/4294967296),i=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(t){return this.writeInt32(t)},n.prototype.read=function(t){var e,i;for(e=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)e.push(this.readByte());return e},n.prototype.write=function(t){var e,i,r,s;for(s=[],i=0,r=t.length;i<r;i++)e=t[i],s.push(this.writeByte(e));return s},n}(),dM=function(){var n;function t(e){var i,r,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},r=0,s=this.tableCount;0<=s?r<s:r>s;r=0<=s?++r:--r)i={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[i.tag]=i}return t.prototype.encode=function(e){var i,r,s,a,o,l,h,c,u,d,g,p,y;for(y in g=Object.keys(e).length,l=Math.log(2),u=16*Math.floor(Math.log(g)/l),a=Math.floor(u/l),c=16*g-u,(r=new yo).writeInt(this.scalarType),r.writeShort(g),r.writeShort(u),r.writeShort(a),r.writeShort(c),s=16*g,h=r.pos+s,o=null,p=[],e)for(d=e[y],r.writeString(y),r.writeInt(n(d)),r.writeInt(h),r.writeInt(d.length),p=p.concat(d),y==="head"&&(o=h),h+=d.length;h%4;)p.push(0),h++;return r.write(p),i=2981146554-n(r.data),r.pos=o+8,r.writeUInt32(i),r.data},n=function(e){var i,r,s,a;for(e=kw.call(e);e.length%4;)e.push(0);for(s=new yo(e),r=0,i=0,a=e.length;i<a;i=i+=4)r+=s.readUInt32();return 4294967295&r},t}(),gM={}.hasOwnProperty,Ks=function(n,t){for(var e in t)gM.call(t,e)&&(n[e]=t[e]);function i(){this.constructor=n}return i.prototype=t.prototype,n.prototype=new i,n.__super__=t.prototype,n};vs=function(){function n(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n}();var mM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var i;return(i=new yo).writeInt(this.version),i.writeInt(this.revision),i.writeInt(this.checkSumAdjustment),i.writeInt(this.magicNumber),i.writeShort(this.flags),i.writeShort(this.unitsPerEm),i.writeLongLong(this.created),i.writeLongLong(this.modified),i.writeShort(this.xMin),i.writeShort(this.yMin),i.writeShort(this.xMax),i.writeShort(this.yMax),i.writeShort(this.macStyle),i.writeShort(this.lowestRecPPEM),i.writeShort(this.fontDirectionHint),i.writeShort(e),i.writeShort(this.glyphDataFormat),i.data},t}(),E2=function(){function n(t,e){var i,r,s,a,o,l,h,c,u,d,g,p,y,w,x,b,L;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),u=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(l=0;l<256;++l)this.codeMap[l]=t.readByte();break;case 4:for(g=t.readUInt16(),d=g/2,t.pos+=6,s=function(){var P,R;for(R=[],l=P=0;0<=d?P<d:P>d;l=0<=d?++P:--P)R.push(t.readUInt16());return R}(),t.pos+=2,y=function(){var P,R;for(R=[],l=P=0;0<=d?P<d:P>d;l=0<=d?++P:--P)R.push(t.readUInt16());return R}(),h=function(){var P,R;for(R=[],l=P=0;0<=d?P<d:P>d;l=0<=d?++P:--P)R.push(t.readUInt16());return R}(),c=function(){var P,R;for(R=[],l=P=0;0<=d?P<d:P>d;l=0<=d?++P:--P)R.push(t.readUInt16());return R}(),r=(this.length-t.pos+this.offset)/2,o=function(){var P,R;for(R=[],l=P=0;0<=r?P<r:P>r;l=0<=r?++P:--P)R.push(t.readUInt16());return R}(),l=x=0,L=s.length;x<L;l=++x)for(w=s[l],i=b=p=y[l];p<=w?b<=w:b>=w;i=p<=w?++b:--b)c[l]===0?a=i+h[l]:(a=o[c[l]/2+(i-p)-(d-l)]||0)!==0&&(a+=h[l]),this.codeMap[i]=65535&a}t.pos=u}return n.encode=function(t,e){var i,r,s,a,o,l,h,c,u,d,g,p,y,w,x,b,L,P,R,j,k,T,q,W,F,M,O,G,tt,Z,it,J,lt,ct,Et,S,U,H,K,st,ht,gt,mt,Lt,Tt,Bt;switch(G=new yo,a=Object.keys(t).sort(function(Gt,Jt){return Gt-Jt}),e){case"macroman":for(y=0,w=function(){var Gt=[];for(p=0;p<256;++p)Gt.push(0);return Gt}(),b={0:0},s={},tt=0,lt=a.length;tt<lt;tt++)b[mt=t[r=a[tt]]]==null&&(b[mt]=++y),s[r]={old:t[r],new:b[t[r]]},w[r]=b[t[r]];return G.writeUInt16(1),G.writeUInt16(0),G.writeUInt32(12),G.writeUInt16(0),G.writeUInt16(262),G.writeUInt16(0),G.write(w),{charMap:s,subtable:G.data,maxGlyphID:y+1};case"unicode":for(M=[],u=[],L=0,b={},i={},x=h=null,Z=0,ct=a.length;Z<ct;Z++)b[R=t[r=a[Z]]]==null&&(b[R]=++L),i[r]={old:R,new:b[R]},o=b[R]-r,x!=null&&o===h||(x&&u.push(x),M.push(r),h=o),x=r;for(x&&u.push(x),u.push(65535),M.push(65535),W=2*(q=M.length),T=2*Math.pow(Math.log(q)/Math.LN2,2),d=Math.log(T/2)/Math.LN2,k=2*q-T,l=[],j=[],g=[],p=it=0,Et=M.length;it<Et;p=++it){if(F=M[p],c=u[p],F===65535){l.push(0),j.push(0);break}if(F-(O=i[F].new)>=32768)for(l.push(0),j.push(2*(g.length+q-p)),r=J=F;F<=c?J<=c:J>=c;r=F<=c?++J:--J)g.push(i[r].new);else l.push(O-F),j.push(0)}for(G.writeUInt16(3),G.writeUInt16(1),G.writeUInt32(12),G.writeUInt16(4),G.writeUInt16(16+8*q+2*g.length),G.writeUInt16(0),G.writeUInt16(W),G.writeUInt16(T),G.writeUInt16(d),G.writeUInt16(k),ht=0,S=u.length;ht<S;ht++)r=u[ht],G.writeUInt16(r);for(G.writeUInt16(0),gt=0,U=M.length;gt<U;gt++)r=M[gt],G.writeUInt16(r);for(Lt=0,H=l.length;Lt<H;Lt++)o=l[Lt],G.writeUInt16(o);for(Tt=0,K=j.length;Tt<K;Tt++)P=j[Tt],G.writeUInt16(P);for(Bt=0,st=g.length;Bt<st;Bt++)y=g[Bt],G.writeUInt16(y);return{charMap:i,subtable:G.data,maxGlyphID:L+1}}},n}(),Fw=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="cmap",t.prototype.parse=function(e){var i,r,s;for(e.pos=this.offset,this.version=e.readUInt16(),s=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=s?r<s:r>s;r=0<=s?++r:--r)i=new E2(e,this.offset),this.tables.push(i),i.isUnicode&&this.unicode==null&&(this.unicode=i);return!0},t.encode=function(e,i){var r,s;return i==null&&(i="macroman"),r=E2.encode(e,i),(s=new yo).writeUInt16(0),s.writeUInt16(1),r.table=s.data.concat(r.subtable),r},t}(),pM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),_M=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var i,r;for(r=[],i=0;i<10;++i)r.push(e.readByte());return r}(),this.charRange=function(){var i,r;for(r=[],i=0;i<4;++i)r.push(e.readInt());return r}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var i,r;for(r=[],i=0;i<2;i=++i)r.push(e.readInt());return r}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),yM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="post",t.prototype.parse=function(e){var i,r,s;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var a;for(r=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=r?a<r:a>r;a=0<=r?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],s=[];e.pos<this.offset+this.length;)i=e.readByte(),s.push(this.names.push(e.readString(i)));return s;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 196608:break;case 262144:return this.map=(function(){var o,l,h;for(h=[],a=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;a=0<=l?++o:--o)h.push(e.readUInt32());return h}).call(this)}},t}(),vM=function(n,t){this.raw=n,this.length=n.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},wM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="name",t.prototype.parse=function(e){var i,r,s,a,o,l,h,c,u,d,g;for(e.pos=this.offset,e.readShort(),i=e.readShort(),l=e.readShort(),r=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+l+e.readShort()});for(h={},a=u=0,d=r.length;u<d;a=++u)s=r[a],e.pos=s.offset,c=e.readString(s.length),o=new vM(c,s),h[g=s.nameID]==null&&(h[g]=[]),h[s.nameID].push(o);this.strings=h,this.copyright=h[0],this.fontFamily=h[1],this.fontSubfamily=h[2],this.uniqueSubfamily=h[3],this.fontName=h[4],this.version=h[5];try{this.postscriptName=h[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=h[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=h[7],this.manufacturer=h[8],this.designer=h[9],this.description=h[10],this.vendorUrl=h[11],this.designerUrl=h[12],this.license=h[13],this.licenseUrl=h[14],this.preferredFamily=h[15],this.preferredSubfamily=h[17],this.compatibleFull=h[18],this.sampleText=h[19]},t}(),xM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),bM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="hmtx",t.prototype.parse=function(e){var i,r,s,a,o,l,h;for(e.pos=this.offset,this.metrics=[],i=0,l=this.file.hhea.numberOfMetrics;0<=l?i<l:i>l;i=0<=l?++i:--i)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var c,u;for(u=[],i=c=0;0<=s?c<s:c>s;i=0<=s?++c:--c)u.push(e.readInt16());return u}(),this.widths=(function(){var c,u,d,g;for(g=[],c=0,u=(d=this.metrics).length;c<u;c++)a=d[c],g.push(a.advance);return g}).call(this),r=this.widths[this.widths.length-1],h=[],i=o=0;0<=s?o<s:o>s;i=0<=s?++o:--o)h.push(this.widths.push(r));return h},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),kw=[].slice,EM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var i,r,s,a,o,l,h,c,u,d;return e in this.cache?this.cache[e]:(a=this.file.loca,i=this.file.contents,r=a.indexOf(e),(s=a.lengthOf(e))===0?this.cache[e]=null:(i.pos=this.offset+r,o=(l=new yo(i.read(s))).readShort(),c=l.readShort(),d=l.readShort(),h=l.readShort(),u=l.readShort(),this.cache[e]=o===-1?new LM(l,c,d,h,u):new SM(l,o,c,d,h,u),this.cache[e]))},t.prototype.encode=function(e,i,r){var s,a,o,l,h;for(o=[],a=[],l=0,h=i.length;l<h;l++)s=e[i[l]],a.push(o.length),s&&(o=o.concat(s.encode(r)));return a.push(o.length),{table:o,offsets:a}},t}(),SM=function(){function n(t,e,i,r,s,a){this.raw=t,this.numberOfContours=e,this.xMin=i,this.yMin=r,this.xMax=s,this.yMax=a,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n}(),LM=function(){function n(t,e,i,r,s){var a,o;for(this.raw=t,this.xMin=e,this.yMin=i,this.xMax=r,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return n.prototype.encode=function(){var t,e,i;for(e=new yo(kw.call(this.raw.data)),t=0,i=this.glyphIDs.length;t<i;++t)e.pos=this.glyphOffsets[t];return e.data},n}(),CM=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Ks(t,vs),t.prototype.tag="loca",t.prototype.parse=function(e){var i,r;return e.pos=this.offset,i=this.file.head.indexToLocFormat,this.offsets=i===0?(function(){var s,a;for(a=[],r=0,s=this.length;r<s;r+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],r=0,s=this.length;r<s;r+=4)a.push(e.readUInt32());return a}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,i){for(var r=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<r.length;++o)if(r[o]=s,a<i.length&&i[a]==o){++a,r[o]=s;var l=this.offsets[o],h=this.offsets[o+1]-l;h>0&&(s+=h)}for(var c=new Array(4*r.length),u=0;u<r.length;++u)c[4*u+3]=255&r[u],c[4*u+2]=(65280&r[u])>>8,c[4*u+1]=(16711680&r[u])>>16,c[4*u]=(4278190080&r[u])>>24;return c},t}(),AM=function(){function n(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var t,e,i,r,s;for(e in r=this.font.cmap.tables[0].codeMap,t={},s=this.subset)i=s[e],t[e]=r[i];return t},n.prototype.glyphsFor=function(t){var e,i,r,s,a,o,l;for(r={},a=0,o=t.length;a<o;a++)r[s=t[a]]=this.font.glyf.glyphFor(s);for(s in e=[],r)(i=r[s])!=null&&i.compound&&e.push.apply(e,i.glyphIDs);if(e.length>0)for(s in l=this.glyphsFor(e))i=l[s],r[s]=i;return r},n.prototype.encode=function(t,e){var i,r,s,a,o,l,h,c,u,d,g,p,y,w,x;for(r in i=Fw.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),g={0:0},x=i.charMap)g[(l=x[r]).old]=l.new;for(p in d=i.maxGlyphID,a)p in g||(g[p]=d++);return c=function(b){var L,P;for(L in P={},b)P[b[L]]=L;return P}(g),u=Object.keys(c).sort(function(b,L){return b-L}),y=function(){var b,L,P;for(P=[],b=0,L=u.length;b<L;b++)o=u[b],P.push(c[o]);return P}(),s=this.font.glyf.encode(a,y,g),h=this.font.loca.encode(s.offsets,y),w={cmap:this.font.cmap.raw(),glyf:s.table,loca:h,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(w["OS/2"]=this.font.os2.raw()),this.font.directory.encode(w)},n}();oe.API.PDFObject=function(){var n;function t(){}return n=function(e,i){return(Array(i+1).join("0")+e).slice(-i)},t.convert=function(e){var i,r,s,a;if(Array.isArray(e))return"["+function(){var o,l,h;for(h=[],o=0,l=e.length;o<l;o++)i=e[o],h.push(t.convert(i));return h}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+n(e.getUTCFullYear(),4)+n(e.getUTCMonth(),2)+n(e.getUTCDate(),2)+n(e.getUTCHours(),2)+n(e.getUTCMinutes(),2)+n(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(r in s=["<<"],e)a=e[r],s.push("/"+r+" "+t.convert(a));return s.push(">>"),s.join(`
`)}return""+e},t}();class TM{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof Su&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return Be(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return Be(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Be(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}function Yd(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function MM(n,t,e){return n+"/"+t+"/"+e}function Ow(n){return PM(n[0],n[1],n[2])}function PM(n,t,e){return(t<<n)+e}function RM(n,t){const e=n[0],i=n[1],r=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(i,r):!0}class H1{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function $l(n,t,e,i,r){return r!==void 0?(r.minX=n,r.maxX=t,r.minY=e,r.maxY=i,r):new H1(n,t,e,i)}const Xl=[0,0,0],Ja=5;class IM{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Be(tE(this.resolutions_,(r,s)=>s-r,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Be(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=xo(i)),Be(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Be(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:g1,Be(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,s)=>{const a=new H1(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const o=this.getTileRangeForExtentAndZ(i,s);a.minX=Math.max(o.minX,a.minX),a.maxX=Math.min(o.maxX,a.maxX),a.minY=Math.max(o.minY,a.minY),a.maxY=Math.min(o.maxY,a.maxY)}return a}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,a=r.maxX;s<=a;++s)for(let o=r.minY,l=r.maxY;o<=l;++o)i([e,s,o])}forEachTileCoordParentTileRange(t,e,i,r){let s,a,o,l=null,h=t[0]-1;for(this.zoomFactor_===2?(a=t[1],o=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(a!==void 0&&o!==void 0?(a=Math.floor(a/2),o=Math.floor(o/2),s=$l(a,a,o,o,i)):s=this.getTileRangeForExtentAndZ(l,h,i),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,a=t[2]*2;return $l(s,s+1,a,a+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],a=t[2];if(e===r)return $l(s,a,s,a,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(s*l),c=Math.floor(a*l);if(e<r)return $l(h,h,c,c,i);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(a+1))-1;return $l(h,u,c,d,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Xl);const r=Xl[1],s=Xl[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Xl);const a=Xl[1],o=Xl[2];return $l(r,a,s,o,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=Dn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=Dn(this.getTileSize(t[0]),this.tmpSize_),a=i[0]+t[1]*s[0]*r,o=i[1]-(t[2]+1)*s[1]*r,l=a+s[0]*r,h=o+s[1]*r;return zs(a,o,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,s){const a=this.getZForResolution(i),o=i/this.getResolution(a),l=this.getOrigin(a),h=Dn(this.getTileSize(a),this.tmpSize_);let c=o*(t-l[0])/i/h[0],u=o*(l[1]-e)/i/h[1];return r?(c=Nf(c,Ja)-1,u=Nf(u,Ja)-1):(c=If(c,Ja),u=If(u,Ja)),Yd(a,c,u,s)}getTileCoordForXYAndZ_(t,e,i,r,s){const a=this.getOrigin(i),o=this.getResolution(i),l=Dn(this.getTileSize(i),this.tmpSize_);let h=(t-a[0])/o/l[0],c=(a[1]-e)/o/l[1];return r?(h=Nf(h,Ja)-1,c=Nf(c,Ja)-1):(h=If(h,Ja),c=If(c,Ja)),Yd(i,h,c,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=qp(this.resolutions_,t,e||0);return pi(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return c5(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}}const Dw=IM;function Bw(n){let t=n.getDefaultTileGrid();return t||(t=OM(n),n.setDefaultTileGrid(t)),t}function NM(n,t,e){const i=t[0],r=n.getTileCoordCenter(t),s=$1(e);if(!mo(s,r)){const a=ke(s),o=Math.ceil((s[0]-r[0])/a);return r[0]+=a*o,n.getTileCoordForCoordAndZ(r,i)}return t}function FM(n,t,e,i){i=i!==void 0?i:"top-left";const r=Gw(n,t,e);return new Dw({extent:n,origin:pE(n,i),resolutions:r,tileSize:e})}function kM(n){const t=n||{},e=t.extent||di("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Gw(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Dw(i)}function Gw(n,t,e,i){t=t!==void 0?t:PS,e=Dn(e!==void 0?e:g1);const r=_n(n),s=ke(n);i=i>0?i:Math.max(s/e[0],r/e[1]);const a=t+1,o=new Array(a);for(let l=0;l<a;++l)o[l]=i/Math.pow(2,l);return o}function OM(n,t,e,i){const r=$1(n);return FM(r,t,e,i)}function $1(n){n=di(n);let t=n.getExtent();if(!t){const e=180*Ih.degrees/n.getMetersPerUnit();t=zs(-e,-e,e,e)}return t}function jw(n,t){const e=[];Object.keys(t).forEach(function(r){t[r]!==null&&t[r]!==void 0&&e.push(r+"="+encodeURIComponent(t[r]))});const i=e.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+i}const DM=/\{z\}/g,BM=/\{x\}/g,GM=/\{y\}/g,jM=/\{-y\}/g;function UM(n,t,e,i,r){return n.replace(DM,t.toString()).replace(BM,e.toString()).replace(GM,i.toString()).replace(jM,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-i).toString()})}function zM(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=i;s<=r;++s)t.push(n.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(n.replace(e[0],r.toString()));return t}return t.push(n),t}function qM(n,t){return function(e,i,r){if(!e)return;let s;const a=e[0];if(t){const o=t.getFullTileRange(a);o&&(s=o.getHeight()-1)}return UM(n,a,e[1],e[2],s)}}function VM(n,t){const e=n.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=qM(n[r],t);return WM(i)}function WM(n){return n.length===1?n[0]:function(t,e,i){if(!t)return;const r=Ow(t),s=uo(r,n.length);return n[s](t,e,i)}}class X1 extends og{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(ie.CHANGE)}release(){this.setState(Qt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==Qt.EMPTY){if(this.state!==Qt.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){he()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const r=e-i+1e3/60;return r>=this.transition_?1:qv(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class Uw extends X1{constructor(t,e,i,r,s,a){super(t,e,a),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=Qt.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Qt.ERROR,this.unlistenImage_(),this.image_=HM(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Qt.LOADED:this.state=Qt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Qt.ERROR&&(this.state=Qt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Qt.IDLE&&(this.state=Qt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=JL(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function HM(){const n=Ji(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}let vm;const Ch=[];function S2(n,t,e,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,r)),n.restore()}function wm(n,t){return Math.abs(n[t*4]-210)>2||Math.abs(n[t*4+3]-.75*255)>2}function $M(){if(vm===void 0){const n=Ji(6,6,Ch);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",S2(n,4,5,4,0),S2(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;vm=wm(t,0)||wm(t,4)||wm(t,8),Eg(n),Ch.push(n.canvas)}return vm}function Cp(n,t,e,i){const r=Kn(e,t,n);let s=Pd(t,i,e);const a=t.getMetersPerUnit();a!==void 0&&(s*=a);const o=n.getMetersPerUnit();o!==void 0&&(s/=o);const l=n.getExtent();if(!l||mo(l,r)){const h=Pd(n,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function XM(n,t,e,i){const r=qs(e);let s=Cp(n,t,r,i);return(!isFinite(s)||s<=0)&&Hp(e,function(a){return s=Cp(n,t,a,i),isFinite(s)&&s>0}),s}function YM(n,t,e,i,r,s,a,o,l,h,c,u,d,g){const p=Ji(Math.round(e*n),Math.round(e*t),Ch);if(u||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(e,e);function y(R){return Math.round(R*e)/e}p.globalCompositeOperation="lighter";const w=Bn();l.forEach(function(R,j,k){Vc(w,R.extent)});let x;const b=e/i,L=(u?1:1+Math.pow(2,-24))/b;if(!d||l.length!==1||h!==0){if(x=Ji(Math.round(ke(w)*b),Math.round(_n(w)*b),Ch),u||(x.imageSmoothingEnabled=!1),r&&g){const R=(r[0]-w[0])*b,j=-(r[3]-w[3])*b,k=ke(r)*b,T=_n(r)*b;x.rect(R,j,k,T),x.clip()}l.forEach(function(R,j,k){if(R.image.width>0&&R.image.height>0){if(R.clipExtent){x.save();const M=(R.clipExtent[0]-w[0])*b,O=-(R.clipExtent[3]-w[3])*b,G=ke(R.clipExtent)*b,tt=_n(R.clipExtent)*b;x.rect(u?M:Math.round(M),u?O:Math.round(O),u?G:Math.round(M+G)-Math.round(M),u?tt:Math.round(O+tt)-Math.round(O)),x.clip()}const T=(R.extent[0]-w[0])*b,q=-(R.extent[3]-w[3])*b,W=ke(R.extent)*b,F=_n(R.extent)*b;x.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,u?T:Math.round(T),u?q:Math.round(q),u?W:Math.round(T+W)-Math.round(T),u?F:Math.round(q+F)-Math.round(q)),R.clipExtent&&x.restore()}})}const P=xo(a);return o.getTriangles().forEach(function(R,j,k){const T=R.source,q=R.target;let W=T[0][0],F=T[0][1],M=T[1][0],O=T[1][1],G=T[2][0],tt=T[2][1];const Z=y((q[0][0]-P[0])/s),it=y(-(q[0][1]-P[1])/s),J=y((q[1][0]-P[0])/s),lt=y(-(q[1][1]-P[1])/s),ct=y((q[2][0]-P[0])/s),Et=y(-(q[2][1]-P[1])/s),S=W,U=F;W=0,F=0,M-=S,O-=U,G-=S,tt-=U;const H=[[M,O,0,0,J-Z],[G,tt,0,0,ct-Z],[0,0,M,O,lt-it],[0,0,G,tt,Et-it]],K=fE(H);if(!K)return;if(p.save(),p.beginPath(),$M()||!u){p.moveTo(J,lt);const ht=4,gt=Z-J,mt=it-lt;for(let Lt=0;Lt<ht;Lt++)p.lineTo(J+y((Lt+1)*gt/ht),lt+y(Lt*mt/(ht-1))),Lt!=ht-1&&p.lineTo(J+y((Lt+1)*gt/ht),lt+y((Lt+1)*mt/(ht-1)));p.lineTo(ct,Et)}else p.moveTo(J,lt),p.lineTo(Z,it),p.lineTo(ct,Et);p.clip(),p.transform(K[0],K[2],K[1],K[3],Z,it),p.translate(w[0]-S,w[3]-U);let st;if(x)st=x.canvas,p.scale(L,-L);else{const ht=l[0],gt=ht.extent;st=ht.image,p.scale(ke(gt)/st.width,-_n(gt)/st.height)}p.drawImage(st,0,0),p.restore()}),x&&(Eg(x),Ch.push(x.canvas)),c&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,o.getTriangles().forEach(function(R,j,k){const T=R.target,q=(T[0][0]-P[0])/s,W=-(T[0][1]-P[1])/s,F=(T[1][0]-P[0])/s,M=-(T[1][1]-P[1])/s,O=(T[2][0]-P[0])/s,G=-(T[2][1]-P[1])/s;p.beginPath(),p.moveTo(F,M),p.lineTo(q,W),p.lineTo(O,G),p.closePath(),p.stroke()}),p.restore()),p.canvas}const KM=10,L2=.25;class ZM{constructor(t,e,i,r,s,a,o){this.sourceProj_=t,this.targetProj_=e;let l={};const h=o?Ym(L=>Pi(o,Kn(L,this.targetProj_,this.sourceProj_))):Fh(this.targetProj_,this.sourceProj_);this.transformInv_=function(L){const P=L[0]+"/"+L[1];return l[P]||(l[P]=h(L)),l[P]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ke(r)>=ke(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ke(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ke(this.targetProj_.getExtent()):null;const c=xo(i),u=cg(i),d=hg(i),g=lg(i),p=this.transformInv_(c),y=this.transformInv_(u),w=this.transformInv_(d),x=this.transformInv_(g),b=KM+(a?Math.max(0,Math.ceil(Math.log2(Vm(i)/(a*a*256*256)))):0);if(this.addQuad_(c,u,d,g,p,y,w,x,b),this.wrapsXInSource_){let L=1/0;this.triangles_.forEach(function(P,R,j){L=Math.min(L,P.source[0][0],P.source[1][0],P.source[2][0])}),this.triangles_.forEach(P=>{if(Math.max(P.source[0][0],P.source[1][0],P.source[2][0])-L>this.sourceWorldWidth_/2){const R=[[P.source[0][0],P.source[0][1]],[P.source[1][0],P.source[1][1]],[P.source[2][0],P.source[2][1]]];R[0][0]-L>this.sourceWorldWidth_/2&&(R[0][0]-=this.sourceWorldWidth_),R[1][0]-L>this.sourceWorldWidth_/2&&(R[1][0]-=this.sourceWorldWidth_),R[2][0]-L>this.sourceWorldWidth_/2&&(R[2][0]-=this.sourceWorldWidth_);const j=Math.min(R[0][0],R[1][0],R[2][0]);Math.max(R[0][0],R[1][0],R[2][0])-j<this.sourceWorldWidth_/2&&(P.source=R)}})}l={}}addTriangle_(t,e,i,r,s,a){this.triangles_.push({source:[r,s,a],target:[t,e,i]})}addQuad_(t,e,i,r,s,a,o,l,h){const c=bn([s,a,o,l]),u=this.sourceWorldWidth_?ke(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const w=bn([t,e,i,r]);p=ke(w)/this.targetWorldWidth_>L2||p}!g&&this.sourceProj_.isGlobal()&&u&&(p=u>L2||p)}if(!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!ki(c,this.maxSourceExtent_))return;let y=0;if(!p&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)p=!0;else if(y=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),y!=1&&y!=2&&y!=4&&y!=8)return}if(h>0){if(!p){const w=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(w);let b;g?b=(uo(s[0],d)+uo(o[0],d))/2-uo(x[0],d):b=(s[0]+o[0])/2-x[0];const L=(s[1]+o[1])/2-x[1];p=b*b+L*L>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const w=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(w),b=[(r[0]+t[0])/2,(r[1]+t[1])/2],L=this.transformInv_(b);this.addQuad_(t,e,w,b,s,a,x,L,h-1),this.addQuad_(b,w,i,r,L,x,o,l,h-1)}else{const w=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(w),b=[(i[0]+r[0])/2,(i[1]+r[1])/2],L=this.transformInv_(b);this.addQuad_(t,w,b,r,s,x,L,l,h-1),this.addQuad_(w,e,i,b,x,a,o,L,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}y&11||this.addTriangle_(t,i,r,s,o,l),y&14||this.addTriangle_(t,i,e,s,o,a),y&&(y&13||this.addTriangle_(e,r,t,a,l,s),y&7||this.addTriangle_(e,r,i,a,l,o))}calculateSourceExtent(){const t=Bn();return this.triangles_.forEach(function(e,i,r){const s=e.source;Wc(t,s[0]),Wc(t,s[1]),Wc(t,s[2])}),t}getTriangles(){return this.triangles_}}const JM=.5;class zw extends X1{constructor(t,e,i,r,s,a,o,l,h,c,u,d){super(s,Qt.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=o,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=a||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let y=this.sourceTileGrid_.getExtent();const w=p?wa(g,p):g;if(Vm(w)===0){this.state=Qt.EMPTY;return}const x=t.getExtent();x&&(y?y=wa(y,x):y=x);const b=r.getResolution(this.wrappedTileCoord_[0]),L=XM(t,i,w,b);if(!isFinite(L)||L<=0){this.state=Qt.EMPTY;return}const P=c!==void 0?c:JM;if(this.triangulation_=new ZM(t,i,w,y,L*P,b),this.triangulation_.getTriangles().length===0){this.state=Qt.EMPTY;return}this.sourceZ_=e.getZForResolution(L);let R=this.triangulation_.calculateSourceExtent();if(y&&(t.canWrapX()?(R[1]=pi(R[1],y[1],y[3]),R[3]=pi(R[3],y[1],y[3])):R=wa(R,y)),!Vm(R))this.state=Qt.EMPTY;else{let j=0,k=0;t.canWrapX()&&(j=ke(x),k=Math.floor((R[0]-x[0])/j)),jv(R.slice(),t,!0).forEach(q=>{const W=e.getTileRangeForExtentAndZ(q,this.sourceZ_);for(let F=W.minX;F<=W.maxX;F++)for(let M=W.minY;M<=W.maxY;M++){const O=h(this.sourceZ_,F,M,o);if(O){const G=k*j;this.sourceTiles_.push({tile:O,offset:G})}}++k}),this.sourceTiles_.length===0&&(this.state=Qt.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var r;const i=e.tile;if(i&&i.getState()==Qt.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=e.offset,s[2]+=e.offset;const a=(r=this.clipExtent_)==null?void 0:r.slice();a&&(a[0]+=e.offset,a[2]+=e.offset),t.push({extent:s,clipExtent:a,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=Qt.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=YM(r,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=Qt.LOADED}this.changed()}load(){if(this.state==Qt.IDLE){this.state=Qt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==Qt.IDLE||i==Qt.LOADING){t++;const r=ve(e,ie.CHANGE,s=>{const a=e.getState();(a==Qt.LOADED||a==Qt.ERROR||a==Qt.EMPTY)&&(ai(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,r){e.getState()==Qt.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ai),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Eg(this.canvas_.getContext("2d")),Ch.push(this.canvas_),this.canvas_=null),super.release()}}class qw extends q1{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Dn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||Ht(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,s){return he()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Bw(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),a=Dn(r.getTileSize(t),this.tmpSize);return s==1?a:TL(a,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=e!==void 0?e:this.getProjection(),r=e!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=NM(r,t,i)),RM(t,r)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class QM extends Cr{constructor(t,e){super(t),this.tile=e}}const xm={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Y1 extends qw{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Y1.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=Ht(e),r=e.getState();let s;r==Qt.LOADING?(this.tileLoadingKeys_[i]=!0,s=xm.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==Qt.ERROR?xm.TILELOADERROR:r==Qt.LOADED?xm.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new QM(s,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=zM(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(VM(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}}class Dg extends Y1{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:tP,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Uw,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!hd(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||hd(e,t)))return this.tileGrid;const i=Ht(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Bw(t)),this.tileGridForProjection[i]}createTile_(t,e,i,r,s,a){const o=[t,e,i],l=this.getTileCoordForTileUrlFunction(o,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(o,h!==void 0?Qt.IDLE:Qt.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=a,c.addEventListener(ie.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,i,r,s){const a=this.getProjection();if(!a||!s||hd(a,s))return this.getTileInternal(t,e,i,r,a||s);const o=[t,e,i],l=this.getKey(),h=this.getTileGridForProjection(a),c=this.getTileGridForProjection(s),u=this.getTileCoordForTileUrlFunction(o,s),d=new zw(a,h,s,c,o,u,this.getTilePixelRatio(r),this.getGutter(),(g,p,y,w)=>this.getTileInternal(g,p,y,w,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return d.key=l,d}getTileInternal(t,e,i,r,s){const a=this.getKey();return this.createTile_(t,e,i,r,s,a)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const i=di(t);if(i){const r=Ht(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}}function tP(n,t){n.getImage().src=t}class K1 extends Dg{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:kM({extent:$1(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}function Ap(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const eP=new Error("disposed"),iP=[256,256];class C2 extends X1{constructor(t){const e=Qt.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=Ap(this.data_);return t?[t.width,t.height]:iP}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Qt.IDLE&&this.state!==Qt.ERROR)return;this.state=Qt.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=Qt.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=Qt.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(eP),this.controller_=null),super.disposeInternal()}}function Vw(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Tp(n,t){return n[0]=t[0],n[1]=t[1],n[4]=t[2],n[5]=t[3],n[12]=t[4],n[13]=t[5],n}const A2=4,Mp="1.3.0";function nP(n,t,e,i,r){r.WIDTH=e[0],r.HEIGHT=e[1];const s=i.getAxisOrientation(),a=$p(r.VERSION,"1.3")>=0;r[a?"CRS":"SRS"]=i.getCode();const o=a&&s.startsWith("ne")?[t[1],t[0],t[3],t[2]]:t;return r.BBOX=o.join(","),jw(n,r)}function rP(n,t,e,i,r,s,a){s=Object.assign({REQUEST:"GetMap"},s);const o=t/e,l=[ly(ke(n)/o,A2),ly(_n(n)/o,A2)];if(e!=1)switch(a){case"geoserver":const c=90*e+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+c:s.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":s.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":s.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return nP(r,n,l,i,s)}function T2(n,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:Mp,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}const sP='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Ww extends K1{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[sP];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",r=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:r,wrapX:t.wrapX,zDirection:t.zDirection})}}class aP extends z1{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,r=t.viewState,s=r.resolution,a=this.getLayer().getSource(),o=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=wa(l,Gr(e.extent,r.projection))),!o[vi.ANIMATING]&&!o[vi.INTERACTING]&&!Wh(l))if(a){const h=r.projection,c=a.getImage(l,s,i,h);c&&(this.loadImage(c)?this.image=c:c.getState()===me.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=Pi(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!mo(s,r))return null;const a=this.image.getExtent(),o=this.image.getImage(),l=ke(a),h=Math.floor(o.width*((r[0]-a[0])/l));if(h<0||h>=o.width)return null;const c=_n(a),u=Math.floor(o.height*((a[3]-r[1])/c));return u<0||u>=o.height?null:this.getImageData(o,h,u)}renderFrame(t,e){const i=this.image,r=i.getExtent(),s=i.getResolution(),[a,o]=Array.isArray(s)?s:[s,s],l=i.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,d=u.center,g=u.resolution,p=c*a/(g*l),y=c*o/(g*l);this.prepareContainer(t,e);const w=this.context.canvas.width,x=this.context.canvas.height,b=this.getRenderContext(t);let L=!1,P=!0;if(h.extent){const q=Gr(h.extent,u.projection);P=ki(q,t.extent),L=P&&!so(q,t.extent),L&&this.clipUnrotated(b,t,q)}const R=i.getImage(),j=Wr(this.tempTransform,w/2,x/2,p,y,0,l*(r[0]-d[0])/a,l*(d[1]-r[3])/o);this.renderedResolution=o*c/l;const k=R.width*j[0],T=R.height*j[3];if(this.getLayer().getSource().getInterpolate()||(b.imageSmoothingEnabled=!1),this.preRender(b,t),P&&k>=.5&&T>=.5){const q=j[4],W=j[5],F=h.opacity;F!==1&&(b.save(),b.globalAlpha=F),b.drawImage(R,0,0,+R.width,+R.height,q,W,k,T),F!==1&&b.restore()}return this.postRender(this.context,t),L&&b.restore(),b.imageSmoothingEnabled=!0,this.container}}class oP extends $h{constructor(t){t=t||{},super(t)}}class lP extends oP{constructor(t){super(t)}createRenderer(){return new aP(this)}getData(t){return super.getData(t)}}const hP=lP;function bm(n,t,e,i){return`${n},${MM(t,e,i)}`}function Em(n,t,e){if(!(e in n))return n[e]=new Set([t]),!0;const i=n[e],r=i.has(t);return r||i.add(t),!r}function cP(n,t,e){const i=n[e];return i?i.delete(t):!1}function M2(n,t){const e=n.layerStatesArray[n.layerIndex];e.extent&&(t=wa(t,Gr(e.extent,n.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(n.viewState.projection).getExtent();r&&(t=wa(t,r))}return t}class Hw extends z1{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Bn(),this.tempTileRange_=new H1(0,0,0,0),this.tempTileCoord_=Yd(0,0,0);const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new TM(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,i,r){const s=this.tileCache_,o=this.getLayer().getSource(),l=bm(o.getKey(),t,e,i);let h;if(s.containsKey(l))h=s.get(l);else{if(h=o.getTile(t,e,i,r.pixelRatio,r.viewState.projection),!h)return null;s.set(l,h)}return h}getTile(t,e,i,r){const s=this.getOrCreateTile(t,e,i,r);return s||null}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=Pi(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!mo(s,r))return null;const a=e.viewState,o=i.getRenderSource(),l=o.getTileGridForProjection(a.projection),h=o.getTilePixelRatio(e.pixelRatio);for(let c=l.getZForResolution(a.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(r,c),d=this.getTile(c,u[1],u[2],e);if(!d||d.getState()!==Qt.LOADED)continue;const g=l.getOrigin(c),p=Dn(l.getTileSize(c)),y=l.getResolution(c);let w;if(d instanceof Uw||d instanceof zw)w=d.getImage();else if(d instanceof C2){if(w=Ap(d.getData()),!w)continue}else continue;const x=Math.floor(h*((r[0]-g[0])/y-u[1]*p[0])),b=Math.floor(h*((g[1]-r[1])/y-u[2]*p[1])),L=Math.round(h*o.getGutterForProjection(a.projection));return this.getImageData(w,x+L,b+L)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const i=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(t,e,i,r,s){const a=t.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=Ht(l);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=o.getMapInternal(),g=Math.max(i-s,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),p=a.rotation,y=p?Bv(a.center,a.resolution,p,t.size):void 0;for(let w=i;w>=g;--w){const x=h.getTileRangeForExtentAndZ(e,w,this.tempTileRange_),b=h.getResolution(w);for(let L=x.minX;L<=x.maxX;++L)for(let P=x.minY;P<=x.maxY;++P){if(p&&!h.tileCoordIntersectsViewport([w,L,P],y))continue;const R=this.getTile(w,L,P,t);if(!R||!Em(r,R,w))continue;const k=R.getKey();if(u[k]=!0,R.getState()===Qt.IDLE&&!t.tileQueue.isKeyQueued(k)){const T=Yd(w,L,P,this.tempTileCoord_);t.tileQueue.enqueue([R,c,h.getTileCoordCenter(T),b])}}}}findStaleTile_(t,e){const i=this.tileCache_,r=t[0],s=t[1],a=t[2],o=this.getStaleKeys();for(let l=0;l<o.length;++l){const h=bm(o[l],r,s,a);if(i.containsKey(h)){const c=i.peek(h);if(c.getState()===Qt.LOADED)return c.endTransition(Ht(this)),Em(e,c,r),!0}}return!1}findAltTiles_(t,e,i,r){const s=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!s)return!1;let a=!0;const o=this.tileCache_,h=this.getLayer().getRenderSource().getKey();for(let c=s.minX;c<=s.maxX;++c)for(let u=s.minY;u<=s.maxY;++u){const d=bm(h,i,c,u);let g=!1;if(o.containsKey(d)){const p=o.peek(d);p.getState()===Qt.LOADED&&(Em(r,p,i),g=!0)}g||(a=!1)}return a}renderFrame(t,e){this.renderComplete=!0;const i=t.layerStatesArray[t.layerIndex],r=t.viewState,s=r.projection,a=r.resolution,o=r.center,l=t.pixelRatio,h=this.getLayer(),c=h.getSource(),u=c.getTileGridForProjection(s),d=u.getZForResolution(a,c.zDirection),g=u.getResolution(d),p=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==p&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=p):this.renderedSourceKey_=p;let y=t.extent;const w=c.getTilePixelRatio(l);this.prepareContainer(t,e);const x=this.context.canvas.width,b=this.context.canvas.height,L=i.extent&&Gr(i.extent);L&&(y=wa(y,Gr(i.extent)));const P=g*x/2/w,R=g*b/2/w,j=[o[0]-P,o[1]-R,o[0]+P,o[1]+R],k={};this.renderedTiles.length=0;const T=h.getPreload();if(t.nextExtent){const J=u.getZForResolution(r.nextResolution,c.zDirection),lt=M2(t,t.nextExtent);this.enqueueTiles(t,lt,J,k,T)}const q=M2(t,y);if(this.enqueueTiles(t,q,d,k,0),T>0&&setTimeout(()=>{this.enqueueTiles(t,q,d-1,k,T-1)},0),!(d in k))return this.container;const W=Ht(this),F=t.time;for(const J of k[d]){const lt=J.getState();if(lt===Qt.EMPTY)continue;const ct=J.tileCoord;if(lt===Qt.LOADED&&J.getAlpha(W,F)===1){J.endTransition(W);continue}if(lt!==Qt.ERROR&&(this.renderComplete=!1),this.findStaleTile_(ct,k)){cP(k,J,d),t.animate=!0;continue}if(this.findAltTiles_(u,ct,d+1,k))continue;const U=u.getMinZoom();for(let H=d-1;H>=U&&!this.findAltTiles_(u,ct,H,k);--H);}const M=g/a*l/w,O=this.getRenderContext(t);Wr(this.tempTransform,x/2,b/2,M,M,0,-x/2,-b/2),i.extent&&this.clipUnrotated(O,t,L),c.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,t);const G=Object.keys(k).map(Number);G.sort(Ds);let tt;const Z=[],it=[];for(let J=G.length-1;J>=0;--J){const lt=G[J],ct=c.getTilePixelSize(lt,l,s),S=u.getResolution(lt)/g,U=ct[0]*S*M,H=ct[1]*S*M,K=u.getTileCoordForCoordAndZ(xo(j),lt),st=u.getTileCoordExtent(K),ht=Pi(this.tempTransform,[w*(st[0]-j[0])/g,w*(j[3]-st[3])/g]),gt=w*c.getGutterForProjection(s);for(const mt of k[lt]){if(mt.getState()!==Qt.LOADED)continue;const Lt=mt.tileCoord,Tt=K[1]-Lt[1],Bt=Math.round(ht[0]-(Tt-1)*U),Gt=K[2]-Lt[2],Jt=Math.round(ht[1]-(Gt-1)*H),pt=Math.round(ht[0]-Tt*U),Y=Math.round(ht[1]-Gt*H),se=Bt-pt,Wt=Jt-Y,Ct=G.length===1;let Pt=!1;tt=[pt,Y,pt+se,Y,pt+se,Y+Wt,pt,Y+Wt];for(let Nt=0,Rt=Z.length;Nt<Rt;++Nt)if(!Ct&&lt<it[Nt]){const Ut=Z[Nt];ki([pt,Y,pt+se,Y+Wt],[Ut[0],Ut[3],Ut[4],Ut[7]])&&(Pt||(O.save(),Pt=!0),O.beginPath(),O.moveTo(tt[0],tt[1]),O.lineTo(tt[2],tt[3]),O.lineTo(tt[4],tt[5]),O.lineTo(tt[6],tt[7]),O.moveTo(Ut[6],Ut[7]),O.lineTo(Ut[4],Ut[5]),O.lineTo(Ut[2],Ut[3]),O.lineTo(Ut[0],Ut[1]),O.clip())}Z.push(tt),it.push(lt),this.drawTile(mt,t,pt,Y,se,Wt,gt,Ct),Pt&&O.restore(),this.renderedTiles.unshift(mt),this.updateUsedTiles(t.usedTiles,c,mt)}}if(this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!Ko(this.renderedExtent_,j),this.renderedExtent_=j,this.renderedPixelRatio=l,this.postRender(this.context,t),i.extent&&O.restore(),O.imageSmoothingEnabled=!0,this.renderComplete){const J=(lt,ct)=>{const Et=Ht(c),S=ct.wantedTiles[Et],U=S?Object.keys(S).length:0;this.updateCacheSize(U),this.tileCache_.expireCache()};t.postRenderFunctions.push(J)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,i,r,s,a,o,l){let h;if(t instanceof C2){if(h=Ap(t.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=Ht(this),d=e.layerStatesArray[e.layerIndex],g=d.opacity*(l?t.getAlpha(u,e.time):1),p=g!==c.globalAlpha;p&&(c.save(),c.globalAlpha=g),c.drawImage(h,o,o,h.width-2*o,h.height-2*o,i,r,s,a),p&&c.restore(),g!==d.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,i){const r=Ht(e);r in t||(t[r]={}),t[r][i.getKey()]=!0}}const co={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class uP extends $h{constructor(t){t=t||{};const e=Object.assign({},t),i=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(co.PRELOAD)}setPreload(t){this.set(co.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(co.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(co.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class fP extends uP{constructor(t){super(t)}createRenderer(){return new Hw(this,{cacheSize:this.getCacheSize()})}}const Xe=fP;class Si extends Dg{constructor(t){t=t||{};const e=Object.assign({},t.params);super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=Bn(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,r){const s=di(i),a=this.getProjection()||s;let o=this.getTileGrid();o||(o=this.getTileGridForProjection(a));const l=Kn(t,s,a),h=Cp(a,s,t,e),c=o.getZForResolution(h,this.zDirection),u=o.getResolution(c),d=o.getTileCoordForCoordAndZ(l,c);if(o.getResolutions().length<=d[0])return;let g=o.getTileCoordExtent(d,this.tmpExtent_);const p=this.gutter_;p!==0&&(g=Vr(g,u*p,g));const y={QUERY_LAYERS:this.params_.LAYERS};Object.assign(y,T2(this.params_,"GetFeatureInfo"),r);const w=Math.floor((l[0]-g[0])/u),x=Math.floor((g[3]-l[1])/u);return y[this.v13_?"I":"X"]=w,y[this.v13_?"J":"Y"]=x,this.getRequestUrl_(d,g,1,a||s,y)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:Mp,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;i.LAYER=r}if(t!==void 0){const r=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;i.SCALE=t*r/s}return Object.assign(i,e),jw(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,r,s){const a=this.urls;if(!a)return;let o;if(a.length==1)o=a[0];else{const l=uo(Ow(t),a.length);o=a[l]}return rP(e,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),i,r,o,s,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}setParams_(t){this.params_=t,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(t){this.setParams_(Object.assign({},t))}updateParams(t){this.setParams_(Object.assign(this.params_,t))}updateV13_(){const t=this.params_.VERSION||Mp;this.v13_=$p(t,"1.3")>=0}tileUrlFunction(t,e,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const s=r.getResolution(t[0]);let a=r.getTileCoordExtent(t,this.tmpExtent_);const o=this.gutter_;o!==0&&(a=Vr(a,s*o,a));const l=Object.assign({},T2(this.params_,"GetMap"));return this.getRequestUrl_(t,a,e,i,l)}}const Z1=34962,J1=34963,dP=35040,gP=35044,Pp=35048,mP=5121,pP=5123,_P=5125,$w=5126,P2=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function yP(n,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!rE},t);const e=P2.length;for(let i=0;i<e;++i)try{const r=n.getContext(P2[i],t);if(r)return r}catch{}return null}const vP={STATIC_DRAW:gP,STREAM_DRAW:dP,DYNAMIC_DRAW:Pp};class R2{constructor(t,e){this.array_=null,this.type_=t,Be(t===Z1||t===J1,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:vP.STATIC_DRAW}ofSize(t){return this.array_=new(td(this.type_))(t),this}fromArray(t){return this.array_=td(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(td(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){const e=td(this.type_);if(!(t instanceof e))throw new Error(`Expected ${e}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function td(n){switch(n){case Z1:return Float32Array;case J1:return Uint32Array;default:return Float32Array}}const ed={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},wP=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,xP=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class I2{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t.vertexShader||wP),e.compileShader(i);const r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t.fragmentShader||xP),e.compileShader(r),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,i),e.attachShader(this.renderTargetProgram_,r),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(a=>{this.uniforms_.push({value:t.uniforms[a],location:e.getUniformLocation(this.renderTargetProgram_,a)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){const e=this.getGL(),i=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const r=0,s=e.RGBA,a=0,o=e.RGBA,l=e.UNSIGNED_BYTE,h=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,r,s,i[0],i[1],a,o,l,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i[0],i[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,i,r){const s=this.getGL(),a=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const l=Ht(s.canvas);if(!t.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const o=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(t),i&&i(s,t),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let i,r=1;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(t):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${r}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,i.width,i.height,0,e.UNSIGNED_BYTE,new Uint8Array(i.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.uniform1i(s.location,r++);else if(Array.isArray(i))switch(i.length){case 2:e.uniform2f(s.location,i[0],i[1]);return;case 3:e.uniform3f(s.location,i[0],i[1],i[2]);return;case 4:e.uniform4f(s.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&e.uniform1f(s.location,i)})}}const da={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Vn={UNSIGNED_BYTE:mP,UNSIGNED_SHORT:pP,UNSIGNED_INT:_P,FLOAT:$w},Kd={};function N2(n){return"shared/"+n}let F2=0;function bP(){const n="unique/"+F2;return F2+=1,n}function EP(n){let t=Kd[n];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:yP(e)},Kd[n]=t}return t.users+=1,t.context}function SP(n){const t=Kd[n];if(!t||(t.users-=1,t.users>0))return;const e=t.context,i=e.getExtension("WEBGL_lose_context");i&&i.loseContext();const r=e.canvas;r.width=1,r.height=1,delete Kd[n]}class LP extends Su{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?N2(t.canvasCacheKey):bP(),this.gl_=EP(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(ed.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(ed.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Zi(),this.offsetScaleMatrix_=Zi(),this.tmpMat4_=Vw(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(i=>new I2({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new I2({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===N2(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,i=Ht(t);let r=this.bufferCache_[i];if(!r){const s=e.createBuffer();r={buffer:t,webGlBuffer:s},this.bufferCache_[i]=r}e.bindBuffer(t.getType(),r.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=Ht(t);delete this.bufferCache_[e]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(ed.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(ed.RESTORED,this.boundHandleWebGLContextRestored_),SP(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,i){const r=this.gl_,s=this.getCanvas(),a=t.size,o=t.pixelRatio;(s.width!==a[0]*o||s.height!==a[1]*o)&&(s.width=a[0]*o,s.height=a[1]*o,s.style.width=a[0]+"px",s.style.height=a[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,e?r.ZERO:r.ONE_MINUS_SRC_ALPHA),i?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindFrameBuffer(t,e){const i=this.getGL();i.bindFramebuffer(i.FRAMEBUFFER,t),e&&i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0)}bindInitialFrameBuffer(){const t=this.getGL(),e=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);const i=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0)}bindTexture(t,e,i){const r=this.gl_;r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.getUniformLocation(i),e)}bindAttribute(t,e,i){const r=this.getGL();this.bindBuffer(t);const s=this.getAttributeLocation(e);r.enableVertexAttribArray(s),r.vertexAttribPointer(s,i,r.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,e,i,r){const s=this.gl_,a=e.getSize();s.bindFramebuffer(s.FRAMEBUFFER,e.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,e.getDepthbuffer()),s.viewport(0,0,a[0],a[1]),s.bindTexture(s.TEXTURE_2D,e.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,i?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,e){const i=this.gl_;this.getExtension("OES_element_index_uint");const r=i.UNSIGNED_INT,s=4,a=e-t,o=t*s;i.drawElements(i.TRIANGLES,a,r,o)}finalizeDraw(t,e,i){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(t,null,e,i):this.postProcessPasses_[r].apply(t,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,i=t.viewState.rotation,r=t.pixelRatio;this.setUniformFloatValue(da.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(da.ZOOM,t.viewState.zoom),this.setUniformFloatValue(da.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(da.PIXEL_RATIO,r),this.setUniformFloatVec2(da.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(da.ROTATION,i)}applyHitDetectionUniform(t){const e=this.getUniformLocation(da.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(da.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let i,r=0;this.uniforms_.forEach(s=>{if(i=typeof s.value=="function"?s.value(t):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData||i instanceof WebGLTexture){i instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=i):s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),this.bindTexture(s.texture,r,s.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=!(i instanceof HTMLImageElement)||i.complete;!(i instanceof WebGLTexture)&&a&&s.prevValue!==i&&(s.prevValue=i,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)),r++}else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(s.name,Tp(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:e.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);return;case 3:e.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);return;case 4:e.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&e.uniform1f(this.getUniformLocation(s.name),i)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,e&&(this.applyFrameState(e),this.applyUniforms(e))}compileShader(t,e){const i=this.gl_,r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}getProgram(t,e){const i=this.gl_,r=this.compileShader(t,i.FRAGMENT_SHADER),s=this.compileShader(e,i.VERTEX_SHADER),a=i.createProgram();if(i.attachShader(a,r),i.attachShader(a,s),i.linkProgram(a),!i.getShaderParameter(r,i.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(o)}if(i.deleteShader(r),!i.getShaderParameter(s,i.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(o)}if(i.deleteShader(s),!i.getProgramParameter(a,i.LINK_STATUS)){const o=`GL program linking failed: ${i.getProgramInfoLog(a)}`;throw new Error(o)}return a}getUniformLocation(t){const e=Ht(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=Ht(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const i=t.size,r=t.viewState.rotation,s=t.viewState.resolution,a=t.viewState.center;return Wr(e,0,0,2/(s*i[0]),2/(s*i[1]),-r,-a[0],-a[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,i,r,s){const a=this.getAttributeLocation(t);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,e,i,!1,r,s))}enableAttributes(t){const e=CP(t);let i=0;for(let r=0;r<t.length;r++){const s=t[r];this.enableAttributeArray_(s.name,s.size,s.type||$w,e,i),i+=s.size*Xw(s.type)}}handleWebGLContextLost(t){rl(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,i,r){const s=this.gl_;i=i||s.createTexture();const a=r?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const o=0,l=s.RGBA,h=0,c=s.RGBA,u=s.UNSIGNED_BYTE;return e instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,o,l,t[0],t[1],h,c,u,e):e?s.texImage2D(s.TEXTURE_2D,o,l,c,u,e):s.texImage2D(s.TEXTURE_2D,o,l,t[0],t[1],h,c,u,null),i}}function CP(n){let t=0;for(let e=0;e<n.length;e++){const i=n[e];t+=i.size*Xw(i.type)}return t}function Xw(n){switch(n){case Vn.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Vn.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Vn.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Vn.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Q1 extends pw{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=Zi(),this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener($e.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(pn.PRECOMPOSE)){const r=new $c(pn.PRECOMPOSE,void 0,e,t);i.dispatchEvent(r)}}dispatchPostComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(pn.POSTCOMPOSE)){const r=new $c(pn.POSTCOMPOSE,void 0,e,t);i.dispatchEvent(r)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,i=-1,r;for(let a=0,o=t.layerStatesArray.length;a<o;a++){const l=t.layerStatesArray[a].layer,h=l.getRenderer();if(!(h instanceof Q1)){e=!0;continue}const c=l.getClassName();if((e||c!==r)&&(i+=1,e=!1),r=c,h===this)break}const s="map/"+t.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new LP({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){var t;this.clearCache(),this.removeHelper(),(t=this.getLayer())==null||t.removeChangeListener($e.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){Wr(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new $c(t,this.inversePixelTransform_,i,e);r.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(pn.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(pn.POSTRENDER,t,e)}}const AP={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};const Sm={...AP,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"};class TP{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}}function MP(n,t){return`operator_${n}_${Object.keys(t.functions).length}`}function fo(n){const t=n.toString();return t.includes(".")?t:t+".0"}function t_(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(fo).join(", ")})`}function _d(n){const t=Hr(n),e=t.length>3?t[3]:1;return t_([t[0]/255,t[1]/255,t[2]/255,e])}function PP(n){const t=Dn(n);return t_(t)}const Lm={};let RP=0;function yu(n){return n in Lm||(Lm[n]=RP++),Lm[n]}function pa(n){return fo(yu(n))}function e_(n){return"u_var_"+n}function Yw(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const Cm="getBandValue",IP="u_paletteTextures",Kw="featureId",Zw="geometryType",Rp=-9999999;function NP(n,t,e,i){const r=yn(n,t,e);return i_(r,t,i)}function Ve(n){return(t,e,i)=>{const r=e.args.length,s=new Array(r);for(let a=0;a<r;++a)s[a]=i_(e.args[a],i,t);return n(s,t)}}const FP={[ut.Get]:(n,t)=>{const i=t.args[0].value;return i in n.properties||(n.properties[i]={name:i,type:t.type}),"a_prop_"+i},[ut.Id]:n=>(n.featureId=!0,"a_"+Kw),[ut.GeometryType]:n=>(n.geometryType=!0,"a_"+Zw),[ut.LineMetric]:()=>"currentLineMetric",[ut.Var]:(n,t)=>{const i=t.args[0].value;return i in n.variables||(n.variables[i]={name:i,type:t.type}),e_(i)},[ut.Has]:(n,t)=>{const i=t.args[0].value;return i in n.properties||(n.properties[i]={name:i,type:t.type}),`(a_prop_${i} != ${fo(Rp)})`},[ut.Resolution]:()=>"u_resolution",[ut.Zoom]:()=>"u_zoom",[ut.Time]:()=>"u_time",[ut.Any]:Ve(n=>`(${n.join(" || ")})`),[ut.All]:Ve(n=>`(${n.join(" && ")})`),[ut.Not]:Ve(([n])=>`(!${n})`),[ut.Equal]:Ve(([n,t])=>`(${n} == ${t})`),[ut.NotEqual]:Ve(([n,t])=>`(${n} != ${t})`),[ut.GreaterThan]:Ve(([n,t])=>`(${n} > ${t})`),[ut.GreaterThanOrEqualTo]:Ve(([n,t])=>`(${n} >= ${t})`),[ut.LessThan]:Ve(([n,t])=>`(${n} < ${t})`),[ut.LessThanOrEqualTo]:Ve(([n,t])=>`(${n} <= ${t})`),[ut.Multiply]:Ve(n=>`(${n.join(" * ")})`),[ut.Divide]:Ve(([n,t])=>`(${n} / ${t})`),[ut.Add]:Ve(n=>`(${n.join(" + ")})`),[ut.Subtract]:Ve(([n,t])=>`(${n} - ${t})`),[ut.Clamp]:Ve(([n,t,e])=>`clamp(${n}, ${t}, ${e})`),[ut.Mod]:Ve(([n,t])=>`mod(${n}, ${t})`),[ut.Pow]:Ve(([n,t])=>`pow(${n}, ${t})`),[ut.Abs]:Ve(([n])=>`abs(${n})`),[ut.Floor]:Ve(([n])=>`floor(${n})`),[ut.Ceil]:Ve(([n])=>`ceil(${n})`),[ut.Round]:Ve(([n])=>`floor(${n} + 0.5)`),[ut.Sin]:Ve(([n])=>`sin(${n})`),[ut.Cos]:Ve(([n])=>`cos(${n})`),[ut.Atan]:Ve(([n,t])=>t!==void 0?`atan(${n}, ${t})`:`atan(${n})`),[ut.Sqrt]:Ve(([n])=>`sqrt(${n})`),[ut.Match]:Ve(n=>{const t=n[0],e=n[n.length-1];let i=null;for(let r=n.length-3;r>=1;r-=2){const s=n[r],a=n[r+1];i=`(${t} == ${s} ? ${a} : ${i||e})`}return i}),[ut.Between]:Ve(([n,t,e])=>`(${n} >= ${t} && ${n} <= ${e})`),[ut.Interpolate]:Ve(([n,t,...e])=>{let i="";for(let r=0;r<e.length-2;r+=2){const s=e[r],a=i||e[r+1],o=e[r+2],l=e[r+3];let h;n===fo(1)?h=`(${t} - ${s}) / (${o} - ${s})`:h=`(pow(${n}, (${t} - ${s})) - 1.0) / (pow(${n}, (${o} - ${s})) - 1.0)`,i=`mix(${a}, ${l}, clamp(${h}, 0.0, 1.0))`}return i}),[ut.Case]:Ve(n=>{const t=n[n.length-1];let e=null;for(let i=n.length-3;i>=0;i-=2){const r=n[i],s=n[i+1];e=`(${r} ? ${s} : ${e||t})`}return e}),[ut.In]:Ve(([n,...t],e)=>{const i=MP("in",e),r=[];for(let s=0;s<t.length;s+=1)r.push(`  if (inputValue == ${t[s]}) { return true; }`);return e.functions[i]=`bool ${i}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${i}(${n})`}),[ut.Array]:Ve(n=>`vec${n.length}(${n.join(", ")})`),[ut.Color]:Ve(n=>{if(n.length===1)return`vec4(vec3(${n[0]} / 255.0), 1.0)`;if(n.length===2)return`vec4(vec3(${n[0]} / 255.0), ${n[1]})`;const t=n.slice(0,3).map(i=>`${i} / 255.0`);if(n.length===3)return`vec4(${t.join(", ")}, 1.0)`;const e=n[3];return`vec4(${t.join(", ")}, ${e})`}),[ut.Band]:Ve(([n,t,e],i)=>{if(!(Cm in i.functions)){let r="";const s=i.bandCount||1;for(let a=0;a<s;a++){const o=Math.floor(a/4);let l=a%4;a===s-1&&l===1&&(l=3);const h=`${Sm.TILE_TEXTURE_ARRAY}[${o}]`;r+=`  if (band == ${a+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}i.functions[Cm]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Sm.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Sm.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${Cm}(${n}, ${t??"0.0"}, ${e??"0.0"})`}),[ut.Palette]:(n,t)=>{const[e,...i]=t.args,r=i.length,s=new Uint8Array(r*4);for(let h=0;h<i.length;h++){const c=i[h].value,u=Hr(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}n.paletteTextures||(n.paletteTextures=[]);const a=`${IP}[${n.paletteTextures.length}]`,o=new TP(a,s);n.paletteTextures.push(o);const l=i_(e,Xt,n);return`texture2D(${a}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function i_(n,t,e){if(n instanceof C5){const i=FP[n.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(n.operator)}`);return i(e,n,t)}if((n.type&Xt)>0)return fo(n.value);if((n.type&nn)>0)return n.value.toString();if((n.type&rn)>0)return pa(n.value.toString());if((n.type&Li)>0)return _d(n.value);if((n.type&Zn)>0)return t_(n.value);if((n.type&ds)>0)return PP(n.value);throw new Error(`Unexpected expression ${n.value} (expected type ${lh(t)})`)}function kP(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const k2=.985,Yl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders
`,Kl=kP();class Jw{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${fo(Kl["circle-radius"])} + ${fo(Kl["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=_d(Kl["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=fo(Kl["stroke-width"]),this.strokeColorExpression_=_d(Kl["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=pa("round"),this.strokeJoinExpression_=pa("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=_d(Kl["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t,e,i,r){return this.attributes_.push({name:t,type:e,varyingName:t.replace(/^a_/,"v_"),varyingType:r??e,varyingExpression:i??t}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){return this.vertexShaderFunctions_.includes(t)?this:(this.vertexShaderFunctions_.push(t),this)}addFragmentShaderFunction(t){return this.fragmentShaderFunctions_.includes(t)?this:(this.fragmentShaderFunctions_.push(t),this)}getSymbolVertexShader(){return this.hasSymbol_?`${Yl}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Yl}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Yl}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;

varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${k2} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Yl}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${k2}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${pa("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${pa("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${pa("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${pa("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
      
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));
  float currentLengthPx = lengthToPoint + v_distanceOffsetPx;
  float currentRadiusPx = distanceFromSegment(currentPoint, v_segmentStart, v_segmentEnd);
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPoint / segmentLength);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Yl}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Yl}
${this.uniforms_.map(t=>`uniform ${t};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}function pe(n,t,e){const i=Sg();return NP(t,e,i,n)}function OP(n){const t=Hr(n),e=t[0]*256,i=t[1],r=t[2]*256,s=Math.round(t[3]*255);return[e+i,r+s]}const DP=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    fract(packedColor[1] / 256.0)
  );
}`;function n_(n){return n===Li||n===ds?2:n===Zn?4:1}function Ip(n){const t=n_(n);return t>1?`vec${t}`:"float"}function Qw(n,t){for(const e in t.variables){const i=t.variables[e],r=e_(i.name);let s=Ip(i.type);i.type===Li&&(s="vec4"),n.addUniform(`${s} ${r}`)}for(const e in t.properties){const i=t.properties[e],r=Ip(i.type),s=`a_prop_${i.name}`;i.type===Li?(n.addAttribute(s,r,`unpackColor(${s})`,"vec4"),n.addVertexShaderFunction(DP)):n.addAttribute(s,r)}for(const e in t.functions)n.addVertexShaderFunction(t.functions[e]),n.addFragmentShaderFunction(t.functions[e])}function tx(n,t){const e={};for(const i in n.variables){const r=n.variables[i],s=e_(r.name);e[s]=()=>{const a=t[r.name];return typeof a=="number"?a:typeof a=="boolean"?a?1:0:r.type===Li?Hr(a||"#eee"):typeof a=="string"?yu(a):a}}return e}function ex(n){const t={};for(const e in n.properties){const i=n.properties[e],r=s=>{const a=s.get(i.name);return i.type===Li?OP([...Hr(a||"#eee")]):typeof a=="string"?yu(a):typeof a=="boolean"?a?1:0:a};t[`prop_${i.name}`]={size:n_(i.type),callback:r}}return t}class Zd{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(t,e){for(let i=0;i<t.length;i++)this.addFeature(t[i],e)}addFeature(t,e){let i=t.getGeometry();i&&(e&&(i=i.clone(),i.applyTransform(e)),this.addGeometry_(i,t))}clearFeatureEntryInPointBatch_(t){const e=Ht(t),i=this.pointBatch.entries[e];if(i)return this.pointBatch.geometriesCount-=i.flatCoordss.length,delete this.pointBatch.entries[e],i}clearFeatureEntryInLineStringBatch_(t){const e=Ht(t),i=this.lineStringBatch.entries[e];if(i)return this.lineStringBatch.verticesCount-=i.verticesCount,this.lineStringBatch.geometriesCount-=i.flatCoordss.length,delete this.lineStringBatch.entries[e],i}clearFeatureEntryInPolygonBatch_(t){const e=Ht(t),i=this.polygonBatch.entries[e];if(i)return this.polygonBatch.verticesCount-=i.verticesCount,this.polygonBatch.ringsCount-=i.ringsCount,this.polygonBatch.geometriesCount-=i.flatCoordss.length,delete this.polygonBatch.entries[e],i}addGeometry_(t,e){var r;const i=t.getType();switch(i){case"GeometryCollection":{const s=t.getGeometriesArray();for(const a of s)this.addGeometry_(a,e);break}case"MultiPolygon":{const s=t;this.addCoordinates_(i,s.getFlatCoordinates(),s.getEndss(),e,Ht(e),s.getStride());break}case"MultiLineString":{const s=t;this.addCoordinates_(i,s.getFlatCoordinates(),s.getEnds(),e,Ht(e),s.getStride());break}case"MultiPoint":{const s=t;this.addCoordinates_(i,s.getFlatCoordinates(),null,e,Ht(e),s.getStride());break}case"Polygon":{const s=t;this.addCoordinates_(i,s.getFlatCoordinates(),s.getEnds(),e,Ht(e),s.getStride());break}case"Point":{const s=t;this.addCoordinates_(i,s.getFlatCoordinates(),null,e,Ht(e),s.getStride());break}case"LineString":case"LinearRing":{const s=t,a=s.getStride();this.addCoordinates_(i,s.getFlatCoordinates(),null,e,Ht(e),a,(r=s.getLayout)==null?void 0:r.call(s));break}}}addCoordinates_(t,e,i,r,s,a,o){let l;switch(t){case"MultiPolygon":{const h=i;for(let c=0,u=h.length;c<u;c++){let d=h[c];const g=c>0?h[c-1]:null,p=g?g[g.length-1]:0,y=d[d.length-1];d=p>0?d.map(w=>w-p):d,this.addCoordinates_("Polygon",e.slice(p,y),d,r,s,a,o)}break}case"MultiLineString":{const h=i;for(let c=0,u=h.length;c<u;c++){const d=c>0?h[c-1]:0;this.addCoordinates_("LineString",e.slice(d,h[c]),null,r,s,a,o)}break}case"MultiPoint":for(let h=0,c=e.length;h<c;h+=a)this.addCoordinates_("Point",e.slice(h,h+2),null,r,s,null,null);break;case"Polygon":{const h=i;if(r instanceof hr){const d=d5(e,h);if(d.length>1){this.addCoordinates_("MultiPolygon",e,d,r,s,a,o);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:r,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=e.length/a;const c=i.length,u=i.map((d,g,p)=>g>0?(d-p[g-1])/a:d/a);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=c,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(BP(e,a)),this.polygonBatch.entries[s].ringsVerticesCounts.push(u),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=c;for(let d=0,g=h.length;d<g;d++){const p=d>0?h[d-1]:0;this.addCoordinates_("LinearRing",e.slice(p,h[d]),null,r,s,a,o)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:r,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(e);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:r,flatCoordss:[],verticesCount:0})),l=e.length/a,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(GP(e,a,o)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(t,e){const i=this.uidToRef_.get(t),r=i||this.freeGlobalRef_.pop()||++this.globalCounter_;return e.ref=r,i||(this.refToFeature_.set(r,e.feature),this.uidToRef_.set(t,r)),e}removeRef_(t,e){if(!t)throw new Error("This feature has no ref: "+e);this.refToFeature_.delete(t),this.uidToRef_.delete(e),this.freeGlobalRef_.push(t)}changeFeature(t){if(!this.uidToRef_.get(Ht(t)))return;this.removeFeature(t);const e=t.getGeometry();e&&this.addGeometry_(e,t)}removeFeature(t){let e=this.clearFeatureEntryInPointBatch_(t);e=this.clearFeatureEntryInPolygonBatch_(t)||e,e=this.clearFeatureEntryInLineStringBatch_(t)||e,e&&this.removeRef_(e.ref,Ht(e.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(t){return this.refToFeature_.get(t)}isEmpty(){return this.globalCounter_===0}filter(t){const e=new Zd;e.globalCounter_=this.globalCounter_,e.uidToRef_=this.uidToRef_,e.refToFeature_=this.refToFeature_;let i=!0;for(const r of this.refToFeature_.values())t(r)&&(e.addFeature(r),i=!1);return i?new Zd:e}}function BP(n,t){return t===2?n:n.filter((e,i)=>i%t<2)}function GP(n,t,e){return t===3&&e==="XYM"?n:t===4?n.filter((i,r)=>r%t!==2):t===3?n.map((i,r)=>r%t!==2?i:0):new Array(n.length*1.5).fill(0).map((i,r)=>r%3===2?0:n[Math.round(r/1.5)])}function jP(){const n='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let u=e(t,0,i,x,!0);const l=[];if(!u||u.next===u.prev)return l;let c,h,y;if(o&&(u=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const u=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);u===u.next&&(u.steiner=!0),o.push(a(u))}o.sort(f);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,u,x)),t.length>80*x){c=1/0,h=1/0;let e=-1/0,n=-1/0;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<h&&(h=o),x>e&&(e=x),o>n&&(n=o)}y=Math.max(e-c,n-h),y=0!==y?32767/y:0}return r(u,l,x,c,h,y,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=w(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=w(x/r|0,t[x],t[x+1],o);return o&&g(o,o.next)&&(A(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(A(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,f,s,l,a,h){if(!t)return;!h&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,u=0;for(let t=0;t<n&&(u++,i=i.nextZ,i);t++);let f=n;for(;u>0||f>0&&i;)0!==u&&(0===f||!i||x.z<=i.z)?(r=x,x=x.nextZ,u--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let y=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),A(t),t=p.next,y=p.next;else if((t=p)===y){h?1===h?r(t=i(n(t),e),e,f,s,l,a,2):2===h&&u(t,e,f,s,l,a):r(n(t),e,f,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,u=e.y,f=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(u,f,s),a=Math.max(x,o,i),h=Math.max(u,f,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=h&&y(x,u,o,f,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const u=x.x,f=o.x,s=i.x,l=x.y,a=o.y,h=i.y,p=Math.min(u,f,s),g=Math.min(l,a,h),b=Math.max(u,f,s),M=Math.max(l,a,h),m=c(p,g,e,n,r),Z=c(b,M,e,n,r);let d=t.prevZ,w=t.nextZ;for(;d&&d.z>=m&&w&&w.z<=Z;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;d&&d.z>=m;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;w&&w.z<=Z;){if(w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!g(n,x)&&b(n,r,r.next,x)&&Z(n,x)&&Z(x,n)&&(e.push(n.i,r.i,x.i),A(r),A(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function u(t,e,x,o,i,u){let f=t;do{let t=f.next.next;for(;t!==f.prev;){if(f.i!==t.i&&p(f,t)){let s=d(f,t);return f=n(f,f.next),s=n(s,s.next),r(f,e,x,o,i,u,0),void r(s,e,x,o,i,u,0)}t=t.next}f=f.next}while(f!==t)}function f(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(g(t,n))return n;do{if(g(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const u=o,f=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&h(x<s?r:i,x,f,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);Z(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==u);return o}(t,e);if(!r)return e;const x=d(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function h(t,e,n,r,x,o,i,u){return(x-i)*(e-u)>=(t-i)*(o-u)&&(t-i)*(r-u)>=(n-i)*(e-u)&&(n-i)*(o-u)>=(x-i)*(r-u)}function y(t,e,n,r,x,o,i,u){return!(t===i&&e===u)&&h(t,e,n,r,x,o,i,u)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Z(t,e)&&Z(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||g(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){const x=m(v(t,e,n)),o=m(v(t,e,r)),i=m(v(n,r,t)),u=m(v(n,r,e));return x!==o&&i!==u||(!(0!==x||!M(t,n,e))||(!(0!==o||!M(t,r,e))||(!(0!==i||!M(n,t,r))||!(0!==u||!M(n,e,r)))))}function M(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function m(t){return t>0?1:t<0?-1:0}function Z(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function d(t,e){const n=E(t.i,t.x,t.y),r=E(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(t,e,n,r){const x=E(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function I(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function z(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],u=e[3],f=e[4],s=e[5];return t[0]=u/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-u*f)/n,t[5]=-(x*s-o*f)/n,t}new Array(6);const F=[],P={vertexPosition:0,indexPosition:0};function B(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function N(t,e,n,r,x,o){const i=3+x,u=t[e+0],f=t[e+1],s=F;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/i;return B(n,l,u,f,0),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,1),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,2),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,3),s.length&&n.set(s,l+3),l+=i,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,P.vertexPosition=l,P.indexPosition=c,P}function R(t,e,n,r,x,o,i,u,f,s,l){const c=10+u.length,a=o.length/c,h=[t[e+0],t[e+1]],y=[t[n],t[n+1]],p=t[e+2],v=t[n+2],g=I(f,[...h]),b=I(f,[...y]);function M(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),u=[(n[0]-t[0])/i,(n[1]-t[1])/i],f=0===r||0===i?0:Math.acos((s=u[0]*x[0]+u[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return u[0]*o[0]+u[1]*o[1]>0?f:2*Math.PI-f}let m=-1,Z=-1,d=l;const w=null!==x;if(null!==r){m=M(g,b,I(f,[...[t[r],t[r+1]]])),Math.cos(m)<=.985&&(d+=Math.tan((m-Math.PI)/2))}if(w){Z=M(b,g,I(f,[...[t[x],t[x+1]]])),Math.cos(Z)<=.985&&(d+=Math.tan((Math.PI-Z)/2))}function A(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(0,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(1,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(2,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(3,l)),o.push(...u),i.push(a,a+1,a+2,a+1,a+3,a+2),{length:s+Math.sqrt((b[0]-g[0])*(b[0]-g[0])+(b[1]-g[1])*(b[1]-g[1])),angle:d}}function S(e,n,r,x,o){const i=2+o;let u=n;const f=e.slice(u,u+o);u+=o;const s=e[u++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[u++],t<s-1&&(c[t]=l);const a=e.slice(u,u+2*l),h=t(a,c,2);for(let t=0;t<h.length;t++)x.push(h[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...f);return u+2*l}const T="GENERATE_POLYGON_BUFFERS",_="GENERATE_POINT_BUFFERS",O="GENERATE_LINE_STRING_BUFFERS",U=self;U.onmessage=t=>{const e=t.data;switch(e.type){case _:{const t=3,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x,u=4*i*(r+t),f=new Uint32Array(6*i),s=new Float32Array(u);let l;for(let t=0;t<o.length;t+=x)l=N(o,t,s,f,r,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:o.buffer},e);U.postMessage(c,[s.buffer,f.buffer,o.buffer]);break}case O:{const t=[],n=[],r=e.customAttributesSize,x=3,o=new Float32Array(e.renderInstructions);let i=0;const u=[1,0,0,1,0,0];let f,s;for(z(u,e.renderInstructionsTransform);i<o.length;){s=Array.from(o.slice(i,i+r)),i+=r,f=o[i++];const e=i,l=i+(f-1)*x,c=o[e]===o[l]&&o[e+1]===o[l+1];let a=0,h=0;for(let r=0;r<f-1;r++){let y=null;r>0?y=i+(r-1)*x:c&&(y=l-x);let p=null;r<f-2?p=i+(r+2)*x:c&&(p=e+x);const v=R(o,i+r*x,i+(r+1)*x,y,p,t,n,s,u,a,h);a=v.length,h=v.angle}i+=f*x}const l=Uint32Array.from(n),c=Float32Array.from(t),a=Object.assign({vertexBuffer:c.buffer,indexBuffer:l.buffer,renderInstructions:o.buffer},e);U.postMessage(a,[c.buffer,l.buffer,o.buffer]);break}case T:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=S(x,o,t,n,r);const i=Uint32Array.from(n),u=Float32Array.from(t),f=Object.assign({vertexBuffer:u.buffer,indexBuffer:i.buffer,renderInstructions:x.buffer},e);U.postMessage(f,[u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(n,"binary").toString("base64"):URL.createObjectURL(new Blob([n],{type:"application/javascript"})))}const Am={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function UP(n,t){t=t||[];const e=256,i=e-1;return t[0]=Math.floor(n/e/e/e)/i,t[1]=Math.floor(n/e/e)%e/i,t[2]=Math.floor(n/e)%e/i,t[3]=n%e/i,t}function zP(n){let t=0;const e=256,i=e-1;return t+=Math.round(n[0]*e*e*e*i),t+=Math.round(n[1]*e*e*i),t+=Math.round(n[2]*e*i),t+=Math.round(n[3]*i),t}function r_(n,t,e,i){let r=0;for(const s in t){const a=t[s],o=a.callback.call(e,e.feature);let l=(o==null?void 0:o[0])??o;l===Rp&&console.warn('The "has" operator might return false positives.'),l===void 0?l=Rp:l===null&&(l=0),n[i+r++]=l,!(!a.size||a.size===1)&&(n[i+r++]=o[1],!(a.size<3)&&(n[i+r++]=o[2],!(a.size<4)&&(n[i+r++]=o[3])))}return r}function Bg(n){return Object.keys(n).reduce((t,e)=>t+(n[e].size||1),0)}function qP(n,t,e,i){const r=(2+Bg(e))*n.geometriesCount;(!t||t.length!==r)&&(t=new Float32Array(r));const s=[];let a=0;for(const o in n.entries){const l=n.entries[o];for(let h=0,c=l.flatCoordss.length;h<c;h++)s[0]=l.flatCoordss[h][0],s[1]=l.flatCoordss[h][1],Pi(i,s),t[a++]=s[0],t[a++]=s[1],a+=r_(t,e,l,a)}return t}function VP(n,t,e,i){const r=3*n.verticesCount+(1+Bg(e))*n.geometriesCount;(!t||t.length!==r)&&(t=new Float32Array(r));const s=[];let a=0;for(const o in n.entries){const l=n.entries[o];for(let h=0,c=l.flatCoordss.length;h<c;h++){s.length=l.flatCoordss[h].length,Bs(l.flatCoordss[h],0,s.length,3,i,s,3),a+=r_(t,e,l,a),t[a++]=s.length/3;for(let u=0,d=s.length;u<d;u+=3)t[a++]=s[u],t[a++]=s[u+1],t[a++]=s[u+2]}}return t}function WP(n,t,e,i){const r=2*n.verticesCount+(1+Bg(e))*n.geometriesCount+n.ringsCount;(!t||t.length!==r)&&(t=new Float32Array(r));const s=[];let a=0;for(const o in n.entries){const l=n.entries[o];for(let h=0,c=l.flatCoordss.length;h<c;h++){s.length=l.flatCoordss[h].length,Bs(l.flatCoordss[h],0,s.length,2,i,s),a+=r_(t,e,l,a),t[a++]=l.ringsVerticesCounts[h].length;for(let u=0,d=l.ringsVerticesCounts[h].length;u<d;u++)t[a++]=l.ringsVerticesCounts[h][u];for(let u=0,d=s.length;u<d;u+=2)t[a++]=s[u],t[a++]=s[u+1]}}return t}function Jd(n){return(JSON.stringify(n).split("").reduce((e,i)=>(e<<5)-e+i.charCodeAt(0),0)>>>0).toString()}function s_(n,t,e,i){if(`${i}radius`in n&&i!=="icon-"){let r=pe(e,n[`${i}radius`],Xt);if(`${i}radius2`in n){const s=pe(e,n[`${i}radius2`],Xt);r=`max(${r}, ${s})`}`${i}stroke-width`in n&&(r=`(${r} + ${pe(e,n[`${i}stroke-width`],Xt)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${r} * 2. + 0.5)`)}if(`${i}scale`in n){const r=pe(e,n[`${i}scale`],ds);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${r}`)}`${i}displacement`in n&&t.setSymbolOffsetExpression(pe(e,n[`${i}displacement`],Zn)),`${i}rotation`in n&&t.setSymbolRotationExpression(pe(e,n[`${i}rotation`],Xt)),`${i}rotate-with-view`in n&&t.setSymbolRotateWithView(!!n[`${i}rotate-with-view`])}function ix(n,t,e,i,r){let s="vec4(0.)";if(t!==null&&(s=t),e!==null&&i!==null){const l=`smoothstep(-${i} + 0.63, -${i} - 0.58, ${n})`;s=`mix(${e}, ${s}, ${l})`}const a=`(1.0 - smoothstep(-0.63, 0.58, ${n}))`;let o=`${s} * vec4(1.0, 1.0, 1.0, ${a})`;return r!==null&&(o=`${o} * vec4(1.0, 1.0, 1.0, ${r})`),o}function a_(n,t,e,i,r){const s=new Image;s.crossOrigin=n[`${i}cross-origin`]===void 0?"anonymous":n[`${i}cross-origin`],Be(typeof n[`${i}src`]=="string",`WebGL layers do not support expressions for the ${i}src style property`),s.src=n[`${i}src`],e[`u_texture${r}_size`]=()=>s.complete?[s.width,s.height]:[0,0],t.addUniform(`vec2 u_texture${r}_size`);const a=`u_texture${r}_size`;return e[`u_texture${r}`]=s,t.addUniform(`sampler2D u_texture${r}`),a}function o_(n,t,e,i,r){let s=pe(e,n[`${t}offset`],Zn);if(`${t}offset-origin`in n)switch(n[`${t}offset-origin`]){case"top-right":s=`vec2(${i}.x, 0.) + ${r} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${i}.y) + ${r} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${i} - ${r} - ${s}`;break}return s}function HP(n,t,e,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,s_(n,t,i,"circle-");let r=null;"circle-opacity"in n&&(r=pe(i,n["circle-opacity"],Xt));let s="coordsPx";"circle-scale"in n&&(s=`coordsPx / ${pe(i,n["circle-scale"],ds)}`);let a=null;"circle-fill-color"in n&&(a=pe(i,n["circle-fill-color"],Li));let o=null;"circle-stroke-color"in n&&(o=pe(i,n["circle-stroke-color"],Li));let l=pe(i,n["circle-radius"],Xt),h=null;"circle-stroke-width"in n&&(h=pe(i,n["circle-stroke-width"],Xt),l=`(${l} + ${h} * 0.5)`);const c=`circleDistanceField(${s}, ${l})`,u=ix(c,a,o,h,r);t.setSymbolColorExpression(u)}function $P(n,t,e,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,s_(n,t,i,"shape-");let r=null;"shape-opacity"in n&&(r=pe(i,n["shape-opacity"],Xt));let s="coordsPx";"shape-scale"in n&&(s=`coordsPx / ${pe(i,n["shape-scale"],ds)}`);let a=null;"shape-fill-color"in n&&(a=pe(i,n["shape-fill-color"],Li));let o=null;"shape-stroke-color"in n&&(o=pe(i,n["shape-stroke-color"],Li));let l=null;"shape-stroke-width"in n&&(l=pe(i,n["shape-stroke-width"],Xt));const h=pe(i,n["shape-points"],Xt);let c="0.";"shape-angle"in n&&(c=pe(i,n["shape-angle"],Xt));let u,d=pe(i,n["shape-radius"],Xt);if(l!==null&&(d=`${d} + ${l} * 0.5`),"shape-radius2"in n){let p=pe(i,n["shape-radius2"],Xt);l!==null&&(p=`${p} + ${l} * 0.5`),u=`starDistanceField(${s}, ${h}, ${d}, ${p}, ${c})`}else u=`regularDistanceField(${s}, ${h}, ${d}, ${c})`;const g=ix(u,a,o,l,r);t.setSymbolColorExpression(g)}function XP(n,t,e,i){let r="vec4(1.0)";"icon-color"in n&&(r=pe(i,n["icon-color"],Li)),"icon-opacity"in n&&(r=`${r} * vec4(1.0, 1.0, 1.0, ${pe(i,n["icon-opacity"],Xt)})`);const s=Jd(n["icon-src"]),a=a_(n,t,e,"icon-",s);if(t.setSymbolColorExpression(`${r} * texture2D(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in n&&"icon-height"in n&&t.setSymbolSizeExpression(`vec2(${pe(i,n["icon-width"],Xt)}, ${pe(i,n["icon-height"],Xt)})`),"icon-offset"in n&&"icon-size"in n){const o=pe(i,n["icon-size"],Zn),l=t.getSymbolSizeExpression();t.setSymbolSizeExpression(o);const h=o_(n,"icon-",i,"v_quadSizePx",o);t.setTextureCoordinateExpression(`(vec4((${h}).xyxy) + vec4(0., 0., ${o})) / (${l}).xyxy`)}if(s_(n,t,i,"icon-"),"icon-anchor"in n){const o=pe(i,n["icon-anchor"],Zn);let l="1.0";"icon-scale"in n&&(l=pe(i,n["icon-scale"],ds));let h;n["icon-anchor-x-units"]==="pixels"&&n["icon-anchor-y-units"]==="pixels"?h=`${o} * ${l}`:n["icon-anchor-x-units"]==="pixels"?h=`${o} * vec2(vec2(${l}).x, v_quadSizePx.y)`:n["icon-anchor-y-units"]==="pixels"?h=`${o} * vec2(v_quadSizePx.x, vec2(${l}).x)`:h=`${o} * v_quadSizePx`;let c=`v_quadSizePx * vec2(0.5, -0.5) + ${h} * vec2(-1., 1.)`;if("icon-anchor-origin"in n)switch(n["icon-anchor-origin"]){case"top-right":c=`v_quadSizePx * -0.5 + ${h}`;break;case"bottom-left":c=`v_quadSizePx * 0.5 - ${h}`;break;case"bottom-right":c=`v_quadSizePx * vec2(-0.5, 0.5) + ${h} * vec2(1., -1.)`;break}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${c}`)}}function YP(n,t,e,i){if("stroke-color"in n&&t.setStrokeColorExpression(pe(i,n["stroke-color"],Li)),"stroke-pattern-src"in n){const r=Jd(n["stroke-pattern-src"]),s=a_(n,t,e,"stroke-pattern-",r);let a=s,o="vec2(0.)";"stroke-pattern-offset"in n&&"stroke-pattern-size"in n&&(a=pe(i,n["stroke-pattern-size"],Zn),o=o_(n,"stroke-pattern-",i,s,a));let l="0.";"stroke-pattern-spacing"in n&&(l=pe(i,n["stroke-pattern-spacing"],Xt)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord);
}`;const h=`u_texture${r}`;let c="1.";"stroke-color"in n&&(c=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${c} * sampleStrokePattern(${h}, ${s}, ${o}, ${a}, ${l}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in n&&t.setStrokeWidthExpression(pe(i,n["stroke-width"],Xt)),"stroke-offset"in n&&t.setStrokeOffsetExpression(pe(i,n["stroke-offset"],Xt)),"stroke-line-cap"in n&&t.setStrokeCapExpression(pe(i,n["stroke-line-cap"],rn)),"stroke-line-join"in n&&t.setStrokeJoinExpression(pe(i,n["stroke-line-join"],rn)),"stroke-miter-limit"in n&&t.setStrokeMiterLimitExpression(pe(i,n["stroke-miter-limit"],Xt)),"stroke-line-dash"in n){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${pa("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${pa("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let r=n["stroke-line-dash"].map(d=>pe(i,d,Xt));r.length%2===1&&(r=[...r,...r]);let s="0.";"stroke-line-dash-offset"in n&&(s=pe(i,n["stroke-line-dash-offset"],Xt));const o=`dashDistanceField_${Jd(n["stroke-line-dash"])}`,l=r.map((d,g)=>`float dashLength${g} = ${d};`),h=r.map((d,g)=>`dashLength${g}`).join(" + ");let c="0.",u=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType, lineWidth)`;for(let d=2;d<r.length;d+=2)c=`${c} + dashLength${d-2} + dashLength${d-1}`,u=`min(${u}, getSingleDashDistance(distance, radius, ${c}, dashLength${d}, totalDashLength, capType, lineWidth))`;i.functions[o]=`float ${o}(float distance, float radius, float capType, float lineWidth) {
  ${l.join(`
  `)}
  float totalDashLength = ${h};
  return ${u};
}`,t.setStrokeDistanceFieldExpression(`${o}(currentLengthPx + ${s}, currentRadiusPx, capType, v_width)`)}}function KP(n,t,e,i){if("fill-color"in n&&t.setFillColorExpression(pe(i,n["fill-color"],Li)),"fill-pattern-src"in n){const r=Jd(n["fill-pattern-src"]),s=a_(n,t,e,"fill-pattern-",r);let a=s,o="vec2(0.)";"fill-pattern-offset"in n&&"fill-pattern-size"in n&&(a=pe(i,n["fill-pattern-size"],Zn),o=o_(n,"fill-pattern-",i,s,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${r}`;let h="1.";"fill-color"in n&&(h=t.getFillColorExpression()),t.setFillColorExpression(`${h} * sampleFillPattern(${l}, ${s}, ${o}, ${a}, pxOrigin, pxPos)`)}}function ZP(n,t,e){const i=Yw(),r=new Jw,s={};if("icon-src"in n?XP(n,r,s,i):"shape-points"in n?$P(n,r,s,i):"circle-radius"in n&&HP(n,r,s,i),YP(n,r,s,i),KP(n,r,s,i),e){const l=pe(i,e,nn);r.setFragmentDiscardExpression(`!${l}`)}const a={};function o(l,h,c,u){if(!i[l])return;const d=Ip(c),g=n_(c);r.addAttribute(`a_${h}`,d),a[h]={size:g,callback:u}}return o("geometryType",Zw,rn,l=>yu(Lg(l.getGeometry()))),o("featureId",Kw,rn|Xt,l=>{const h=l.getId()??null;return typeof h=="string"?yu(h):h}),Qw(r,i),{builder:r,attributes:{...a,...ex(i)},uniforms:{...s,...tx(i,t)}}}function JP(n){const t=Array.isArray(n)?n:[n];if("style"in t[0]){const e=[],i=t,r=[];for(const s of i){const a=Array.isArray(s.style)?s.style:[s.style];let o=s.filter;s.else&&r.length&&(o=["all",...r.map(h=>["!",h])],s.filter&&o.push(s.filter),o.length<3&&(o=o[1])),s.filter&&r.push(s.filter);const l=a.map(h=>({style:h,...o&&{filter:o}}));e.push(...l)}return e}return"builder"in t[0]?t:t.map(e=>({style:e}))}const QP=[];let Tm;function tR(){return Tm||(Tm=jP()),Tm}let eR=0;const Ls={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"};class iR{constructor(t,e,i,r,s){this.helper_,this.hitDetectionEnabled_=!!r;let a=t;if(!("builder"in t)){const c=t,u=ZP(c.style,e,c.filter);a={builder:u.builder,attributes:u.attributes,uniforms:u.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!a.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=a.builder.getFillVertexShader(),this.fillFragmentShader_=a.builder.getFillFragmentShader()),this.hasStroke_=!!a.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=a.builder.getStrokeVertexShader(),this.strokeFragmentShader_=a.builder.getStrokeFragmentShader()),this.hasSymbol_=!!a.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=a.builder.getSymbolVertexShader(),this.symbolFragmentShader_=a.builder.getSymbolFragmentShader()),this.featureFilter_=null,s&&(this.featureFilter_=this.computeFeatureFilter(s));const l=this.hitDetectionEnabled_?{hitColor:{callback(){return UP(this.ref,QP)},size:4}}:{};this.customAttributes_=Object.assign({},l,a.attributes),this.uniforms_=a.uniforms;const h=Object.entries(this.customAttributes_).map(([c,u])=>({name:`a_${c}`,size:u.size||1,type:Vn.FLOAT}));this.polygonAttributesDesc_=[{name:Ls.POSITION,size:2,type:Vn.FLOAT},...h],this.lineStringAttributesDesc_=[{name:Ls.SEGMENT_START,size:2,type:Vn.FLOAT},{name:Ls.MEASURE_START,size:1,type:Vn.FLOAT},{name:Ls.SEGMENT_END,size:2,type:Vn.FLOAT},{name:Ls.MEASURE_END,size:1,type:Vn.FLOAT},{name:Ls.JOIN_ANGLES,size:2,type:Vn.FLOAT},{name:Ls.DISTANCE,size:1,type:Vn.FLOAT},{name:Ls.PARAMETERS,size:1,type:Vn.FLOAT},...h],this.pointAttributesDesc_=[{name:Ls.POSITION,size:2,type:Vn.FLOAT},{name:Ls.INDEX,size:1,type:Vn.FLOAT},...h],this.setHelper(i)}computeFeatureFilter(t){const e=Sg();let i;try{i=Xs(t,nn,e)}catch{return null}if(e.mapState||e.variables.size>0)return null;const r=C1();return s=>{if(r.properties=s.getPropertiesInternal(),e.featureId){const a=s.getId();a!==void 0?r.featureId=a:r.featureId=null}return r.geometryType=Lg(s.getGeometry()),i(r)}}async generateBuffers(t,e){let i=t;if(this.featureFilter_&&(i=i.filter(this.featureFilter_),i.isEmpty()))return null;const r=this.generateRenderInstructions_(i,e),[s,a,o]=await Promise.all([this.generateBuffersForType_(r.polygonInstructions,"Polygon",e),this.generateBuffersForType_(r.lineStringInstructions,"LineString",e),this.generateBuffersForType_(r.pointInstructions,"Point",e)]),l=ou(Zi(),e);return{polygonBuffers:s,lineStringBuffers:a,pointBuffers:o,invertVerticesTransform:l}}generateRenderInstructions_(t,e){const i=this.hasFill_?WP(t.polygonBatch,new Float32Array(0),this.customAttributes_,e):null,r=this.hasStroke_?VP(t.lineStringBatch,new Float32Array(0),this.customAttributes_,e):null,s=this.hasSymbol_?qP(t.pointBatch,new Float32Array(0),this.customAttributes_,e):null;return{polygonInstructions:i,lineStringInstructions:r,pointInstructions:s}}generateBuffersForType_(t,e,i){if(t===null)return null;const r=eR++;let s;switch(e){case"Polygon":s=Am.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=Am.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=Am.GENERATE_POINT_BUFFERS;break}const a={id:r,type:s,renderInstructions:t.buffer,renderInstructionsTransform:i,customAttributesSize:Bg(this.customAttributes_)},o=tR();return o.postMessage(a,[t.buffer]),t=null,new Promise(l=>{const h=c=>{const u=c.data;if(u.id!==r||(o.removeEventListener("message",h),!this.helper_.getGL()))return;const d=new R2(Z1,Pp).fromArrayBuffer(u.vertexBuffer),g=new R2(J1,Pp).fromArrayBuffer(u.indexBuffer);this.helper_.flushBufferData(d),this.helper_.flushBufferData(g),l([g,d])};o.addEventListener("message",h)})}render(t,e,i){this.hasFill_&&this.renderInternal_(t.polygonBuffers[0],t.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,e,i),this.hasStroke_&&this.renderInternal_(t.lineStringBuffers[0],t.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,e,i),this.hasSymbol_&&this.renderInternal_(t.pointBuffers[0],t.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,e,i)}renderInternal_(t,e,i,r,s,a){const o=t.getSize();o!==0&&(this.helper_.useProgram(i,s),this.helper_.bindBuffer(e),this.helper_.bindBuffer(t),this.helper_.enableAttributes(r),a(),this.helper_.drawElements(0,o))}setHelper(t,e=null){this.helper_=t,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),e&&(e.polygonBuffers&&(this.helper_.flushBufferData(e.polygonBuffers[0]),this.helper_.flushBufferData(e.polygonBuffers[1])),e.lineStringBuffers&&(this.helper_.flushBufferData(e.lineStringBuffers[0]),this.helper_.flushBufferData(e.lineStringBuffers[1])),e.pointBuffers&&(this.helper_.flushBufferData(e.pointBuffers[0]),this.helper_.flushBufferData(e.pointBuffers[1])))}}const Cs=new Uint8Array(4);class nR{constructor(t,e){this.helper_=t;const i=t.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.depthbuffer_=i.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){Hs(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return Cs[0]=0,Cs[1]=0,Cs[2]=0,Cs[3]=0,Cs;this.readAll();const i=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return Cs[0]=this.data_[i*4],Cs[1]=this.data_[i*4+1],Cs[2]=this.data_[i*4+2],Cs[3]=this.data_[i*4+3],Cs}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}function rR(n,t){const e=n.viewState.projection,r=t.getSource().getWrapX()&&e.canWrapX(),s=e.getExtent(),a=n.extent,o=r?ke(s):null,l=r?Math.ceil((a[2]-s[2])/o)+1:1;return[r?Math.floor((a[0]-s[0])/o):0,l,o]}const Zl={...da,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class sR extends Q1{constructor(t,e){const i={[Zl.RENDER_EXTENT]:[0,0,0,0],[Zl.PATTERN_ORIGIN]:[0,0],[Zl.GLOBAL_ALPHA]:1};super(t,{uniforms:i,postProcesses:e.postProcesses}),this.hitDetectionEnabled_=!e.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=Bn(),this.currentTransform_=Zi(),this.tmpCoords_=[0,0],this.tmpTransform_=Zi(),this.tmpMat4_=Vw(),this.currentFrameStateTransform_=Zi(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(e),this.batch_=new Zd,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(t){const e=this.getLayer().getSource();let i;this.batch_.addFeatures(e.getFeatures(),i),this.sourceListenKeys_=[ve(e,dn.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,i)),ve(e,dn.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),ve(e,dn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),ve(e,dn.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(t){this.styleVariables_=t.variables,this.styles_=JP(t.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(t=>new iR(t,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in t?t.filter:null))}reset(t){this.applyOptions_(t),this.helper&&this.createRenderers_(),super.reset(t)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((t,e)=>t.setHelper(this.helper,this.buffers_[e])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new nR(this.helper))}handleSourceFeatureAdded_(t,e){const i=e.feature;this.batch_.addFeature(i,t)}handleSourceFeatureChanged_(t){const e=t.feature;this.batch_.changeFeature(e)}handleSourceFeatureDelete_(t){const e=t.feature;this.batch_.removeFeature(e)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(t){t5(this.tmpTransform_,this.currentFrameStateTransform_),vg(this.tmpTransform_,t),this.helper.setUniformMatrixValue(Zl.PROJECTION_MATRIX,Tp(this.tmpMat4_,this.tmpTransform_)),ou(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Zl.SCREEN_TO_WORLD_MATRIX,Tp(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,ou(this.tmpTransform_,t),Pi(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Zl.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[i,r,s]=rR(t,this.getLayer());this.helper.prepareDraw(t),this.renderWorlds(t,!1,i,r,s),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const a=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,i,r,s),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),a}prepareFrameInternal(t){this.initialFeaturesAdded_||(this.addInitialFeatures_(t),this.initialFeaturesAdded_=!0);const e=this.getLayer(),i=e.getSource(),r=t.viewState,s=!t.viewHints[vi.ANIMATING]&&!t.viewHints[vi.INTERACTING],a=!Ko(this.previousExtent_,t.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),s&&(a||o)){const l=r.projection,h=r.resolution,c=e instanceof Iu?e.getRenderBuffer():0,u=Vr(t.extent,c*h);i.loadFeatures(u,h,l),this.ready=!1;const d=this.helper.makeProjectionTransform(t,Zi()),g=this.styleRenderers_.map((p,y)=>p.generateBuffers(this.batch_,d).then(w=>{this.buffers_[y]&&this.disposeBuffers(this.buffers_[y]),this.buffers_[y]=w}));Promise.all(g).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=t.extent.slice()}return!0}renderWorlds(t,e,i,r,s){let a=i;e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(t,this.currentFrameStateTransform_),e5(this.currentFrameStateTransform_,a*s,0);for(let o=0,l=this.styleRenderers_.length;o<l;o++){const h=this.styleRenderers_[o],c=this.buffers_[o];c&&h.render(c,t,()=>{this.applyUniforms_(c.invertVerticesTransform),this.helper.applyHitDetectionUniform(e)})}}while(++a<r)}forEachFeatureAtCoordinate(t,e,i,r,s){if(Be(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const a=Pi(e.coordinateToPixelTransform,t.slice()),o=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),l=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],h=zP(l),c=this.batch_.getFeatureFromRef(h);if(c)return r(c,this.getLayer(),null)}disposeBuffers(t){const e=i=>{for(const r of i)r&&this.helper.deleteBuffer(r)};t.pointBuffers&&e(t.pointBuffers),t.lineStringBuffers&&e(t.lineStringBuffers),t.polygonBuffers&&e(t.polygonBuffers)}disposeInternal(){this.buffers_.forEach(t=>{t&&this.disposeBuffers(t)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(t){ai(t)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const ua={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},aR=["#00f","#0ff","#0f0","#ff0","#f00"];class oR extends Iu{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.filter_=t.filter??!0,this.styleVariables_=t.variables||{},this.gradient_=null,this.addChangeListener(ua.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:aR),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);const i=t.weight?t.weight:"weight";this.weight_=i,this.setRenderOrder(null)}getBlur(){return this.get(ua.BLUR)}getGradient(){return this.get(ua.GRADIENT)}getRadius(){return this.get(ua.RADIUS)}handleGradientChanged_(){this.gradient_=lR(this.getGradient())}setBlur(t){const e=this.get(ua.BLUR);if(this.set(ua.BLUR,t),typeof t=="number"&&typeof e=="number"){this.changed();return}this.clearRenderer()}setGradient(t){this.set(ua.GRADIENT,t)}setRadius(t){const e=this.get(ua.RADIUS);if(this.set(ua.RADIUS,t),typeof t=="number"&&typeof e=="number"){this.changed();return}this.clearRenderer()}setFilter(t){this.filter_=t,this.changed(),this.clearRenderer()}setWeight(t){this.weight_=t,this.changed(),this.clearRenderer()}createRenderer(){const t=new Jw,e=Yw(),i=pe(e,this.filter_,nn);let r=pe(e,this.getRadius(),Xt),s=pe(e,this.getBlur(),Xt);const a={};typeof this.getBlur()=="number"&&(s="a_blur",a.a_blur=()=>this.getBlur(),t.addUniform("float a_blur")),typeof this.getRadius()=="number"&&(r="a_radius",a.a_radius=()=>this.getRadius(),t.addUniform("float a_radius"));const o={};let l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const u=typeof this.weight_=="string"?d=>d.get(this.weight_):this.weight_;o.prop_weight={size:1,callback:d=>{const g=u(d);return g!==void 0?pi(g,0,1):1}},l="a_prop_weight",t.addAttribute("a_prop_weight","float")}else{const u=["clamp",this.weight_,0,1];l=pe(e,u,Xt)}t.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${s});
  float radius = ${r};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${r} + ${s}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${r} + ${s}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${i}`),Qw(t,e);const h=ex(e),c=tx(e,this.styleVariables_);return new sR(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:t,attributes:{...h,...o},uniforms:{...c,...a}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}renderDeclutter(){}}function lR(n){const i=Ji(1,256),r=i.createLinearGradient(0,0,1,256),s=1/(n.length-1);for(let a=0,o=n.length;a<o;++a)r.addColorStop(a*s,n[a]);return i.fillStyle=r,i.fillRect(0,0,1,256),i.canvas}const hR=oR,cR={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},O2={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class uR extends Hw{constructor(t,e){super(t,e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Zi(),this.tileClipContexts_=null}drawTile(t,e,i,r,s,a,o,l){this.updateExecutorGroup_(t,e.pixelRatio,e.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,e),super.drawTile(t,e,i,r,s,a,o,l)}getTile(t,e,i,r){const s=this.getOrCreateTile(t,e,i,r);if(!s)return null;const o=r.viewState.resolution,l=r.viewHints;return(!(l[vi.ANIMATING]||l[vi.INTERACTING])||!s.wantedResolution)&&(s.wantedResolution=o),s}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,i){const r=this.getLayer(),s=r.getRevision(),a=r.getRenderOrder()||null,o=t.wantedResolution,l=t.getReplayState(r);if(!l.dirty&&l.renderedResolution===o&&l.renderedRevision==s&&l.renderedRenderOrder==a)return;const h=r.getSource(),c=!!r.getDeclutter(),u=h.getTileGrid(),g=h.getTileGridForProjection(i).getTileCoordExtent(t.wrappedTileCoord),p=h.getSourceTiles(e,i,t),y=Ht(r);delete t.hitDetectionImageData[y],t.executorGroups[y]=[],l.dirty=!1;for(let w=0,x=p.length;w<x;++w){const b=p[w];if(b.getState()!=Qt.LOADED)continue;const L=b.tileCoord,P=u.getTileCoordExtent(L),R=wa(g,P),j=Vr(R,r.getRenderBuffer()*o,this.tempExtent),k=Ko(P,R)?null:j,T=new hw(0,R,o,e),q=fp(o,e),W=function(tt,Z){let it;const J=tt.getStyleFunction()||r.getStyleFunction();if(J&&(it=J(tt,o)),it){const lt=this.renderFeature(tt,q,it,T,c,Z);l.dirty=l.dirty||lt}},F=b.getFeatures();a&&a!==l.renderedRenderOrder&&F.sort(a);for(let tt=0,Z=F.length;tt<Z;++tt){const it=F[tt];(!k||ki(k,it.getGeometry().getExtent()))&&W.call(this,it,tt)}const M=T.finish(),O=r.getRenderMode()!=="vector"&&c&&p.length===1?null:R,G=new cw(O,o,e,h.getOverlaps(),M,r.getRenderBuffer(),!0);t.executorGroups[y].push(G)}l.renderedRevision=s,l.renderedRenderOrder=a,l.renderedResolution=o}forEachFeatureAtCoordinate(t,e,i,r,s){var L,P;const a=e.viewState.resolution,o=e.viewState.rotation;i=i??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(e.viewState.projection),u=bn([t]);Vr(u,a*i,u);const d={},g=function(R,j,k){let T=R.getId();T===void 0&&(T=Ht(R));const q=d[T];if(q){if(q!==!0&&k<q.distanceSq){if(k===0)return d[T]=!0,s.splice(s.lastIndexOf(q),1),r(R,l,j);q.geometry=j,q.distanceSq=k}}else{if(k===0)return d[T]=!0,r(R,l,j);s.push(d[T]={feature:R,layer:l,geometry:j,distanceSq:k,callback:r})}},p=this.renderedTiles,y=Ht(l),w=l.getDeclutter(),x=w?(P=(L=e.declutter)==null?void 0:L[w])==null?void 0:P.all().map(R=>R.value):null;let b;t:for(let R=0,j=p.length;R<j;++R){const k=p[R],T=c.getTileCoordExtent(k.wrappedTileCoord);if(!ki(T,u))continue;const q=k.executorGroups[y];for(let W=0,F=q.length;W<F;++W)if(b=q[W].forEachFeatureAtCoordinate(t,a,o,i,g,x),b)break t}return b}getFeatures(t){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((e,i)=>{const r=this.getLayer(),s=r.getSource(),a=this.renderedProjection,o=a.getExtent(),l=this.renderedResolution,h=s.getTileGridForProjection(a),c=Pi(this.renderedPixelToCoordinateTransform_,t.slice()),u=h.getTileCoordForCoordAndResolution(c,l).toString(),d=this.renderedTiles.find(L=>L.tileCoord.toString()===u&&L.getState()===Qt.LOADED);if(!d||d.loadingSourceTiles>0){e([]);return}s.getWrapX()&&a.canWrapX()&&!so(o,h.getTileCoordExtent(d.tileCoord))&&ug(c,a);const g=Ht(r),p=h.getTileCoordExtent(d.wrappedTileCoord),y=xo(p),w=[(c[0]-y[0])/l,(y[1]-c[1])/l],x=d.getSourceTiles().reduce((L,P)=>L.concat(P.getFeatures()),[]);let b=d.hitDetectionImageData[g];if(!b){const L=Dn(h.getTileSize(h.getZForResolution(l,s.zDirection))),P=this.renderedRotation_,R=[this.getRenderTransform(h.getTileCoordCenter(d.wrappedTileCoord),l,0,Er,L[0]*Er,L[1]*Er,0)];b=uw(L,R,x,r.getStyleFunction(),h.getTileCoordExtent(d.wrappedTileCoord),d.getReplayState(r).renderedResolution,P),d.hitDetectionImageData[g]=b}e(fw(w,x,b))})}getFeaturesInExtent(t){const e=[],i=this.getTileCache();if(i.getCount()===0)return e;const s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),a=s.getZForResolution(this.renderedResolution),o={};return i.forEach(l=>{if(l.tileCoord[0]!==a||l.getState()!==Qt.LOADED)return;const h=l.getSourceTiles();for(let c=0,u=h.length;c<u;++c){const d=h[c],g=d.getKey();if(g in o)continue;o[g]=!0;const p=d.tileCoord;if(ki(t,s.getTileCoordExtent(p))){const y=d.getFeatures();if(y)for(let w=0,x=y.length;w<x;++w){const b=y[w],L=b.getGeometry();ki(t,L.getExtent())&&e.push(b)}}}}),e}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){var d;const i=this.context,r=i.globalAlpha;i.globalAlpha=e.opacity;const s=t.viewHints,a=!(s[vi.ANIMATING]||s[vi.INTERACTING]),o=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),h=l?(d=t.declutter)==null?void 0:d[l]:void 0,c=Ht(this.getLayer()),u=this.renderedTiles;for(let g=0,p=u.length;g<p;++g){const y=u[g],w=y.executorGroups[c];if(w)for(let x=w.length-1;x>=0;--x)w[x].execute(this.context,o,this.getTileRenderTransform(y,t),t.viewState.rotation,a,Wd,h)}i.globalAlpha=r}renderDeferredInternal(t){const e=this.renderedTiles,i=Ht(this.getLayer()),r=e.reduce((l,h,c)=>(h.executorGroups[i].forEach(u=>l.push({executorGroup:u,index:c})),l),[]),s=r.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),a={};for(let l=0,h=r.length;l<h;++l){const c=r[l].executorGroup.getDeferredZIndexContexts();for(const u in c)a[u]=!0}Object.keys(a).map(Number).sort(Ds).forEach(l=>{s.forEach((h,c)=>{h[l]&&(h[l].forEach(u=>{const{executorGroup:d,index:g}=r[c],p=d.getRenderedContext(),y=p.globalAlpha;p.globalAlpha=this.renderedOpacity_;const w=this.tileClipContexts_[g];w&&w.draw(p),u.draw(p),w&&p.restore(),p.globalAlpha=y,u.clear()}),h[l].length=0)})})}getTileRenderTransform(t,e){const i=e.pixelRatio,r=e.viewState,s=r.center,a=r.resolution,o=r.rotation,l=e.size,h=Math.round(l[0]*i),c=Math.round(l[1]*i),d=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),g=t.tileCoord,p=d.getTileCoordExtent(t.wrappedTileCoord),y=d.getTileCoordExtent(g,this.tempExtent)[0]-p[0];return vg(D0(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(s,a,o,i,h,c,y))}postRender(t,e){var R;const i=e.viewHints,r=!(i[vi.ANIMATING]||i[vi.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const s=this.getLayer(),a=s.getRenderMode(),o=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),h=l?O2[a].filter(j=>!Wd.includes(j)):O2[a],c=e.viewState,u=c.rotation,d=s.getSource(),p=d.getTileGridForProjection(c.projection).getZForResolution(c.resolution,d.zDirection),y=this.renderedTiles,w=[],x=[],b=[],L=Ht(s);let P=!0;for(let j=y.length-1;j>=0;--j){const k=y[j];P=P&&!k.getReplayState(s).dirty;const T=k.executorGroups[L].filter(tt=>tt.hasExecutors(h));if(T.length===0)continue;const q=this.getTileRenderTransform(k,e),W=k.tileCoord[0];let F=!1;const M=T[0].getClipCoords(q);let O=t,G;if(M){G=new U1,O=G.getContext();for(let tt=0,Z=w.length;tt<Z;++tt)if(p!==W&&W<x[tt]){const it=w[tt];ki([M[0],M[3],M[4],M[7]],[it[0],it[3],it[4],it[7]])&&(F||(O.save(),F=!0),O.beginPath(),O.moveTo(M[0],M[1]),O.lineTo(M[2],M[3]),O.lineTo(M[4],M[5]),O.lineTo(M[6],M[7]),O.moveTo(it[6],it[7]),O.lineTo(it[4],it[5]),O.lineTo(it[2],it[3]),O.lineTo(it[0],it[1]),O.clip())}w.push(M),x.push(W)}for(let tt=0,Z=T.length;tt<Z;++tt)T[tt].execute(t,[t.canvas.width,t.canvas.height],q,u,r,h,(R=e.declutter)==null?void 0:R[l]);F&&(O===t?O.restore():b[j]=G)}t.globalAlpha=o,this.ready=P,this.tileClipContexts_=b,e.declutter||this.renderDeferredInternal(e),super.postRender(t,e)}renderFeature(t,e,i,r,s,a){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)o=Hd(r,t,i[l],e,this.boundHandleStyleImageChange_,void 0,s,a)||o;else o=Hd(r,t,i,e,this.boundHandleStyleImageChange_,void 0,s,a);return o}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const i=t.getReplayState(e),r=e.getRevision(),s=t.wantedResolution;return i.renderedTileResolution!==s||i.renderedTileRevision!==r}renderTileImage_(t,e){const i=this.getLayer(),r=t.getReplayState(i),s=i.getRevision(),a=t.executorGroups[Ht(i)];r.renderedTileRevision=s;const o=t.wrappedTileCoord,l=o[0],h=i.getSource();let c=e.pixelRatio;const d=e.viewState.projection,g=h.getTileGridForProjection(d),p=g.getResolution(t.tileCoord[0]),y=e.pixelRatio/t.wantedResolution*p,w=g.getResolution(l),x=t.getContext();c=Math.round(Math.max(c,y/c));const b=h.getTilePixelSize(l,c,d);x.canvas.width=b[0],x.canvas.height=b[1];const L=c/y;if(L!==1){const k=yy(this.tmpTransform_);D0(k,L,L),x.setTransform.apply(x,k)}const P=g.getTileCoordExtent(o,this.tempExtent),R=y/w,j=yy(this.tmpTransform_);D0(j,R,-R),e5(j,-P[0],-P[3]);for(let k=0,T=a.length;k<T;++k)a[k].execute(x,[x.canvas.width*L,x.canvas.height*L],j,0,!0,cR[i.getRenderMode()],null);r.renderedTileResolution=t.wantedResolution}}class fR extends Iu{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload;const i=t.cacheSize===void 0?0:t.cacheSize;delete t.cacheSize,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i;const r=t.renderMode||"hybrid";Be(r=="hybrid"||r=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=r,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new uR(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(co.PRELOAD)}getUseInterimTilesOnError(){return this.get(co.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(co.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(co.USE_INTERIM_TILES_ON_ERROR,t)}}const dR=fR,D2=["fullscreenchange","webkitfullscreenchange"],B2={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class gR extends sn{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const e=t.label!==void 0?t.label:"";this.labelNode_=typeof e=="string"?document.createTextNode(e):e;const i=t.labelActive!==void 0?t.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const r=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(ie.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${ll} ${Mu}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const e=t.getOwnerDocument();if(G2(e))if(j2(e))pR(e);else{let i;this.source_?i=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:i=t.getTargetElement(),this.keys_?mR(i):nx(i)}}handleFullScreenChange_(){const t=this.getMap();if(!t)return;const e=this.isInFullscreen_;this.isInFullscreen_=j2(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Fd(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(B2.ENTERFULLSCREEN)):(Fd(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(B2.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,e){e?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){const e=this.getMap();e&&e.removeChangeListener(fn.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(fn.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const t=this.documentListeners_;for(let i=0,r=t.length;i<r;++i)ai(t[i]);t.length=0;const e=this.getMap();if(e){const i=e.getOwnerDocument();G2(i)?this.element.classList.remove(Sy):this.element.classList.add(Sy);for(let r=0,s=D2.length;r<s;++r)t.push(ve(i,D2[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function G2(n){const t=n.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&n.fullscreenEnabled)}function j2(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function nx(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function mR(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():nx(n)}function pR(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const Mm="projection",U2="coordinateFormat";class _R extends sn{constructor(t){t=t||{};const e=document.createElement("div");e.className=t.className!==void 0?t.className:"ol-mouse-position",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un,this.addChangeListener(Mm,this.handleProjectionChanged_),t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat),t.projection&&this.setProjection(t.projection),this.renderOnMouseOut_=t.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?t.placeholder:"&#160;",this.renderedHTML_=e.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=t.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(U2)}getProjection(){return this.get(Mm)}handleMouseMove(t){const e=this.getMap();this.updateHTML_(e.getEventPixel(t))}handleMouseOut(t){this.updateHTML_(null)}setMap(t){if(super.setMap(t),t){const e=t.getViewport();this.listenerKeys.push(ve(e,su.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(ve(e,su.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(t){this.set(U2,t)}setProjection(t){this.set(Mm,di(t))}updateHTML_(t){let e=this.placeholder_;if(t&&this.mapProjection_){if(!this.transform_){const s=this.getProjection();s?this.transform_=Au(this.mapProjection_,s):this.transform_=JE}const r=this.getMap().getCoordinateFromPixelInternal(t);if(r){if(this.transform_(r,r),this.wrapX_){const a=this.getProjection()||this.mapProjection_;ug(r,a)}const s=this.getCoordinateFormat();s?e=s(r):e=r.toString()}}(!this.renderedHTML_||e!==this.renderedHTML_)&&(this.element.innerHTML=e,this.renderedHTML_=e)}render(t){const e=t.frameState;e?this.mapProjection_!=e.viewState.projection&&(this.mapProjection_=e.viewState.projection,this.transform_=null):this.mapProjection_=null}}const yR=_R,Pm="units",vR=[1,2,5],Ic=25.4/.28;class wR extends sn{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;const i=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+ll,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Pm,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(Pm)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(Pm,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=t.center,i=t.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let a=Pd(i,t.resolution,e,s);const o=this.minWidth_*(this.dpi_||Ic)/Ic,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Ic)/Ic:void 0;let h=o*a,c="";if(r=="degrees"){const L=Ih.degrees;h*=L,h<L/60?(c="",a*=3600):h<L?(c="",a*=60):c=""}else if(r=="imperial")h<.9144?(c="in",a/=.0254):h<1609.344?(c="ft",a/=.3048):(c="mi",a/=1609.344);else if(r=="nautical")a/=1852,c="NM";else if(r=="metric")h<1e-6?(c="nm",a*=1e9):h<.001?(c="m",a*=1e6):h<1?(c="mm",a*=1e3):h<1e3?c="m":(c="km",a/=1e3);else if(r=="us")h<.9144?(c="in",a*=39.37):h<1609.344?(c="ft",a/=.30480061):(c="mi",a/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(o*a)/Math.log(10)),d,g,p,y=0,w,x;for(;;){p=Math.floor(u/3);const L=Math.pow(10,p);if(d=vR[(u%3+3)%3]*L,g=Math.round(d/a),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){d=y,g=w,p=x;break}else if(g>=o)break;y=d,w=g,x=p,++u}const b=this.scaleBar_?this.createScaleBar(g,d,c):d.toFixed(p<0?-p:0)+" "+c;this.renderedHTML_!=b&&(this.innerElement_.innerHTML=b,this.renderedHTML_=b),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,i){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),a=this.scaleBarSteps_,o=t/a,l=[this.createMarker("absolute")];for(let c=0;c<a;++c){const u=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${o}px;"></div>`+this.createMarker("relative")+(c%2===0||a===2?this.createStepText(c,t,!1,e,i):"")+"</div>")}return l.push(this.createStepText(a,t,!0,e,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+s+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,e,i,r,s){const o=(t===0?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+s),l=t===0?-3:e/this.scaleBarSteps_*-1,h=t===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${t===0?"left":"center"};min-width: ${h}px;left: ${i?e+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const t=Pd(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||Ic,i=1e3/25.4;return t*i*e}render(t){const e=t.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}}const xR=wR;class bR extends sn{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.extent=t.extent?t.extent:null;const e=t.className!==void 0?t.className:"ol-zoom-extent",i=t.label!==void 0?t.label:"E",r=t.tipLabel!==void 0?t.tipLabel:"Fit to extent",s=document.createElement("button");s.setAttribute("type","button"),s.title=r,s.appendChild(typeof i=="string"?document.createTextNode(i):i),s.addEventListener(ie.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+ll+" "+Mu,o=this.element;o.className=a,o.appendChild(s)}handleClick_(t){t.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const e=this.getMap().getView(),i=this.extent?Gr(this.extent,e.getProjection()):e.getProjection().getExtent();e.fitInternal(Bo(i))}}const ER=bR,SR={ADD_FEATURES:"addfeatures"};class LR extends Cr{constructor(t,e,i,r){super(t),this.features=i,this.file=e,this.projection=r}}class CR extends _s{constructor(t){t=t||{},super({handleEvent:Sa}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const e=t.formatConstructors?t.formatConstructors:[];for(let i=0,r=e.length;i<r;++i){let s=e[i];typeof s=="function"&&(s=new s),this.formats_.push(s),this.readAsBuffer_=this.readAsBuffer_||s.getType()==="arraybuffer"}this.projection_=t.projection?di(t.projection):null,this.dropListenKeys_=null,this.source_=t.source||null,this.target=t.target?t.target:null}handleResult_(t,e){const i=e.target.result,r=this.getMap();let s=this.projection_;s||(s=Jv(),s||(s=r.getView().getProjection()));let a;const o=this.formats_;for(let l=0,h=o.length;l<h;++l){const c=o[l];let u=i;this.readAsBuffer_&&c.getType()!=="arraybuffer"&&(a===void 0&&(a=new TextDecoder().decode(i)),u=a);const d=this.tryReadFeatures_(c,u,{featureProjection:s});if(d&&d.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(d)),this.dispatchEvent(new LR(SR.ADD_FEATURES,t,d,s));break}}}registerListeners_(){const t=this.getMap();if(t){const e=this.target?this.target:t.getViewport();this.dropListenKeys_=[ve(e,ie.DROP,this.handleDrop,this),ve(e,ie.DRAGENTER,this.handleStop,this),ve(e,ie.DRAGOVER,this.handleStop,this),ve(e,ie.DROP,this.handleStop,this)]}}setActive(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),super.setActive(t)}setMap(t){this.unregisterListeners_(),super.setMap(t),this.getActive()&&this.registerListeners_()}tryReadFeatures_(t,e,i){try{return t.readFeatures(e,i)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(ai),this.dropListenKeys_=null)}handleDrop(t){const e=t.dataTransfer.files;for(let i=0,r=e.length;i<r;++i){const s=e.item(i),a=new FileReader;a.addEventListener(ie.LOAD,this.handleResult_.bind(this,s)),this.readAsBuffer_?a.readAsArrayBuffer(s):a.readAsText(s)}}handleStop(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}}const AR=CR;class TR extends $s{constructor(t){t=t||{},super(t),this.condition_=t.condition?t.condition:Pu,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=t.duration!==void 0?t.duration:400}handleDragEvent(t){if(!yh(t))return;const e=t.map,i=e.getSize(),r=t.pixel,s=r[0]-i[0]/2,a=i[1]/2-r[1],o=Math.atan2(a,s),l=Math.sqrt(s*s+a*a),h=e.getView();if(this.lastAngle_!==void 0){const c=this.lastAngle_-o;h.adjustRotationInternal(c)}this.lastAngle_=o,this.lastMagnitude_!==void 0&&h.adjustResolutionInternal(this.lastMagnitude_/l),this.lastMagnitude_!==void 0&&(this.lastScaleDelta_=this.lastMagnitude_/l),this.lastMagnitude_=l}handleUpEvent(t){if(!yh(t))return!0;const i=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),this.lastScaleDelta_=0,!1}handleDownEvent(t){return yh(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0):!1}}const MR=TR,z2=0,Jc=1,q2=[0,0,0,0],Ah=[],Rm={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Im extends Cr{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}class PR extends $s{constructor(t){super(t),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:v1,this.defaultDeleteCondition_=function(i){return _5(i)&&_1(i)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:hu,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new dp,this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ge({source:new Fe({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:IR(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let e;if(t.features?e=t.features:t.source&&(this.source_=t.source,e=new On(this.source_.getFeatures()),this.source_.addEventListener(dn.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(dn.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ki.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ki.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=t.snapToPointer===void 0?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const r=this.SEGMENT_WRITERS_[e.getType()];r&&r(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(i.getCoordinateFromPixel(this.lastPixel_)),t.addEventListener(ie.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new On;const i=this.featuresBeingModified_.getArray();for(let r=0,s=e.length;r<s;++r){const a=e[r].feature;a&&!i.includes(a)&&this.featuresBeingModified_.push(a)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Im(Rm.MODIFYSTART,this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(ie.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(r){t===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const s=i[r];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===s&&this.dragSegments_.splice(a,1);e.remove(s)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r],o={feature:t,geometry:e,depth:[r],index:r,segment:[a,a]};this.rBush_.insert(e.getExtent(),o)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,s=i.length-1;r<s;++r){const a=i.slice(r,r+2),o={feature:t,geometry:e,index:r,segment:a};this.rBush_.insert(bn(a),o)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,l=a.length-1;o<l;++o){const h=a.slice(o,o+2),c={feature:t,geometry:e,depth:[r],index:o,segment:h};this.rBush_.insert(bn(h),c)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,l=a.length-1;o<l;++o){const h=a.slice(o,o+2),c={feature:t,geometry:e,depth:[r],index:o,segment:h};this.rBush_.insert(bn(h),c)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,l=a.length;o<l;++o){const h=a[o];for(let c=0,u=h.length-1;c<u;++c){const d=h.slice(c,c+2),g={feature:t,geometry:e,depth:[o,r],index:c,segment:d};this.rBush_.insert(bn(d),g)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),r={feature:t,geometry:e,index:z2,segment:[i,i]},s={feature:t,geometry:e,index:Jc,segment:[i,i]},a=[r,s];r.featureSegments=a,s.featureSegments=a,this.rBush_.insert(qc(i),r);let o=e;this.rBush_.insert(o.getExtent(),s)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let r=0;r<i.length;++r){const s=i[r],a=this.SEGMENT_WRITERS_[s.getType()];a(t,s)}}createOrUpdateVertexFeature_(t,e,i,r){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(t):(s=new ei(new fi(t)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",e),s.set("geometries",i),s.set("existing",r),s}handleEvent(t){if(!t.originalEvent)return!0;this.lastPointerEvent_=t;let e;return!t.map.getView().getInteracting()&&t.type==Ie.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(t.type!=Ie.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),t.type==Ie.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}findInsertVerticesAndUpdateDragSegments_(t){this.handlePointerAtPixel_(t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const e=this.vertexFeature_;if(!e)return;this.getMap().getView().getProjection();const i=[],r=e.getGeometry().getCoordinates(),s=bn([r]),a=this.rBush_.getInExtent(s),o={};a.sort(RR);for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.segment;let d=Ht(c.geometry);const g=c.depth;if(g&&(d+="-"+g.join("-")),o[d]||(o[d]=new Array(2)),c.geometry.getType()==="Circle"&&c.index===Jc){const p=W2(t,c);qn(p,r)&&!o[d][0]&&(this.dragSegments_.push([c,0]),o[d][0]=c);continue}if(qn(u[0],r)&&!o[d][0]){this.dragSegments_.push([c,0]),o[d][0]=c;continue}if(qn(u[1],r)&&!o[d][1]){if(o[d][0]&&o[d][0].index===0){let p=c.geometry.getCoordinates();switch(c.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":p=p[g[1]];case"Polygon":if(c.index!==p[g[0]].length-2)continue;break}}this.dragSegments_.push([c,1]),o[d][1]=c;continue}Ht(u)in this.vertexSegments_&&!o[d][0]&&!o[d][1]&&i.push(c)}return i}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_.map(([s])=>s));const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],r=[];for(let s=0,a=this.dragSegments_.length;s<a;++s){const o=this.dragSegments_[s],l=o[0],h=l.feature;i.includes(h)||i.push(h);const c=l.geometry;r.includes(c)||r.push(c);const u=l.depth;let d;const g=l.segment,p=o[1];for(;e.length<c.getStride();)e.push(g[p][e.length]);switch(c.getType()){case"Point":d=e,g[0]=e,g[1]=e;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=e,g[0]=e,g[1]=e;break;case"LineString":d=c.getCoordinates(),d[l.index+p]=e,g[p]=e;break;case"MultiLineString":d=c.getCoordinates(),d[u[0]][l.index+p]=e,g[p]=e;break;case"Polygon":d=c.getCoordinates(),d[u[0]][l.index+p]=e,g[p]=e;break;case"MultiPolygon":d=c.getCoordinates(),d[u[1]][u[0]][l.index+p]=e,g[p]=e;break;case"Circle":const y=c;if(g[0]=e,g[1]=e,l.index===z2)this.changingFeature_=!0,y.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,t.map.getView().getProjection();let w=Cd(Mi(y.getCenter()),Mi(e));y.setRadius(w),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(e,i,r,!0)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(e);if(i!=null&&i.length&&this.insertVertexCondition_(t)&&(this.willModifyFeatures_(t,i),this.vertexFeature_)){const r=this.vertexFeature_.getGeometry().getCoordinates();for(let s=i.length-1;s>=0;--s)this.insertVertex_(i[s],r);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()==="Circle"){const s=r,a=s.getCenter(),o=i.featureSegments[0],l=i.featureSegments[1];o.segment[0]=a,o.segment[1]=a,l.segment[0]=a,l.segment[1]=a,this.rBush_.update(qc(a),o);let h=s;this.rBush_.update(h.getExtent(),l)}else this.rBush_.update(bn(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Im(Rm.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.coordinate)}handlePointerAtPixel_(t){const e=this.getMap(),i=e.getPixelFromCoordinate(t);e.getView().getProjection();const r=function(o,l){return V2(t,o)-V2(t,l)};let s,a;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;e.forEachFeatureAtPixel(i,(l,h,c)=>{c&&c.getType()==="Point"&&(c=new fi(Jo(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof ei&&this.features_.getArray().includes(l)){a=u;const d=l.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:l,geometry:a,segment:[d,d]}]}return!0},{layerFilter:o})}if(!s){const o=Gr(qc(t,q2)),l=e.getView().getResolution()*this.pixelTolerance_,h=yg(Vr(o,l,q2));s=this.rBush_.getInExtent(h)}if(s&&s.length>0){const o=s.sort(r)[0],l=o.segment;let h=W2(t,o);const c=e.getPixelFromCoordinate(h);let u=Cd(i,c);if(a||u<=this.pixelTolerance_){const d={};if(d[Ht(l)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-t[0],this.delta_[1]=h[1]-t[1]),o.geometry.getType()==="Circle"&&o.index===Jc)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[o.feature],[o.geometry],this.snappedToVertex_);else{const g=e.getPixelFromCoordinate(l[0]),p=e.getPixelFromCoordinate(l[1]),y=Rh(c,g),w=Rh(c,p);if(u=Math.sqrt(Math.min(y,w)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=y>w?l[1]:l[0]),this.createOrUpdateVertexFeature_(h,[o.feature],[o.geometry],this.snappedToVertex_);const x={};x[Ht(o.geometry)]=!0;for(let b=1,L=s.length;b<L;++b){const P=s[b].segment;if(qn(l[0],P[0])&&qn(l[1],P[1])||qn(l[0],P[1])&&qn(l[1],P[0])){const R=Ht(s[b].geometry);R in x||(x[R]=!0,d[Ht(P)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,r=t.feature,s=t.geometry,a=t.depth,o=t.index;let l;for(;e.length<s.getStride();)e.push(0);switch(s.getType()){case"MultiLineString":l=s.getCoordinates(),l[a[0]].splice(o+1,0,e);break;case"Polygon":l=s.getCoordinates(),l[a[0]].splice(o+1,0,e);break;case"MultiPolygon":l=s.getCoordinates(),l[a[1]][a[0]].splice(o+1,0,e);break;case"LineString":l=s.getCoordinates(),l.splice(o+1,0,e);break;default:return!1}this.setGeometryCoordinates_(s,l);const h=this.rBush_;h.remove(t),this.updateSegmentIndices_(s,o,a,1);const c={segment:[i[0],e],feature:r,geometry:s,depth:a,index:o};h.insert(bn(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[e,i[1]],feature:r,geometry:s,depth:a,index:o+1};return h.insert(bn(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(t){var e;return t&&this.findInsertVerticesAndUpdateDragSegments_(t),(e=this.vertexFeature_)==null?void 0:e.getGeometry().getCoordinates()}getPoint(){var e;const t=(e=this.vertexFeature_)==null?void 0:e.getGeometry().getCoordinates();return t?Jo(t,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const t=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(bn([t])).some(({segment:i})=>qn(i[0],t)||qn(i[1],t))}removePoint(t){if(t&&(t=Mi(t,this.getMap().getView().getProjection()),this.updatePointer_(t)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Ie.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_.map(([r])=>r));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Im(Rm.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i=!1,r,s,a,o,l,h,c,u,d,g,p;for(l=t.length-1;l>=0;--l)a=t[l],g=a[0],p=Ht(g.feature),g.depth&&(p+="-"+g.depth.join("-")),p in e||(e[p]={}),a[1]===0?(e[p].right=g,e[p].index=g.index):a[1]==1&&(e[p].left=g,e[p].index=g.index+1);for(p in e){switch(d=e[p].right,c=e[p].left,h=e[p].index,u=h-1,c!==void 0?g=c:g=d,u<0&&(u=0),o=g.geometry,s=o.getCoordinates(),r=s,i=!1,o.getType()){case"MultiLineString":s[g.depth[0]].length>2&&(s[g.depth[0]].splice(h,1),i=!0);break;case"LineString":s.length>2&&(s.splice(h,1),i=!0);break;case"MultiPolygon":r=r[g.depth[1]];case"Polygon":r=r[g.depth[0]],r.length>4&&(h==r.length-1&&(h=0),r.splice(h,1),i=!0,h===0&&(r.pop(),r.push(r[0]),u=r.length-1));break}if(i){this.setGeometryCoordinates_(o,s);const y=[];if(c!==void 0&&(this.rBush_.remove(c),y.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),y.push(d.segment[1])),c!==void 0&&d!==void 0){const w={depth:g.depth,feature:g.feature,geometry:g.geometry,index:u,segment:y};this.rBush_.insert(bn(w.segment),w)}this.updateSegmentIndices_(o,h,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const t=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(bn([t])).some(({segment:i})=>!(qn(i[0],t)||qn(i[1],t)))}insertPoint(t){var r;const e=t?Mi(t,this.getMap().getView().getProjection()):(r=this.vertexFeature_)==null?void 0:r.getGeometry().getCoordinates();return e?this.findInsertVerticesAndUpdateDragSegments_(e).reduce((s,a)=>s||this.insertVertex_(a,e),!1):!1}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,r){this.rBush_.forEachInExtent(t.getExtent(),function(s){s.geometry===t&&(i===void 0||s.depth===void 0||Hs(s.depth,i))&&s.index>e&&(s.index+=r)})}}function RR(n,t){return n.index-t.index}function V2(n,t,e){const i=t.geometry;if(i.getType()==="Circle"){let s=i;if(t.index===Jc){const a=Rh(s.getCenter(),Mi(n)),o=Math.sqrt(a)-s.getRadius();return o*o}}const r=Mi(n);return Ah[0]=Mi(t.segment[0]),Ah[1]=Mi(t.segment[1]),EE(r,Ah)}function W2(n,t,e){const i=t.geometry;if(i.getType()==="Circle"&&t.index===Jc)return Jo(i.getClosestPoint(Mi(n)));const r=Mi(n);return Ah[0]=Mi(t.segment[0]),Ah[1]=Mi(t.segment[1]),Jo(Uv(r,Ah))}function IR(){const n=P1();return function(t,e){return n.Point}}const H2=PR,NR={SELECT:"select"};class FR extends Cr{constructor(t,e,i,r){super(t),this.selected=e,this.deselected=i,this.mapBrowserEvent=r}}const id={};class l_ extends _s{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:_1,this.addCondition_=t.addCondition?t.addCondition:tp,this.removeCondition_=t.removeCondition?t.removeCondition:tp,this.toggleCondition_=t.toggleCondition?t.toggleCondition:Pu,this.multi_=t.multi?t.multi:!1,this.filter_=t.filter?t.filter:Sa,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=t.style!==void 0?t.style:kR(),this.features_=t.features||new On;let e;if(t.layers)if(typeof t.layers=="function")e=t.layers;else{const i=t.layers;e=function(r){return i.includes(r)}}else e=Sa;this.layerFilter_=e,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,e){this.featureLayerAssociation_[Ht(t)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[Ht(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(Ki.ADD,this.boundAddFeature_),this.features_.addEventListener(Ki.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Ki.ADD,this.boundAddFeature_),this.features_.removeEventListener(Ki.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const e=t.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){const i=this.getMap().getAllLayers().find(function(r){if(r instanceof Ge&&r.getSource()&&r.getSource().hasFeature(e))return r});i&&this.addFeatureLayerAssociation_(e,i)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const e=Ht(t);e in id||(id[e]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const e=this.getMap().getInteractions().getArray();for(let r=e.length-1;r>=0;--r){const s=e[r];if(s!==this&&s instanceof l_&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(t)!==-1){t.setStyle(s.getStyle());return}}const i=Ht(t);t.setStyle(id[i]),delete id[i]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[Ht(t)]}handleEvent(t){if(!this.condition_(t))return!0;const e=this.addCondition_(t),i=this.removeCondition_(t),r=this.toggleCondition_(t),s=!e&&!i&&!r,a=t.map,o=this.getFeatures(),l=[],h=[];if(s){rl(this.featureLayerAssociation_),a.forEachFeatureAtPixel(t.pixel,(c,u)=>{if(!(!(c instanceof ei)||!this.filter_(c,u)))return this.addFeatureLayerAssociation_(c,u),h.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=o.getLength()-1;c>=0;--c){const u=o.item(c),d=h.indexOf(u);d>-1?h.splice(d,1):(o.remove(u),l.push(u))}h.length!==0&&o.extend(h)}else{a.forEachFeatureAtPixel(t.pixel,(c,u)=>{if(!(!(c instanceof ei)||!this.filter_(c,u)))return(e||r)&&!o.getArray().includes(c)?(this.addFeatureLayerAssociation_(c,u),h.push(c)):(i||r)&&o.getArray().includes(c)&&(l.push(c),this.removeFeatureLayerAssociation_(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=l.length-1;c>=0;--c)o.remove(l[c]);o.extend(h)}return(h.length>0||l.length>0)&&this.dispatchEvent(new FR(NR.SELECT,h,l,t)),!0}}function kR(){const n=P1();return ze(n.Polygon,n.LineString),ze(n.GeometryCollection,n.LineString),function(t){return t.getGeometry()?n[t.getGeometry().getType()]:null}}const La=l_;function OR(n){const t=Object.keys(n.defs),e=t.length;let i,r;for(i=0;i<e;++i){const s=t[i];if(!od(s)){const a=n.defs(s);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),Md(new mg({code:s,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(i=0;i<e;++i){const s=t[i],a=od(s);for(r=0;r<e;++r){const o=t[r],l=od(o);if(!ld(s,o))if(n.defs[s]===n.defs[o])Xm([a,l]);else{const h=n(s,o);eS(a,l,_y(a,l,h.forward),_y(l,a,h.inverse))}}}}function DR(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var el=1,il=2,Th=3,BR=4,Np=5,$2=6378137,GR=6356752314e-3,X2=.0066943799901413165,Qc=484813681109536e-20,Mt=Math.PI/2,jR=.16666666666666666,UR=.04722222222222222,zR=.022156084656084655,jt=1e-10,En=.017453292519943295,ks=57.29577951308232,Qe=Math.PI/4,vu=Math.PI*2,Ui=3.14159265359,mr={};mr.greenwich=0;mr.lisbon=-9.131906111111;mr.paris=2.337229166667;mr.bogota=-74.080916666667;mr.madrid=-3.687938888889;mr.rome=12.452333333333;mr.bern=7.439583333333;mr.jakarta=106.807719444444;mr.ferro=-17.666666666667;mr.brussels=4.367975;mr.stockholm=18.058277777778;mr.athens=23.7163375;mr.oslo=10.722916666667;const qR={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Y2=/[\s_\-\/\(\)]/g;function vo(n,t){if(n[t])return n[t];for(var e=Object.keys(n),i=t.toLowerCase().replace(Y2,""),r=-1,s,a;++r<e.length;)if(s=e[r],a=s.toLowerCase().replace(Y2,""),a===i)return n[s]}function Fp(n){var t={},e=n.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),i,r,s,a={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*En},lat_1:function(o){t.lat1=o*En},lat_2:function(o){t.lat2=o*En},lat_ts:function(o){t.lat_ts=o*En},lon_0:function(o){t.long0=o*En},lon_1:function(o){t.long1=o*En},lon_2:function(o){t.long2=o*En},alpha:function(o){t.alpha=parseFloat(o)*En},gamma:function(o){t.rectified_grid_angle=parseFloat(o)},lonc:function(o){t.longc=o*En},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r:function(o){t.a=t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var l=vo(qR,o);l&&(t.to_meter=l.to_meter)},from_greenwich:function(o){t.from_greenwich=o*En},pm:function(o){var l=vo(mr,o);t.from_greenwich=(l||parseFloat(o))*En},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(i in e)r=e[i],i in a?(s=a[i],typeof s=="function"?s(r):t[s]=r):t[i]=r;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var wu=1,rx=2,sx=3,Qd=4,ax=5,h_=-1,VR=/\s/,WR=/[A-Za-z]/,HR=/[A-Za-z84_]/,Gg=/[,\]]/,ox=/[\d\.E\-\+]/;function Ma(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=wu}Ma.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==Qd)for(;VR.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case wu:return this.neutral(n);case rx:return this.keyword(n);case Qd:return this.quoted(n);case ax:return this.afterquote(n);case sx:return this.number(n);case h_:return}};Ma.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=Qd;return}if(Gg.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};Ma.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=wu;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=wu,this.currentObject=this.stack.pop(),this.currentObject||(this.state=h_);return}};Ma.prototype.number=function(n){if(ox.test(n)){this.word+=n;return}if(Gg.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};Ma.prototype.quoted=function(n){if(n==='"'){this.state=ax;return}this.word+=n};Ma.prototype.keyword=function(n){if(HR.test(n)){this.word+=n;return}if(n==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=wu;return}if(Gg.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};Ma.prototype.neutral=function(n){if(WR.test(n)){this.word=n,this.state=rx;return}if(n==='"'){this.word="",this.state=Qd;return}if(ox.test(n)){this.word=n,this.state=sx;return}if(Gg.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};Ma.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===h_)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function $R(n){var t=new Ma(n);return t.output()}function K2(n,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var i=t?{}:n,r=e.reduce(function(s,a){return dh(a,s),s},i);t&&(n[t]=r)}function dh(n,t){if(!Array.isArray(n)){t[n]=!0;return}var e=n.shift();if(e==="PARAMETER"&&(e=n.shift()),n.length===1){if(Array.isArray(n[0])){t[e]={},dh(n[0],t[e]);return}t[e]=n[0];return}if(!n.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=n;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(n);return}Array.isArray(e)||(t[e]={});var i;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&dh(n[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:n[0],a:n[1],rf:n[2]},n.length===4&&dh(n[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":n[0]=["name",n[0]],K2(t,e,n);return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return dh(n,t[e]);return K2(t,e,n)}}var XR=.017453292519943295;function YR(n,t){var e=t[0],i=t[1];!(e in n)&&i in n&&(n[e]=n[i],t.length===3&&(n[e]=t[2](n[e])))}function As(n){return n*XR}function KR(n){if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var t="",e=0,i=n.AXIS.length;e<i;++e){var r=[n.AXIS[e][0].toLowerCase(),n.AXIS[e][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?t+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?t+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?t+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(n.axis=t)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var s=n.GEOGCS;n.type==="GEOGCS"&&(s=n),s&&(s.DATUM?n.datumCode=s.DATUM.name.toLowerCase():n.datumCode=s.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),(n.datumCode==="new_zealand_geodetic_datum_1949"||n.datumCode==="new_zealand_1949")&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode.slice(-6)==="_ferro"&&(n.datumCode=n.datumCode.slice(0,-6)),n.datumCode.slice(-8)==="_jakarta"&&(n.datumCode=n.datumCode.slice(0,-8)),~n.datumCode.indexOf("belge")&&(n.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(n.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=s.DATUM.SPHEROID.a,n.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(n.datum_params=s.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a);function a(h){var c=n.to_meter||1;return h*c}var o=function(h){return YR(n,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",As],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",As],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",As],["lat0","latitude_of_origin",As],["lat0","standard_parallel_1",As],["lat1","standard_parallel_1",As],["lat2","standard_parallel_2",As],["azimuth","Azimuth"],["alpha","azimuth",As],["srsCode","name"]];l.forEach(o),!n.long0&&n.longc&&(n.projName==="Albers_Conic_Equal_Area"||n.projName==="Lambert_Azimuthal_Equal_Area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(n.projName==="Stereographic_South_Pole"||n.projName==="Polar Stereographic (variant B)")?(n.lat0=As(n.lat1>0?90:-90),n.lat_ts=n.lat1):!n.lat_ts&&n.lat0&&n.projName==="Polar_Stereographic"&&(n.lat_ts=n.lat0,n.lat0=As(n.lat0>0?90:-90))}function lx(n){var t=$R(n),e=t.shift(),i=t.shift();t.unshift(["name",i]),t.unshift(["type",e]);var r={};return dh(t,r),KR(r),r}function Wn(n){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?Wn[n]=Fp(arguments[1]):Wn[n]=lx(arguments[1]):Wn[n]=e}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){Array.isArray(i)?Wn.apply(t,i):Wn(i)});if(typeof n=="string"){if(n in Wn)return Wn[n]}else"EPSG"in n?Wn["EPSG:"+n.EPSG]=n:"ESRI"in n?Wn["ESRI:"+n.ESRI]=n:"IAU2000"in n?Wn["IAU2000:"+n.IAU2000]=n:console.log(n);return}}DR(Wn);function ZR(n){return typeof n=="string"}function JR(n){return n in Wn}var QR=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function t4(n){return QR.some(function(t){return n.indexOf(t)>-1})}var e4=["3857","900913","3785","102113"];function i4(n){var t=vo(n,"authority");if(t){var e=vo(t,"epsg");return e&&e4.indexOf(e)>-1}}function n4(n){var t=vo(n,"extension");if(t)return vo(t,"proj4")}function r4(n){return n[0]==="+"}function s4(n){if(ZR(n)){if(JR(n))return Wn[n];if(t4(n)){var t=lx(n);if(i4(t))return Wn["EPSG:3857"];var e=n4(t);return e?Fp(e):t}if(r4(n))return Fp(n)}else return n}function Z2(n,t){n=n||{};var e,i;if(!t)return n;for(i in t)e=t[i],e!==void 0&&(n[i]=e);return n}function Ws(n,t,e){var i=n*t;return e/Math.sqrt(1-i*i)}function Du(n){return n<0?-1:1}function Vt(n){return Math.abs(n)<=Ui?n:n-Du(n)*vu}function gs(n,t,e){var i=n*e,r=.5*n;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(Mt-t))/i}function xu(n,t){for(var e=.5*n,i,r,s=Mt-2*Math.atan(t),a=0;a<=15;a++)if(i=n*Math.sin(s),r=Mt-2*Math.atan(t*Math.pow((1-i)/(1+i),e))-s,s+=r,Math.abs(r)<=1e-10)return s;return-9999}function a4(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Ws(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function o4(n){var t=n.x,e=n.y;if(e*ks>90&&e*ks<-90&&t*ks>180&&t*ks<-180)return null;var i,r;if(Math.abs(Math.abs(e)-Mt)<=jt)return null;if(this.sphere)i=this.x0+this.a*this.k0*Vt(t-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Qe+.5*e));else{var s=Math.sin(e),a=gs(this.e,e,s);i=this.x0+this.a*this.k0*Vt(t-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return n.x=i,n.y=r,n}function l4(n){var t=n.x-this.x0,e=n.y-this.y0,i,r;if(this.sphere)r=Mt-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var s=Math.exp(-e/(this.a*this.k0));if(r=xu(this.e,s),r===-9999)return null}return i=Vt(this.long0+t/(this.a*this.k0)),n.x=i,n.y=r,n}var h4=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const c4={init:a4,forward:o4,inverse:l4,names:h4};function u4(){}function J2(n){return n}var f4=["longlat","identity"];const d4={init:u4,forward:J2,inverse:J2,names:f4};var g4=[c4,d4],yd={},tg=[];function hx(n,t){var e=tg.length;return n.names?(tg[e]=n,n.names.forEach(function(i){yd[i.toLowerCase()]=e}),this):(console.log(t),!0)}function m4(n){if(!n)return!1;var t=n.toLowerCase();if(typeof yd[t]<"u"&&tg[yd[t]])return tg[yd[t]]}function p4(){g4.forEach(hx)}const _4={start:p4,add:hx,get:m4};var xe={};xe.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};xe.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};xe.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};xe.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};xe.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};xe.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};xe.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};xe.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};xe.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};xe.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};xe.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};xe.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};xe.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};xe.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};xe.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};xe.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};xe.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};xe.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};xe.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};xe.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};xe.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};xe.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};xe.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};xe.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};xe.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};xe.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};xe.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};xe.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};xe.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};xe.hough={a:6378270,rf:297,ellipseName:"Hough"};xe.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};xe.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};xe.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};xe.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};xe.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};xe.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};xe.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};xe.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};xe.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};xe.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};xe.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};xe.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var y4=xe.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};xe.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function v4(n,t,e,i){var r=n*n,s=t*t,a=(r-s)/r,o=0;i?(n*=1-a*(jR+a*(UR+a*zR)),r=n*n,a=0):o=Math.sqrt(a);var l=(r-s)/s;return{es:a,e:o,ep2:l}}function w4(n,t,e,i,r){if(!n){var s=vo(xe,i);s||(s=y4),n=s.a,t=s.b,e=s.rf}return e&&!t&&(t=(1-1/e)*n),(e===0||Math.abs(n-t)<jt)&&(r=!0,t=n),{a:n,b:t,rf:e,sphere:r}}var on={};on.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};on.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};on.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};on.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};on.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};on.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};on.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};on.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};on.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};on.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};on.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};on.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};on.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};on.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};on.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};on.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};on.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};on.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function x4(n,t,e,i,r,s,a){var o={};return n===void 0||n==="none"?o.datum_type=Np:o.datum_type=BR,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=el),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=il,o.datum_params[3]*=Qc,o.datum_params[4]*=Qc,o.datum_params[5]*=Qc,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=Th,o.grids=a),o.a=e,o.b=i,o.es=r,o.ep2=s,o}var cx={};function b4(n,t){var e=new DataView(t),i=L4(e),r=C4(e,i),s=A4(e,r,i),a={header:r,subgrids:s};return cx[n]=a,a}function E4(n){if(n===void 0)return null;var t=n.split(",");return t.map(S4)}function S4(n){if(n.length===0)return null;var t=n[0]==="@";return t&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:n,mandatory:!t,grid:cx[n]||null,isNull:!1}}function gh(n){return n/3600*Math.PI/180}function L4(n){var t=n.getInt32(8,!1);return t===11?!1:(t=n.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function C4(n,t){return{nFields:n.getInt32(8,t),nSubgridFields:n.getInt32(24,t),nSubgrids:n.getInt32(40,t),shiftType:kp(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,t),fromSemiMinorAxis:n.getFloat64(136,t),toSemiMajorAxis:n.getFloat64(152,t),toSemiMinorAxis:n.getFloat64(168,t)}}function kp(n,t,e){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(t,e)))}function A4(n,t,e){for(var i=176,r=[],s=0;s<t.nSubgrids;s++){var a=M4(n,i,e),o=P4(n,i,a,e),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);r.push({ll:[gh(a.lowerLongitude),gh(a.lowerLatitude)],del:[gh(a.longitudeInterval),gh(a.latitudeInterval)],lim:[l,h],count:a.gridNodeCount,cvs:T4(o)}),i+=176+a.gridNodeCount*16}return r}function T4(n){return n.map(function(t){return[gh(t.longitudeShift),gh(t.latitudeShift)]})}function M4(n,t,e){return{name:kp(n,t+8,t+16).trim(),parent:kp(n,t+24,t+24+8).trim(),lowerLatitude:n.getFloat64(t+72,e),upperLatitude:n.getFloat64(t+88,e),lowerLongitude:n.getFloat64(t+104,e),upperLongitude:n.getFloat64(t+120,e),latitudeInterval:n.getFloat64(t+136,e),longitudeInterval:n.getFloat64(t+152,e),gridNodeCount:n.getInt32(t+168,e)}}function P4(n,t,e,i){for(var r=t+176,s=16,a=[],o=0;o<e.gridNodeCount;o++){var l={latitudeShift:n.getFloat32(r+o*s,i),longitudeShift:n.getFloat32(r+o*s+4,i),latitudeAccuracy:n.getFloat32(r+o*s+8,i),longitudeAccuracy:n.getFloat32(r+o*s+12,i)};a.push(l)}return a}function js(n,t){if(!(this instanceof js))return new js(n);t=t||function(h){if(h)throw h};var e=s4(n);if(typeof e!="object"){t(n);return}var i=js.projections.get(e.projName);if(!i){t(n);return}if(e.datumCode&&e.datumCode!=="none"){var r=vo(on,e.datumCode);r&&(e.datum_params=e.datum_params||(r.towgs84?r.towgs84.split(","):null),e.ellps=r.ellipse,e.datumName=r.datumName?r.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var s=w4(e.a,e.b,e.rf,e.ellps,e.sphere),a=v4(s.a,s.b,s.rf,e.R_A),o=E4(e.nadgrids),l=e.datum||x4(e.datumCode,e.datum_params,s.a,s.b,a.es,a.ep2,o);Z2(this,e),Z2(this,i),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=l,this.init(),t(null,this)}js.projections=_4;js.projections.start();function R4(n,t){return n.datum_type!==t.datum_type||n.a!==t.a||Math.abs(n.es-t.es)>5e-11?!1:n.datum_type===el?n.datum_params[0]===t.datum_params[0]&&n.datum_params[1]===t.datum_params[1]&&n.datum_params[2]===t.datum_params[2]:n.datum_type===il?n.datum_params[0]===t.datum_params[0]&&n.datum_params[1]===t.datum_params[1]&&n.datum_params[2]===t.datum_params[2]&&n.datum_params[3]===t.datum_params[3]&&n.datum_params[4]===t.datum_params[4]&&n.datum_params[5]===t.datum_params[5]&&n.datum_params[6]===t.datum_params[6]:!0}function ux(n,t,e){var i=n.x,r=n.y,s=n.z?n.z:0,a,o,l,h;if(r<-Mt&&r>-1.001*Mt)r=-Mt;else if(r>Mt&&r<1.001*Mt)r=Mt;else{if(r<-Mt)return{x:-1/0,y:-1/0,z:n.z};if(r>Mt)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(r),h=Math.cos(r),l=o*o,a=e/Math.sqrt(1-t*l),{x:(a+s)*h*Math.cos(i),y:(a+s)*h*Math.sin(i),z:(a*(1-t)+s)*o}}function fx(n,t,e,i){var r=1e-12,s=r*r,a=30,o,l,h,c,u,d,g,p,y,w,x,b,L,P=n.x,R=n.y,j=n.z?n.z:0,k,T,q;if(o=Math.sqrt(P*P+R*R),l=Math.sqrt(P*P+R*R+j*j),o/e<r){if(k=0,l/e<r)return T=Mt,q=-i,{x:n.x,y:n.y,z:n.z}}else k=Math.atan2(R,P);h=j/l,c=o/l,u=1/Math.sqrt(1-t*(2-t)*c*c),p=c*(1-t)*u,y=h*u,L=0;do L++,g=e/Math.sqrt(1-t*y*y),q=o*p+j*y-g*(1-t*y*y),d=t*g/(g+q),u=1/Math.sqrt(1-d*(2-d)*c*c),w=c*(1-d)*u,x=h*u,b=x*p-w*y,p=w,y=x;while(b*b>s&&L<a);return T=Math.atan(x/Math.abs(w)),{x:k,y:T,z:q}}function I4(n,t,e){if(t===el)return{x:n.x+e[0],y:n.y+e[1],z:n.z+e[2]};if(t===il){var i=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6];return{x:h*(n.x-l*n.y+o*n.z)+i,y:h*(l*n.x+n.y-a*n.z)+r,z:h*(-o*n.x+a*n.y+n.z)+s}}}function N4(n,t,e){if(t===el)return{x:n.x-e[0],y:n.y-e[1],z:n.z-e[2]};if(t===il){var i=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=(n.x-i)/h,u=(n.y-r)/h,d=(n.z-s)/h;return{x:c+l*u-o*d,y:-l*c+u+a*d,z:o*c-a*u+d}}}function nd(n){return n===el||n===il}function F4(n,t,e){if(R4(n,t)||n.datum_type===Np||t.datum_type===Np)return e;var i=n.a,r=n.es;if(n.datum_type===Th){var s=Q2(n,!1,e);if(s!==0)return;i=$2,r=X2}var a=t.a,o=t.b,l=t.es;if(t.datum_type===Th&&(a=$2,o=GR,l=X2),r===l&&i===a&&!nd(n.datum_type)&&!nd(t.datum_type))return e;if(e=ux(e,r,i),nd(n.datum_type)&&(e=I4(e,n.datum_type,n.datum_params)),nd(t.datum_type)&&(e=N4(e,t.datum_type,t.datum_params)),e=fx(e,l,a,o),t.datum_type===Th){var h=Q2(t,!0,e);if(h!==0)return}return e}function Q2(n,t,e){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-e.x,y:e.y},r={x:Number.NaN,y:Number.NaN},s=[];t:for(var a=0;a<n.grids.length;a++){var o=n.grids[a];if(s.push(o.name),o.isNull){r=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var l=o.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,g=u.ll[0]-d,p=u.ll[1]-d,y=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,w=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(p>i.y||g>i.x||w<i.y||y<i.x)&&(r=k4(i,t,u),!isNaN(r.x)))break t}}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*ks+" "+i.y*ks+" tried: '"+s+"'"),-1):(e.x=-r.x,e.y=r.y,0)}function k4(n,t,e){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var r={x:n.x,y:n.y};r.x-=e.ll[0],r.y-=e.ll[1],r.x=Vt(r.x-Math.PI)+Math.PI;var s=tv(r,e);if(t){if(isNaN(s.x))return i;s.x=r.x-s.x,s.y=r.y-s.y;var a=9,o=1e-12,l,h;do{if(h=tv(s,e),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:r.x-(h.x+s.x),y:r.y-(h.y+s.y)},s.x+=l.x,s.y+=l.y}while(a--&&Math.abs(l.x)>o&&Math.abs(l.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=Vt(s.x+e.ll[0]),i.y=s.y+e.ll[1]}else isNaN(s.x)||(i.x=n.x+s.x,i.y=n.y+s.y);return i}function tv(n,t){var e={x:n.x/t.del[0],y:n.y/t.del[1]},i={x:Math.floor(e.x),y:Math.floor(e.y)},r={x:e.x-1*i.x,y:e.y-1*i.y},s={x:Number.NaN,y:Number.NaN},a;if(i.x<0||i.x>=t.lim[0]||i.y<0||i.y>=t.lim[1])return s;a=i.y*t.lim[0]+i.x;var o={x:t.cvs[a][0],y:t.cvs[a][1]};a++;var l={x:t.cvs[a][0],y:t.cvs[a][1]};a+=t.lim[0];var h={x:t.cvs[a][0],y:t.cvs[a][1]};a--;var c={x:t.cvs[a][0],y:t.cvs[a][1]},u=r.x*r.y,d=r.x*(1-r.y),g=(1-r.x)*(1-r.y),p=(1-r.x)*r.y;return s.x=g*o.x+d*l.x+p*c.x+u*h.x,s.y=g*o.y+d*l.y+p*c.y+u*h.y,s}function ev(n,t,e){var i=e.x,r=e.y,s=e.z||0,a,o,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(a=i,"ew".indexOf(n.axis[l])!==-1?o="x":o="y"):l===1?(a=r,"ns".indexOf(n.axis[l])!==-1?o="y":o="x"):(a=s,o="z"),n.axis[l]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":e[o]!==void 0&&(h.z=a);break;case"d":e[o]!==void 0&&(h.z=-a);break;default:return null}return h}function dx(n){var t={x:n[0],y:n[1]};return n.length>2&&(t.z=n[2]),n.length>3&&(t.m=n[3]),t}function O4(n){iv(n.x),iv(n.y)}function iv(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function D4(n,t){return(n.datum.datum_type===el||n.datum.datum_type===il||n.datum.datum_type===Th)&&t.datumCode!=="WGS84"||(t.datum.datum_type===el||t.datum.datum_type===il||t.datum.datum_type===Th)&&n.datumCode!=="WGS84"}function eg(n,t,e,i){var r;Array.isArray(e)?e=dx(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var s=e.z!==void 0;if(O4(e),n.datum&&t.datum&&D4(n,t)&&(r=new js("WGS84"),e=eg(n,r,e,i),n=r),i&&n.axis!=="enu"&&(e=ev(n,!1,e)),n.projName==="longlat")e={x:e.x*En,y:e.y*En,z:e.z||0};else if(n.to_meter&&(e={x:e.x*n.to_meter,y:e.y*n.to_meter,z:e.z||0}),e=n.inverse(e),!e)return;if(n.from_greenwich&&(e.x+=n.from_greenwich),e=F4(n.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*ks,y:e.y*ks,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),i&&t.axis!=="enu"?ev(t,!0,e):(e&&!s&&delete e.z,e)}var nv=js("WGS84");function Nm(n,t,e,i){var r,s,a;return Array.isArray(e)?(r=eg(n,t,e,i)||{x:NaN,y:NaN},e.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof r.z=="number"?[r.x,r.y,r.z].concat(e.splice(3)):[r.x,r.y,e[2]].concat(e.splice(3)):[r.x,r.y].concat(e.splice(2)):[r.x,r.y]):(s=eg(n,t,e,i),a=Object.keys(e),a.length===2||a.forEach(function(o){if(typeof n.name<"u"&&n.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;s[o]=e[o]}),s)}function rv(n){return n instanceof js?n:n.oProj?n.oProj:js(n)}function dr(n,t,e){n=rv(n);var i=!1,r;return typeof t>"u"?(t=n,n=nv,i=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=n,n=nv,i=!0),t=rv(t),e?Nm(n,t,e):(r={forward:function(s,a){return Nm(n,t,s,a)},inverse:function(s,a){return Nm(t,n,s,a)}},i&&(r.oProj=t),r)}var sv=6,gx="AJSAJS",mx="AFAFAF",mh=65,or=73,Fr=79,Gc=86,jc=90;const B4={forward:px,inverse:G4,toPoint:_x};function px(n,t){return t=t||5,z4(j4({lat:n[1],lon:n[0]}),t)}function G4(n){var t=c_(vx(n.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function _x(n){var t=c_(vx(n.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Fm(n){return n*(Math.PI/180)}function av(n){return 180*(n/Math.PI)}function j4(n){var t=n.lat,e=n.lon,i=6378137,r=.00669438,s=.9996,a,o,l,h,c,u,d,g=Fm(t),p=Fm(e),y,w;w=Math.floor((e+180)/6)+1,e===180&&(w=60),t>=56&&t<64&&e>=3&&e<12&&(w=32),t>=72&&t<84&&(e>=0&&e<9?w=31:e>=9&&e<21?w=33:e>=21&&e<33?w=35:e>=33&&e<42&&(w=37)),a=(w-1)*6-180+3,y=Fm(a),o=r/(1-r),l=i/Math.sqrt(1-r*Math.sin(g)*Math.sin(g)),h=Math.tan(g)*Math.tan(g),c=o*Math.cos(g)*Math.cos(g),u=Math.cos(g)*(p-y),d=i*((1-r/4-3*r*r/64-5*r*r*r/256)*g-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*g)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*g)-35*r*r*r/3072*Math.sin(6*g));var x=s*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*o)*u*u*u*u*u/120)+5e5,b=s*(d+l*Math.tan(g)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*o)*u*u*u*u*u*u/720));return t<0&&(b+=1e7),{northing:Math.round(b),easting:Math.round(x),zoneNumber:w,zoneLetter:U4(t)}}function c_(n){var t=n.northing,e=n.easting,i=n.zoneLetter,r=n.zoneNumber;if(r<0||r>60)return null;var s=.9996,a=6378137,o=.00669438,l,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),c,u,d,g,p,y,w,x,b,L=e-5e5,P=t;i<"N"&&(P-=1e7),w=(r-1)*6-180+3,l=o/(1-o),y=P/s,x=y/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),b=x+(3*h/2-27*h*h*h/32)*Math.sin(2*x)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*x)+151*h*h*h/96*Math.sin(6*x),c=a/Math.sqrt(1-o*Math.sin(b)*Math.sin(b)),u=Math.tan(b)*Math.tan(b),d=l*Math.cos(b)*Math.cos(b),g=a*(1-o)/Math.pow(1-o*Math.sin(b)*Math.sin(b),1.5),p=L/(c*s);var R=b-c*Math.tan(b)/g*(p*p/2-(5+3*u+10*d-4*d*d-9*l)*p*p*p*p/24+(61+90*u+298*d+45*u*u-252*l-3*d*d)*p*p*p*p*p*p/720);R=av(R);var j=(p-(1+2*u+d)*p*p*p/6+(5-2*d+28*u-3*d*d+8*l+24*u*u)*p*p*p*p*p/120)/Math.cos(b);j=w+av(j);var k;if(n.accuracy){var T=c_({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});k={top:T.lat,right:T.lon,bottom:R,left:j}}else k={lat:R,lon:j};return k}function U4(n){var t="Z";return 84>=n&&n>=72?t="X":72>n&&n>=64?t="W":64>n&&n>=56?t="V":56>n&&n>=48?t="U":48>n&&n>=40?t="T":40>n&&n>=32?t="S":32>n&&n>=24?t="R":24>n&&n>=16?t="Q":16>n&&n>=8?t="P":8>n&&n>=0?t="N":0>n&&n>=-8?t="M":-8>n&&n>=-16?t="L":-16>n&&n>=-24?t="K":-24>n&&n>=-32?t="J":-32>n&&n>=-40?t="H":-40>n&&n>=-48?t="G":-48>n&&n>=-56?t="F":-56>n&&n>=-64?t="E":-64>n&&n>=-72?t="D":-72>n&&n>=-80&&(t="C"),t}function z4(n,t){var e="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+q4(n.easting,n.northing,n.zoneNumber)+e.substr(e.length-5,t)+i.substr(i.length-5,t)}function q4(n,t,e){var i=yx(e),r=Math.floor(n/1e5),s=Math.floor(t/1e5)%20;return V4(r,s,i)}function yx(n){var t=n%sv;return t===0&&(t=sv),t}function V4(n,t,e){var i=e-1,r=gx.charCodeAt(i),s=mx.charCodeAt(i),a=r+n-1,o=s+t,l=!1;a>jc&&(a=a-jc+mh-1,l=!0),(a===or||r<or&&a>or||(a>or||r<or)&&l)&&a++,(a===Fr||r<Fr&&a>Fr||(a>Fr||r<Fr)&&l)&&(a++,a===or&&a++),a>jc&&(a=a-jc+mh-1),o>Gc?(o=o-Gc+mh-1,l=!0):l=!1,(o===or||s<or&&o>or||(o>or||s<or)&&l)&&o++,(o===Fr||s<Fr&&o>Fr||(o>Fr||s<Fr)&&l)&&(o++,o===or&&o++),o>Gc&&(o=o-Gc+mh-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function vx(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var t=n.length,e=null,i="",r,s=0;!/[A-Z]/.test(r=n.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+n;i+=r,s++}var a=parseInt(i,10);if(s===0||s+3>t)throw"MGRSPoint bad conversion from: "+n;var o=n.charAt(s++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+n;e=n.substring(s,s+=2);for(var l=yx(a),h=W4(e.charAt(0),l),c=H4(e.charAt(1),l);c<$4(o);)c+=2e6;var u=t-s;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var d=u/2,g=0,p=0,y,w,x,b,L;return d>0&&(y=1e5/Math.pow(10,d),w=n.substring(s,s+d),g=parseFloat(w)*y,x=n.substring(s+d),p=parseFloat(x)*y),b=g+h,L=p+c,{easting:b,northing:L,zoneLetter:o,zoneNumber:a,accuracy:y}}function W4(n,t){for(var e=gx.charCodeAt(t-1),i=1e5,r=!1;e!==n.charCodeAt(0);){if(e++,e===or&&e++,e===Fr&&e++,e>jc){if(r)throw"Bad character: "+n;e=mh,r=!0}i+=1e5}return i}function H4(n,t){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var e=mx.charCodeAt(t-1),i=0,r=!1;e!==n.charCodeAt(0);){if(e++,e===or&&e++,e===Fr&&e++,e>Gc){if(r)throw"Bad character: "+n;e=mh,r=!0}i+=1e5}return i}function $4(n){var t;switch(n){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+n}function Bh(n,t,e){if(!(this instanceof Bh))return new Bh(n,t,e);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof t>"u"){var i=n.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=n,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Bh.fromMGRS=function(n){return new Bh(_x(n))};Bh.prototype.toMGRS=function(n){return px([this.x,this.y],n)};var X4=1,Y4=.25,ov=.046875,lv=.01953125,hv=.01068115234375,K4=.75,Z4=.46875,J4=.013020833333333334,Q4=.007120768229166667,tI=.3645833333333333,eI=.005696614583333333,iI=.3076171875;function wx(n){var t=[];t[0]=X4-n*(Y4+n*(ov+n*(lv+n*hv))),t[1]=n*(K4-n*(ov+n*(lv+n*hv)));var e=n*n;return t[2]=e*(Z4-n*(J4+n*Q4)),e*=n,t[3]=e*(tI-n*eI),t[4]=e*n*iI,t}function jg(n,t,e,i){return e*=t,t*=t,i[0]*n-e*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}var nI=20;function xx(n,t,e){for(var i=1/(1-t),r=n,s=nI;s;--s){var a=Math.sin(r),o=1-t*a*a;if(o=(jg(r,a,Math.cos(r),e)-n)*(o*Math.sqrt(o))*i,r-=o,Math.abs(o)<jt)return r}return r}function rI(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=wx(this.es),this.ml0=jg(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function sI(n){var t=n.x,e=n.y,i=Vt(t-this.long0),r,s,a,o=Math.sin(e),l=Math.cos(e);if(this.es){var c=l*i,u=Math.pow(c,2),d=this.ep2*Math.pow(l,2),g=Math.pow(d,2),p=Math.abs(l)>jt?Math.tan(e):0,y=Math.pow(p,2),w=Math.pow(y,2);r=1-this.es*Math.pow(o,2),c=c/Math.sqrt(r);var x=jg(e,o,l,this.en);s=this.a*(this.k0*c*(1+u/6*(1-y+d+u/20*(5-18*y+w+14*d-58*y*d+u/42*(61+179*w-w*y-479*y)))))+this.x0,a=this.a*(this.k0*(x-this.ml0+o*i*c/2*(1+u/12*(5-y+9*d+4*g+u/30*(61+w-58*y+270*d-330*y*d+u/56*(1385+543*w-w*y-3111*y))))))+this.y0}else{var h=l*Math.sin(i);if(Math.abs(Math.abs(h)-1)<jt)return 93;if(s=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=l*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>jt)return 93;a=0}else a=Math.acos(a);e<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return n.x=s,n.y=a,n}function aI(n){var t,e,i,r,s=(n.x-this.x0)*(1/this.a),a=(n.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,e=xx(t,this.es,this.en),Math.abs(e)<Mt){var u=Math.sin(e),d=Math.cos(e),g=Math.abs(d)>jt?Math.tan(e):0,p=this.ep2*Math.pow(d,2),y=Math.pow(p,2),w=Math.pow(g,2),x=Math.pow(w,2);t=1-this.es*Math.pow(u,2);var b=s*Math.sqrt(t)/this.k0,L=Math.pow(b,2);t=t*g,i=e-t*L/(1-this.es)*.5*(1-L/12*(5+3*w-9*p*w+p-4*y-L/30*(61+90*w-252*p*w+45*x+46*p-L/56*(1385+3633*w+4095*x+1574*x*w)))),r=Vt(this.long0+b*(1-L/6*(1+2*w+p-L/20*(5+28*w+24*x+8*p*w+6*p-L/42*(61+662*w+1320*x+720*x*w))))/d)}else i=Mt*Du(a),r=0;else{var o=Math.exp(s/this.k0),l=.5*(o-1/o),h=this.lat0+a/this.k0,c=Math.cos(h);t=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(l,2))),i=Math.asin(t),a<0&&(i=-i),l===0&&c===0?r=0:r=Vt(Math.atan2(l,c)+this.long0)}return n.x=r,n.y=i,n}var oI=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const vd={init:rI,forward:sI,inverse:aI,names:oI};function bx(n){var t=Math.exp(n);return t=(t-1/t)/2,t}function Dr(n,t){n=Math.abs(n),t=Math.abs(t);var e=Math.max(n,t),i=Math.min(n,t)/(e||1);return e*Math.sqrt(1+Math.pow(i,2))}function lI(n){var t=1+n,e=t-1;return e===0?n:n*Math.log(t)/e}function hI(n){var t=Math.abs(n);return t=lI(t*(1+t/(Dr(1,t)+1))),n<0?-t:t}function u_(n,t){for(var e=2*Math.cos(2*t),i=n.length-1,r=n[i],s=0,a;--i>=0;)a=-s+e*r+n[i],s=r,r=a;return t+a*Math.sin(2*t)}function cI(n,t){for(var e=2*Math.cos(t),i=n.length-1,r=n[i],s=0,a;--i>=0;)a=-s+e*r+n[i],s=r,r=a;return Math.sin(t)*a}function uI(n){var t=Math.exp(n);return t=(t+1/t)/2,t}function Ex(n,t,e){for(var i=Math.sin(t),r=Math.cos(t),s=bx(e),a=uI(e),o=2*r*a,l=-2*i*s,h=n.length-1,c=n[h],u=0,d=0,g=0,p,y;--h>=0;)p=d,y=u,d=c,u=g,c=-p+o*d-l*u+n[h],g=-y+l*d+o*u;return o=i*a,l=r*s,[o*c-l*g,o*g+l*c]}function fI(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(vd.init.apply(this),this.forward=vd.forward,this.inverse=vd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),t=n/(2-n),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var i=u_(this.cbg,this.lat0);this.Zb=-this.Qn*(i+cI(this.gtu,2*i))}function dI(n){var t=Vt(n.x-this.long0),e=n.y;e=u_(this.cbg,e);var i=Math.sin(e),r=Math.cos(e),s=Math.sin(t),a=Math.cos(t);e=Math.atan2(i,a*r),t=Math.atan2(s*r,Dr(i,r*a)),t=hI(Math.tan(t));var o=Ex(this.gtu,2*e,2*t);e=e+o[0],t=t+o[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,h=1/0),n.x=l,n.y=h,n}function gI(n){var t=(n.x-this.x0)*(1/this.a),e=(n.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var i,r;if(Math.abs(t)<=2.623395162778){var s=Ex(this.utg,2*e,2*t);e=e+s[0],t=t+s[1],t=Math.atan(bx(t));var a=Math.sin(e),o=Math.cos(e),l=Math.sin(t),h=Math.cos(t);e=Math.atan2(a*h,Dr(l,h*o)),t=Math.atan2(l,h*o),i=Vt(t+this.long0),r=u_(this.cgb,e)}else i=1/0,r=1/0;return n.x=i,n.y=r,n}var mI=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const wd={init:fI,forward:dI,inverse:gI,names:mI};function pI(n,t){if(n===void 0){if(n=Math.floor((Vt(t)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var _I="etmerc";function yI(){var n=pI(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*En,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,wd.init.apply(this),this.forward=wd.forward,this.inverse=wd.inverse}var vI=["Universal Transverse Mercator System","utm"];const wI={init:yI,names:vI,dependsOn:_I};function f_(n,t){return Math.pow((1-n)/(1+n),t)}var xI=20;function bI(){var n=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Qe)/(Math.pow(Math.tan(.5*this.lat0+Qe),this.C)*f_(this.e*n,this.ratexp))}function EI(n){var t=n.x,e=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Qe),this.C)*f_(this.e*Math.sin(e),this.ratexp))-Mt,n.x=this.C*t,n}function SI(n){for(var t=1e-14,e=n.x/this.C,i=n.y,r=Math.pow(Math.tan(.5*i+Qe)/this.K,1/this.C),s=xI;s>0&&(i=2*Math.atan(r*f_(this.e*Math.sin(n.y),-.5*this.e))-Mt,!(Math.abs(i-n.y)<t));--s)n.y=i;return s?(n.x=e,n.y=i,n):null}var LI=["gauss"];const d_={init:bI,forward:EI,inverse:SI,names:LI};function CI(){d_.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function AI(n){var t,e,i,r;return n.x=Vt(n.x-this.long0),d_.forward.apply(this,[n]),t=Math.sin(n.y),e=Math.cos(n.y),i=Math.cos(n.x),r=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*i),n.x=r*e*Math.sin(n.x),n.y=r*(this.cosc0*t-this.sinc0*e*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function TI(n){var t,e,i,r,s;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,s=Dr(n.x,n.y)){var a=2*Math.atan2(s,this.R2);t=Math.sin(a),e=Math.cos(a),r=Math.asin(e*this.sinc0+n.y*t*this.cosc0/s),i=Math.atan2(n.x*t,s*this.cosc0*e-n.y*this.sinc0*t)}else r=this.phic0,i=0;return n.x=i,n.y=r,d_.inverse.apply(this,[n]),n.x=Vt(n.x+this.long0),n}var MI=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const PI={init:CI,forward:AI,inverse:TI,names:MI};function RI(n,t,e){return t*=e,Math.tan(.5*(Mt+n))*Math.pow((1-t)/(1+t),.5*e)}function II(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=jt&&(this.k0=.5*(1+Du(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=jt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=jt&&Math.abs(Math.cos(this.lat_ts))>jt&&(this.k0=.5*this.cons*Ws(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/gs(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Ws(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Mt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function NI(n){var t=n.x,e=n.y,i=Math.sin(e),r=Math.cos(e),s,a,o,l,h,c,u=Vt(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=jt&&Math.abs(e+this.lat0)<=jt?(n.x=NaN,n.y=NaN,n):this.sphere?(s=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(u)),n.x=this.a*s*r*Math.sin(u)+this.x0,n.y=this.a*s*(this.coslat0*i-this.sinlat0*r*Math.cos(u))+this.y0,n):(a=2*Math.atan(this.ssfn_(e,i,this.e))-Mt,l=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=jt?(h=gs(this.e,e*this.con,this.con*i),c=2*this.a*this.k0*h/this.cons,n.x=this.x0+c*Math.sin(t-this.long0),n.y=this.y0-this.con*c*Math.cos(t-this.long0),n):(Math.abs(this.sinlat0)<jt?(s=2*this.a*this.k0/(1+l*Math.cos(u)),n.y=s*o):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*l*Math.cos(u))),n.y=s*(this.cosX0*o-this.sinX0*l*Math.cos(u))+this.y0),n.x=s*l*Math.sin(u)+this.x0,n))}function FI(n){n.x-=this.x0,n.y-=this.y0;var t,e,i,r,s,a=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,e=this.lat0,a<=jt?(n.x=t,n.y=e,n):(e=Math.asin(Math.cos(o)*this.sinlat0+n.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<jt?this.lat0>0?t=Vt(this.long0+Math.atan2(n.x,-1*n.y)):t=Vt(this.long0+Math.atan2(n.x,n.y)):t=Vt(this.long0+Math.atan2(n.x*Math.sin(o),a*this.coslat0*Math.cos(o)-n.y*this.sinlat0*Math.sin(o))),n.x=t,n.y=e,n)}else if(Math.abs(this.coslat0)<=jt){if(a<=jt)return e=this.lat0,t=this.long0,n.x=t,n.y=e,n;n.x*=this.con,n.y*=this.con,i=a*this.cons/(2*this.a*this.k0),e=this.con*xu(this.e,i),t=this.con*Vt(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else r=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=jt?s=this.X0:(s=Math.asin(Math.cos(r)*this.sinX0+n.y*Math.sin(r)*this.cosX0/a),t=Vt(this.long0+Math.atan2(n.x*Math.sin(r),a*this.cosX0*Math.cos(r)-n.y*this.sinX0*Math.sin(r)))),e=-1*xu(this.e,Math.tan(.5*(Mt+s)));return n.x=t,n.y=e,n}var kI=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const OI={init:II,forward:NI,inverse:FI,names:kI,ssfn_:RI};function DI(){var n=this.lat0;this.lambda0=this.long0;var t=Math.sin(n),e=this.a,i=this.rf,r=1/i,s=2*r-Math.pow(r,2),a=this.e=Math.sqrt(s);this.R=this.k0*e*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+n/2)),h=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*l+this.alpha*a/2*h}function BI(n){var t=Math.log(Math.tan(Math.PI/4-n.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(t+e)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(n.x-this.lambda0),a=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(s))),o=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(s));return n.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,n.x=this.R*a+this.x0,n}function GI(n){for(var t=n.x-this.x0,e=n.y-this.y0,i=t/this.R,r=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),o=this.lambda0+a/this.alpha,l=0,h=s,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return n.x=o,n.y=h,n}var jI=["somerc"];const UI={init:DI,forward:BI,inverse:GI,names:jI};var sh=1e-7;function zI(n){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||t.indexOf(e)!==-1}function qI(){var n,t,e,i,r,s,a,o,l,h,c=0,u,d=0,g=0,p=0,y=0,w=0,x=0;this.no_off=zI(this),this.no_rot="no_rot"in this;var b=!1;"alpha"in this&&(b=!0);var L=!1;if("rectified_grid_angle"in this&&(L=!0),b&&(x=this.alpha),L&&(c=this.rectified_grid_angle*En),b||L)d=this.longc;else if(g=this.long1,y=this.lat1,p=this.long2,w=this.lat2,Math.abs(y-w)<=sh||(n=Math.abs(y))<=sh||Math.abs(n-Mt)<=sh||Math.abs(Math.abs(this.lat0)-Mt)<=sh||Math.abs(Math.abs(w)-Mt)<=sh)throw new Error;var P=1-this.es;t=Math.sqrt(P),Math.abs(this.lat0)>jt?(o=Math.sin(this.lat0),e=Math.cos(this.lat0),n=1-this.es*o*o,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/P),this.A=this.B*this.k0*t/n,i=this.B*t/(e*Math.sqrt(n)),r=i*i-1,r<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(gs(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=r=1),b||L?(b?(u=Math.asin(Math.sin(x)/i),L||(c=x)):(u=c,x=Math.asin(i*Math.sin(u))),this.lam0=d-Math.asin(.5*(r-1/r)*Math.tan(u))/this.B):(s=Math.pow(gs(this.e,y,Math.sin(y)),this.B),a=Math.pow(gs(this.e,w,Math.sin(w)),this.B),r=this.E/s,l=(a-s)/(a+s),h=this.E*this.E,h=(h-a*s)/(h+a*s),n=g-p,n<-Math.pi?p-=vu:n>Math.pi&&(p+=vu),this.lam0=Vt(.5*(g+p)-Math.atan(h*Math.tan(.5*this.B*(g-p))/l)/this.B),u=Math.atan(2*Math.sin(this.B*Vt(g-this.lam0))/(r-1/r)),c=x=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(x))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Qe-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(Qe+r))}function VI(n){var t={},e,i,r,s,a,o,l,h;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-Mt)>jt){if(a=this.E/Math.pow(gs(this.e,n.y,Math.sin(n.y)),this.B),o=1/a,e=.5*(a-o),i=.5*(a+o),s=Math.sin(this.B*n.x),r=(e*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(r)-1)<jt)throw new Error;h=.5*this.ArB*Math.log((1-r)/(1+r)),o=Math.cos(this.B*n.x),Math.abs(o)<sh?l=this.A*n.x:l=this.ArB*Math.atan2(e*this.cosgam+s*this.singam,o)}else h=n.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*n.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function WI(n){var t,e,i,r,s,a,o,l={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(e=n.y,t=n.x):(e=n.x*this.cosrot-n.y*this.sinrot,t=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*e),r=.5*(i-1/i),s=.5*(i+1/i),a=Math.sin(this.BrA*t),o=(a*this.cosgam+r*this.singam)/s,Math.abs(Math.abs(o)-1)<jt)l.x=0,l.y=o<0?-Mt:Mt;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=xu(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(r*this.cosgam-a*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var HI=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const $I={init:qI,forward:VI,inverse:WI,names:HI};function XI(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<jt)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),i=Ws(this.e,t,e),r=gs(this.e,this.lat1,t),s=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Ws(this.e,s,a),l=gs(this.e,this.lat2,s),h=gs(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>jt?this.ns=Math.log(i/o)/Math.log(r/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function YI(n){var t=n.x,e=n.y;Math.abs(2*Math.abs(e)-Math.PI)<=jt&&(e=Du(e)*(Mt-2*jt));var i=Math.abs(Math.abs(e)-Mt),r,s;if(i>jt)r=gs(this.e,e,Math.sin(e)),s=this.a*this.f0*Math.pow(r,this.ns);else{if(i=e*this.ns,i<=0)return null;s=0}var a=this.ns*Vt(t-this.long0);return n.x=this.k0*(s*Math.sin(a))+this.x0,n.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,n}function KI(n){var t,e,i,r,s,a=(n.x-this.x0)/this.k0,o=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+o*o),e=1):(t=-Math.sqrt(a*a+o*o),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*a,e*o)),t!==0||this.ns>0){if(e=1/this.ns,i=Math.pow(t/(this.a*this.f0),e),r=xu(this.e,i),r===-9999)return null}else r=-Mt;return s=Vt(l/this.ns+this.long0),n.x=s,n.y=r,n}var ZI=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const JI={init:XI,forward:YI,inverse:KI,names:ZI};function QI(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function tN(n){var t,e,i,r,s,a,o,l=n.x,h=n.y,c=Vt(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),i=-c*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(i)),s=Math.asin(Math.cos(e)*Math.sin(i)/Math.cos(r)),a=this.n*s,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),n.y=o*Math.cos(a)/1,n.x=o*Math.sin(a)/1,this.czech||(n.y*=-1,n.x*=-1),n}function eN(n){var t,e,i,r,s,a,o,l,h=n.x;n.x=n.y,n.y=h,this.czech||(n.y*=-1,n.x*=-1),a=Math.sqrt(n.x*n.x+n.y*n.y),s=Math.atan2(n.y,n.x),r=s/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),e=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(t)),n.x=this.long0-e/this.alfa,o=t,l=0;var c=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-n.y)<1e-10&&(l=1),o=n.y,c+=1;while(l===0&&c<15);return c>=15?null:n}var iN=["Krovak","krovak"];const nN={init:QI,forward:tN,inverse:eN,names:iN};function Xn(n,t,e,i,r){return n*r-t*Math.sin(2*r)+e*Math.sin(4*r)-i*Math.sin(6*r)}function Bu(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function Gu(n){return .375*n*(1+.25*n*(1+.46875*n))}function ju(n){return .05859375*n*n*(1+.75*n)}function Uu(n){return n*n*n*(35/3072)}function Gh(n,t,e){var i=t*e;return n/Math.sqrt(1-i*i)}function Yh(n){return Math.abs(n)<Mt?n:n-Du(n)*Math.PI}function ig(n,t,e,i,r){var s,a;s=n/t;for(var o=0;o<15;o++)if(a=(n-(t*s-e*Math.sin(2*s)+i*Math.sin(4*s)-r*Math.sin(6*s)))/(t-2*e*Math.cos(2*s)+4*i*Math.cos(4*s)-6*r*Math.cos(6*s)),s+=a,Math.abs(a)<=1e-10)return s;return NaN}function rN(){this.sphere||(this.e0=Bu(this.es),this.e1=Gu(this.es),this.e2=ju(this.es),this.e3=Uu(this.es),this.ml0=this.a*Xn(this.e0,this.e1,this.e2,this.e3,this.lat0))}function sN(n){var t,e,i=n.x,r=n.y;if(i=Vt(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(r)*Math.sin(i)),e=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var s=Math.sin(r),a=Math.cos(r),o=Gh(this.a,this.e,s),l=Math.tan(r)*Math.tan(r),h=i*Math.cos(r),c=h*h,u=this.es*a*a/(1-this.es),d=this.a*Xn(this.e0,this.e1,this.e2,this.e3,r);t=o*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),e=d-this.ml0+o*s/a*c*(.5+(5-l+6*u)*c/24)}return n.x=t+this.x0,n.y=e+this.y0,n}function aN(n){n.x-=this.x0,n.y-=this.y0;var t=n.x/this.a,e=n.y/this.a,i,r;if(this.sphere){var s=e+this.lat0;i=Math.asin(Math.sin(s)*Math.cos(t)),r=Math.atan2(Math.tan(t),Math.cos(s))}else{var a=this.ml0/this.a+e,o=ig(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Mt)<=jt)return n.x=this.long0,n.y=Mt,e<0&&(n.y*=-1),n;var l=Gh(this.a,this.e,Math.sin(o)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(o),2),u=t*this.a/l,d=u*u;i=o-l*Math.tan(o)/h*u*u*(.5-(1+3*c)*u*u/24),r=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(o)}return n.x=Vt(r+this.long0),n.y=Yh(i),n}var oN=["Cassini","Cassini_Soldner","cass"];const lN={init:rN,forward:sN,inverse:aN,names:oN};function go(n,t){var e;return n>1e-7?(e=n*t,(1-n*n)*(t/(1-e*e)-.5/n*Math.log((1-e)/(1+e)))):2*t}var hN=1,cN=2,uN=3,fN=4;function dN(){var n=Math.abs(this.lat0);if(Math.abs(n-Mt)<jt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<jt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=go(this.e,1),this.mmf=.5/(1-this.es),this.apa=bN(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=go(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function gN(n){var t,e,i,r,s,a,o,l,h,c,u=n.x,d=n.y;if(u=Vt(u-this.long0),this.sphere){if(s=Math.sin(d),c=Math.cos(d),i=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+c*i:1+this.sinph0*s+this.cosph0*c*i,e<=jt)return null;e=Math.sqrt(2/e),t=e*c*Math.sin(u),e*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*c*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<jt)return null;e=Qe-d*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(u),e*=i}}else{switch(o=0,l=0,h=0,i=Math.cos(u),r=Math.sin(u),s=Math.sin(d),a=go(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=Mt+d,a=this.qp-a;break;case this.S_POLE:h=d-Mt,a=this.qp+a;break}if(Math.abs(h)<jt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?e=this.ymf*h*(this.cosb1*o-this.sinb1*l*i):e=(h=Math.sqrt(2/(1+l*i)))*o*this.ymf,t=this.xmf*h*l*r;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(h=Math.sqrt(a))*r,e=i*(this.mode===this.S_POLE?h:-h)):t=e=0;break}}return n.x=this.a*t+this.x0,n.y=this.a*e+this.y0,n}function mN(n){n.x-=this.x0,n.y-=this.y0;var t=n.x/this.a,e=n.y/this.a,i,r,s,a,o,l,h;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(t*t+e*e),r=u*.5,r>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(r),c=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(u)<=jt?0:Math.asin(e*d/u),t*=d,e=c*u;break;case this.OBLIQ:r=Math.abs(u)<=jt?this.lat0:Math.asin(c*this.sinph0+e*d*this.cosph0/u),t*=d*this.cosph0,e=(c-Math.sin(r)*this.sinph0)*u;break;case this.N_POLE:e=-e,r=Mt-r;break;case this.S_POLE:r-=Mt;break}i=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<jt)return n.x=this.long0,n.y=this.lat0,n;a=2*Math.asin(.5*l/this.rq),s=Math.cos(a),t*=a=Math.sin(a),this.mode===this.OBLIQ?(h=s*this.sinb1+e*a*this.cosb1/l,o=this.qp*h,e=l*this.cosb1*s-e*this.sinb1*a):(h=e*a/l,o=this.qp*h,e=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),o=t*t+e*e,!o)return n.x=this.long0,n.y=this.lat0,n;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(t,e),r=EN(Math.asin(h),this.apa)}return n.x=Vt(this.long0+i),n.y=r,n}var pN=.3333333333333333,_N=.17222222222222222,yN=.10257936507936508,vN=.06388888888888888,wN=.0664021164021164,xN=.016415012942191543;function bN(n){var t,e=[];return e[0]=n*pN,t=n*n,e[0]+=t*_N,e[1]=t*vN,t*=n,e[0]+=t*yN,e[1]+=t*wN,e[2]=t*xN,e}function EN(n,t){var e=n+n;return n+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var SN=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const LN={init:dN,forward:gN,inverse:mN,names:SN,S_POLE:hN,N_POLE:cN,EQUIT:uN,OBLIQ:fN};function wo(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function CN(){Math.abs(this.lat1+this.lat2)<jt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Ws(this.e3,this.sin_po,this.cos_po),this.qs1=go(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Ws(this.e3,this.sin_po,this.cos_po),this.qs2=go(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=go(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>jt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function AN(n){var t=n.x,e=n.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var i=go(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,s=this.ns0*Vt(t-this.long0),a=r*Math.sin(s)+this.x0,o=this.rh-r*Math.cos(s)+this.y0;return n.x=a,n.y=o,n}function TN(n){var t,e,i,r,s,a;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),r=0,t!==0&&(r=Math.atan2(i*n.x,i*n.y)),i=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(e=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,e)),s=Vt(r/this.ns0+this.long0),n.x=s,n.y=a,n}function MN(n,t){var e,i,r,s,a,o=wo(.5*t);if(n<jt)return o;for(var l=n*n,h=1;h<=25;h++)if(e=Math.sin(o),i=Math.cos(o),r=n*e,s=1-r*r,a=.5*s*s/i*(t/(1-l)-e/s+.5/n*Math.log((1-r)/(1+r))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var PN=["Albers_Conic_Equal_Area","Albers","aea"];const RN={init:CN,forward:AN,inverse:TN,names:PN,phi1z:MN};function IN(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function NN(n){var t,e,i,r,s,a,o,l,h=n.x,c=n.y;return i=Vt(h-this.long0),t=Math.sin(c),e=Math.cos(c),r=Math.cos(i),a=this.sin_p14*t+this.cos_p14*e*r,s=1,a>0||Math.abs(a)<=jt?(o=this.x0+this.a*s*e*Math.sin(i)/a,l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*r)/a):(o=this.x0+this.infinity_dist*e*Math.sin(i),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*r)),n.x=o,n.y=l,n}function FN(n){var t,e,i,r,s,a;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(t=Math.sqrt(n.x*n.x+n.y*n.y))?(r=Math.atan2(t,this.rc),e=Math.sin(r),i=Math.cos(r),a=wo(i*this.sin_p14+n.y*e*this.cos_p14/t),s=Math.atan2(n.x*e,t*this.cos_p14*i-n.y*this.sin_p14*e),s=Vt(this.long0+s)):(a=this.phic0,s=0),n.x=s,n.y=a,n}var kN=["gnom"];const ON={init:IN,forward:NN,inverse:FN,names:kN};function DN(n,t){var e=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*Mt:Mt;for(var i=Math.asin(.5*t),r,s,a,o,l=0;l<30;l++)if(s=Math.sin(i),a=Math.cos(i),o=n*s,r=Math.pow(1-o*o,2)/(2*a)*(t/(1-n*n)-s/(1-o*o)+.5/n*Math.log((1-o)/(1+o))),i+=r,Math.abs(r)<=1e-10)return i;return NaN}function BN(){this.sphere||(this.k0=Ws(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function GN(n){var t=n.x,e=n.y,i,r,s=Vt(t-this.long0);if(this.sphere)i=this.x0+this.a*s*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var a=go(this.e,Math.sin(e));i=this.x0+this.a*this.k0*s,r=this.y0+this.a*a*.5/this.k0}return n.x=i,n.y=r,n}function jN(n){n.x-=this.x0,n.y-=this.y0;var t,e;return this.sphere?(t=Vt(this.long0+n.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(e=DN(this.e,2*n.y*this.k0/this.a),t=Vt(this.long0+n.x/(this.a*this.k0))),n.x=t,n.y=e,n}var UN=["cea"];const zN={init:BN,forward:GN,inverse:jN,names:UN};function qN(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function VN(n){var t=n.x,e=n.y,i=Vt(t-this.long0),r=Yh(e-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*r,n}function WN(n){var t=n.x,e=n.y;return n.x=Vt(this.long0+(t-this.x0)/(this.a*this.rc)),n.y=Yh(this.lat0+(e-this.y0)/this.a),n}var HN=["Equirectangular","Equidistant_Cylindrical","eqc"];const $N={init:qN,forward:VN,inverse:WN,names:HN};var cv=20;function XN(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Bu(this.es),this.e1=Gu(this.es),this.e2=ju(this.es),this.e3=Uu(this.es),this.ml0=this.a*Xn(this.e0,this.e1,this.e2,this.e3,this.lat0)}function YN(n){var t=n.x,e=n.y,i,r,s,a=Vt(t-this.long0);if(s=a*Math.sin(e),this.sphere)Math.abs(e)<=jt?(i=this.a*a,r=-1*this.a*this.lat0):(i=this.a*Math.sin(s)/Math.tan(e),r=this.a*(Yh(e-this.lat0)+(1-Math.cos(s))/Math.tan(e)));else if(Math.abs(e)<=jt)i=this.a*a,r=-1*this.ml0;else{var o=Gh(this.a,this.e,Math.sin(e))/Math.tan(e);i=o*Math.sin(s),r=this.a*Xn(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+o*(1-Math.cos(s))}return n.x=i+this.x0,n.y=r+this.y0,n}function KN(n){var t,e,i,r,s,a,o,l,h;if(i=n.x-this.x0,r=n.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=jt)t=Vt(i/this.a+this.long0),e=0;else{a=this.lat0+r/this.a,o=i*i/this.a/this.a+a*a,l=a;var c;for(s=cv;s;--s)if(c=Math.tan(l),h=-1*(a*(l*c+1)-l-.5*(l*l+o)*c)/((l-a)/c-1),l+=h,Math.abs(h)<=jt){e=l;break}t=Vt(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(r+this.ml0)<=jt)e=0,t=Vt(this.long0+i/this.a);else{a=(this.ml0+r)/this.a,o=i*i/this.a/this.a+a*a,l=a;var u,d,g,p,y;for(s=cv;s;--s)if(y=this.e*Math.sin(l),u=Math.sqrt(1-y*y)*Math.tan(l),d=this.a*Xn(this.e0,this.e1,this.e2,this.e3,l),g=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),p=d/this.a,h=(a*(u*p+1)-p-.5*u*(p*p+o))/(this.es*Math.sin(2*l)*(p*p+o-2*a*p)/(4*u)+(a-p)*(u*g-2/Math.sin(2*l))-g),l-=h,Math.abs(h)<=jt){e=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=Vt(this.long0+Math.asin(i*u/this.a)/Math.sin(e))}return n.x=t,n.y=e,n}var ZN=["Polyconic","poly"];const JN={init:XN,forward:YN,inverse:KN,names:ZN};function QN(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function tF(n){var t,e=n.x,i=n.y,r=i-this.lat0,s=e-this.long0,a=r/Qc*1e-5,o=s,l=1,h=0;for(t=1;t<=10;t++)l=l*a,h=h+this.A[t]*l;var c=h,u=o,d=1,g=0,p,y,w=0,x=0;for(t=1;t<=6;t++)p=d*c-g*u,y=g*c+d*u,d=p,g=y,w=w+this.B_re[t]*d-this.B_im[t]*g,x=x+this.B_im[t]*d+this.B_re[t]*g;return n.x=x*this.a+this.x0,n.y=w*this.a+this.y0,n}function eF(n){var t,e=n.x,i=n.y,r=e-this.x0,s=i-this.y0,a=s/this.a,o=r/this.a,l=1,h=0,c,u,d=0,g=0;for(t=1;t<=6;t++)c=l*a-h*o,u=h*a+l*o,l=c,h=u,d=d+this.C_re[t]*l-this.C_im[t]*h,g=g+this.C_im[t]*l+this.C_re[t]*h;for(var p=0;p<this.iterations;p++){var y=d,w=g,x,b,L=a,P=o;for(t=2;t<=6;t++)x=y*d-w*g,b=w*d+y*g,y=x,w=b,L=L+(t-1)*(this.B_re[t]*y-this.B_im[t]*w),P=P+(t-1)*(this.B_im[t]*y+this.B_re[t]*w);y=1,w=0;var R=this.B_re[1],j=this.B_im[1];for(t=2;t<=6;t++)x=y*d-w*g,b=w*d+y*g,y=x,w=b,R=R+t*(this.B_re[t]*y-this.B_im[t]*w),j=j+t*(this.B_im[t]*y+this.B_re[t]*w);var k=R*R+j*j;d=(L*R+P*j)/k,g=(P*R-L*j)/k}var T=d,q=g,W=1,F=0;for(t=1;t<=9;t++)W=W*T,F=F+this.D[t]*W;var M=this.lat0+F*Qc*1e5,O=this.long0+q;return n.x=O,n.y=M,n}var iF=["New_Zealand_Map_Grid","nzmg"];const nF={init:QN,forward:tF,inverse:eF,names:iF};function rF(){}function sF(n){var t=n.x,e=n.y,i=Vt(t-this.long0),r=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return n.x=r,n.y=s,n}function aF(n){n.x-=this.x0,n.y-=this.y0;var t=Vt(this.long0+n.x/this.a),e=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=t,n.y=e,n}var oF=["Miller_Cylindrical","mill"];const lF={init:rF,forward:sF,inverse:aF,names:oF};var hF=20;function cF(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=wx(this.es)}function uF(n){var t,e,i=n.x,r=n.y;if(i=Vt(i-this.long0),this.sphere){if(!this.m)r=this.n!==1?Math.asin(this.n*Math.sin(r)):r;else for(var s=this.n*Math.sin(r),a=hF;a;--a){var o=(this.m*r+Math.sin(r)-s)/(this.m+Math.cos(r));if(r-=o,Math.abs(o)<jt)break}t=this.a*this.C_x*i*(this.m+Math.cos(r)),e=this.a*this.C_y*r}else{var l=Math.sin(r),h=Math.cos(r);e=this.a*jg(r,l,h,this.en),t=this.a*i*h/Math.sqrt(1-this.es*l*l)}return n.x=t,n.y=e,n}function fF(n){var t,e,i,r;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,t=n.y/this.a,this.sphere?(t/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(t))),this.m?t=wo((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=wo(Math.sin(t)/this.n)),i=Vt(i+this.long0),t=Yh(t)):(t=xx(n.y/this.a,this.es,this.en),r=Math.abs(t),r<Mt?(r=Math.sin(t),e=this.long0+n.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(t)),i=Vt(e)):r-jt<Mt&&(i=this.long0)),n.x=i,n.y=t,n}var dF=["Sinusoidal","sinu"];const gF={init:cF,forward:uF,inverse:fF,names:dF};function mF(){}function pF(n){for(var t=n.x,e=n.y,i=Vt(t-this.long0),r=e,s=Math.PI*Math.sin(e);;){var a=-(r+Math.sin(r)-s)/(1+Math.cos(r));if(r+=a,Math.abs(a)<jt)break}r/=2,Math.PI/2-Math.abs(e)<jt&&(i=0);var o=.900316316158*this.a*i*Math.cos(r)+this.x0,l=1.4142135623731*this.a*Math.sin(r)+this.y0;return n.x=o,n.y=l,n}function _F(n){var t,e;n.x-=this.x0,n.y-=this.y0,e=n.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var i=Vt(this.long0+n.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var r=Math.asin(e);return n.x=i,n.y=r,n}var yF=["Mollweide","moll"];const vF={init:mF,forward:pF,inverse:_F,names:yF};function wF(){Math.abs(this.lat1+this.lat2)<jt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Bu(this.es),this.e1=Gu(this.es),this.e2=ju(this.es),this.e3=Uu(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Ws(this.e,this.sinphi,this.cosphi),this.ml1=Xn(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<jt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Ws(this.e,this.sinphi,this.cosphi),this.ml2=Xn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Xn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function xF(n){var t=n.x,e=n.y,i;if(this.sphere)i=this.a*(this.g-e);else{var r=Xn(this.e0,this.e1,this.e2,this.e3,e);i=this.a*(this.g-r)}var s=this.ns*Vt(t-this.long0),a=this.x0+i*Math.sin(s),o=this.y0+this.rh-i*Math.cos(s);return n.x=a,n.y=o,n}function bF(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var t,e,i,r;this.ns>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),t=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),t=-1);var s=0;if(e!==0&&(s=Math.atan2(t*n.x,t*n.y)),this.sphere)return r=Vt(this.long0+s/this.ns),i=Yh(this.g-e/this.a),n.x=r,n.y=i,n;var a=this.g-e/this.a;return i=ig(a,this.e0,this.e1,this.e2,this.e3),r=Vt(this.long0+s/this.ns),n.x=r,n.y=i,n}var EF=["Equidistant_Conic","eqdc"];const SF={init:wF,forward:xF,inverse:bF,names:EF};function LF(){this.R=this.a}function CF(n){var t=n.x,e=n.y,i=Vt(t-this.long0),r,s;Math.abs(e)<=jt&&(r=this.x0+this.R*i,s=this.y0);var a=wo(2*Math.abs(e/Math.PI));(Math.abs(i)<=jt||Math.abs(Math.abs(e)-Mt)<=jt)&&(r=this.x0,e>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*a):s=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),l=o*o,h=Math.sin(a),c=Math.cos(a),u=c/(h+c-1),d=u*u,g=u*(2/h-1),p=g*g,y=Math.PI*this.R*(o*(u-p)+Math.sqrt(l*(u-p)*(u-p)-(p+l)*(d-p)))/(p+l);i<0&&(y=-y),r=this.x0+y;var w=l+u;return y=Math.PI*this.R*(g*w-o*Math.sqrt((p+l)*(l+1)-w*w))/(p+l),e>=0?s=this.y0+y:s=this.y0-y,n.x=r,n.y=s,n}function AF(n){var t,e,i,r,s,a,o,l,h,c,u,d,g;return n.x-=this.x0,n.y-=this.y0,u=Math.PI*this.R,i=n.x/u,r=n.y/u,s=i*i+r*r,a=-Math.abs(r)*(1+s),o=a-2*r*r+i*i,l=-2*a+1+2*r*r+s*s,g=r*r/l+(2*o*o*o/l/l/l-9*a*o/l/l)/27,h=(a-o*o/3/l)/l,c=2*Math.sqrt(-h/3),u=3*g/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,n.y>=0?e=(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:e=-(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,Math.abs(i)<jt?t=this.long0:t=Vt(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(i*i-r*r)+s*s))/2/i),n.x=t,n.y=e,n}var TF=["Van_der_Grinten_I","VanDerGrinten","vandg"];const MF={init:LF,forward:CF,inverse:AF,names:TF};function PF(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function RF(n){var t=n.x,e=n.y,i=Math.sin(n.y),r=Math.cos(n.y),s=Vt(t-this.long0),a,o,l,h,c,u,d,g,p,y,w,x,b,L,P,R,j,k,T,q,W,F,M;return this.sphere?Math.abs(this.sin_p12-1)<=jt?(n.x=this.x0+this.a*(Mt-e)*Math.sin(s),n.y=this.y0-this.a*(Mt-e)*Math.cos(s),n):Math.abs(this.sin_p12+1)<=jt?(n.x=this.x0+this.a*(Mt+e)*Math.sin(s),n.y=this.y0+this.a*(Mt+e)*Math.cos(s),n):(k=this.sin_p12*i+this.cos_p12*r*Math.cos(s),R=Math.acos(k),j=R?R/Math.sin(R):1,n.x=this.x0+this.a*j*r*Math.sin(s),n.y=this.y0+this.a*j*(this.cos_p12*i-this.sin_p12*r*Math.cos(s)),n):(a=Bu(this.es),o=Gu(this.es),l=ju(this.es),h=Uu(this.es),Math.abs(this.sin_p12-1)<=jt?(c=this.a*Xn(a,o,l,h,Mt),u=this.a*Xn(a,o,l,h,e),n.x=this.x0+(c-u)*Math.sin(s),n.y=this.y0-(c-u)*Math.cos(s),n):Math.abs(this.sin_p12+1)<=jt?(c=this.a*Xn(a,o,l,h,Mt),u=this.a*Xn(a,o,l,h,e),n.x=this.x0+(c+u)*Math.sin(s),n.y=this.y0+(c+u)*Math.cos(s),n):(d=i/r,g=Gh(this.a,this.e,this.sin_p12),p=Gh(this.a,this.e,i),y=Math.atan((1-this.es)*d+this.es*g*this.sin_p12/(p*r)),w=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(s)),w===0?T=Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(w)-Math.PI)<=jt?T=-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):T=Math.asin(Math.sin(s)*Math.cos(y)/Math.sin(w)),x=this.e*this.sin_p12/Math.sqrt(1-this.es),b=this.e*this.cos_p12*Math.cos(w)/Math.sqrt(1-this.es),L=x*b,P=b*b,q=T*T,W=q*T,F=W*T,M=F*T,R=g*T*(1-q*P*(1-P)/6+W/8*L*(1-2*P)+F/120*(P*(4-7*P)-3*x*x*(1-7*P))-M/48*L),n.x=this.x0+R*Math.sin(w),n.y=this.y0+R*Math.cos(w),n))}function IF(n){n.x-=this.x0,n.y-=this.y0;var t,e,i,r,s,a,o,l,h,c,u,d,g,p,y,w,x,b,L,P,R,j,k,T;return this.sphere?(t=Math.sqrt(n.x*n.x+n.y*n.y),t>2*Mt*this.a?void 0:(e=t/this.a,i=Math.sin(e),r=Math.cos(e),s=this.long0,Math.abs(t)<=jt?a=this.lat0:(a=wo(r*this.sin_p12+n.y*i*this.cos_p12/t),o=Math.abs(this.lat0)-Mt,Math.abs(o)<=jt?this.lat0>=0?s=Vt(this.long0+Math.atan2(n.x,-n.y)):s=Vt(this.long0-Math.atan2(-n.x,n.y)):s=Vt(this.long0+Math.atan2(n.x*i,t*this.cos_p12*r-n.y*this.sin_p12*i))),n.x=s,n.y=a,n)):(l=Bu(this.es),h=Gu(this.es),c=ju(this.es),u=Uu(this.es),Math.abs(this.sin_p12-1)<=jt?(d=this.a*Xn(l,h,c,u,Mt),t=Math.sqrt(n.x*n.x+n.y*n.y),g=d-t,a=ig(g/this.a,l,h,c,u),s=Vt(this.long0+Math.atan2(n.x,-1*n.y)),n.x=s,n.y=a,n):Math.abs(this.sin_p12+1)<=jt?(d=this.a*Xn(l,h,c,u,Mt),t=Math.sqrt(n.x*n.x+n.y*n.y),g=t-d,a=ig(g/this.a,l,h,c,u),s=Vt(this.long0+Math.atan2(n.x,n.y)),n.x=s,n.y=a,n):(t=Math.sqrt(n.x*n.x+n.y*n.y),w=Math.atan2(n.x,n.y),p=Gh(this.a,this.e,this.sin_p12),x=Math.cos(w),b=this.e*this.cos_p12*x,L=-b*b/(1-this.es),P=3*this.es*(1-L)*this.sin_p12*this.cos_p12*x/(1-this.es),R=t/p,j=R-L*(1+L)*Math.pow(R,3)/6-P*(1+3*L)*Math.pow(R,4)/24,k=1-L*j*j/2-R*j*j*j/6,y=Math.asin(this.sin_p12*Math.cos(j)+this.cos_p12*Math.sin(j)*x),s=Vt(this.long0+Math.asin(Math.sin(w)*Math.sin(j)/Math.cos(y))),T=Math.sin(y),a=Math.atan2((T-this.es*k*this.sin_p12)*Math.tan(y),T*(1-this.es)),n.x=s,n.y=a,n))}var NF=["Azimuthal_Equidistant","aeqd"];const FF={init:PF,forward:RF,inverse:IF,names:NF};function kF(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function OF(n){var t,e,i,r,s,a,o,l,h=n.x,c=n.y;return i=Vt(h-this.long0),t=Math.sin(c),e=Math.cos(c),r=Math.cos(i),a=this.sin_p14*t+this.cos_p14*e*r,s=1,(a>0||Math.abs(a)<=jt)&&(o=this.a*s*e*Math.sin(i),l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*r)),n.x=o,n.y=l,n}function DF(n){var t,e,i,r,s,a,o;return n.x-=this.x0,n.y-=this.y0,t=Math.sqrt(n.x*n.x+n.y*n.y),e=wo(t/this.a),i=Math.sin(e),r=Math.cos(e),a=this.long0,Math.abs(t)<=jt?(o=this.lat0,n.x=a,n.y=o,n):(o=wo(r*this.sin_p14+n.y*i*this.cos_p14/t),s=Math.abs(this.lat0)-Mt,Math.abs(s)<=jt?(this.lat0>=0?a=Vt(this.long0+Math.atan2(n.x,-n.y)):a=Vt(this.long0-Math.atan2(-n.x,n.y)),n.x=a,n.y=o,n):(a=Vt(this.long0+Math.atan2(n.x*i,t*this.cos_p14*r-n.y*this.sin_p14*i)),n.x=a,n.y=o,n))}var BF=["ortho"];const GF={init:kF,forward:OF,inverse:DF,names:BF};var Ti={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},ti={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function jF(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Mt-Qe/2?this.face=Ti.TOP:this.lat0<=-(Mt-Qe/2)?this.face=Ti.BOTTOM:Math.abs(this.long0)<=Qe?this.face=Ti.FRONT:Math.abs(this.long0)<=Mt+Qe?this.face=this.long0>0?Ti.RIGHT:Ti.LEFT:this.face=Ti.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function UF(n){var t={x:0,y:0},e,i,r,s,a,o,l={value:0};if(n.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):e=n.y,i=n.x,this.face===Ti.TOP)s=Mt-e,i>=Qe&&i<=Mt+Qe?(l.value=ti.AREA_0,r=i-Mt):i>Mt+Qe||i<=-(Mt+Qe)?(l.value=ti.AREA_1,r=i>0?i-Ui:i+Ui):i>-(Mt+Qe)&&i<=-Qe?(l.value=ti.AREA_2,r=i+Mt):(l.value=ti.AREA_3,r=i);else if(this.face===Ti.BOTTOM)s=Mt+e,i>=Qe&&i<=Mt+Qe?(l.value=ti.AREA_0,r=-i+Mt):i<Qe&&i>=-Qe?(l.value=ti.AREA_1,r=-i):i<-Qe&&i>=-(Mt+Qe)?(l.value=ti.AREA_2,r=-i-Mt):(l.value=ti.AREA_3,r=i>0?-i+Ui:-i-Ui);else{var h,c,u,d,g,p,y;this.face===Ti.RIGHT?i=Mh(i,+Mt):this.face===Ti.BACK?i=Mh(i,+Ui):this.face===Ti.LEFT&&(i=Mh(i,-Mt)),d=Math.sin(e),g=Math.cos(e),p=Math.sin(i),y=Math.cos(i),h=g*y,c=g*p,u=d,this.face===Ti.FRONT?(s=Math.acos(h),r=rd(s,u,c,l)):this.face===Ti.RIGHT?(s=Math.acos(c),r=rd(s,u,-h,l)):this.face===Ti.BACK?(s=Math.acos(-h),r=rd(s,u,-c,l)):this.face===Ti.LEFT?(s=Math.acos(-c),r=rd(s,u,h,l)):(s=r=0,l.value=ti.AREA_0)}return o=Math.atan(12/Ui*(r+Math.acos(Math.sin(r)*Math.cos(Qe))-Mt)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(r))))),l.value===ti.AREA_1?o+=Mt:l.value===ti.AREA_2?o+=Ui:l.value===ti.AREA_3&&(o+=1.5*Ui),t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,n.x=t.x,n.y=t.y,n}function zF(n){var t={lam:0,phi:0},e,i,r,s,a,o,l,h,c,u={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),e=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?u.value=ti.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(u.value=ti.AREA_1,e-=Mt):n.x<0&&-n.x>=Math.abs(n.y)?(u.value=ti.AREA_2,e=e<0?e+Ui:e-Ui):(u.value=ti.AREA_3,e+=Mt),c=Ui/12*Math.tan(e),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),o=Math.atan(a),r=Math.cos(e),s=Math.tan(i),l=1-r*r*s*s*(1-Math.cos(Math.atan(1/Math.cos(o)))),l<-1?l=-1:l>1&&(l=1),this.face===Ti.TOP)h=Math.acos(l),t.phi=Mt-h,u.value===ti.AREA_0?t.lam=o+Mt:u.value===ti.AREA_1?t.lam=o<0?o+Ui:o-Ui:u.value===ti.AREA_2?t.lam=o-Mt:t.lam=o;else if(this.face===Ti.BOTTOM)h=Math.acos(l),t.phi=h-Mt,u.value===ti.AREA_0?t.lam=-o+Mt:u.value===ti.AREA_1?t.lam=-o:u.value===ti.AREA_2?t.lam=-o-Mt:t.lam=o<0?-o-Ui:-o+Ui;else{var d,g,p;d=l,c=d*d,c>=1?p=0:p=Math.sqrt(1-c)*Math.sin(o),c+=p*p,c>=1?g=0:g=Math.sqrt(1-c),u.value===ti.AREA_1?(c=g,g=-p,p=c):u.value===ti.AREA_2?(g=-g,p=-p):u.value===ti.AREA_3&&(c=g,g=p,p=-c),this.face===Ti.RIGHT?(c=d,d=-g,g=c):this.face===Ti.BACK?(d=-d,g=-g):this.face===Ti.LEFT&&(c=d,d=g,g=-c),t.phi=Math.acos(-p)-Mt,t.lam=Math.atan2(g,d),this.face===Ti.RIGHT?t.lam=Mh(t.lam,-Mt):this.face===Ti.BACK?t.lam=Mh(t.lam,-Ui):this.face===Ti.LEFT&&(t.lam=Mh(t.lam,+Mt))}if(this.es!==0){var y,w,x;y=t.phi<0?1:0,w=Math.tan(t.phi),x=this.b/Math.sqrt(w*w+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-x*x)/(this.one_minus_f*x)),y&&(t.phi=-t.phi)}return t.lam+=this.long0,n.x=t.lam,n.y=t.phi,n}function rd(n,t,e,i){var r;return n<jt?(i.value=ti.AREA_0,r=0):(r=Math.atan2(t,e),Math.abs(r)<=Qe?i.value=ti.AREA_0:r>Qe&&r<=Mt+Qe?(i.value=ti.AREA_1,r-=Mt):r>Mt+Qe||r<=-(Mt+Qe)?(i.value=ti.AREA_2,r=r>=0?r-Ui:r+Ui):(i.value=ti.AREA_3,r+=Mt)),r}function Mh(n,t){var e=n+t;return e<-Ui?e+=vu:e>+Ui&&(e-=vu),e}var qF=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const VF={init:jF,forward:UF,inverse:zF,names:qF};var Op=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Uc=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Sx=.8487,Lx=1.3523,Cx=ks/5,WF=1/Cx,ph=18,ng=function(n,t){return n[0]+t*(n[1]+t*(n[2]+t*n[3]))},HF=function(n,t){return n[1]+t*(2*n[2]+t*3*n[3])};function $F(n,t,e,i){for(var r=t;i;--i){var s=n(r);if(r-=s,Math.abs(s)<e)break}return r}function XF(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function YF(n){var t=Vt(n.x-this.long0),e=Math.abs(n.y),i=Math.floor(e*Cx);i<0?i=0:i>=ph&&(i=ph-1),e=ks*(e-WF*i);var r={x:ng(Op[i],e)*t,y:ng(Uc[i],e)};return n.y<0&&(r.y=-r.y),r.x=r.x*this.a*Sx+this.x0,r.y=r.y*this.a*Lx+this.y0,r}function KF(n){var t={x:(n.x-this.x0)/(this.a*Sx),y:Math.abs(n.y-this.y0)/(this.a*Lx)};if(t.y>=1)t.x/=Op[ph][0],t.y=n.y<0?-Mt:Mt;else{var e=Math.floor(t.y*ph);for(e<0?e=0:e>=ph&&(e=ph-1);;)if(Uc[e][0]>t.y)--e;else if(Uc[e+1][0]<=t.y)++e;else break;var i=Uc[e],r=5*(t.y-i[0])/(Uc[e+1][0]-i[0]);r=$F(function(s){return(ng(i,s)-t.y)/HF(i,s)},r,jt,100),t.x/=ng(Op[e],r),t.y=(5*e+r)*En,n.y<0&&(t.y=-t.y)}return t.x=Vt(t.x+this.long0),t}var ZF=["Robinson","robin"];const JF={init:XF,forward:YF,inverse:KF,names:ZF};function QF(){this.name="geocent"}function t6(n){var t=ux(n,this.es,this.a);return t}function e6(n){var t=fx(n,this.es,this.a,this.b);return t}var i6=["Geocentric","geocentric","geocent","Geocent"];const n6={init:QF,forward:t6,inverse:e6,names:i6};var Nn={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Nc={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function r6(){if(Object.keys(Nc).forEach((function(e){if(typeof this[e]>"u")this[e]=Nc[e].def;else{if(Nc[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Nc[e].num&&(this[e]=parseFloat(this[e]))}Nc[e].degrees&&(this[e]=this[e]*En)}).bind(this)),Math.abs(Math.abs(this.lat0)-Mt)<jt?this.mode=this.lat0<0?Nn.S_POLE:Nn.N_POLE:Math.abs(this.lat0)<jt?this.mode=Nn.EQUIT:(this.mode=Nn.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(n),this.sw=Math.sin(n)}function s6(n){n.x-=this.long0;var t=Math.sin(n.y),e=Math.cos(n.y),i=Math.cos(n.x),r,s;switch(this.mode){case Nn.OBLIQ:s=this.sinph0*t+this.cosph0*e*i;break;case Nn.EQUIT:s=e*i;break;case Nn.S_POLE:s=-t;break;case Nn.N_POLE:s=t;break}switch(s=this.pn1/(this.p-s),r=s*e*Math.sin(n.x),this.mode){case Nn.OBLIQ:s*=this.cosph0*t-this.sinph0*e*i;break;case Nn.EQUIT:s*=t;break;case Nn.N_POLE:s*=-(e*i);break;case Nn.S_POLE:s*=e*i;break}var a,o;return a=s*this.cg+r*this.sg,o=1/(a*this.sw*this.h1+this.cw),r=(r*this.cg-s*this.sg)*this.cw*o,s=a*o,n.x=r*this.a,n.y=s*this.a,n}function a6(n){n.x/=this.a,n.y/=this.a;var t={x:n.x,y:n.y},e,i,r;r=1/(this.pn1-n.y*this.sw),e=this.pn1*n.x*r,i=this.pn1*n.y*this.cw*r,n.x=e*this.cg+i*this.sg,n.y=i*this.cg-e*this.sg;var s=Dr(n.x,n.y);if(Math.abs(s)<jt)t.x=0,t.y=n.y;else{var a,o;switch(o=1-s*s*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/s+s/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Nn.OBLIQ:t.y=Math.asin(a*this.sinph0+n.y*o*this.cosph0/s),n.y=(a-this.sinph0*Math.sin(t.y))*s,n.x*=o*this.cosph0;break;case Nn.EQUIT:t.y=Math.asin(n.y*o/s),n.y=a*s,n.x*=o;break;case Nn.N_POLE:t.y=Math.asin(a),n.y=-n.y;break;case Nn.S_POLE:t.y=-Math.asin(a);break}t.x=Math.atan2(n.x,n.y)}return n.x=t.x+this.long0,n.y=t.y,n}var o6=["Tilted_Perspective","tpers"];const l6={init:r6,forward:s6,inverse:a6,names:o6};function h6(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,t=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function c6(n){var t=n.x,e=n.y,i,r,s,a;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var o=this.radius_p/Dr(this.radius_p*Math.cos(e),Math.sin(e));if(r=o*Math.cos(t)*Math.cos(e),s=o*Math.sin(t)*Math.cos(e),a=o*Math.sin(e),(this.radius_g-r)*r-s*s-a*a*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(s/Dr(a,i)),n.y=this.radius_g_1*Math.atan(a/i)):(n.x=this.radius_g_1*Math.atan(s/i),n.y=this.radius_g_1*Math.atan(a/Dr(s,i)))}else this.shape==="sphere"&&(i=Math.cos(e),r=Math.cos(t)*i,s=Math.sin(t)*i,a=Math.sin(e),i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(s/Dr(a,i)),n.y=this.radius_g_1*Math.atan(a/i)):(n.x=this.radius_g_1*Math.atan(s/i),n.y=this.radius_g_1*Math.atan(a/Dr(s,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function u6(n){var t=-1,e=0,i=0,r,s,a,o;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),e=Math.tan(n.x/this.radius_g_1)*Dr(1,i)):(e=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Dr(1,e));var l=i/this.radius_p;if(r=e*e+l*l+t*t,s=2*this.radius_g*t,a=s*s-4*r*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-s-Math.sqrt(a))/(2*r),t=this.radius_g+o*t,e*=o,i*=o,n.x=Math.atan2(e,t),n.y=Math.atan(i*Math.cos(n.x)/t),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),e=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(e=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+e*e)),r=e*e+i*i+t*t,s=2*this.radius_g*t,a=s*s-4*r*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-s-Math.sqrt(a))/(2*r),t=this.radius_g+o*t,e*=o,i*=o,n.x=Math.atan2(e,t),n.y=Math.atan(i*Math.cos(n.x)/t)}return n.x=n.x+this.long0,n}var f6=["Geostationary Satellite View","Geostationary_Satellite","geos"];const d6={init:h6,forward:c6,inverse:u6,names:f6};var tu=1.340264,eu=-.081106,iu=893e-6,nu=.003796,rg=Math.sqrt(3)/2;function g6(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function m6(n){var t=Vt(n.x-this.long0),e=n.y,i=Math.asin(rg*Math.sin(e)),r=i*i,s=r*r*r;return n.x=t*Math.cos(i)/(rg*(tu+3*eu*r+s*(7*iu+9*nu*r))),n.y=i*(tu+eu*r+s*(iu+nu*r)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function p6(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var t=1e-9,e=12,i=n.y,r,s,a,o,l,h;for(h=0;h<e&&(r=i*i,s=r*r*r,a=i*(tu+eu*r+s*(iu+nu*r))-n.y,o=tu+3*eu*r+s*(7*iu+9*nu*r),i-=l=a/o,!(Math.abs(l)<t));++h);return r=i*i,s=r*r*r,n.x=rg*n.x*(tu+3*eu*r+s*(7*iu+9*nu*r))/Math.cos(i),n.y=Math.asin(Math.sin(i)/rg),n.x=Vt(n.x+this.long0),n}var _6=["eqearth","Equal Earth","Equal_Earth"];const y6={init:g6,forward:m6,inverse:p6,names:_6};function v6(n){n.Proj.projections.add(vd),n.Proj.projections.add(wd),n.Proj.projections.add(wI),n.Proj.projections.add(PI),n.Proj.projections.add(OI),n.Proj.projections.add(UI),n.Proj.projections.add($I),n.Proj.projections.add(JI),n.Proj.projections.add(nN),n.Proj.projections.add(lN),n.Proj.projections.add(LN),n.Proj.projections.add(RN),n.Proj.projections.add(ON),n.Proj.projections.add(zN),n.Proj.projections.add($N),n.Proj.projections.add(JN),n.Proj.projections.add(nF),n.Proj.projections.add(lF),n.Proj.projections.add(gF),n.Proj.projections.add(vF),n.Proj.projections.add(SF),n.Proj.projections.add(MF),n.Proj.projections.add(FF),n.Proj.projections.add(GF),n.Proj.projections.add(VF),n.Proj.projections.add(JF),n.Proj.projections.add(n6),n.Proj.projections.add(l6),n.Proj.projections.add(d6),n.Proj.projections.add(y6)}dr.defaultDatum="WGS84";dr.Proj=js;dr.WGS84=new dr.Proj("WGS84");dr.Point=Bh;dr.toPoint=dx;dr.defs=Wn;dr.nadgrid=b4;dr.transform=eg;dr.mgrs=B4;dr.version="__VERSION__";v6(dr);var w6=class extends Ar{constructor(t){t=t||{},super();var e=this.input=t.input;e||(e=this.input=document.createElement("INPUT"),t.type&&e.setAttribute("type",t.type),t.min!==void 0&&e.setAttribute("min",t.min),t.max!==void 0&&e.setAttribute("max",t.max),t.step!==void 0&&e.setAttribute("step",t.step),t.parent&&t.parent.appendChild(e)),t.disabled&&(e.disabled=!0),t.checked!==void 0&&(e.checked=!!t.checked),t.val!==void 0&&(e.value=t.val),t.hidden&&(e.style.display="none"),e.addEventListener("focus",(function(){this.element&&this.element.classList.add("ol-focus")}).bind(this));var i;e.addEventListener("focusout",(function(){this.element&&(i&&clearTimeout(i),i=setTimeout((function(){this.element.classList.remove("ol-focus")}).bind(this),0))}).bind(this))}_listenDrag(t,e){var i=(function(r){this.moving=!0,this.element.classList.add("ol-moving");var s=(function(a){a.type==="pointerup"&&(document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",s),document.removeEventListener("pointercancel",s),setTimeout((function(){this.moving=!1,this.element.classList.remove("ol-moving")}).bind(this))),a.target===t&&e(a),a.stopPropagation(),a.preventDefault()}).bind(this);document.addEventListener("pointermove",s,!1),document.addEventListener("pointerup",s,!1),document.addEventListener("pointercancel",s,!1),r.stopPropagation(),r.preventDefault()}).bind(this);t.addEventListener("mousedown",i,!1),t.addEventListener("touchstart",i,!1)}setValue(t){t!==void 0&&(this.input.value=t),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},g_=class extends w6{constructor(t){t=t||{},super(t);var e=this.element=document.createElement("LABEL");t.html instanceof Element?e.appendChild(t.html):t.html!==void 0&&(e.innerHTML=t.html),e.className=("ol-ext-check ol-ext-checkbox "+(t.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(e,this.input),e.appendChild(this.input),e.appendChild(document.createElement("SPAN")),t.after&&e.appendChild(document.createTextNode(t.after)),this.input.addEventListener("change",(function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}).bind(this))}isChecked(){return this.input.checked}},x6=class extends g_{constructor(t){t=t||{},super(t),this.element.className=("ol-ext-toggle-switch "+(t.className||"")).trim()}},b6=class extends g_{constructor(t){t=t||{},super(t),this.element.className=("ol-ext-check ol-ext-radio "+(t.className||"")).trim()}},X={};X.create=function(n,t){t=t||{};var e;if(n==="TEXT")e=document.createTextNode(t.html||""),t.parent&&t.parent.appendChild(e);else{e=document.createElement(n),/button/i.test(n)&&e.setAttribute("type","button");for(var i in t)switch(i){case"className":{t.className&&t.className.trim&&e.setAttribute("class",t.className.trim());break}case"text":{e.innerText=t.text;break}case"html":{t.html instanceof Element?e.appendChild(t.html):t.html!==void 0&&(e.innerHTML=t.html);break}case"parent":{t.parent&&t.parent.appendChild(e);break}case"options":{if(/select/i.test(n))for(var r in t.options)X.create("OPTION",{html:r,value:t.options[r],parent:e});break}case"style":{X.setStyle(e,t.style);break}case"change":case"click":{X.addListener(e,i,t[i]);break}case"on":{for(var s in t.on)X.addListener(e,s,t.on[s]);break}case"checked":{e.checked=!!t.checked;break}default:{e.setAttribute(i,t[i]);break}}}return e};X.createSwitch=function(n){var t=X.create("INPUT",{type:"checkbox",on:n.on,click:n.click,change:n.change,parent:n.parent}),e=Object.assign({input:t},n||{});return new x6(e),t};X.createCheck=function(n){var t=X.create("INPUT",{name:n.name,type:n.type==="radio"?"radio":"checkbox",on:n.on,parent:n.parent}),e=Object.assign({input:t},n||{});return n.type==="radio"?new b6(e):new g_(e),t};X.setHTML=function(n,t){t instanceof Element?n.appendChild(t):t!==void 0&&(n.innerHTML=t)};X.appendText=function(n,t){n.appendChild(document.createTextNode(t||""))};X.addListener=function(n,t,e,i){typeof t=="string"&&(t=t.split(" ")),t.forEach(function(r){n.addEventListener(r,e,i)})};X.removeListener=function(n,t,e){typeof t=="string"&&(t=t.split(" ")),t.forEach(function(i){n.removeEventListener(i,e)})};X.show=function(n){n.style.display=""};X.hide=function(n){n.style.display="none"};X.hidden=function(n){return X.getStyle(n,"display")==="none"};X.toggle=function(n){n.style.display=n.style.display==="none"?"":"none"};X.setStyle=function(n,t){for(var e in t)switch(e){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":{typeof t[e]=="number"?n.style[e]=t[e]+"px":n.style[e]=t[e];break}default:n.style[e]=t[e]}};X.getStyle=function(n,t){var e,i=(n.ownerDocument||document).defaultView;if(i&&i.getComputedStyle)t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),e=i.getComputedStyle(n,null).getPropertyValue(t);else if(n.currentStyle&&(t=t.replace(/-(\w)/g,function(r,s){return s.toUpperCase()}),e=n.currentStyle[t],/^\d+(em|pt|%|ex)?$/i.test(e)))return function(r){var s=n.style.left,a=n.runtimeStyle.left;return n.runtimeStyle.left=n.currentStyle.left,n.style.left=r||0,r=n.style.pixelLeft+"px",n.style.left=s,n.runtimeStyle.left=a,r}(e);return/px$/.test(e)?parseInt(e):e};X.outerHeight=function(n){return n.offsetHeight+X.getStyle(n,"marginBottom")};X.outerWidth=function(n){return n.offsetWidth+X.getStyle(n,"marginLeft")};X.offsetRect=function(n){var t=n.getBoundingClientRect();return{top:t.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:t.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:t.height||t.bottom-t.top,width:t.width||t.right-t.left}};X.getFixedOffset=function(n){var t={left:0,top:0},e=function(i){if(!i)return t;if(X.getStyle(i,"position")==="absolute"&&X.getStyle(i,"transform")!=="none"){var r=i.getBoundingClientRect();return t.left+=r.left,t.top+=r.top,t}return e(i.offsetParent)};return e(n.offsetParent)};X.positionRect=function(n,t){var e=0,i=0,r=function(s){if(s)return e+=s.offsetLeft,i+=s.offsetTop,r(s.offsetParent);var a={top:n.offsetTop+i,left:n.offsetLeft+e};return t&&(a.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,a.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),a.bottom=a.top+n.offsetHeight,a.right=a.top+n.offsetWidth,a};return r(n.offsetParent)};X.scrollDiv=function(n,t){t=t||{};var e=!1,i=0,r,s=0,a=typeof t.onmove=="function"?t.onmove:function(){},o=t.vertical?"screenY":"screenX",l=t.vertical?"scrollTop":"scrollLeft",h=!1,c,u,d=0,g=function(){L&&(d++,setTimeout(p))},p=function(){if(L){if(d--,d)return;var k=n.clientHeight,T=n.scrollHeight;c=k/T,L.style.height=c*100+"%",L.style.top=n.scrollTop/T*100+"%",b.style.height=k+"px",k>T-.5?b.classList.add("ol-100pc"):b.classList.remove("ol-100pc")}},y=function(k){k.target.classList.contains("ol-noscroll")||(h=!1,e=k[o],s=new Date,n.classList.add("ol-move"),k.preventDefault(),window.addEventListener("pointermove",w),X.addListener(window,["pointerup","pointercancel"],R))},w=function(k){if(e!==!1){var T=(u?-1/c:1)*(e-k[o]);h=h||Math.round(T),n[l]+=T,r=new Date,r-s&&(i=(i+T/(r-s))/2),e=k[o],s=r,T&&a(!0)}else h=!0},x=function(k){var T=k>0?Math.min(100,k/2):Math.max(-100,k/2);k-=T,n[l]+=T,-1<k&&k<1?(h?setTimeout(function(){n.classList.remove("ol-move")}):n.classList.remove("ol-move"),h=!1,a(!1)):setTimeout(function(){x(k)},40)},b,L;if(t.vertical&&t.minibar){var P=function(k){n.removeEventListener("pointermove",P),n.parentNode.classList.add("ol-miniscroll"),L=X.create("DIV"),b=X.create("DIV",{className:"ol-scroll",html:L}),n.parentNode.insertBefore(b,n),L.addEventListener("pointerdown",function(T){u=!0,y(T)}),t.mousewheel&&(X.addListener(b,["mousewheel","DOMMouseScroll","onmousewheel"],function(T){j(T)}),X.addListener(L,["mousewheel","DOMMouseScroll","onmousewheel"],function(T){j(T)})),n.parentNode.addEventListener("pointerenter",g),window.addEventListener("resize",g),k!==!1&&g()};n.parentNode?P(!1):n.addEventListener("pointermove",P),n.addEventListener("scroll",function(){g()})}n.style["touch-action"]="none",n.style.overflow="hidden",n.classList.add("ol-scrolldiv"),X.addListener(n,["pointerdown"],function(k){u=!1,y(k)}),n.addEventListener("click",function(k){n.classList.contains("ol-move")&&(k.preventDefault(),k.stopPropagation())},!0);var R=function(k){s=new Date-s,s>100||u?i=0:s>0&&(i=((i||0)+(e-k[o])/s)/2),x(t.animate===!1?0:i*200),e=!1,i=0,s=0,n.classList.contains("ol-move")?n.classList.remove("ol-hasClick"):(n.classList.add("ol-hasClick"),setTimeout(function(){n.classList.remove("ol-hasClick")},500)),u=!1,window.removeEventListener("pointermove",w),X.removeListener(window,["pointerup","pointercancel"],R)},j=function(k){var T=Math.max(-1,Math.min(1,k.wheelDelta||-k.detail));return n.classList.add("ol-move"),n[l]-=T*30,n.classList.remove("ol-move"),!1};return t.mousewheel&&X.addListener(n,["mousewheel","DOMMouseScroll","onmousewheel"],j),{refresh:g}};X.dispatchEvent=function(n,t){var e;try{e=new CustomEvent(n)}catch{e=document.createEvent("CustomEvent"),e.initCustomEvent(n,!0,!0,{})}t.dispatchEvent(e)};var Ax=class extends sn{constructor(t){t=t||{};var e=(t.className||"")+" ol-search"+(t.target?"":" ol-unselectable ol-control"),i=X.create("DIV",{className:e});super({element:i,target:t.target});var r=this;if(t.typing==null&&(t.typing=300),this._classname=t.className||"search",t.collapsed!==!1&&i.classList.add("ol-collapsed"),t.target||(this.button=document.createElement("BUTTON"),this.button.setAttribute("type","button"),this.button.setAttribute("title",t.title||t.label||"Search"),this.button.addEventListener("click",function(){if(i.classList.toggle("ol-collapsed"),!i.classList.contains("ol-collapsed")){i.querySelector("input.search").focus();for(var d=i.querySelectorAll("li"),g=0;g<d.length;g++)d[g].classList.remove("select");l.value||r.drawList_()}}),i.appendChild(this.button)),t.inputLabel){var s=document.createElement("LABEL");s.innerText=t.inputLabel,i.appendChild(s)}var a,o="",l=this._input=document.createElement("INPUT");l.setAttribute("type","search"),l.setAttribute("class","search"),l.setAttribute("autocomplete","off"),l.setAttribute("placeholder",t.placeholder||"Search..."),l.addEventListener("change",function(d){r.dispatchEvent({type:"change:input",input:d,value:l.value})});var h=function(d){var g=i.querySelector("ul.autocomplete li.select"),p=l.value;if(d.key=="ArrowDown"||d.key=="ArrowUp"||d.key=="Down"||d.key=="Up")g?(g.classList.remove("select"),g=/Down/.test(d.key)?g.nextElementSibling:g.previousElementSibling,g&&g.classList.add("select")):i.querySelector("ul.autocomplete li").classList.add("select");else if(d.type=="input"&&!p)setTimeout(function(){r.drawList_()},200);else if(g&&(d.type=="search"||d.key=="Enter"))i.classList.contains("ol-control")&&l.blur(),g.classList.remove("select"),o=p,r._handleSelect(r._list[g.getAttribute("data-search")]);else if(d.type=="search"||d.key=="Enter"||o!=p&&t.typing>=0)if(o=p,o){a&&clearTimeout(a);var y=r.get("minLength");a=setTimeout(function(){if(o.length>=y){var w=r.autocomplete(o,function(x){r.drawList_(x)});w&&r.drawList_(w)}else r.drawList_()},t.typing)}else r.drawList_();else g=i.querySelector("ul.autocomplete li"),g&&g.classList.remove("select")};if(l.addEventListener("keyup",h),l.addEventListener("search",h),l.addEventListener("cut",h),l.addEventListener("paste",h),l.addEventListener("input",h),t.noCollapse||(l.addEventListener("blur",(function(){setTimeout((function(){l!==document.activeElement&&(i.classList.add("ol-collapsed"),this.set("reverse",!1),i.classList.remove("ol-revers"))}).bind(this),200)}).bind(this)),l.addEventListener("focus",(function(){this.get("reverse")||(i.classList.remove("ol-collapsed"),i.classList.remove("ol-revers"))}).bind(this))),i.appendChild(l),t.reverse){var c=X.create("BUTTON",{type:"button",class:"ol-revers",title:t.reverseTitle||"click on the map",click:(function(){this.get("reverse")?this.set("reverse",!1):(this.set("reverse",!this.get("reverse")),l.focus(),i.classList.add("ol-revers"))}).bind(this)});i.appendChild(c)}var u=document.createElement("UL");u.classList.add("autocomplete"),i.appendChild(u),typeof t.getTitle=="function"&&(this.getTitle=t.getTitle),typeof t.autocomplete=="function"&&(this.autocomplete=t.autocomplete),this.set("copy",t.copy),this.set("minLength",t.minLength||1),this.set("maxItems",t.maxItems||10),this.set("maxHistory",t.maxHistory||t.maxItems||10),t.onselect&&this.on("select",t.onselect),t.centerOnSelect&&this.on("select",(function(d){var g=this.getMap();g&&g.getView().setCenter(d.coordinate)}).bind(this)),t.zoomOnSelect&&this.on("select",(function(d){var g=this.getMap();g&&(g.getView().setCenter(d.coordinate),g.getView().getZoom()<t.zoomOnSelect&&g.getView().setZoom(t.zoomOnSelect))}).bind(this)),this.restoreHistory(),this.drawList_()}setMap(t){this._listener&&Lr(this._listener),this._listener=null,super.setMap(t),t&&(this._listener=t.on("click",this._handleClick.bind(this)))}collapse(t){t===!1?this.element.classList.remove("ol-collapsed"):this.element.classList.add("ol-collapsed")}getInputField(){return this._input}getTitle(t){return t.name||"No title"}_getTitleTxt(t){return X.create("DIV",{html:this.getTitle(t)}).innerText}search(){var t=this.element.querySelector("input.search");this._triggerCustomEvent("search",t)}_handleClick(t){this.get("reverse")&&(document.activeElement.blur(),this.reverseGeocode(t.coordinate))}reverseGeocode(){}_triggerCustomEvent(t,e){X.dispatchEvent(t,e)}setInput(t,e){var i=this.element.querySelector("input.search");i.value=t,e&&this._triggerCustomEvent("keyup",i)}select(t,e,i,r){var s={type:"select",search:t,reverse:!!e,coordinate:i};if(r)for(var a in r)s[a]=r[a];this.dispatchEvent(s)}_handleSelect(t,e,i){if(t){var r=this.get("history"),s;try{var a=JSON.stringify(t);for(s=r.length-1;s>=0;s--)(!r[s]||JSON.stringify(r[s])===a)&&r.splice(s,1)}catch{for(s=r.length-1;s>=0;s--)r[s]===t&&r.splice(s,1)}r.unshift(t);for(var o=Math.max(0,this.get("maxHistory")||10)||0;r.length>o;)r.pop();this.saveHistory(),this.select(t,e,null,i),e&&(this.setInput(this._getTitleTxt(t)),this.drawList_(),setTimeout((function(){this.collapse(!1)}).bind(this),300))}}saveHistory(){try{this.get("maxHistory")>=0?localStorage["ol@search-"+this._classname]=JSON.stringify(this.get("history")):localStorage.removeItem("ol@search-"+this._classname)}catch{console.warn("Failed to access localStorage...")}}restoreHistory(){if(this._history[this._classname])this.set("history",this._history[this._classname]);else try{this._history[this._classname]=JSON.parse(localStorage["ol@search-"+this._classname]),this.set("history",this._history[this._classname])}catch{this.set("history",[])}}clearHistory(){this.set("history",[]),this.saveHistory(),this.drawList_()}getHistory(){return this.get("history")}autocomplete(t,e){return e([]),!1}drawList_(t){var e=this,i=this.element.querySelector("ul.autocomplete");if(i.innerHTML="",this._list=[],t)i.setAttribute("class","autocomplete");else{var r=this.element.querySelector("input.search"),s=r.value;if(!s)t=this.get("history");else return;i.setAttribute("class","autocomplete history")}for(var a,o=Math.min(e.get("maxItems"),t.length),l=0;l<o;l++)if(t[l]&&(!l||!e.equalFeatures(t[l],t[l-1]))){a=document.createElement("LI"),a.setAttribute("data-search",this._list.length),this._list.push(t[l]),a.addEventListener("click",function(c){e._handleSelect(e._list[c.currentTarget.getAttribute("data-search")])});var h=e.getTitle(t[l]);h instanceof Element?a.appendChild(h):a.innerHTML=h,i.appendChild(a)}o&&this.get("copy")&&(a=document.createElement("LI"),a.classList.add("copy"),a.innerHTML=this.get("copy"),i.appendChild(a))}equalFeatures(){return!1}};Ax.prototype._history={};var m_=class extends Ar{constructor(t){t=t||{},super(),this._auth=t.auth,this.set("dataType",t.dataType||"JSON")}static get(t){var e=new m_(t);t.success&&e.on("success",function(i){t.success(i.response,i)}),t.error&&e.on("error",function(i){t.error(i)}),e.send(t.url,t.data,t.options)}static getCORS(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.send(),i.onreadystatechange=function(){this.readyState==this.HEADERS_RECEIVED&&e(i.getResponseHeader("Access-Control-Allow-Origin"))}}send(t,e,i){i=i||{};var r=this,s=i.encode!==!1;s&&(t=encodeURI(t));var a="";for(var o in e)e.hasOwnProperty(o)&&e[o]!==void 0&&(a+=(a?"&":"?")+o+"="+(s?encodeURIComponent(e[o]):e[o]));this._request&&i.abort!==!1&&this._request.abort();var l=this._request=new XMLHttpRequest;l.open("GET",t+a,!0),i.timeout&&(l.timeout=i.timeout),this._auth&&l.setRequestHeader("Authorization","Basic "+this._auth),this.dispatchEvent({type:"loadstart"}),l.onload=function(){if(r._request=null,r.dispatchEvent({type:"loadend"}),this.status>=200&&this.status<400){var h;try{switch(r.get("dataType")){case"JSON":{h=JSON.parse(this.response);break}default:h=this.response}}catch(c){r.dispatchEvent({type:"error",status:0,statusText:"parsererror",error:c,options:i,jqXHR:this});return}r.dispatchEvent({type:"success",response:h,status:this.status,statusText:this.statusText,options:i,jqXHR:this})}else r.dispatchEvent({type:"error",status:this.status,statusText:this.statusText,options:i,jqXHR:this})},l.ontimeout=function(){r._request=null,r.dispatchEvent({type:"loadend"}),r.dispatchEvent({type:"error",status:this.status,statusText:"Timeout",options:i,jqXHR:this})},l.onerror=function(){r._request=null,r.dispatchEvent({type:"loadend"}),r.dispatchEvent({type:"error",status:this.status,statusText:this.statusText,options:i,jqXHR:this})},l.send()}},E6=class extends Ax{constructor(t){t=t||{},t.className=t.className||"JSON",delete t.autocomplete,t.minLength=t.minLength||3,t.typing=t.typing||800,super(t);var e=t.url||"";if(window.location.protocol==="https:"){var i=document.createElement("a");i.href=e,i.protocol=window.location.protocol,e=i.href}this.set("url",e),this._ajax=new m_({dataType:"JSON",auth:t.authentication}),this._ajax.on("success",(function(r){r.status>=200&&r.status<400?typeof this._callback=="function"&&this._callback(r.response):(typeof this._callback=="function"&&this._callback(!1,"error"),console.log("AJAX ERROR",arguments))}).bind(this)),this._ajax.on("error",(function(){typeof this._callback=="function"&&this._callback(!1,"error"),console.log("AJAX ERROR",arguments)}).bind(this)),this._ajax.on("loadstart",(function(){this.element.classList.add("searching")}).bind(this)),this._ajax.on("loadend",(function(){this.element.classList.remove("searching")}).bind(this)),typeof t.handleResponse=="function"&&(this.handleResponse=t.handleResponse)}ajax(t,e,i,r){r=r||{},this._callback=i,this._ajax.set("dataType",r.dataType||"JSON"),this._ajax.send(t,e,r)}autocomplete(t,e){var i=this.requestData(t),r=encodeURI(this.get("url"));this.ajax(r,i,function(s){typeof e=="function"&&e(this.handleResponse(s))})}requestData(t){return{q:t}}handleResponse(t){return t}},S6=class extends E6{constructor(t){t=t||{},t.className=t.className||"photon",t.url=t.url||"https://photon.komoot.io/api/",t.copy=t.copy||'<a href="http://www.openstreetmap.org/copyright" target="new">&copy; OpenStreetMap contributors</a>',super(t),this.set("lang",t.lang),this.set("position",t.position)}getTitle(t){var e=t.properties;return(e.housenumber||"")+" "+(e.street||e.name||"")+"<i> "+(e.postcode||"")+" "+(e.city||"")+" ("+e.country+")</i>"}requestData(t){var e={q:t,lang:this.get("lang"),limit:this.get("maxItems")};if(this.get("position")){var i=this.getMap().getView(),r=new fi(i.getCenter());r=r.transform(i.getProjection(),"EPSG:4326").getCoordinates(),e.lon=r[0],e.lat=r[1]}return e}handleResponse(t){return t.features}equalFeatures(t,e){return this.getTitle(t)===this.getTitle(e)&&t.geometry.coordinates[0]===e.geometry.coordinates[0]&&t.geometry.coordinates[1]===e.geometry.coordinates[1]}select(t){var e=t.geometry.coordinates;try{e=Kn(t.geometry.coordinates,"EPSG:4326",this.getMap().getView().getProjection())}catch{}this.dispatchEvent({type:"select",search:t,coordinate:e})}reverseData(t){var e=Kn(t,this.getMap().getView().getProjection(),"EPSG:4326");return{lon:e[0],lat:e[1]}}reverseGeocode(t,e){this.ajax(this.get("url").replace("/api/","/reverse/").replace("/search/","/reverse/"),this.reverseData(t),(function(i){i.features&&(i=i.features),i instanceof Array||(i=[i]),e?e.call(this,i):this._handleSelect(i[0],!0)}).bind(this))}};class L6{read(t){if(!t)return null;if(typeof t=="string"){const e=ya(t);return this.readFromDocument(e)}return _a(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){he()}}const C6="http://www.w3.org/1999/xlink";function p_(n){return n.getAttributeNS(C6,"href")}const Qi=[null,"http://www.opengis.net/wms"];function Kh(n){return $p(n[0].version,"1.3")>=0}const A6=Dt(Qi,{Service:vt(K6),Capability:vt(Y6)}),Tx={Request:vt(sk),Exception:vt(tk),Layer:vt(ek)},T6=Dt(Qi,{...Tx,UserDefinedSymbolization:vt($6)}),M6=Dt(Qi,Tx);class P6 extends L6{constructor(){super(),this.version=void 0}readFromNode(t){this.version=t.getAttribute("version").trim();const e=we({version:this.version},A6,t,[]);return e||null}}const Mx={Name:vt(ue),Title:vt(ue),Abstract:vt(ue),KeywordList:vt(kx),OnlineResource:vt(p_),ContactInformation:vt(Z6),Fees:vt(ue),AccessConstraints:vt(ue)},R6=Dt(Qi,Mx),I6=Dt(Qi,{...Mx,LayerLimit:vt(nm),MaxWidth:vt(nm),MaxHeight:vt(nm)}),N6=Dt(Qi,{ContactPersonPrimary:vt(J6),ContactPosition:vt(ue),ContactAddress:vt(Q6),ContactVoiceTelephone:vt(ue),ContactFacsimileTelephone:vt(ue),ContactElectronicMailAddress:vt(ue)}),F6=Dt(Qi,{ContactPerson:vt(ue),ContactOrganization:vt(ue)}),k6=Dt(Qi,{AddressType:vt(ue),Address:vt(ue),City:vt(ue),StateOrProvince:vt(ue),PostCode:vt(ue),Country:vt(ue)}),O6=Dt(Qi,{Format:Rs(ue)}),Px={Name:vt(ue),Title:vt(ue),Abstract:vt(ue),KeywordList:vt(kx),BoundingBox:Sn(Nx),Dimension:Sn(ik),Attribution:vt(H6),AuthorityURL:Sn(lk),Identifier:Sn(ue),MetadataURL:Sn(hk),DataURL:Sn(Ca),FeatureListURL:Sn(Ca),Style:Sn(ck),Layer:Sn(Ug)},Rx=Dt(Qi,{...Px,SRS:Sn(ue),Extent:vt(nk),ScaleHint:Sn(rk),LatLonBoundingBox:vt((n,t)=>Nx(n,t,!1)),Layer:Sn(Ug)}),Ix=Dt(Qi,{...Px,CRS:Sn(ue),EX_GeographicBoundingBox:vt(X6),MinScaleDenominator:vt(si),MaxScaleDenominator:vt(si),Layer:Sn(Ug)}),D6=Dt(Qi,{Title:vt(ue),OnlineResource:vt(p_),LogoURL:vt(Fx)}),B6=Dt(Qi,{westBoundLongitude:vt(si),eastBoundLongitude:vt(si),southBoundLatitude:vt(si),northBoundLatitude:vt(si)}),G6=Dt(Qi,{GetCapabilities:vt(km),GetMap:vt(km),GetFeatureInfo:vt(km)}),j6=Dt(Qi,{Format:Sn(ue),DCPType:Sn(ak)}),U6=Dt(Qi,{HTTP:vt(ok)}),z6=Dt(Qi,{Get:vt(Ca),Post:vt(Ca)}),q6=Dt(Qi,{Name:vt(ue),Title:vt(ue),Abstract:vt(ue),LegendURL:Sn(Fx),StyleSheetURL:vt(Ca),StyleURL:vt(Ca)}),V6=Dt(Qi,{Format:vt(ue),OnlineResource:vt(p_)}),W6=Dt(Qi,{Keyword:Rs(ue)});function H6(n,t){return we({},D6,n,t)}function $6(n,t){return{SupportSLD:!!Ur(n.getAttribute("UserDefinedSymbolization")),UserLayer:!!Ur(n.getAttribute("UserLayer")),UserStyle:!!Ur(n.getAttribute("UserStyle")),RemoteWFS:!!Ur(n.getAttribute("RemoteWFS"))}}function Nx(n,t,e=!0){const i=[cs(n.getAttribute("minx")),cs(n.getAttribute("miny")),cs(n.getAttribute("maxx")),cs(n.getAttribute("maxy"))],r=[cs(n.getAttribute("resx")),cs(n.getAttribute("resy"))],s={extent:i,res:r};return e&&(Kh(t)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function X6(n,t){const e=we({},B6,n,t);if(!e)return;const i=e.westBoundLongitude,r=e.southBoundLatitude,s=e.eastBoundLongitude,a=e.northBoundLatitude;if(!(i===void 0||r===void 0||s===void 0||a===void 0))return[i,r,s,a]}function Y6(n,t){return we({},Kh(t)?M6:T6,n,t)}function K6(n,t){return we({},Kh(t)?I6:R6,n,t)}function Z6(n,t){return we({},N6,n,t)}function J6(n,t){return we({},F6,n,t)}function Q6(n,t){return we({},k6,n,t)}function tk(n,t){return we([],O6,n,t)}function ek(n,t){const e=we({},Kh(t)?Ix:Rx,n,t);return e.Layer===void 0?Object.assign(e,Ug(n,t)):e}function Ug(n,t){const e=Kh(t),i=t[t.length-1],r=we({},e?Ix:Rx,n,t);if(!r)return;let s=Ur(n.getAttribute("queryable"));s===void 0&&(s=i.queryable),r.queryable=s!==void 0?s:!1;let a=Ud(n.getAttribute("cascaded"));a===void 0&&(a=i.cascaded),r.cascaded=a;let o=Ur(n.getAttribute("opaque"));o===void 0&&(o=i.opaque),r.opaque=o!==void 0?o:!1;let l=Ur(n.getAttribute("noSubsets"));l===void 0&&(l=i.noSubsets),r.noSubsets=l!==void 0?l:!1;let h=cs(n.getAttribute("fixedWidth"));h||(h=i.fixedWidth),r.fixedWidth=h;let c=cs(n.getAttribute("fixedHeight"));c||(c=i.fixedHeight),r.fixedHeight=c;const u=["Style","AuthorityURL"];e?u.push("CRS"):u.push("SRS","Dimension"),u.forEach(function(g){if(g in i){const p=r[g]||[];r[g]=p.concat(i[g])}});const d=["BoundingBox","Attribution"];return e?d.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):d.push("LatLonBoundingBox","ScaleHint","Extent"),d.forEach(function(g){if(!(g in r)){const p=i[g];r[g]=p}}),r}function ik(n,t){const e={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return Kh(t)&&Object.assign(e,{default:n.getAttribute("default"),multipleValues:Ur(n.getAttribute("multipleValues")),nearestValue:Ur(n.getAttribute("nearestValue")),current:Ur(n.getAttribute("current")),values:ue(n)}),e}function nk(n,t){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:Ur(n.getAttribute("nearestValue"))}}function rk(n,t){return{min:cs(n.getAttribute("min")),max:cs(n.getAttribute("max"))}}function Ca(n,t){return we({},V6,n,t)}function sk(n,t){return we({},G6,n,t)}function ak(n,t){return we({},U6,n,t)}function ok(n,t){return we({},z6,n,t)}function km(n,t){return we({},j6,n,t)}function Fx(n,t){const e=Ca(n,t);if(e){const i=[Ud(n.getAttribute("width")),Ud(n.getAttribute("height"))];return e.size=i,e}}function lk(n,t){const e=Ca(n,t);if(e)return e.name=n.getAttribute("name"),e}function hk(n,t){const e=Ca(n,t);if(e)return e.type=n.getAttribute("type"),e}function ck(n,t){return we({},q6,n,t)}function kx(n,t){return we([],W6,n,t)}const uk=P6;var jh=class extends sn{constructor(t){t=t||{};var e=document.createElement("div");e.className=(t.className||"")+" ol-button ol-unselectable ol-control",super({element:e,target:t.target});var i=this,r=this.button_=document.createElement(/ol-text-button/.test(t.className)?"div":"button");r.type="button",t.title&&(r.title=t.title),t.name&&(r.name=t.name),t.html instanceof Element?r.appendChild(t.html):r.innerHTML=t.html||"";var s=function(a){a&&a.preventDefault&&(a.preventDefault(),a.stopPropagation()),t.handleClick&&t.handleClick.call(i,a)};r.addEventListener("click",s),e.appendChild(r),!t.title&&r.firstElementChild&&(r.title=r.firstElementChild.title),t.title&&this.set("title",t.title),t.title&&this.set("title",t.title),t.name&&this.set("name",t.name)}setVisible(t){t?X.show(this.element):X.hide(this.element)}setTitle(t){this.button_.setAttribute("title",t)}setHtml(t){X.setHTML(this.button_,t)}getButtonElement(){return this.button_}},Ox=class extends sn{constructor(t){t=t||{},t.fullscreen&&(t.target=document.body);var e=X.create("DIV",{className:((t.className||"")+(t.zoom?" ol-zoom":"")+" ol-ext-dialog").trim()});super({element:e,target:t.target}),e.addEventListener("click",(function(s){this.get("hideOnBack")&&s.target===e&&this.close(),this.get("hideOnClick")&&this.close()}).bind(this));var i=X.create("FORM",{on:{submit:this._onButton("submit")},parent:e});X.create("H2",{parent:i}),X.create("DIV",{className:"ol-closebox",click:this._onButton("cancel"),parent:i}),X.create("DIV",{className:"ol-content",parent:i}),this._progress=X.create("DIV",{style:{display:"none"},parent:i});var r=X.create("DIV",{className:"ol-progress-bar",parent:this._progress});this._progressbar=X.create("DIV",{parent:r}),this._progressMessage=X.create("DIV",{className:"ol-progress-message",parent:this._progress}),X.create("DIV",{className:"ol-buttons",parent:i}),this.set("closeBox",t.closeBox!==!1),this.set("zoom",!!t.zoom),this.set("hideOnClick",!!t.hideOnClick),this.set("hideOnBack",!!t.hideOnBack),this.set("className",e.className),this.set("closeOnSubmit",t.closeOnSubmit),this.set("buttons",t.buttons),this.setContent(t)}show(t){t&&((t instanceof Element||typeof t=="string")&&(t={content:t}),this.setContent(t)),this.element.classList.add("ol-visible");var e=this.element.querySelector('input[type="text"],input[type="search"],input[type="number"]');if(e&&e.focus(),this.dispatchEvent({type:"show"}),t){if(t.autoclose){var i=setTimeout((function(){this.hide()}).bind(this),t.autoclose);this.once("hide",function(){clearTimeout(i)})}if(t.hideOnBack){var r=this.get("hideOnBack");this.set("hideOnBack",!0),this.once("hide",(function(){this.set("hideOnBack",r)}).bind(this))}}}open(){this.show()}setContentMessage(t){if(t!==void 0){var e=this.getContentElement();t instanceof Element&&X.setHTML(e,""),X.setHTML(e,t||"")}}setTitle(t){var e=this.element.querySelector("form");e.querySelector("h2").innerText=t||"",t?e.classList.add("ol-title"):e.classList.remove("ol-title")}setContent(t){if(t){this.element.className=this.get("className"),typeof t=="string"&&(t={content:t}),t=t||{},this.setProgress(!1),t.max&&this.setProgress(0,t.max),t.progress!==void 0&&this.setProgress(t.progress),this.get("zoom")?this.element.classList.add("ol-zoom"):this.element.classList.remove("ol-zoom"),t.className&&t.className.split(" ").forEach((function(a){this.element.classList.add(a)}).bind(this));var e=this.element.querySelector("form");t.content!==void 0&&(t.content instanceof Element&&X.setHTML(e.querySelector(".ol-content"),""),X.setHTML(e.querySelector(".ol-content"),t.content||"")),this.setTitle(t.title),t.closeBox||this.get("closeBox")&&t.closeBox!==!1?e.classList.add("ol-closebox"):e.classList.remove("ol-closebox");var i=this.element.querySelector(".ol-buttons");i.innerHTML="";var r=t.buttons||this.get("buttons");if(r){e.classList.add("ol-button");for(var s in r)X.create("INPUT",{type:s==="submit"?"submit":"button",value:r[s],click:this._onButton(s,t.onButton),parent:i})}else e.classList.remove("ol-button")}}getContentElement(){return this.element.querySelector("form .ol-content")}setProgress(t,e,i){if(t===!1){X.setStyle(this._progress,{display:"none"});return}if(e>0?this.set("max",Number(e)):e=this.get("max"),!e)X.setStyle(this._progress,{display:"none"});else{var r=Math.round(t/e*100);X.setStyle(this._progress,{display:""}),this._progressbar.className=r?"":"notransition",X.setStyle(this._progressbar,{width:r+"%"})}this._progressMessage.innerHTML="",X.setHTML(this._progressMessage,i||"")}_onButton(t,e){var i=(function(r){r.preventDefault(),(t!=="submit"||this.get("closeOnSubmit")!==!1)&&this.hide();var s=this.getInputs();this.dispatchEvent({type:"button",button:t,inputs:s}),typeof e=="function"&&e(t,s)}).bind(this);return i}getInputs(){var t={};return["input","textarea","select"].forEach((function(e){this.element.querySelectorAll("form "+e).forEach(function(i){i.className&&i.className.split(" ").forEach(function(r){t[r]=i})})}).bind(this)),t}hide(){this.element.classList.remove("ol-visible"),this.dispatchEvent({type:"hide"})}close(){this.hide()}isOpen(){return this.element.classList.contains("ol-visible")}};q1.prototype.getPreview=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAk6QAAJOkBUCTn+AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANeSURBVHic7ZpPiE1RHMc/780MBhkik79JSUlIUbOxI+wkI2yRhYSUlJLNpJF/xcpiJBmZGBZsNM1CkmhKITGkGbH0/BuPmXnP4rxbb/TOn3fvOffeec6nfqvb/b7f93fveeec37ng8Xg8Ho/nf6Uu4d+fDswFssCvhHOJhaXAMeApMAQUyyIPPAdOAiuTStAVy4EHjDWsix5gdRLJ2mY34ulWYz6IEeA4kIk9awtkgTOEM/5vdAKT4k0/Ou3YMR/ELcbRm9AKFLBbgCJwNE4TYZkJfMG++SIwDCyLz0o4bI17WdyJz0r1TAZ+oDcxCBwAFgIzEIuhvcBbg3sLwOK4DFXLFvQGniCGSSUagS4DjUPOHESkA3XiOWCORqMR6Nfo9DjI3QqPUSd+ylBnv0Zn0GrWFvmIOvGNhjqrNDp/EAutyFgRKUM2tgO+Gur81FxvAKYZaimxXYBvmuuLDHWWaK4X0RfJCNsF6NdcbzXU2a65PohYFKWOc+jn8PUajbWIXaBKp9NB7lZYh34OzwFbFfd/NtDYYSth27urLGIm0M31AL3APWAAmIooymaDnPIl/Vz4NN1yHrd7gcvxWQnHAuA3bsyPop8hUsE13BSgK04TUViBeFo2zedJ8S6wElexW4D2eNOPTjNi6WvD/DtEr8E6tk6GGoAmxFY2iFHE9NZiQf8gogiB9gTEH23izAZuE77vHyU+ANucO1QwD3hD/MbLowAcdm20EmkwXx4n3NodS9rMB2HabYpEWs0HcRqHp0fNwAvJD+eBTZr7p6BvmQVxUaEzEbiruNfJekH15L8jtrEm7JJolEcOmKXRqQOuKDQuY7HZY8s8iNfzkSLxIuI43FTrkkLnOlBfRW4VsWk+oAX5weknxFAxJQNckGgVgZuIRVoomoGXEmGTMa+iQ6K7M4SW7k24QYgiuDQPYinbhugiF4H3RGtzZYCzyIvQXfpNI1ybLyeLpf5+iTbkRbiP2EcocTHm4+YI8iI8RFHwWjAfsA95Q+YZFU6wasl8wB7kReijtNbIILa0vcg/PRlGfPQwHmlCviDqAzaA+OREtzqr1ejOIDorxlNEjTGUBV4nnUWCvAJxGDlA8q9j3DEArAn2zvXAfOwfl6eVAmJrPpJ0Ih6Px+PxeJLjLwPul3vj5d0eAAAAAElFTkSuQmCC"};qw.prototype.getPreview=function(n,t){n||(n=[21020,6355964]),t||(t=150);var e=this.getTileGrid().getTileCoordForCoordAndResolution(n,t),i=this.getTileUrlFunction();return i.call(this,e,this.getProjection())};Si.prototype.getPreview=function(n,t){n||(n=[21020,6355964]),t||(t=150);var e=this.getTileUrlFunction();if(e){var i=this.getTileGrid()||this.getTileGridForProjection(this.getProjection()),r=i.getTileCoordForCoordAndResolution(n,t);return e.call(this,r,1,this.getProjection())}var s=this.getGetFeatureInfoUrl?this.getGetFeatureInfoUrl(n,t,this.getProjection()||"EPSG:3857",{}):this.getFeatureInfoUrl(n,t,this.getProjection()||"EPSG:3857",{});return s=s.replace(/getfeatureinfo/i,"GetMap"),s};$h.prototype.getPreview=function(n,t,e){if(this.get("preview"))return[this.get("preview")];if(t||(t=150),t<this.getMinResolution()||t>this.getMaxResolution()){var i=this.getMinResolution(),r=this.getMaxResolution();for(r>1e5&&(r=156543),i<.15&&(i=.15),t=r;r>i;)i*=2,r/=2,t=i}var s=this.getExtent();if(n||(n=[21020,6355964]),s&&!mo(s,n)&&(n=[(s[0]+s[2])/2,(s[1]+s[3])/2]),e&&(n=Kn(n,e,this.getSource().getProjection())),this.getSource&&this.getSource())try{return[this.getSource().getPreview(n,t)]}catch{}return[]};Qn.prototype.getPreview=function(n,t){if(this.get("preview"))return[this.get("preview")];var e=[];if(this.getLayers)for(var i=this.getLayers().getArray(),r=0;r<i.length;r++)e=e.concat(i[r].getPreview(n,t));return e};var __=class extends jh{constructor(t){t=t||{};var e=Object.assign({},t||{});e.target===document.body&&delete e.target,e.target?(e.className=((e.className||"")+" ol-wmscapabilities ol-hidden").trim(),delete e.target):(e.className=((e.className||"")+" ol-wmscapabilities").trim(),e.handleClick=function(){i.showDialog()}),super(e);var i=this;this._proxy=t.proxy,this.set("srs",t.srs||[]),this.set("cors",t.cors),this.set("trace",t.trace),this.set("title",t.title),this.set("loadLabel",t.loadLabel),this.set("optional",t.optional),this.createDialog(t),this._elements.formVersion.value="1.0.0";var r=this._getParser();this._ajax=new m_({dataType:"text",auth:t.authentication}),this._ajax.on("success",(function(s){var a;try{a=r.read(s.response)}catch(o){this.showError({type:"load",error:o})}a&&(a.Capability.Layer.Layer?(a.url=s.options.url,this.showCapabilities(a)):this.showError({type:"noLayer"})),this.dispatchEvent({type:"capabilities",capabilities:a}),typeof s.options.callback=="function"&&s.options.callback(a)}).bind(this)),this._ajax.on("error",(function(s){this.showError({type:"load",error:s}),this.dispatchEvent({type:"capabilities"}),s.options.callback}).bind(this)),this._ajax.on("loadstart",(function(){this._elements.element.classList.add("ol-searching")}).bind(this)),this._ajax.on("loadend",(function(){this._elements.element.classList.remove("ol-searching")}).bind(this)),t.onselect&&this.on("load",function(s){t.onselect(s.layer,s.options)})}_getParser(){return new uk}createDialog(t){var e=t.target;(!e||e===document.body)&&(this._dialog=new Ox({className:"ol-wmscapabilities",closeBox:!0,closeOnSubmit:!1,target:t.target}),this._dialog.on("button",(function(p){p.button==="submit"&&this.getCapabilities(p.inputs.url.value)}).bind(this)),e=null);var i=X.create("DIV",{className:("ol-wmscapabilities "+(t.className||"")).trim(),parent:e});this._elements={element:e||i};var r=X.create("DIV",{className:"ol-url",parent:i}),s=this._elements.input=X.create("INPUT",{className:"url",type:"text",tabIndex:1,placeholder:t.placeholder||"service url...",autocorrect:"off",autocapitalize:"off",parent:r});if(s.addEventListener("keyup",(function(p){p.keyCode===13&&this.getCapabilities(s.value,t)}).bind(this)),t.services){var a=X.create("SELECT",{className:"url",on:{change:(function(p){var y=p.target.options[p.target.selectedIndex].value;this.getCapabilities(y,t),p.target.selectedIndex=0}).bind(this)},parent:r});X.create("OPTION",{html:" ",parent:a});for(var o in t.services)X.create("OPTION",{html:o,value:t.services[o],parent:a})}X.create("BUTTON",{click:(function(){this.getCapabilities(s.value,t)}).bind(this),html:t.searchLabel||"search",parent:r}),this._elements.error=X.create("DIV",{className:"ol-error",parent:r});var l=this._elements.result=X.create("DIV",{className:"ol-result",parent:i}),h=X.create("DIV",{className:"ol-preview",html:t.previewLabel||"preview",parent:l});this._elements.preview=X.create("IMG",{parent:h}),this._img=new Image,this._img.crossOrigin="Anonymous",this._img.addEventListener("error",(function(){h.className="ol-preview tainted",this._elements.formCrossOrigin.checked=!1}).bind(this)),this._img.addEventListener("load",(function(){h.className="ol-preview ok",this._elements.formCrossOrigin.checked=!0}).bind(this)),this._elements.select=X.create("DIV",{className:"ol-select-list",tabIndex:2,parent:l}),this._elements.data=X.create("DIV",{className:"ol-data",parent:l}),this._elements.buttons=X.create("DIV",{className:"ol-buttons",parent:l}),this._elements.legend=X.create("IMG",{className:"ol-legend",parent:l});var c=this._elements.form=X.create("UL",{className:"ol-wmsform",parent:i}),u=(function(p,y,w){var x=X.create("LI",{parent:c});if(X.create("LABEL",{html:this.labels[p],parent:x}),typeof y=="boolean")this._elements[p]=X.create("INPUT",{type:"checkbox",checked:y,parent:x});else if(y instanceof Array){var b=this._elements[p]=X.create("SELECT",{parent:x});y.forEach((function(L){X.create("OPTION",{html:L,value:L,parent:b})}).bind(this))}else this._elements[p]=X.create("INPUT",{value:y===void 0?"":y,placeholder:w||"",type:typeof y=="number"?"number":"text",parent:x});return x}).bind(this);u("formTitle"),u("formLayer","","layer1,layer2,...");var d=u("formMap");d.setAttribute("data-param","map"),d=u("formStyle"),d.setAttribute("data-param","style"),u("formFormat",["image/png","image/jpeg"]),u("formMinZoom",0),u("formMaxZoom",20),d=u("formExtent","","xmin,ymin,xmax,ymax"),d.setAttribute("data-param","extent");var g=d.querySelector("input");return X.create("BUTTON",{title:this.labels.mapExtent,click:(function(){g.value=this.getMap().getView().calculateExtent(this.getMap().getSize()).join(",")}).bind(this),parent:d}),d=u("formProjection",""),d.setAttribute("data-param","proj"),u("formCrossOrigin",!1),d=u("formVersion","1.3.0"),d.setAttribute("data-param","version"),u("formAttribution",""),X.create("BUTTON",{html:this.get("loadLabel")||"Load",click:(function(){var p=this._getFormOptions(),y=this.getLayerFromOptions(p);this.dispatchEvent({type:"load",layer:y,options:p}),this._dialog.hide()}).bind(this),parent:c}),i}getLayerFromOptions(t){t.layer.source=new Si(t.source);var e=new Xe(t.layer);return delete t.layer.source,e}setMap(t){super.setMap(t),this._dialog&&this._dialog.setMap(t)}getDialog(){return this._dialog}showDialog(t,e){this.showError(),this._elements.formProjection.value||(this._elements.formProjection.value=this.getMap().getView().getProjection().getCode()),this._dialog&&this._dialog.show({title:this.get("title")===void 0?"WMS":this.get("title"),content:this._elements.element}),this.getCapabilities(t,e);var i=this._elements.select.querySelector(".selected");i&&(this._elements.select.scrollTop=i.offsetTop-20)}testUrl(t){var e=new RegExp("^(https?:\\/\\/)((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=\\/-]*)?(\\#[-a-z\\d_]*)?$","i");return!!e.test(t)}getRequestParam(t){return{SERVICE:"WMS",REQUEST:"GetCapabilities",VERSION:t.version||"1.3.0"}}getCapabilities(t,e){if(t){if(!this.testUrl(t)){this.showError({type:"badUrl"});return}e=e||{},t=t.split("?");var i=t[1];t=t[0],this._elements.formMap.value="",this._elements.formLayer.value="",this._elements.formStyle.value="",this._elements.formTitle.value="",this._elements.formProjection.value=this.getMap().getView().getProjection().getCode(),this._elements.formFormat.selectedIndex=0;var r=e.map||"",s={};i&&(i=i.replace(/^\?/,"").split("&"),i.forEach((function(d){if(d=d.split("="),d[1]=decodeURIComponent(d[1]||""),/^map$/i.test(d[0])&&(r=d[1],this._elements.formMap.value=r),/^layers$/i.test(d[0])&&(this._elements.formLayer.value=d[1],this._elements.formTitle.value=d[1].split(",")[0]),/^style$/i.test(d[0])&&(this._elements.formStyle.value=d[1]),/^crs$/i.test(d[0])&&(this._elements.formProjection.value=d[1]),/^format$/i.test(d[0])){for(var g,p=0;g=this._elements.formFormat.options[p];p++)if(g.value===d[1]){this._elements.formFormat.selectedIndex=p;break}}this.get("optional")&&this.get("optional").split(",").forEach((function(y){y===d[0]&&(s[y]=d[1])}).bind(this))}).bind(this)));var a=this.getRequestParam(e),o=[];r&&(a.MAP=r,o.push("map="+r));for(var l in s)a[l]=s[l],o.push(l+"="+s[l]);var h=this._elements.input.value=(t||"")+(o?"?"+o.join("&"):"");if(this.clearForm(),this._proxy){var c="";for(var u in a)c+=(c?"&":"")+u+"="+a[u];this._ajax.send(this._proxy,{url:c},{url:h,timeout:e.timeout||1e4,callback:e.onload,abort:!1})}else this._ajax.send(t,a,{url:h,timeout:e.timeout||1e4,callback:e.onload,abort:!1})}}showError(t){t?this._elements.error.innerHTML=this.error[t.type]||"ERROR ("+t.type+")":this._elements.error.innerHTML="",t&&t.type==="load"?this._elements.form.classList.add("visible"):this._elements.form.classList.remove("visible")}clearForm(){this._elements.result.classList.remove("ol-visible"),this.showError(),this._elements.select.innerHTML="",this._elements.data.innerHTML="",this._elements.preview.src="",this._elements.legend.src="",this._elements.legend.classList.remove("visible")}showCapabilities(t){this._elements.result.classList.add("ol-visible");var e=[],i=(function(r,s){s=s||0,r.Layer.forEach((function(a){a.Attribution||(a.Attribution=r.Attribution),a.EX_GeographicBoundingBox||(a.EX_GeographicBoundingBox=r.EX_GeographicBoundingBox);var o=X.create("DIV",{className:(a.Layer?"ol-title ":"")+"level-"+s,html:a.Name||a.Title,click:(function(){this._elements.buttons.innerHTML="",this._elements.data.innerHTML="",this._elements.legend.src=this._elements.preview.src="",this._elements.element.classList.remove("ol-form"),this.showError();var l=this.getOptionsFromCap(a,t),h=this.getLayerFromOptions(l);if(this._currentOptions=l,e.forEach(function(d){d.classList.remove("selected")}),o.classList.add("selected"),h){X.create("BUTTON",{html:this.get("loadLabel")||"Load",className:"ol-load",click:(function(){this.dispatchEvent({type:"load",layer:h,options:l}),this._dialog&&this._dialog.hide()}).bind(this),parent:this._elements.buttons}),X.create("BUTTON",{className:"ol-wmsform",click:(function(){this._elements.element.classList.toggle("ol-form")}).bind(this),parent:this._elements.buttons});var c=this.getMap().getView().getResolution(),u=this.getMap().getView().getCenter();this._elements.preview.src=h.getPreview(u,c,this.getMap().getView().getProjection()),this._img.src=this._elements.preview.src,X.create("p",{className:"ol-title",html:l.data.title,parent:this._elements.data}),X.create("p",{html:l.data.abstract,parent:this._elements.data}),l.data.legend&&l.data.legend.length?(this._elements.legend.src=l.data.legend[0],this._elements.legend.classList.add("visible")):(this._elements.legend.src="",this._elements.legend.classList.remove("visible"))}}).bind(this),parent:this._elements.select});e.push(o),a.Layer&&i(a,s+1)}).bind(this))}).bind(this);this._elements.select.innerHTML="",i(t.Capability.Layer)}getLayerResolution(t,e,i){var r=t==="min"?"MinScaleDenominator":"MaxScaleDenominator";if(e[r]!==void 0)return e[r]/(72/2.54*100);if(!e.Layer)return t==="min"?0:156543.03392804097;i=t==="min"?156543.03392804097:0;for(var s=0;s<e.Layer.length;s++){var a=this.getLayerResolution(t,e.Layer[s],i);a!==void 0&&(i=Math[t](i,a))}return i}getOptionsFromCap(t,e){var i=e.Capability.Request.GetMap.Format,r,s,a=[/png/,/jpeg/,/gif/];for(s=0;s<3;s++){for(var o=0;o<i.length;o++)if(a[s].test(i[o])){r=i[o];break}if(r)break}r||(r=i[0]);var l=this.getMap().getView().getProjection().getCode();this.showError();var h=!1;t.CRS?t.CRS.indexOf(l)>=0?h=!0:t.CRS.indexOf("EPSG:4326")>=0?(l="EPSG:4326",h=!0):this.get("srs").forEach(function(P){t.CRS.indexOf(P)>=0&&(l=P,h=!0)}):h=!1,h||(this.showError({type:"srs"}),this.get("trace")&&console.log("BAD srs: ",t.CRS));var c=t.EX_GeographicBoundingBox;c&&(c=iS(c,"EPSG:4326",this.getMap().getView().getProjection()));var u=[];t.Attribution&&t.Attribution.Title&&u.push('<a href="'+encodeURI(t.Attribution.OnlineResource)+'">&copy; '+t.Attribution.Title.replace(/</g,"&lt;")+"</a>");var d={title:t.Title,extent:c,queryable:t.queryable,abstract:t.Abstract,minResolution:this.getLayerResolution("min",t),maxResolution:this.getLayerResolution("max",t)||156543.03392804097},g={url:e.Capability.Request.GetMap.DCPType[0].HTTP.Get.OnlineResource,projection:l,attributions:u,crossOrigin:this.get("cors")?"anonymous":null,params:{LAYERS:t.Name,FORMAT:r,VERSION:e.version||"1.3.0"}},p=new kr({projection:this.getMap().getView().getProjection()});p.setResolution(d.minResolution);var y=Math.round(p.getZoom());p.setResolution(d.maxResolution);var w=Math.round(p.getZoom());if(this._fillForm({title:d.title,layers:g.params.LAYERS,format:g.params.FORMAT,minZoom:w,maxZoom:y,extent:c?c.join(","):"",projection:g.projection,attribution:g.attributions[0]||"",version:g.params.VERSION}),this.get("trace")){var x=JSON.stringify([g],null,"	").replace(/\\"/g,'"');d.source="SOURCE";var b="new ol.layer.Tile ("+JSON.stringify(d,null,"	")+")";b=b.replace(/\\"/g,'"').replace('"SOURCE"',"new ol.source.TileWMS("+x+")").replace(/\\t/g,"	").replace(/\\n/g,`
`).replace(`([
	`,"(").replace(`}
])`,"})"),console.log(b),delete d.source}var L=[];return t.Style&&t.Style.forEach(function(P){P.LegendURL&&L.push(P.LegendURL[0].OnlineResource)}),{layer:d,source:g,data:{title:t.Title,abstract:t.Abstract,logo:t.Attribution&&t.Attribution.LogoURL?t.Attribution.LogoURL.OnlineResource:void 0,keyword:t.KeywordList,legend:L,opaque:t.opaque,queryable:t.queryable}}}_getFormOptions(){var t=parseInt(this._elements.formMinZoom.value),e=parseInt(this._elements.formMaxZoom.value),i=new kr({projection:this.getMap().getView().getProjection()});i.setZoom(t);var r=i.getResolution();i.setZoom(e);var s=i.getResolution(),a=[];this._elements.formExtent.value&&this._elements.formExtent.value.split(",").forEach(function(h){a.push(parseFloat(h))}),a.length!==4&&(a=void 0);var o=[];this._elements.formAttribution.value&&o.push(this._elements.formAttribution.value);var l={layer:{title:this._elements.formTitle.value,extent:a,maxResolution:r,minResolution:s},source:{url:this._elements.input.value,crossOrigin:this._elements.formCrossOrigin.checked?"anonymous":null,projection:this._elements.formProjection.value,attributions:o,params:{FORMAT:this._elements.formFormat.options[this._elements.formFormat.selectedIndex].value,LAYERS:this._elements.formLayer.value,VERSION:this._elements.formVersion.value}},data:{title:this._elements.formTitle.value}};return this._elements.formMap.value&&(l.source.params.MAP=this._elements.formMap.value),l}_fillForm(t){this._elements.formTitle.value=t.title,this._elements.formLayer.value=t.layers,this._elements.formStyle.value=t.style;var e,i;for(i=0;e=this._elements.formFormat.options[i];i++)if(e.value===t.format){this._elements.formFormat.selectedIndex=i;break}this._elements.formExtent.value=t.extent||"",this._elements.formMaxZoom.value=t.maxZoom,this._elements.formMinZoom.value=t.minZoom,this._elements.formProjection.value=t.projection,this._elements.formAttribution.value=t.attribution,this._elements.formVersion.value=t.version}loadLayer(t,e,i){this.getCapabilities(t,{onload:(function(r){r?r.Capability.Layer.Layer.forEach((function(s){if(s.Name===e||s.Identifier===e){var a=this.getOptionsFromCap(s,r),o=this.getLayerFromOptions(a);this.dispatchEvent({type:"load",layer:o,options:a}),typeof i=="function"&&i({layer:o,options:a})}}).bind(this)):this.dispatchEvent({type:"load",error:!0})}).bind(this)})}};__.prototype.error={load:"Can't retrieve service capabilities, try to add it manually...",badUrl:"The input value is not a valid url...",TileMatrix:"No TileMatrixSet supported...",noLayer:"No layer available for this service...",srs:"The service projection looks different from that of your map, it may not display correctly..."};__.prototype.labels={formTitle:"Title:",formLayer:"Layers:",formMap:"Map:",formStyle:"Style:",formFormat:"Format:",formMinZoom:"Min zoom level:",formMaxZoom:"Max zoom level:",formExtent:"Extent:",mapExtent:"use map extent...",formProjection:"Projection:",formCrossOrigin:"CrossOrigin:",formVersion:"Version:",formAttribution:"Attribution:"};var fk=function(n){if(!n)return null;var t=n.getViewport().getElementsByClassName("ol-fixedoverlay")[0];return t||(n.getViewport().querySelector(".ol-layers")?(t=document.createElement("canvas"),t.className="ol-fixedoverlay",n.getViewport().querySelector(".ol-layers").after(t),n.on("precompose",function(e){t.width=n.getSize()[0]*e.frameState.pixelRatio,t.height=n.getSize()[1]*e.frameState.pixelRatio})):t=n.getViewport().querySelector("canvas")),t},nl=class extends sn{constructor(t){t=t||{},super(t),this.setStyle(t.style)}setMap(t){this.getCanvas(t);var e=this.getMap();if(this._listener&&(Lr(this._listener),this._listener=null),super.setMap(t),e)try{e.renderSync()}catch{}t&&(this._listener=t.on("postcompose",this._draw.bind(this)))}getCanvas(t){return fk(t)}getContext(t){var e=t.context;if(!e&&this.getMap()){var i=this.getMap().getViewport().getElementsByClassName("ol-fixedoverlay")[0];e=i?i.getContext("2d"):null}return e}setStyle(t){this._style=t||new Zt({})}getStyle(){return this._style}getStroke(){var t=this._style.getStroke();return t||this._style.setStroke(new fe({color:"#000",width:1.25})),this._style.getStroke()}getFill(){var t=this._style.getFill();return t||this._style.setFill(new Ne({color:"#fff"})),this._style.getFill()}getTextStroke(){var t=this._style.getText();return t||(t=new Sr({})),t.getStroke()||t.setStroke(new fe({color:"#fff",width:3})),t.getStroke()}getTextFill(){var t=this._style.getText();return t||(t=new Sr({})),t.getFill()||t.setFill(new Ne({color:"#fff"})),t.getFill()}getTextFont(){var t=this._style.getText();return t||(t=new Sr({})),t.getFont()||t.setFont("12px sans-serif"),t.getFont()}_draw(){console.warn("[CanvasBase] draw function not implemented.")}},dk=class extends m1{constructor(t){t=t||{},super(t),this.element.classList.add("ol-canvas-control"),this.setCanvas(!!t.canvas),t||(t={}),t.style||(t.style=new Zt),this.setStyle(t.style)}setCanvas(t){if(this.isCanvas_=t,t&&this.setCollapsed(!1),this.element.style.visibility=t?"hidden":"visible",this.getMap())try{this.getMap().renderSync()}catch{}}setStyle(t){var e=t.getText();this.font_=e?e.getFont():"10px sans-serif";var i=e?e.getStroke():null,r=e?e.getFill():null;this.fontStrokeStyle_=i?fs(i.getColor()):"#fff",this.fontFillStyle_=r?fs(r.getColor()):"#000",this.fontStrokeWidth_=i?i.getWidth():3,this.getMap()&&this.getMap().render()}setMap(t){nl.prototype.getCanvas.call(this,t);var e=this.getMap();if(this._listener&&Lr(this._listener),this._listener=null,super.setMap(t),e)try{e.renderSync()}catch{}t&&(this._listener=t.on("postcompose",this.drawAttribution_.bind(this))),this.setCanvas(this.isCanvas_)}drawAttribution_(t){if(this.isCanvas_){var e=this.getContext(t);if(e){var i="";Array.prototype.slice.call(this.element.querySelectorAll("li")).filter(function(d){return d.style.display!=="none"}).map(function(d){i+=(i?" - ":"")+d.textContent});var r=t.frameState.pixelRatio;e.save(),e.scale(r,r);var s=this.element.getBoundingClientRect(),a=this.getMap().getViewport().getBoundingClientRect(),o=this.getMap().getSize()[0]/a.width;e.translate((s.left-a.left)*o,(s.top-a.top)*o);var l=this.element.clientHeight,h=this.element.clientWidth,c=X.getStyle(this.element,"textAlign")||"center",u;switch(c){case"left":{u=0;break}case"right":{u=h;break}default:{u=h/2;break}}e.beginPath(),e.strokeStyle=this.fontStrokeStyle_,e.fillStyle=this.fontFillStyle_,e.lineWidth=this.fontStrokeWidth_,e.textAlign=c,e.textBaseline="middle",e.font=this.font_,e.lineJoin="round",e.strokeText(i,u,l/2),e.fillText(i,u,l/2),e.closePath(),e.restore()}}}getContext(t){return nl.prototype.getContext.call(this,t)}},Dx=class extends nl{constructor(t){t=t||{};var e=X.create("DIV",{className:(t.className||"")+" ol-control-title ol-unselectable",style:{display:"block",visibility:"hidden"}});super({element:e,style:t.style}),this.setTitle(t.title||""),this.setVisible(t.visible!==!1),this.element.style.font=this.getTextFont()}setStyle(t){super.setStyle(t),this.element&&(this.element.style.font=this.getTextFont()),this.getMap()&&this.getMap().render()}setTitle(t){if(this.element.textContent=t,this.set("title",t),this.getMap())try{this.getMap().renderSync()}catch{}}getTitle(){return this.get("title")}setVisible(t){if(this.element.style.display=t?"block":"none",this.getMap())try{this.getMap().renderSync()}catch{}}getVisible(){return this.element.style.display!=="none"}_draw(t){if(this.getVisible()){var e=this.getContext(t);if(e){var i=t.frameState.pixelRatio;e.save(),e.scale(i,i);var r=this.element.getBoundingClientRect(),s=this.getMap().getViewport().getBoundingClientRect(),a=this.getMap().getSize()[0]/s.width;e.translate(Math.round((r.left-s.left)*a),Math.round((r.top-s.top)*a));var o=this.element.clientHeight,l=this.element.clientWidth,h=l/2;e.beginPath(),e.fillStyle=fs(this.getFill().getColor()),e.rect(0,0,l,o),e.fill(),e.closePath(),e.beginPath(),e.fillStyle=fs(this.getTextFill().getColor()),e.strokeStyle=fs(this.getTextStroke().getColor()),e.lineWidth=this.getTextStroke().getWidth(),e.textAlign="center",e.textBaseline="middle",e.font=this.getTextFont(),e.lineJoin="round",e.lineWidth&&e.strokeText(this.getTitle(),h,o/2),e.fillText(this.getTitle(),h,o/2),e.closePath(),e.restore()}}}},gk=class extends xR{constructor(t){super(t),this.element.classList.add("ol-canvas-control"),this.scaleHeight_=6,t||(t={}),t.style||(t.style=new Zt),this.setStyle(t.style)}setMap(t){nl.prototype.getCanvas.call(this,t);var e=this.getMap();if(this._listener&&Lr(this._listener),this._listener=null,super.setMap(t),e)try{e.renderSync()}catch{}t&&(this._listener=t.on("postcompose",this.drawScale_.bind(this))),this.element.style.visibility="hidden",this.olscale=this.element.querySelector(".ol-scale-line-inner")}setStyle(t){var e=t.getStroke();this.strokeStyle_=e?fs(e.getColor()):"#000",this.strokeWidth_=e?e.getWidth():2;var i=t.getFill();this.fillStyle_=i?fs(i.getColor()):"#fff";var r=t.getText();this.font_=r?r.getFont():"10px Arial",e=r?r.getStroke():null,i=r?r.getFill():null,this.fontStrokeStyle_=e?fs(e.getColor()):this.fillStyle_,this.fontStrokeWidth_=e?e.getWidth():3,this.fontFillStyle_=i?fs(i.getColor()):this.strokeStyle_,this.getMap()&&this.getMap().render()}drawScale_(t){if(!(this.element.style.visibility!=="hidden"||X.getStyle(this.element,"display")==="none")){var e=this.getContext(t);if(e){var i=parseInt(this.olscale.style.width);if(i){var r=this.olscale.textContent,s={left:this.element.offsetLeft,top:this.element.offsetTop},a=t.frameState.pixelRatio;e.save(),e.scale(a,a),s.top+=this.element.clientHeight-this.scaleHeight_,e.beginPath(),e.strokeStyle=this.fontStrokeStyle_,e.fillStyle=this.fontFillStyle_,e.lineWidth=this.fontStrokeWidth_,e.textAlign="center",e.textBaseline="bottom",e.font=this.font_,e.lineJoin="round",e.strokeText(r,s.left+i/2,s.top),e.fillText(r,s.left+i/2,s.top),e.closePath(),s.top+=2,e.lineWidth=this.strokeWidth_,e.strokeStyle=this.strokeStyle_;for(var o=4,l=parseInt(r);l%10===0;)l/=10;l%5===0&&(o=5);for(var h=0;h<o;h++)e.beginPath(),e.fillStyle=h%2?this.fillStyle_:this.strokeStyle_,e.rect(s.left+h*i/o,s.top,i/o,this.scaleHeight_),e.stroke(),e.fill(),e.closePath();e.restore()}}}}getContext(t){return nl.prototype.getContext.call(this,t)}},mk=class extends nl{constructor(t){t=t||{};var e=document.createElement("div");if(super({element:e,target:t.target}),t.target)e.className=t.className||"ol-legend";else{e.className=(t.className||"ol-legend")+" ol-unselectable ol-control"+(t.collapsible===!1?" ol-uncollapsible":" ol-collapsed");var i=document.createElement("button");i.setAttribute("type","button"),i.addEventListener("click",(function(){this.toggle()}).bind(this)),e.appendChild(i),i=document.createElement("button"),i.setAttribute("type","button"),i.className="ol-closebox",i.addEventListener("click",(function(){this.toggle()}).bind(this)),e.appendChild(i)}this._legend=t.legend,this._legend.getCanvas().className="ol-legendImg",e.appendChild(this._legend.getCanvas()),e.appendChild(this._legend.getListElement()),t.collapsible!==!1&&t.collapsed===!1&&this.show(),this._legend.on("select",(function(r){this.dispatchEvent(r)}).bind(this)),this._legend.on("refresh",(function(){if(this._onCanvas&&this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this)),this._legend.on("items",(function(r){r.nb?(this.element.classList.remove("ol-empty"),this.element.title=t.title||"legend"):(this.element.classList.add("ol-empty"),this.element.title=t.emptyTitle||"no legend"),this.dispatchEvent(r)}).bind(this))}getLegend(){return this._legend}setCanvas(t){if(this._onCanvas=t,this.element.style.visibility=t?"hidden":"visible",this.getMap())try{this.getMap().renderSync()}catch{}}onCanvas(){return!!this._onCanvas}_draw(t){if(this._onCanvas&&!this.element.classList.contains("ol-collapsed")){var e=this._legend.getCanvas(),i=this.getContext(t),r=i.canvas.height-e.height;i.save(),i.rect(0,r,e.width,e.height);var s="#fff";this._legend.getTextStyle().getBackgroundFill()&&(s=fs(this._legend.getTextStyle().getBackgroundFill().getColor())),i.fillStyle=i.strokeStyle=s,i.lineWidth=10,i.lineJoin="round",i.stroke(),i.clearRect(0,r,e.width,e.height),i.fill(),i.drawImage(e,0,r),i.restore()}}show(){if(this.element.classList.contains("ol-collapsed")&&(this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!1}),this.getMap()))try{this.getMap().renderSync()}catch{}}hide(){if(!this.element.classList.contains("ol-collapsed")&&(this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!0}),this.getMap()))try{this.getMap().renderSync()}catch{}}collapse(t){t===!1?this.show():this.hide()}isCollapsed(){return this.element.classList.contains("ol-collapsed")}toggle(){if(this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:this.element.classList.contains("ol-collapsed")}),this.getMap())try{this.getMap().renderSync()}catch{}}},pk=class extends sn{constructor(t){t=t||{};var e=X.create("DIV",{className:t.className||"ol-print"});super({element:e,target:t.target}),t.target||(e.classList.add("ol-unselectable","ol-control"),X.create("BUTTON",{type:"button",title:t.title||"Print",click:(function(){this.print()}).bind(this),parent:e})),this.set("immediate",t.immediate),this.set("imageType",t.imageType||"image/jpeg"),this.set("quality",t.quality||.8),this.set("orientation",t.orientation)}toClipboard(t,e){try{t.canvas.toBlob(function(i){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},i.type,{value:i,enumerable:!0}))]),typeof e=="function"&&e(!0)}catch{typeof e=="function"&&e(!1)}})}catch{typeof e=="function"&&e(!1)}}copyMap(t,e){this.once("print",(function(i){this.toClipboard(i,e)}).bind(this)),this.print(t)}_getCanvas(t,e,i){var r;if(t.context)i=t.context.canvas;else{if(i)r=i.getContext("2d");else{i=document.createElement("canvas");var s=this.getMap().getSize();i.width=s[0],i.height=s[1],r=i.getContext("2d"),/jp.*g$/.test(e)&&(r.fillStyle=this.get("bgColor")||"white",r.fillRect(0,0,i.width,i.height))}this.getMap().getViewport().querySelectorAll(".ol-layers canvas, canvas.ol-fixedoverlay").forEach((function(a){if(a.width){if(r.save(),a.parentNode.style.opacity==="0")return;r.globalAlpha=parseFloat(a.parentNode.style.opacity)||1,r.globalCompositeOperation=X.getStyle(a.parentNode,"mix-blend-mode"),r.filter=X.getStyle(a.parentNode,"filter");var o=X.getStyle(a,"transform")||X.getStyle(a,"-webkit-transform");/^matrix/.test(o)?(o=o.replace(/^matrix\(|\)$/g,"").split(","),o.forEach(function(l,h){o[h]=parseFloat(l)}),r.transform(o[0],o[1],o[2],o[3],o[4],o[5]),r.drawImage(a,0,0)):r.drawImage(a,0,0,X.getStyle(a,"width"),X.getStyle(a,"height")),r.restore()}}).bind(this))}return i}fastPrint(t,e){t=t||{},this._ol6?requestAnimationFrame((function(){e(this._getCanvas({},t.imageType,t.canvas))}).bind(this)):(this.getMap().once("postcompose",(function(i){i.context||(this._ol6=!0),e(this._getCanvas(i,t.imageType,t.canvas))}).bind(this)),this.getMap().render())}print(t){t=t||{};var e=t.imageType||this.get("imageType"),i=t.quality||this.get("quality");if(this.getMap()){if(t.immediate!=="silent"&&this.dispatchEvent(Object.assign({type:"printing"},t)),!t.immediate){setTimeout((function(){t=Object.assign({},t),t.immediate="silent",this.print(t)}).bind(this),200);return}this.getMap().once(this.get("immediate")?"postcompose":"rendercomplete",(function(r){var s=this._getCanvas(r,e),a=t.size||[210,297],o=t.format||"a4",l,h,c,u=t.orient||this.get("orientation"),d=typeof t.margin=="number"?t.margin:10;if(s){u!=="landscape"&&u!=="portrait"&&(u=s.width>s.height?"landscape":"portrait"),u==="landscape"&&(a=[a[1],a[0]]);var g=Math.min((a[0]-2*d)/s.width,(a[1]-2*d)/s.height);l=g*s.width,h=g*s.height,c=[(a[0]-l)/2,(a[1]-h)/2]}var p;try{p=s?s.toDataURL(e,i):null}catch{this.dispatchEvent({type:"error",canvas:s});return}var y=Object.assign({type:"print",print:{format:o,orientation:u,unit:"mm",size:a,position:c,imageWidth:l,imageHeight:h},image:p,imageType:e,quality:i,canvas:s},t);this.dispatchEvent(y)}).bind(this)),this.getMap().render()}}},Om=function(n,t){var e=n.getView(),i=e.getProjection(),r=e.getCenter(),s=n.getPixelFromCoordinate(r);s[1]+=1;var a=n.getCoordinateFromPixel(s),o=au(Kn(r,i,"EPSG:4326"),Kn(a,i,"EPSG:4326"));return o*=(t||96)/.0254,o},_k=function(n,t,e){if(n&&t){var i=t;if(typeof t=="string"&&(t=t.replace(":","/").split("/"),i=t[1],i||(i=t[0]||""),i=i.replace(/[^\d]/g,""),i=parseInt(i),t[1])){var r=parseInt(t[0]);r&&(i/=r)}if(!i)return;var s=n.getView(),a=s.getProjection(),o=s.getCenter(),l=n.getPixelFromCoordinate(o);l[1]+=1;var h=n.getCoordinateFromPixel(l),c=au(Kn(o,a,"EPSG:4326"),Kn(h,a,"EPSG:4326"));return c*=(e||96)/.0254,s.setResolution(s.getResolution()*i/c),i}},uv=class extends nl{constructor(t){t=t||{};var e=document.createElement("div");e.className="ol-control ol-compassctrl ol-unselectable ol-hidden"+(t.className?" "+t.className:""),e.style.position="absolute",e.style.visibility="hidden";var i=t.style instanceof fe?new Zt({stroke:t.style}):t.style;t.style||(i=new Zt({stroke:new fe({width:0})})),super({element:e,style:i}),this.set("rotateVithView",t.rotateWithView!==!1),this.setVisible(t.visible!==!1),this.setImage(t.image||t.src)}setImage(t){if(t instanceof Image)this.img_=t,this.img_.onload=(function(){if(this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this);else if(typeof t=="string")switch(t){case"compact":{this.img_=this.compactCompass_(this.element.clientWidth,this.getStroke().getColor());break}case"default":{this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor());break}default:{this.img_=new Image,this.img_.onload=(function(){if(this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this),this.img_.src=t;break}}else this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor())}compactCompass_(t,e){var i=document.createElement("canvas"),r=i.getContext("2d");t=i.width=i.height=t||150;var s=t/2;return r.translate(s,s),r.fillStyle=e||"#963",r.lineWidth=5,r.lineJoin=r.lineCap="round",r.font="bold "+s*.4+"px sans-serif",r.textBaseline="bottom",r.textAlign="center",r.strokeStyle="#fff",r.globalAlpha=.75,r.strokeText("N",0,-s/2),r.globalAlpha=1,r.fillText("N",0,-s/2),r.beginPath(),r.moveTo(0,s/4),r.lineTo(s/3,s/2),r.lineTo(0,-s/2),r.lineTo(-s/3,s/2),r.lineTo(0,s/4),r.lineWidth=12,r.fillStyle="#fff",r.globalAlpha=.75,r.fill(),r.stroke(),r.globalAlpha=1,r.fillStyle=r.strokeStyle=e||"#963",r.lineWidth=5,r.beginPath(),r.moveTo(0,s/4),r.lineTo(0,-s/2),r.lineTo(s/3,s/2),r.lineTo(0,s/4),r.fill(),r.stroke(),r.beginPath(),r.moveTo(0,s/4),r.lineTo(0,-s/2),r.lineTo(-s/3,s/2),r.lineTo(0,s/4),r.stroke(),i}defaultCompass_(t,e){var i=document.createElement("canvas"),r=i.getContext("2d");t=i.width=i.height=t||150;var s=t/2,a=.22*s;function o(h,c){r.fillStyle=e||"#963",r.beginPath(),r.moveTo(0,0),r.lineTo(h,0),r.lineTo(c,c),r.moveTo(0,0),r.lineTo(-h,0),r.lineTo(-c,-c),r.moveTo(0,0),r.lineTo(0,h),r.lineTo(-c,c),r.moveTo(0,0),r.lineTo(0,-h),r.lineTo(c,-c),r.moveTo(0,0),r.fill(),r.stroke()}function l(h,c){r.globalCompositeOperation="destination-out",r.fillStyle="#fff",r.beginPath(),r.moveTo(0,0),r.lineTo(h,0),r.lineTo(c,-c),r.moveTo(0,0),r.lineTo(-h,0),r.lineTo(-c,c),r.moveTo(0,0),r.lineTo(0,h),r.lineTo(c,c),r.moveTo(0,0),r.lineTo(0,-h),r.lineTo(-c,-c),r.moveTo(0,0),r.fill(),r.globalCompositeOperation="source-over",r.beginPath(),r.moveTo(0,0),r.lineTo(h,0),r.lineTo(c,-c),r.moveTo(0,0),r.lineTo(-h,0),r.lineTo(-c,c),r.moveTo(0,0),r.lineTo(0,h),r.lineTo(c,c),r.moveTo(0,0),r.lineTo(0,-h),r.lineTo(-c,-c),r.moveTo(0,0),r.stroke()}return r.translate(s,s),r.strokeStyle=e||"#963",r.lineWidth=1.5,r.beginPath(),r.arc(0,0,t*.41,0,2*Math.PI),r.arc(0,0,t*.44,0,2*Math.PI),r.stroke(),r.rotate(Math.PI/4),o(s*.9,a*.8),l(s*.9,a*.8),r.rotate(-Math.PI/4),o(s,a),l(s,a),i}getVisible(){return X.getStyle(this.element,"display")==="block"}setVisible(t){t?this.element.classList.add("ol-visible"):this.element.classList.remove("ol-visible"),this.getMap()&&this.getMap().render()}_draw(t){var e=this.getContext(t);if(!(!e||!this.getVisible())){var i=e.canvas,r,s=[];for(r=0;r<8;r++)s[r]=[Math.cos(Math.PI*r/8),Math.sin(Math.PI*r/8)];var a=t.frameState.pixelRatio;e.save(),e.scale(a,a);var o=this.element.clientWidth,l=this.element.clientHeight,h={left:this.element.offsetLeft,top:this.element.offsetTop},c=this.img_,u=t.frameState.viewState.rotation;if(e.beginPath(),e.translate(h.left+o/2,h.top+l/2),this.get("rotateVithView")&&e.rotate(u),this.getStroke().getWidth()){e.beginPath(),e.strokeStyle=this.getStroke().getColor(),e.lineWidth=this.getStroke().getWidth();var d=Math.max(i.width,i.height);for(r=0;r<8;r++)e.moveTo(-s[r][0]*d,-s[r][1]*d),e.lineTo(s[r][0]*d,s[r][1]*d);e.stroke()}c.width&&e.drawImage(c,-o/2,-l/2,o,l),e.closePath(),e.restore()}}},ul=class extends sn{constructor(t){t=t||{};var e=X.create("DIV",{className:(t.className||"ol-print")+" ol-unselectable ol-control"});super({element:e}),this._lang=t.lang||"en",t.target||X.create("BUTTON",{type:"button",title:t.title||"Print",click:(function(){this.print()}).bind(this),parent:e}),t.openWindow&&this.on("print",function(O){O.canvas&&window.open().document.write('<img src="'+O.canvas.toDataURL()+'"/>')}),t.target=t.target||X.create("DIV");var i=this._printCtrl=new pk(t);i.on(["print","error","printing"],(function(O){s.setAttribute("data-status",O.type),O.clipboard||this.dispatchEvent(O)}).bind(this)),this._compass=new uv({src:t.northImage||"compact",visible:!1,className:"olext-print-compass",style:new fe({color:"#333",width:0})});var r=this._printDialog=new Ox({target:t.targetDialog||document.body,closeBox:!0,className:"ol-ext-print-dialog"}),s=r.getContentElement();this._input={};var a=X.create("DIV",{className:"ol-print-param",parent:s});this._pages=[X.create("DIV",{className:"ol-page"})];var o=X.create("DIV",{className:"ol-map",parent:this._pages[0]});X.create("DIV",{html:this._pages[0],className:"ol-print-map",parent:s}),X.create("H2",{html:this.i18n("title"),parent:a});var l=X.create("UL",{parent:a}),h=X.create("LI",{className:"ol-orientation",parent:l});this._input.orientation={list:h};var c=X.create("LABEL",{className:"portrait",parent:h});this._input.orientation.portrait=X.create("INPUT",{type:"radio",name:"ol-print-orientation",value:"portrait",checked:!0,on:{change:(function(O){this.setOrientation(O.target.value)}).bind(this)},parent:c}),X.create("SPAN",{html:this.i18n("portrait"),parent:c}),c=X.create("LABEL",{className:"landscape",parent:h}),this._input.orientation.landscape=X.create("INPUT",{type:"radio",name:"ol-print-orientation",value:"landscape",on:{change:(function(O){this.setOrientation(O.target.value)}).bind(this)},parent:c}),X.create("SPAN",{html:this.i18n("landscape"),parent:c});var u;h=X.create("LI",{html:X.create("LABEL",{html:this.i18n("size")}),className:"ol-size",parent:l});var d=this._input.size=X.create("SELECT",{on:{change:(function(){this.setSize(d.value||W)}).bind(this)},parent:h});for(u in this.paperSize)X.create("OPTION",{html:u+(this.paperSize[u]?" - "+this.paperSize[u][0]+"x"+this.paperSize[u][1]+" mm":this.i18n("custom")),value:u,parent:d});h=X.create("LI",{html:X.create("LABEL",{html:this.i18n("margin")}),className:"ol-margin",parent:l});var g=this._input.margin=X.create("SELECT",{on:{change:(function(){this.setMargin(g.value)}).bind(this)},parent:h});for(u in this.marginSize)X.create("OPTION",{html:this.i18n(u)+" - "+this.marginSize[u]+" mm",value:this.marginSize[u],parent:g});h=X.create("LI",{html:X.create("LABEL",{html:this.i18n("scale")}),className:"ol-scale",parent:l});var p=this._input.scale=X.create("SELECT",{on:{change:(function(){this.setScale(parseInt(p.value))}).bind(this)},parent:h});Object.keys(this.scales).forEach((function(O){X.create("OPTION",{html:this.scales[O],value:O,parent:p})}).bind(this)),h=X.create("LI",{className:"ol-legend",parent:l});var y=X.createSwitch({html:this.i18n("legend"),checked:!1,on:{change:(function(){M.legend.control.setCanvas(y.checked)}).bind(this)},parent:h});h=X.create("LI",{className:"ol-print-north",parent:l});var w=this._input.north=X.createSwitch({html:this.i18n("north"),checked:"checked",on:{change:(function(){w.checked?this._compass.element.classList.add("ol-print-compass"):this._compass.element.classList.remove("ol-print-compass"),this.getMap().render()}).bind(this)},parent:h});h=X.create("LI",{className:"ol-print-title",parent:l});var x=X.createSwitch({html:this.i18n("mapTitle"),checked:!1,on:{change:(function(O){M.title.control.setVisible(O.target.checked)}).bind(this)},parent:h}),b=X.create("INPUT",{type:"text",placeholder:this.i18n("mapTitle"),on:{keydown:function(O){O.keyCode===13&&O.preventDefault()},keyup:function(){M.title.control.setTitle(b.value)},change:(function(){M.title.control.setTitle(b.value)}).bind(this)},parent:h}),L=X.create("DIV",{className:"ol-user-param",parent:a});h=X.create("LI",{className:"ol-saveas",parent:l});var P=X.create("DIV",{html:this.i18n("copied"),className:"ol-clipboard-copy",parent:h}),R=X.create("SELECT",{on:{change:(function(){if(this.formats[R.value].clipboard)i.copyMap(this.formats[R.value],function(tt){tt&&(P.classList.add("visible"),setTimeout(function(){P.classList.remove("visible")},1e3))});else{var O=typeof this.getSize()=="string"?this.getSize():null,G=Object.assign({format:O,size:O?this.paperSize[O]:null,orient:this.getOrientation(),margin:this.getMargin()},this.formats[R.value]);i.print(G)}R.value=""}).bind(this)},parent:h});X.create("OPTION",{html:this.i18n("saveas"),style:{display:"none"},value:"",parent:R}),this.formats.forEach((function(O,G){if(O.pdf){if(t.pdf===!1)return}else if(O.clipboard){if(t.copy===!1)return}else if(t.save===!1)return;X.create("OPTION",{html:this.i18n(O.title),value:G,parent:R})}).bind(this)),h=X.create("LI",{className:"ol-savelegend",parent:l});var j=X.create("DIV",{html:this.i18n("copied"),className:"ol-clipboard-copy",parent:h}),k=X.create("SELECT",{on:{change:(function(){var O=M.legend.control.getLegend().getCanvas(),G=document.createElement("CANVAS");G.width=O.width,G.height=O.height;var tt=G.getContext("2d");if(tt.fillStyle="#fff",tt.fillRect(0,0,G.width,G.height),tt.drawImage(O,0,0),this.formats[k.value].clipboard)G.toBlob(function(S){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},S.type,{value:S,enumerable:!0}))]),j.classList.add("visible"),setTimeout(function(){j.classList.remove("visible")},1e3)}catch{}},"image/png");else{var Z;try{Z=G.toDataURL(this.formats[k.value].imageType,this.formats[k.value].quality);var it=typeof this.getSize()=="string"?this.getSize():"A4",J=G.width/96*25.4,lt=G.height/96*25.4,ct=this.paperSize[it];this.getOrientation()==="landscape"&&(ct=[ct[1],ct[0]]);var Et=[(ct[0]-J)/2,(ct[1]-lt)/2];this.dispatchEvent({type:"print",print:{legend:!0,format:it,orientation:this.getOrientation(),unit:"mm",size:this.paperSize[it],position:Et,imageWidth:J,imageHeight:lt},image:Z,imageType:this.formats[k.value].imageType,pdf:this.formats[k.value].pdf,quality:this.formats[k.value].quality,canvas:G})}catch{}}k.value=""}).bind(this)},parent:h});X.create("OPTION",{html:this.i18n("saveLegend"),style:{display:"none"},value:"",parent:k}),this.formats.forEach((function(O,G){X.create("OPTION",{html:this.i18n(O.title),value:G,parent:k})}).bind(this));var T=X.create("DIV",{className:"ol-ext-buttons",parent:a});X.create("BUTTON",{html:this.i18n("printBt"),type:"submit",click:function(O){O.preventDefault(),window.print()},parent:T}),X.create("BUTTON",{html:this.i18n("cancel"),type:"button",click:function(){r.hide()},parent:T}),X.create("DIV",{html:this.i18n("errorMsg"),className:"ol-error",parent:a});var q,W,F,M={};r.on("show",(function(){this.dispatchEvent({type:"show",userElement:L,dialog:this._printDialog,page:this.getPage()});var O=this.getMap();O&&(document.body.classList.add("ol-print-document"),q=O.getTargetElement(),W=O.getSize(),typeof this.getSize()=="string"?this.setSize(this.getSize()):this.setSize(W),O.setTarget(o),F&&Lr(F),F=O.on("moveend",(function(){this.setScale(Om(O))}).bind(this)),this.setScale(Om(O)),M={},this.getMap().getControls().forEach((function(G){G instanceof mk&&(M.legend={control:G}),G instanceof Dx&&(M.title={control:G}),G instanceof uv&&(M.compass?G.element.classList.remove("ol-print-compass"):(this._input.north.checked?G.element.classList.add("ol-print-compass"):G.element.classList.remove("ol-print-compass"),this._compass=G,M.compass={control:G}))}).bind(this)),M.title?(x.checked=M.title.isVisible=M.title.control.getVisible(),b.value=M.title.control.getTitle(),x.parentNode.parentNode.classList.remove("hidden")):x.parentNode.parentNode.classList.add("hidden"),M.legend?(M.legend.ison=M.legend.control.onCanvas(),M.legend.collapsed=M.legend.control.isCollapsed(),M.legend.control.collapse(!1),k.parentNode.classList.remove("hidden"),y.parentNode.parentNode.classList.remove("hidden"),y.checked=!M.legend.collapsed,M.legend.control.setCanvas(!M.legend.collapsed)):(k.parentNode.classList.add("hidden"),y.parentNode.parentNode.classList.add("hidden")))}).bind(this)),r.on("hide",(function(){document.body.classList.remove("ol-print-document"),q&&(this.getMap().setTarget(q),q=null,F&&Lr(F),M.title&&M.title.control.setVisible(M.title.isVisible),M.legend&&(M.legend.control.setCanvas(M.legend.ison),M.legend.control.collapse(M.legend.collapsed)),this.dispatchEvent({type:"hide"}))}).bind(this)),window.addEventListener("resize",(function(){this.setSize()}).bind(this)),t.saveAs&&this.on("print",function(O){O.pdf||O.canvas.toBlob(function(G){var tt=(O.print.legend?"legend.":"map.")+O.imageType.replace("image/","");t.saveAs(G,tt)},O.imageType,O.quality)}),t.jsPDF&&this.on("print",function(O){if(O.pdf){var G=new t.jsPDF({orientation:O.print.orientation,unit:O.print.unit,format:O.print.size});G.addImage(O.image,"JPEG",O.print.position[0],O.print.position[0],O.print.imageWidth,O.print.imageHeight),G.save(O.print.legend?"legend.pdf":"map.pdf")}})}static addLang(t,e){ul.prototype._labels[t]=e}isOpen(){return this._printDialog.isOpen()}i18n(t){var e=this._labels.en[t]||t;return this._labels[this._lang]&&this._labels[this._lang][t]&&(e=this._labels[this._lang][t]),e}getOrientation(){return this._orientation||"portrait"}setOrientation(t){this._orientation=t==="landscape"?"landscape":"portrait",this._input.orientation[this._orientation].checked=!0,this.setSize()}getMargin(){return this._margin||0}setMargin(t){this._margin=t,this._input.margin.value=t,this.setSize()}getSize(){return this._size}setSize(t){if(this._printDialog.getContentElement().setAttribute("data-status",""),t?this._size=t:t=this._size,!!t){if(typeof t=="string"){for(var e in this.paperSize)e&&new RegExp(e,"i").test(t)&&(t=e);this.paperSize[t]||(t=this._size="A4"),this._input.size.value=t,t=[Math.trunc(this.paperSize[t][0]*96/25.4),Math.trunc(this.paperSize[t][1]*96/25.4)],this.getOrientation()==="landscape"&&(t=[t[1],t[0]]),this.getPage().classList.remove("margin")}else this._input.size.value="",this.getPage().classList.add("margin");var i=this.getPage(),r=i.parentNode.getBoundingClientRect(),s=(r.width-40)/t[0],a=(r.height-40)/t[1],o=Math.min(s,a,1);i.style.width=t[0]+"px",i.style.height=t[1]+"px",i.style["-webkit-transform"]=i.style.transform="translate(-50%,-50%) scale("+o+")";var l=Math.round(5/o);i.style["-webkit-box-shadow"]=i.style["box-shadow"]=l+"px "+l+"px "+l+"px rgba(0,0,0,.6)",i.style.padding=this.getMargin()*96/25.4+"px",this.getMap()&&this.getMap().updateSize(),this.dispatchEvent({type:"dialog:refresh"})}}getContentElement(){return this._printDialog.getContentElement()}getUserElement(){return this._printDialog.getContentElement().querySelector(".ol-user-param")}getPage(){return this._pages[0]}setMap(t){this.getMap()&&(this.getMap().removeControl(this._compass),this.getMap().removeControl(this._printCtrl),this.getMap().removeControl(this._printDialog)),super.setMap(t),this.getMap()&&(this.getMap().addControl(this._compass),this.getMap().addControl(this._printCtrl),this.getMap().addControl(this._printDialog))}setScale(t){_k(this.getMap(),t),this._input.scale.value=" "+Math.round(t/100)*100}getScale(){return Om(this.getMap())}print(t){t=t||{},t.size&&this.setSize(t.size),t.scale&&this.setScale(t.scale),t.orientation&&this.setOrientation(t.orientation),t.margin&&this.setMargin(t.margin),this._printDialog.show()}getrintControl(){return this._printCtrl}};ul.prototype._labels={en:{title:"Print",orientation:"Orientation",portrait:"Portrait",landscape:"Landscape",size:"Page size",custom:"screen size",margin:"Margin",scale:"Scale",legend:"Legend",north:"North arrow",mapTitle:"Map title",saveas:"Save as...",saveLegend:"Save legend...",copied:" Copied to clipboard",errorMsg:"Can't save map canvas...",printBt:"Print...",clipboardFormat:"copy to clipboard...",jpegFormat:"save as jpeg",pngFormat:"save as png",pdfFormat:"save as pdf",none:"none",small:"small",large:"large",cancel:"cancel"},fr:{title:"Imprimer",orientation:"Orientation",portrait:"Portrait",landscape:"Paysage",size:"Taille du papier",custom:"taille cran",margin:"Marges",scale:"Echelle",legend:"Lgende",north:"Flche du nord",mapTitle:"Titre de la carte",saveas:"Enregistrer sous...",saveLegend:"Enregistrer la lgende...",copied:" Carte copie",errorMsg:"Impossible d'enregistrer la carte",printBt:"Imprimer",clipboardFormat:"copier dans le presse-papier...",jpegFormat:"enregistrer un jpeg",pngFormat:"enregistrer un png",pdfFormat:"enregistrer un pdf",none:"aucune",small:"petites",large:"larges",cancel:"annuler"},de:{title:"Drucken",orientation:"Ausrichtung",portrait:"Hochformat",landscape:"Querformat",size:"Papierformat",custom:"Bildschirmgre",margin:"Rand",scale:"Mastab",legend:"Legende",north:"Nordpfeil",mapTitle:"Kartentitel",saveas:"Speichern als...",saveLegend:"Legende speichern...",copied:" In die Zwischenablage kopiert",errorMsg:"Kann Karte nicht speichern...",printBt:"Drucken...",clipboardFormat:"in die Zwischenablage kopieren...",jpegFormat:"speichern als jpeg",pngFormat:"speichern als png",pdfFormat:"speichern als pdf",none:"kein",small:"klein",large:"gro",cancel:"abbrechen"},zh:{title:"",orientation:"",portrait:"",landscape:"",size:"",custom:"",margin:"",scale:"",legend:"",north:"",mapTitle:"",saveas:"...",saveLegend:"...",copied:" ",errorMsg:"...",printBt:"...",cancel:""}};ul.prototype.paperSize={"":null,A0:[841,1189],A1:[594,841],A2:[420,594],A3:[297,420],A4:[210,297],"US Letter":[215.9,279.4],A5:[148,210],B4:[257,364],B5:[182,257]};ul.prototype.marginSize={none:0,small:5,large:10};ul.prototype.formats=[{title:"clipboardFormat",imageType:"image/png",clipboard:!0},{title:"jpegFormat",imageType:"image/jpeg",quality:.8},{title:"pngFormat",imageType:"image/png",quality:.8},{title:"pdfFormat",imageType:"image/jpeg",pdf:!0}];ul.prototype.scales={" 5000":"1/5.000"," 10000":"1/10.000"," 25000":"1/25.000"," 50000":"1/50.000"," 100000":"1/100.000"," 250000":"1/250.000"," 1000000":"1/1.000.000"};/*!
  * ol-contextmenu - v5.5.0
  * https://github.com/jonataswalker/ol-contextmenu
  * Built: Wed Aug 07 2024 12:29:18 GMT+0000 (Coordinated Universal Time)
  */var yk=Object.defineProperty,vk=(n,t,e)=>t in n?yk(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ar=(n,t,e)=>vk(n,typeof t!="symbol"?t+"":t,e),Bx={exports:{}};function y_(){}y_.prototype={on:function(n,t,e){var i=this.e||(this.e={});return(i[n]||(i[n]=[])).push({fn:t,ctx:e}),this},once:function(n,t,e){var i=this;function r(){i.off(n,r),t.apply(e,arguments)}return r._=t,this.on(n,r,e)},emit:function(n){var t=[].slice.call(arguments,1),e=((this.e||(this.e={}))[n]||[]).slice(),i=0,r=e.length;for(i;i<r;i++)e[i].fn.apply(e[i].ctx,t);return this},off:function(n,t){var e=this.e||(this.e={}),i=e[n],r=[];if(i&&t)for(var s=0,a=i.length;s<a;s++)i[s].fn!==t&&i[s].fn._!==t&&r.push(i[s]);return r.length?e[n]=r:delete e[n],this}};Bx.exports=y_;var wk=Bx.exports.TinyEmitter=y_,v_=(n=>(n.CONTEXTMENU="contextmenu",n.CLICK="click",n.DBLCLICK="dblclick",n))(v_||{}),no=(n=>(n.BEFOREOPEN="beforeopen",n.OPEN="open",n.CLOSE="close",n.ADD_MENU_ENTRY="add-menu-entry",n))(no||{});class fv extends Ms{constructor(t){super(t.type,t.map,t.originalEvent)}}const xk={width:150,scrollAt:4,eventType:v_.CONTEXTMENU,defaultItems:!0,items:[]},Qa="ol-ctx-menu",Ln={namespace:Qa,container:`${Qa}-container`,separator:`${Qa}-separator`,submenu:`${Qa}-submenu`,hidden:`${Qa}-hidden`,icon:`${Qa}-icon`,zoomIn:`${Qa}-zoom-in`,zoomOut:`${Qa}-zoom-out`,unselectable:"ol-unselectable"},dv=[{text:"Zoom In",classname:`${Ln.zoomIn} ${Ln.icon}`,callback:(n,t)=>{const e=t.getView();e.animate({zoom:Number(e.getZoom())+1,duration:700,center:n.coordinate})}},{text:"Zoom Out",classname:`${Ln.zoomOut} ${Ln.icon}`,callback:(n,t)=>{const e=t.getView();e.animate({zoom:Number(e.getZoom())-1,duration:700,center:n.coordinate})}}];function sg(n){const t=document.createDocumentFragment(),e=document.createElement("div");for(e.innerHTML=n;e.firstChild;)t.append(e.firstChild);return t}function bk(n){var l,h;const t=document.importNode(n),e=n.offsetWidth;t.style.cssText=`position: fixed; top: 0; left: 0; overflow: auto; visibility: hidden; pointer-events: none; height: unset; max-height: unset; width: ${e}px`;const i=sg("<span>Foo</span>"),r=sg("<span>Foo</span>"),s=document.createElement("li"),a=document.createElement("li");s.append(i),a.append(r),t.append(s),t.append(a),(l=n.parentNode)==null||l.append(t);const o=t.offsetHeight/2;return(h=n.parentNode)==null||h.removeChild(t),o}function gv({parentNode:n,item:t,isSubmenu:e=!1,isInsideSubmenu:i=!1,emitter:r}){const s=`_${Math.random().toString(36).slice(2,11)}`;if(typeof t!="string"&&"text"in t){const c=`<span>${t.text}</span>`,u=sg(c),d=document.createElement("li");t.classname=t.classname||"",t.icon&&(t.classname===""?t.classname=Ln.icon:t.classname.includes(Ln.icon)===!1&&(t.classname+=` ${Ln.icon}`),d.setAttribute("style",`background-image:url(${t.icon})`)),d.id=s,d.className=t.classname,d.append(u),n.append(d);const g={id:s,isSubmenu:e,isInsideSubmenu:i,isSeparator:!1,callback:"callback"in t?t.callback:null,data:"data"in t?t.data:null};return r.emit(no.ADD_MENU_ENTRY,g,d),d}const a=`<li id="${s}" class="${Ln.separator}"><hr></li>`,o=sg(a);n.append(o);const l=n.lastChild,h={id:s,isSubmenu:!1,isInsideSubmenu:!1,isSeparator:!0,callback:null,data:null};return r.emit(no.ADD_MENU_ENTRY,h,l),l}function Dp({container:n,items:t,menuWidth:e,isInsideSubmenu:i,emitter:r}){t.forEach(s=>{if(typeof s!="string"&&"items"in s&&Array.isArray(s.items)){const a=gv({parentNode:n,item:s,isSubmenu:!0,emitter:r});a.classList.add(Ln.submenu);const o=document.createElement("ul");o.classList.add(Ln.container),o.style.width=`${e}px`,a.append(o),Dp({emitter:r,menuWidth:e,container:o,items:s.items,isInsideSubmenu:!0})}else gv({parentNode:n,item:s,isSubmenu:!1,isInsideSubmenu:i,emitter:r})})}function Dm(n,t){if(!n)throw new Error(t)}class xd extends sn{constructor(t={}){Dm(typeof t=="object","@param `opts` should be object type!");const e=document.createElement("div");super({element:e}),ar(this,"map"),ar(this,"emitter",new wk),ar(this,"container"),ar(this,"coordinate",[]),ar(this,"pixel",[]),ar(this,"contextMenuEventListener"),ar(this,"entryCallbackEventListener"),ar(this,"mapMoveListener"),ar(this,"lineHeight",0),ar(this,"disabled"),ar(this,"opened"),ar(this,"items",[]),ar(this,"menuEntries",new Map),ar(this,"options"),this.options={...xk,...t};const i=document.createElement("ul");e.append(i),e.style.width=`${this.options.width}px`,e.classList.add(Ln.container,Ln.unselectable,Ln.hidden),this.container=e,this.contextMenuEventListener=r=>{this.handleContextMenu(r)},this.entryCallbackEventListener=r=>{this.handleEntryCallback(r)},this.mapMoveListener=()=>{this.handleMapMove()},this.disabled=!1,this.opened=!1,window.addEventListener("beforeunload",()=>{this.removeListeners()},{once:!0})}clear(){for(const t of this.menuEntries.keys())this.removeMenuEntry(t);this.container.replaceChildren(),this.container.append(document.createElement("ul"))}enable(){this.disabled=!1}disable(){this.disabled=!0}getDefaultItems(){return dv}countItems(){return this.menuEntries.size}extend(t){Dm(Array.isArray(t),"@param `items` should be an Array."),Dp({items:t,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild})}closeMenu(){this.opened=!1,this.container.classList.add(Ln.hidden),this.dispatchEvent(no.CLOSE)}isOpen(){return this.opened}updatePosition(t){Dm(Array.isArray(t),"@param `pixel` should be an Array."),this.isOpen()&&(this.pixel=t,this.positionContainer())}pop(){const t=Array.from(this.menuEntries.keys()).pop();t&&this.removeMenuEntry(t)}shift(){const t=Array.from(this.menuEntries.keys()).shift();t&&this.removeMenuEntry(t)}push(t){t&&this.extend([t])}setMap(t){if(super.setMap(t),t){this.map=t,t.getViewport().addEventListener(this.options.eventType,this.contextMenuEventListener,!1),t.on("movestart",()=>{this.handleMapMove()}),this.emitter.on(no.ADD_MENU_ENTRY,(i,r)=>{this.handleAddMenuEntry(i,r)},this),this.items=this.options.defaultItems?this.options.items.concat(dv):this.options.items,Dp({items:this.items,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild});const e=this.getMenuEntriesLength();this.lineHeight=e>0?this.container.offsetHeight/e:bk(this.container)}else this.removeListeners(),this.clear()}removeListeners(){this.map.getViewport().removeEventListener(this.options.eventType,this.contextMenuEventListener,!1),this.emitter.off(no.ADD_MENU_ENTRY)}removeMenuEntry(t){let e=document.getElementById(t);e==null||e.remove(),e=null,this.menuEntries.delete(t)}handleContextMenu(t){var e;this.coordinate=this.map.getEventCoordinate(t),this.pixel=this.map.getEventPixel(t),this.dispatchEvent(new fv({map:this.map,originalEvent:t,type:no.BEFOREOPEN})),!this.disabled&&(this.options.eventType===v_.CONTEXTMENU&&(t.stopPropagation(),t.preventDefault()),setTimeout(()=>{this.openMenu(t)}),(e=t.target)==null||e.addEventListener("pointerdown",i=>{this.opened&&(i.stopPropagation(),this.closeMenu())},{once:!0}))}openMenu(t){this.opened=!0,this.positionContainer(),this.container.classList.remove(Ln.hidden),this.dispatchEvent(new fv({map:this.map,originalEvent:t,type:no.OPEN}))}getMenuEntriesLength(){return Array.from(this.menuEntries).filter(([,t])=>t.isSeparator===!1&&t.isSubmenu===!1&&t.isInsideSubmenu===!1).length}positionContainer(){const t=this.map.getSize()||[0,0],e={w:t[0]-this.pixel[0],h:t[1]-this.pixel[1]},i=this.getMenuEntriesLength(),r={w:this.container.offsetWidth,h:Math.round(this.lineHeight*i)},s=e.w>=r.w?this.pixel[0]+5:this.pixel[0]-r.w;this.container.style.left=`${s}px`,this.container.style.top=e.h>=r.h?`${this.pixel[1]-10}px`:`${this.pixel[1]-r.h}px`,this.container.style.right="auto",this.container.style.bottom="auto",e.w-=r.w;const a=h=>Array.from(h.children).filter(c=>c.tagName==="LI"&&c.classList.contains(Ln.submenu));let o=0;const l=(h,c)=>{o+=1,a(h).forEach(u=>{const d=c>=r.w?r.w-8:(r.w+8)*-1,g=u.querySelector(`ul.${Ln.container}`),p=Math.round(this.lineHeight*Array.from(g.children).filter(y=>y.tagName==="LI").length);g.style.left=`${d}px`,g.style.right="auto",g.style.top=e.h>=p+r.h?"0":`-${g.offsetHeight-25}px`,g.style.bottom="auto",g.style.zIndex=String(o),a(g).length>0&&l(g,c-r.w)})};l(this.container.firstElementChild,e.w)}handleMapMove(){this.closeMenu()}handleEntryCallback(t){var s;t.preventDefault(),t.stopPropagation();const e=t.currentTarget,i=this.menuEntries.get(e.id);if(!i)return;const r={data:i.data,coordinate:this.coordinate};this.closeMenu(),(s=i.callback)==null||s.call(i,r,this.map)}handleAddMenuEntry(t,e){this.menuEntries.set(t.id,t),this.positionContainer(),"callback"in t&&typeof t.callback=="function"&&e.addEventListener("click",this.entryCallbackEventListener,!1)}}const Bp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAA5CAIAAADLFv4EAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TSkUqDnaQ4pChOtlFRRxLLRbBQmkrtOpgcukXNGlIUlwcBdeCgx+LVQcXZ10dXAVB8APEXXBSdJES/5cUWsR4cNyPd/ced+8AoV1nqhmIA6pmGdlUQiwUV8XgKwLwI4gIIhIz9XRuMQ/P8XUPH1/vYjzL+9yfY1gpmQzwicRxphsW8Qbx3Kalc94nDrOqpBCfE08ZdEHiR67LLr9xrjgs8Mywkc8uEIeJxUofy33MqoZKPEscVVSN8oWCywrnLc5qvcm69+QvDJW0lRzXaY4jhSWkkYEIGU3UUIeFGK0aKSaytJ/w8Eccf4ZcMrlqYORIogEVkuMH/4Pf3ZrlmWk3KZQABl5s+2MCCO4CnZZtfx/bducE8D8DV1rP32gD85+kt3pa9AgY2QYurnuavAdc7gBjT7pkSI7kpymUy8D7GX1TERi9BYbW3N66+zh9APLU1fINcHAITFYoe93j3YP9vf17ptvfD2T/cqGRoIISAAAAB3RJTUUH6QQDCykKsmxw0AAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAs4SURBVFjDlVlbb13Hdf7Wmr3PlTwkdUiKoqSQVHWLpCalG6MpLNORZVmyIlt2lNpuUFsJGiDtfyj6UqA/oX1LW9eGlbQPtuUGCaqiTYK4adFGfilsBK0tyHZ0o0WKPOS57VlfH2bO5hFvlvfDwdqDtb/ZM99867KPrK6uZlmmqt77NE299yLivU+SxHsfx5Oks9LganP5gw86H15rvv8/7ffez65dg3PJgQOlI0cL09O1Y0fTnRPpwACdSwuFzXHSNJ9LlpeXRYTkxl+IAMgWF1euXVv51a+WL1/2H/wvXALn4BxIUaV5GGEe3W765dnq6dO1hx4q7d2b1mo0izgAgHX40mg01s/X87Nut/Hee3evXGn+5Md244aUyxSAgAqMUIUZBIAAFFFmGTpt3bN34NzTtUcfHTx8WJzbOHe0792755wj6ZzrdrvBVtX20tLClSsLP7jkr12DGSI+1q5Nb+OvuN/aP/T88xNnzliabsR3zsnq6mrOR85x89NP5y+9vvzDH7LZROLgLWw7SHFKb1ABCUBEaQan/T7hVkrF6gsv7n35ZakOrMPfnOPW/PzNV15Z/cd/gBlEEMkmCYmbLCB7e24QDQdCEAYVZhQBKSoDL/7hrpcvJsPDASKfRfN9NzMRyRqN+cuXV998g1lGkGYkAdIbAHojSTOaAWDmCdAMJJj7eJIgQQPZeOONOz/6kV9Zsb4zZGYa1g7AOZe128tXry699ipbrcgcCQGNEAT0aGDtmKwNCrjOx8hGY/GVv128elXJMFfgWJMkCWvPsswvLNz+679CowGIOEXYEXUQiHMQiKqog4g4BSBORTT6AKJORERVVNceccqFhYVXX129dStN03BysyxT66lNidtv/1P2618ThAIAjBCl9xCBUSAQCbdsd9DtsN1mtxMGRZUkQYjQ29qDgEA6//nLpZ/9LOt08hUnOdvN33yycvktcY5GaNhe6fEnNBMVeoPPUCoVT58uzcyAbP3fB+2f/huyDGkKM6j0XnTtQYggTRcuvT706KOlycnAceK9d84RWHznHVu8yyAYI0SgAm/iHAMigEKh/NSzu7/1reqe3ZqkAKzbXb5+/Tev/n3ryhVk3ci6Krzv4QAq8OTiwvJ//1dl93kjkyRJgras2Vx59120O1CNkUgVNDiNYUJEkrT2x9/dd/FiUq2G8xiuwvBw7c/+/NrU1L3vf5+djjgFyR4OnBNvcA6t9tI7/14/9aQrlbrdrmZZJqqtW7dsfj7qzAyqpIVTSzNRRbNZfe4bMy+9lA4M9M8aXqkwVJv6o5fKZ8+i2wF7ejUvqmLGEFfM2927ndt3CDjnVFVJdm7f9nc/BUjvAcJ72H3S1Knp8aefTgcHscVVqNV2PvusjO+kWQ8H9J4RxwOwhbvt+TsisqbjbGmJy8twDiJQjQSLigCqAEtfebgyOblurfetW7W6e0/p4YcBQh3CgwFHNdyy0bClJZJJkkQdd5eX2FiGN1GVEP5UI0MEIOnYWFIuY9tLSyUdHZOQtdQJgSBrUpwTgu22b7VUtdvthhUrjOh0AZBGGgBkPo+Rkcmtl9uXoiI7oNFMYliVGHqbzazViitWVYCapigUQqCArAuHArJz82Z3ZWX7Wa3V8vPz4S1huA8n6KpSSasVAN579d4DSIeGtL4DAFREFYAkDhC4SHP7P365euPGGtCGi2YrH3/ceucXkjgAUIhKDwdwKiJSqWplIK44xM+0XpehYZCijnnQyOWUOLt589bbb7fv3dtq4vbi4u233sTSEkPaVqVZjINASBhubLQ4PiYiPR0DxYkJHdkRBBB/jSDhCQgzjzRZ+bu/ufHW5dbdTzfO2pyfv/6DSyuXLtGFqgH0Bgi9hxlAeAMgtVo6OkqzJEkS55yZFer18uHD2btX2emEcC8iFAFN1MV4Wyrf+cu/aH18vX7yiYHp6aRaBSRrLDc+/PDOP/9k5fVLUiox1EAiMAs4EAEEMCkUi188kg4PBx0nWZY55ygyNDe3/OYbyDKEosM5mBfnQn4NJY4Uisuvvbby858XD39RBwcB+KV7nffft48+ijHALIboIOIY+U2colwZOv6IqJr3zrkkSZKQGcv79xe/8nDrX/+Fnpok9JmoBlmoS+i9OIUnRPjJJ82ProtL6DOohhpPnKP3cBoOR5hAnYsFWuarTzwxdOgwzWI+zquCtFKpv/iCVAcixwSN9CYQ+ixUP6QBpPnIHwGzUIP2Yq3BCILeS/QhzFAdqD9z3kTCXFHHeQ1WO3ioeuGb6LZjahOJERR52AvFRpAcoSoS4qLrPYLeI1h7sNWqvfB8ce/efK6o48C2c45pOnLihDt4eC1OqYImqgIIBKGYVQXDrEKw5yMS690YMoOoRJAcOVqbe6xQreS7G3VsZiF+Jmk6MDMz+PVzcI7eEwyFBEl6i7cgzEgL+xl2m6HqCXnJjKCYgUaSkPLJk9V9+zLv8/ou6jjsQOyuSqWRubn0S1+GiLAXMmOBHWvH3q/lYVXu9+mVsQIy/e0v1U88ruVywN+E47BukpWpqeFnnpFiMeaoyKJCBC5mOgn8Oe2lv40+ClWk6chzz1VmZiTE5/65+mvdyDcw9rUTpSdP03sIgjTB3oLQC4eqIAUiUb4u+gAwigi6nYFz52qPPCKq4Qz1nyft3/dgq4gV0t3fvphMTSPzsX4IvWig3PsoKiNpNA+QPoMRZvAGkFmmu3aPXLhQGqrltXTE78vHknOc28n4zh3f+56USrImp1Diu5DfgbBaBWJBnytQRKVSqf/pnwxOz3hvm+Jr6BuDtu6zi8Xa7z5UPnuWpKhAYn0TWjFKmF3CIMkoYgCqBMtnnhr56u8jSfq124+vWZbl+95vm/fFHfX6uWeSAwcJQej/zBiqXQt1JEMSBCg9H5i5mX0jZ8644WHV2Kmsw79Px/0c5Hbt6JHBp85KksSKM+8KA9NkKHHyW3pDklRPPVk7dmwrzMjxOh3nJzy8HUVGv342nZ3NFSIugYgkvXo09nAJROAcBOnvzE6cP69peh/OA3IcIygpIkmtNv7t70ghASixPwtFv0SxqdJ7qIAmhdLoxYtpvb4R57M57n/TMF45eHDoO99FsxWDYuy7EfNSyIMEmq3KH3xz+NixjTu3iY77e9Zgh165f7w4OFg7fjyZnQUNEBhiyGR/827uyJHR02dYLG6F08+39nOwpW1WmZoaOHVKymVxoelWQMQ5aC+Cpung2XOVqentcPps7ed1Y9yOtogWiyOPHHf7D0SOfWzsoq68Tw4cqH3197Rc2g6nPx/nHMQvfVvZQGnPnurc15AWQh8GMxgB0BNpYfDE4wP79n02Tj/Hm+p4E27StH7yca3XQxUQOwYVgFqvj5x8Aqoq8tk4OcdhB/JTt5GPOG5Wnpwc+sYFhA9FIuJUSDFfO/9scWLnuiy3Jc5W+Xg7Gxh+7DHZUaf3IvGTlozvHD5xQntZ7oFwzNa++vS/ac7HOts5l46N1S5cQLvNELY7ndKpU+WJiY15fRscVV071TkH29uFarUyOyvlcqw9isWR48eZpg/ybL+9ZT7eyjay8oUvFObmBCJA8fhccXJ30vs6+uA4n5NjMxEp7NhROnI0fEAsHTtWHB19UF435TjPnZ9pa6lUPXRQdk7o2Fh53z4pFh/82dyO3WKePTbagZt146WpabdrUkSq+/ev89nUf+N4kleduUd+Avv1vc6nND6eTE6KWWF8nL3Ms9F/G5xkHX95H9XfU23ik6bV2VnJMkmS8AV8U/9tcJJN+e9/083PiFn10CF2Ovl398+Ls8ZxrPE28NE/3m8Xd+2SELl6/y99Lpz/B1+gvnCIH/A9AAAAAElFTkSuQmCC";var li=class extends sn{constructor(t){t=t||{};var e=X.create("DIV",{className:((t.className||"")+" ol-feature-list").trim()});t.target||(e.classList.add("ol-unselectable"),e.classList.add("ol-control"),e.dataset.control=1),super({element:e,target:t.target}),this._listFeatures=[],this._columns=[],this._bottomScroll=e.classList.contains("ol-bottom"),this.set("pageLength",t.pageLength||100),this._canSort=[],this._sort={},t.target||X.create("BUTTON",{type:"button",click:(function(){this.collapse()}).bind(this),parent:e});var i=X.create("DIV",{className:"ol-content",parent:e});this._menu=X.create("DIV",{className:"ol-header",html:'<div class="ol-buttons"></div>',parent:i}),X.create("P",{text:t.title||"",parent:this._menu}),this.addButton({className:"ol-closebox",type:"button",click:(function(){this.collapse()}).bind(this),parent:this._menu});var r=X.create("DIV",{className:"ol-sizer",parent:i});r.addEventListener("mousedown",this._dragSizer.bind(this)),r.addEventListener("touchstart",this._dragSizer.bind(this));var s=this._list=X.create("TABLE",{className:"ol-list",parent:X.create("DIV",{className:"ol-scroll-container",tabindex:-1,parent:i})});s.parentNode.addEventListener("scroll",this._drawPage.bind(this)),this._head=X.create("THEAD",{parent:s}),this._listbody=X.create("TBODY",{parent:s}),this.collapse(t.collapsed!==!1),this.setFeatures(t.features)}setMap(t){super.setMap(t),t.addEventListener("change:size",this.resize.bind(this)),this.resize()}};li.prototype.setBottomScroll=function(n){this._bottomScroll=!!n,this._bottomScroll?this.element.classList.add("ol-bottom"):this.element.classList.remove("ol-bottom")};li.prototype.scrollTo=function(n){if(n==="select"){var t=this._listbody.querySelector(".ol-selected");if(t)return this._scrollAt(t),t}else{var e=this._findFeatureIndex(n);if(e>=0){var i=this._list.parentNode;return i.scrollTo(i.scrollLeft,(e+1.5)*this.getRowHeight()-i.getBoundingClientRect().height/2),this._listFeatures[e]}}return!1};li.prototype._findFeatureIndex=function(n){var t=this._listFeatures;if(t){for(let e=0;e<t.length;e++)if(t[e].feature===n)return e}return-1};li.prototype._findRow=function(n){var t=this._listFeatures;if(t){for(let e=0;e<t.length;e++)if(t[e].feature===n)return t[e]}return!1};li.prototype.collapse=function(n){n===void 0&&(n=!this._collapsed),n!==this._collapsed&&(this._collapsed=n,this._collapsed?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this._collapsed}),this._collapsed||this.refresh())};li.prototype.isCollapsed=function(){return this._collapsed};li.prototype.setFeatures=function(n){this._drawbind||(this._drawbind=this._drawList.bind(this)),this._source&&this._source.un&&this._source.un(["loadend","addfeature","removefeature","add","remove"],this._drawbind),this._source=n||[],this._drawList(),this._source.on&&this._source.on(["loadend","addfeature","removefeature","add","remove"],this._drawbind)};li.prototype.sortBy=function(n,t){t?this._sort[n]=t!=="down":delete this._sort[n],this.sort()};li.prototype.getSort=function(){return this._sort};li.prototype.resetSort=function(){this._sort={},this.sort()};li.prototype.enableSort=function(){this._canSort=[...arguments],Object.keys(this._sort).forEach((function(n){this._canSort.indexOf(n)<0&&delete this._sort[n]}).bind(this)),this.sort()};li.prototype._drawList=function(n){if(n){clearTimeout(this._drawout),this._drawout=setTimeout(this._drawList.bind(this),100);return}var t=this._source.getFeatures?this._source.getFeatures():this._source;this._columns=this.getColumns(t),this._drawHead(),this._listFeatures=[],t.forEach((function(e){var i=X.create("TR",{on:{click:(function(r){var s=r.target.closest("TD");this.dispatchEvent({type:"select",property:s.dataset.prop,feature:e,row:r.target.closest("TR"),col:s,originalEvent:r}),this.select(e,!0)}).bind(this),dblclick:(function(r){var s=r.target.closest("TD");this.dispatchEvent({type:"dblclick",property:s.dataset.prop,feature:e,row:r.target.closest("TR"),col:s,originalEvent:r})}).bind(this)}});this._listFeatures.push({feature:e,tr:i}),this._updateFeature(e,i)}).bind(this)),this.sort()};li.prototype.updateFeature=function(n){var t=this._findFeatureIndex(n);return t>=0?(this._updateFeature(this._listFeatures[t].feature,this._listFeatures[t].tr),!0):!1};li.prototype._updateFeature=function(n,t){t.innerHTML="",this._columns.forEach((function(e){var i=this.formatProperty(n,e);X.create("TD",{text:i.val,html:i.html,className:i.type,"data-prop":e,parent:t})}).bind(this))};li.prototype._drawHead=function(){var n=this._columns;this._head.innerHTML="";var t=X.create("TR",{parent:this._head});n.forEach((function(e){var i=X.create("TD",{html:X.create("P",{text:e}),parent:t});if(this._canSort.length&&this._canSort.indexOf(e)>=0){i.classList.add("sort");var r=X.create("BUTTON",{className:"sort"+(this._sort[e]===!0?" sortup":this._sort[e]===!1?" sortdown":""),click:(function(){var s;r.classList.contains("sortup")?s="down":r.classList.contains("sortdown")||(s="up"),this.sortBy(e,s)}).bind(this),parent:i})}}).bind(this))};li.prototype.sort=function(){var n=Object.keys(this._sort);n.length&&this._listFeatures.sort((function(t,e){for(let s=0;s<n.length;s++){var i=n[s],r=this.sortFn(t.feature,e.feature,i);if(r)return this._sort[i]?r:-r}return 0}).bind(this)),this.refresh(!0)};li.prototype.refresh=function(n){n&&(this._curPage=-1),this._drawHead(),this._drawPage(),this.resize()};li.prototype.update=function(){this._drawList(),this.select(this._curSelection.feature,!0)};li.prototype.getRowHeight=function(){return this._head.getBoundingClientRect().height};li.prototype._drawPage=function(){var n=Math.round(this.get("pageLength")/2),t=Math.round(n/2),e=this._list.parentNode.scrollTop,i=this.getRowHeight(),r=Math.round((e/i-t)/n);if(r*n>this._listFeatures.length&&(r=0),r!==this._curPage){this._curPage=r,this._listbody.innerHTML="",this._listbody.appendChild(X.create("TR",{style:{height:Math.max(0,(r*n-t)*i)+"px"}}));for(var s=Math.min(this._listFeatures.length,(r+1)*n+t),a=Math.max(0,r*n-t);a<s;a++)this._listbody.appendChild(this._listFeatures[a].tr);this._listbody.appendChild(X.create("TR",{style:{height:Math.max(0,(this._listFeatures.length-s)*i)+"px"}})),this.get("focus")!==!1&&this._listbody.focus()}};li.prototype.sortFn=function(n,t,e){var i=n.get(e)||"",r=t.get(e)||"";return i<r?-1:i>r?1:0};li.prototype.formatProperty=function(n,t){var e=n.get(t);return{val:e===void 0?"-":e,type:typeof e}};li.prototype.getColumns=function(n){var t=this.columns||[];if(!t.length&&n){var e={};n.forEach(function(i){Object.keys(i.getProperties()).forEach(function(r){i.get(r)instanceof e1||(e[r]=!0)})}),t=Object.keys(e)}return t};li.prototype.setColumns=function(n){this.columns=n||[],this._drawList(),this.select(this._curSelection.feature,!0)};li.prototype._dragSizer=function(n){var t=this;switch(this._movefn||(this._movefn=this._dragSizer.bind(this)),n.stopPropagation(),n.preventDefault(),n.type){case"touchcancel":case"touchend":case"mouseup":{t._pageY=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(i){document.removeEventListener(i,t._movefn)});break}case"mousedown":case"touchstart":t._contentHeight=t._list.parentNode.getBoundingClientRect().height,t._pageY=n.pageY||n.touches&&n.touches.length&&n.touches[0].pageY||n.changedTouches&&n.changedTouches.length&&n.changedTouches[0].pageY,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(i){document.addEventListener(i,t._movefn)});case"mousemove":case"touchmove":{if(t.pageY!==!1){var e=n.pageY||n.touches&&n.touches.length&&n.touches[0].pageY||n.changedTouches&&n.changedTouches.length&&n.changedTouches[0].pageY;this._bottomScroll?t.resize(t._contentHeight+e-t._pageY):t.resize(t._contentHeight-e+t._pageY)}break}}};li.prototype.resize=function(n){if(this.getMap()){var t=this._list.parentNode.getBoundingClientRect().height;if(n!==void 0&&(this._list.parentNode.style.height=n+"px"),this.element.dataset.control){var e=this.getMap().getTargetElement().getBoundingClientRect().height-this._head.getBoundingClientRect().height;this._list.parentNode.style.maxHeight=Math.min(e,this._list.getBoundingClientRect().height)+"px"}t!==this._list.parentNode.getBoundingClientRect().height&&this.dispatchEvent({type:"resize",height:this._list.parentNode.getBoundingClientRect().height})}};li.prototype.getSelection=function(){return this._curSelection?this._listFeatures[this._findFeatureIndex(this._curSelection.feature)]:null};li.prototype.select=function(n,t){this._curSelection&&this._curSelection.tr.classList.remove("ol-selected"),this._curSelection=null,n&&(t?this._curSelection=this._listFeatures[this._findFeatureIndex(n)]:this._curSelection=this.scrollTo(n)),this._curSelection&&this._curSelection.tr.classList.add("ol-selected")};li.prototype.addButton=function(n){return X.create("BUTTON",{className:n.className,title:n.title||"",html:n.html||"",click:n.click,parent:this._menu.querySelector(".ol-buttons")})};var Is=class extends sn{constructor(t){t=t||{};var e=document.createElement("DIV");if(e.classList.add("ol-unselectable","ol-control","ol-bar"),t.className){var i=t.className.split(" ").filter(function(s){return s.length>0});e.classList.add.apply(e.classList,i)}if(t.group&&e.classList.add("ol-group"),super({element:e,target:t.target}),this.set("toggleOne",t.toggleOne),this.set("autoDeactivate",t.autoDeactivate),this.controls_=[],t.controls instanceof Array)for(var r=0;r<t.controls.length;r++)this.addControl(t.controls[r])}setVisible(t){t?this.element.style.display="":this.element.style.display="none"}getVisible(){return this.element.style.display!="none"}setMap(t){super.setMap(t);for(var e=0;e<this.controls_.length;e++){var i=this.controls_[e];i.setMap(t)}}getControls(){return this.controls_}setPosition(t){this.element.classList.remove("ol-left","ol-top","ol-bottom","ol-right"),t=t.split("-");for(var e=0;e<t.length;e++)switch(t[e]){case"top":case"left":case"bottom":case"right":this.element.classList.add("ol-"+t[e]);break}}addControl(t){this.controls_.push(t),t.setTarget(this.element),this.getMap()&&this.getMap().addControl(t),t._activateBar&&t.un("change:active",t._activateBar),t._activateBar=(function(e){this.onActivateControl_(e,t)}).bind(this),t.on("change:active",t._activateBar),t.getActive&&this.onActivateControl_({target:t,active:t.getActive()},t)}removeControl(t){const e=this.controls_.indexOf(t);e>-1&&(this.controls_.splice(e,1),this.getMap()&&this.getMap().removeControl(t),t._activateBar&&t.un("change:active",t._activateBar),delete t._activateBar)}deactivateControls(t){for(var e=0;e<this.controls_.length;e++)this.controls_[e]!==t&&this.controls_[e].setActive&&this.controls_[e].setActive(!1)}getActiveControls(){for(var t=[],e=0,i;i=this.controls_[e];e++)i.getActive&&i.getActive()&&t.push(i);return t}setActive(t){if(!t&&this.get("autoDeactivate")&&this.deactivateControls(),t)for(var e=this.getControls(),i=0,r;r=e[i];i++)r.get("autoActivate")&&r.setActive(!0)}onActivateControl_(t,e){if(this.get("toggleOne")){if(t.active){var i;for(i=0;i<this.controls_.length&&this.controls_[i]!==e;i++);if(i==this.controls_.length)return;this.deactivateControls(this.controls_[i])}else if(!this.getActiveControls().length){for(var r=0,s;s=this.controls_[r];r++)if(s.get("autoActivate")){s.setActive(!0);break}}}t.type?this.dispatchEvent({type:"control:active",control:e,active:t.active}):this.dispatchEvent({type:"control:add",control:e,active:t.active})}getControlsByName(t){var e=this.getControls();return e.filter(function(i){return i.get("name")===t})}},Fn=class extends jh{constructor(t){t=t||{},t.toggleFn&&(t.onToggle=t.toggleFn),t.handleClick=function(){e.toggle(),t.onToggle&&t.onToggle.call(e,e.getActive())},t.className=(t.className||"")+" ol-toggle",super(t);var e=this;this.interaction_=t.interaction,this.interaction_&&(this.interaction_.setActive(t.active),this.interaction_.on("change:active",function(){e.setActive(e.interaction_.getActive())})),this.set("title",t.title),this.set("autoActivate",t.autoActivate),t.bar&&this.setSubBar(t.bar),this.setActive(t.active),this.setDisable(t.disable)}setMap(t){!t&&this.getMap()&&(this.interaction_&&this.getMap().removeInteraction(this.interaction_),this.subbar_&&this.getMap().removeControl(this.subbar_)),super.setMap(t),t&&(this.interaction_&&t.addInteraction(this.interaction_),this.subbar_&&t.addControl(this.subbar_))}getSubBar(){return this.subbar_}setSubBar(t){var e=this.getMap();e&&this.subbar_&&e.removeControl(this.subbar_),this.subbar_=t,t&&(this.subbar_.setTarget(this.element),this.subbar_.element.classList.add("ol-option-bar"),e&&e.addControl(this.subbar_))}getDisable(){var t=this.element.querySelector("button");return t&&t.disabled}setDisable(t){this.getDisable()!=t&&(this.element.querySelector("button").disabled=t,t&&this.getActive()&&this.setActive(!1),this.dispatchEvent({type:"change:disable",key:"disable",oldValue:!t,disable:t}))}getActive(){return this.element.classList.contains("ol-active")}toggle(){this.getActive()?this.setActive(!1):this.setActive(!0)}setActive(t){this.interaction_&&this.interaction_.setActive(t),this.subbar_&&this.subbar_.setActive(t),this.getActive()!==t&&(t?this.element.classList.add("ol-active"):this.element.classList.remove("ol-active"),this.dispatchEvent({type:"change:active",key:"active",oldValue:!t,active:t}))}setInteraction(t){this.interaction_=t}getInteraction(){return this.interaction_}},ro=class extends jh{constructor(t){t=t||{},t.className=(t.className||"")+" ol-text-button",super(t)}},mv=class extends La{constructor(t){super(t),this.on("select",(function(e){this.getFeatures().clear(),this.delete(e.selected)}).bind(this))}_getSources(t){if(!this.getMap())return[];t||(t=this.getMap().getLayers());var e=[];return t.forEach((function(i){i.getLayers?e=e.concat(this._getSources(i.getLayers())):i.getSource&&i.getSource()instanceof Fe&&e.push(i.getSource())}).bind(this)),e}delete(t){if(t&&(t.length||t.getLength())){this.dispatchEvent({type:"deletestart",features:t});var e=[];this._getSources().forEach(function(i){try{t.forEach(function(r){i.removeFeature(r),e.push(r)})}catch{}}),this.dispatchEvent({type:"deleteend",features:e})}}},kn=function(n,t){var e=n[0]-t[0],i=n[1]-t[1];return Math.sqrt(e*e+i*i)},Br=function(n,t){return n[0]==t[0]&&n[1]==t[1]},pv=function(n,t){var e=[],i=n.length-1,r=i,s,a,o,l,h,c,u,d,g,p,y,w,x,b=Br(n[0],n[i]);b||(y=n[0],w=n[1],x=[y[0]+(w[1]-y[1])/kn(y,w)*t,y[1]-(w[0]-y[0])/kn(y,w)*t],e.push(x),n.push(n[i]),i++,r--);for(var L=0;L<r;L++)y=n[L],w=n[(L+1)%i],x=n[(L+2)%i],s=(w[1]-y[1])/(w[0]-y[0]),a=(x[1]-w[1])/(x[0]-w[0]),Math.abs(s-a)>1e-10&&(o=Math.sqrt((w[0]-y[0])*(w[0]-y[0])+(w[1]-y[1])*(w[1]-y[1])),l=Math.sqrt((x[0]-w[0])*(x[0]-w[0])+(x[1]-w[1])*(x[1]-w[1])),h=y[0]+t*(w[1]-y[1])/o,c=w[0]+t*(x[1]-w[1])/l,u=y[1]-t*(w[0]-y[0])/o,d=w[1]-t*(x[0]-w[0])/l,g=(a*c-s*h+u-d)/(a-s),p=(s*a*(c-h)+a*u-s*d)/(a-s),w[0]-y[0]==0&&(g=w[0]+t*(w[1]-y[1])/Math.abs(w[1]-y[1]),p=a*g-a*c+d),x[0]-w[0]==0&&(g=x[0]+t*(x[1]-w[1])/Math.abs(x[1]-w[1]),p=s*g-s*h+u),e.push([g,p]));return b?e.push(e[0]):(n.pop(),y=n[n.length-1],w=n[n.length-2],x=[y[0]-(w[1]-y[1])/kn(y,w)*t,y[1]+(w[0]-y[0])/kn(y,w)*t],e.push(x)),e},_v=function(n,t){for(var e=0;e<t.length-1;e++){var i=t[e],r=t[e+1];if(Br(n,i)||Br(n,r))return{index:1,segment:[i,r]};var s=kn(i,r),a=[(r[0]-i[0])/s,(r[1]-i[1])/s],o=kn(i,n),l=[(n[0]-i[0])/o,(n[1]-i[1])/o];if(Math.abs(a[0]*l[1]-a[1]*l[0])<1e-10)return{index:1,segment:[i,r]}}return{index:-1}},Gx;(function(){function n(e,i){var r;for(let s=e.length-1;s>0;s--)(e[s][0]>i&&e[s-1][0]<i||e[s][0]<i&&e[s-1][0]>i)&&(r=[i,(i-e[s][0])/(e[s-1][0]-e[s][0])*(e[s-1][1]-e[s][1])+e[s][1]],e.splice(s,0,r))}function t(e,i){var r;for(let s=e.length-1;s>0;s--)(e[s][1]>i&&e[s-1][1]<i||e[s][1]<i&&e[s-1][1]>i)&&(r=[(i-e[s][1])/(e[s-1][1]-e[s][1])*(e[s-1][0]-e[s][0])+e[s][0],i],e.splice(s,0,r))}Gx=function(e,i){var r=i.getType()==="Polygon";if(!r&&i.getType()!=="MultiPolygon")return null;var s=i.getCoordinates();return r&&(s=[s]),s.forEach(function(a){a.forEach(function(o){n(o,e[0]),n(o,e[2]),t(o,e[1]),t(o,e[3])})}),s.forEach(function(a){a.forEach(function(o){o.forEach(function(l){l[0]<e[0]?l[0]=e[0]:l[0]>e[2]&&(l[0]=e[2]),l[1]<e[1]?l[1]=e[1]:l[1]>e[3]&&(l[1]=e[3])})})}),r?new Ei(s[0]):new $r(s)}})();var zg=function(n,t,e,i){var r=[];i!==!1&&r.push(n);var s=kn(n,t);if(s){var a=Math.round(s/e);if(a>1)for(var o=(t[0]-n[0])/a,l=(t[1]-n[1])/a,h=1;h<a;h++)r.push([n[0]+o*h,n[1]+l*h])}return r.push(t),r};wi.prototype.sampleAt=function(n){for(var t=this.getCoordinates(),e=[],i=1;i<t.length;i++)e=e.concat(zg(t[i-1],t[i],n,i===1));return new wi(e)};Vs.prototype.sampleAt=function(n){var t=this.getCoordinates(),e=[];return t.forEach(function(i){for(var r=[],s=1;s<i.length;s++)r=r.concat(zg(i[s-1],i[s],n,s===1));e.push(r)}),new Vs(e)};Ei.prototype.sampleAt=function(n){var t=this.getCoordinates(),e=[];return t.forEach(function(i){for(var r=[],s=1;s<i.length;s++)r=r.concat(zg(i[s-1],i[s],n,s===1));e.push(r)}),new Ei(e)};$r.prototype.sampleAt=function(n){var t=this.getCoordinates(),e=[];return t.forEach(function(i){var r=[];e.push(r),i.forEach(function(s){for(var a=[],o=1;o<s.length;o++)a=a.concat(zg(s[o-1],s[o],n,o===1));r.push(a)})}),new $r(e)};tl.prototype.intersection=function(n,t){if(n.sampleAt){var e=Vr(this.getCenter().concat(this.getCenter()),this.getRadius());n=Gx(e,n),n=n.simplify(t);var i=this.getCenter(),r=this.getRadius(),s=n.sampleAt(t).getCoordinates();switch(n.getType()){case"Polygon":s=[s];case"MultiPolygon":{var a=!1,o=[];return s.forEach(function(l){var h=[];o.push(h),l.forEach(function(c){var u=[];h.push(u),c.forEach(function(d){var g=kn(i,d);g>r?(a=!0,u.push([i[0]+r/g*(d[0]-i[0]),i[1]+r/g*(d[1]-i[1])])):u.push(d)})})}),a?n.getType()==="Polygon"?new Ei(o[0]):new $r(o):n}}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+n.getType());return n};var jx;(function(){var n=[255,255,255,1],t=[0,153,255,1],e=3,i=[new Zt({stroke:new fe({color:n,width:e+2})}),new Zt({image:new fr({radius:e*2,fill:new Ne({color:t}),stroke:new fe({color:n,width:e/2})}),stroke:new fe({color:t,width:e}),fill:new Ne({color:[255,255,255,.5]})})];jx=function(r){if(r===!0)return i;r=r||{};var s=new Ne({color:r.fillColor||"rgba(255,255,255,0.4)"}),a=new fe({color:r.color||"#3399CC",width:1.25}),o=new Zt({image:new fr({fill:s,stroke:a,radius:5}),fill:s,stroke:a});return[o]}})();const Ux=jx;var yv=class extends $s{constructor(t){t=t||{},super({handleDownEvent:function(i){return e.handleDownEvent_(i)},handleDragEvent:function(i){return e.handleDragEvent_(i)},handleMoveEvent:function(i){return e.handleMoveEvent_(i)},handleUpEvent:function(i){return e.handleUpEvent_(i)}});var e=this;this._filter=t.filter,this.features_=t.features,this.layers_=t.layers?t.layers instanceof Array?t.layers:[t.layers]:null,this.set("duplicate",t.duplicate),this.source_=t.source,this._style=typeof t.style=="function"?t.style:function(){return t.style?t.style:Ux(!0)},this.previousCursor_=!1}getFeatureAtPixel_(t){var e=this;return this.getMap().forEachFeatureAtPixel(t.pixel,function(i,r){var s;if(e._filter&&!e._filter(i,r))return!1;if(e.layers_){for(var a=0;a<e.layers_.length;a++)if(e.layers_[a]===r){s=i;break}}else e.features_?e.features_.forEach(function(d){d===i&&(s=i)}):s=i;var o=s.getGeometry().getType();if(s&&/Polygon|LineString/.test(o)){if(o==="Polygon"&&s.getGeometry().getCoordinates().length>1)return!1;var l=s.getGeometry().getClosestPoint(t.coordinate),h=l[0]-t.coordinate[0],c=l[1]-t.coordinate[1],u=Math.sqrt(h*h+c*c)/t.frameState.viewState.resolution;return u<5?{feature:s,hit:l,coordinates:s.getGeometry().getCoordinates(),geom:s.getGeometry().clone(),geomType:o}:!1}else return!1},{hitTolerance:5})}handleDownEvent_(t){return this.current_=this.getFeatureAtPixel_(t),this.current_?(this.currentStyle_=this.current_.feature.getStyle(),this.source_&&(this.get("duplicate")||t.originalEvent.ctrlKey)?(this.current_.feature=this.current_.feature.clone(),this.current_.feature.setStyle(this._style(this.current_.feature)),this.source_.addFeature(this.current_.feature)):(this.current_.feature.setStyle(this._style(this.current_.feature)),this._modifystart=!0),this.dispatchEvent({type:"offsetstart",feature:this.current_.feature,offset:0}),!0):!1}handleDragEvent_(t){this._modifystart&&(this.dispatchEvent({type:"modifystart",features:[this.current_.feature]}),this._modifystart=!1);var e=this.current_.geom.getClosestPoint(t.coordinate),i=kn(e,t.coordinate),r,s,a,o;switch(this.current_.geomType){case"Polygon":{if(r=_v(e,this.current_.coordinates[0]).segment,r){s=[r[1][0]-r[0][0],r[1][1]-r[0][1]],a=[t.coordinate[0]-e[0],t.coordinate[1]-e[1]],s[0]*a[1]-s[1]*a[0]>0&&(i=-i),o=[];for(var l=0;l<this.current_.coordinates.length;l++)o.push(pv(this.current_.coordinates[l],l==0?i:-i));this.current_.feature.setGeometry(new Ei(o))}break}case"LineString":{r=_v(e,this.current_.coordinates).segment,r&&(s=[r[1][0]-r[0][0],r[1][1]-r[0][1]],a=[t.coordinate[0]-e[0],t.coordinate[1]-e[1]],s[0]*a[1]-s[1]*a[0]>0&&(i=-i),o=pv(this.current_.coordinates,i),this.current_.feature.setGeometry(new wi(o)));break}}this.dispatchEvent({type:"offsetting",feature:this.current_.feature,offset:i,segment:[e,t.coordinate],coordinate:t.coordinate})}handleUpEvent_(t){this._modifystart||this.dispatchEvent({type:"offsetend",feature:this.current_.feature,coordinate:t.coordinate}),this.current_.feature.setStyle(this.currentStyle_),this.current_=!1}handleMoveEvent_(t){var e=this.getFeatureAtPixel_(t);e?(this.previousCursor_===!1&&(this.previousCursor_=t.map.getTargetElement().style.cursor),t.map.getTargetElement().style.cursor="pointer"):(t.map.getTargetElement().style.cursor=this.previousCursor_,this.previousCursor_=!1)}};wi.prototype.splitAt=function(n,t){var e;if(!n)return[this];if(t||(t=1e-10),n.length&&n[0].length){var i=[this];for(e=0;e<n.length;e++){for(var r=[],s=0;s<i.length;s++){var a=i[s].splitAt(n[e],t);r=r.concat(a)}i=r}return i}if(Br(n,this.getFirstCoordinate())||Br(n,this.getLastCoordinate()))return[this];var o=this.getCoordinates(),l=[o[0]],h=[];for(e=0;e<o.length-1;e++)if(!Br(o[e],o[e+1])){if(Br(n,o[e+1]))l.push(o[e+1]),h.push(new wi(l)),l=[];else if(!Br(n,o[e])){var c,u,d=!1;o[e][0]==o[e+1][0]?(c=(o[e][1]-n[1])/(o[e][1]-o[e+1][1]),d=o[e][0]==n[0]&&0<c&&c<=1):o[e][1]==o[e+1][1]?(c=(o[e][0]-n[0])/(o[e][0]-o[e+1][0]),d=o[e][1]==n[1]&&0<c&&c<=1):(c=(o[e][0]-n[0])/(o[e][0]-o[e+1][0]),u=(o[e][1]-n[1])/(o[e][1]-o[e+1][1]),d=Math.abs(c-u)<=t&&0<c&&c<=1),d&&(l.push(n),h.push(new wi(l)),l=[n])}l.push(o[e+1])}return l.length>1&&h.push(new wi(l)),h.length?h:[this]};var vv=class extends _s{constructor(t){t||(t={}),super({handleEvent:function(h){switch(h.type){case"singleclick":return this.handleDownEvent(h);case"pointermove":return this.handleMoveEvent(h);default:return!0}}}),this.snapDistance_=t.snapDistance||25,this.tolerance_=t.tolerance||1e-10,this.cursor_=t.cursor,this.setSources(t.sources),t.features&&(this.sources_||(this.sources_=[]),this.sources_.push(new Fe({features:t.features}))),this.filterSplit_=t.filter||function(){return!0};var e=[255,255,255,1],i=[0,153,255,1],r=3,s=new Ne({color:"rgba(255,255,255,0.4)"}),a=new fe({color:"#3399CC",width:1.25}),o=[new Zt({image:new fr({fill:s,stroke:a,radius:5}),fill:s,stroke:a})],l=[new Zt({stroke:new fe({color:e,width:r+2})}),new Zt({image:new fr({radius:2*r,fill:new Ne({color:i}),stroke:new fe({color:e,width:r/2})}),stroke:new fe({color:i,width:r})})];t.sketchStyle&&(o=t.sketchStyle instanceof Array?t.sketchStyle:[t.sketchStyle]),t.featureStyle&&(l=t.featureStyle instanceof Array?t.featureStyle:[t.featureStyle]),this.overlayLayer_=new Ge({source:new Fe({useSpatialIndex:!1}),name:"Split overlay",displayInLayerSwitcher:!1,style:function(h){return h._sketch_?o:l}})}setMap(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),super.setMap(t),this.overlayLayer_.setMap(t)}getSources(){if(!this.sources_&&this.getMap()){var t=[],e=function(i){i.forEach(function(r){r.getVisible()&&(r.getSource&&r.getSource()instanceof Fe?t.unshift(r.getSource()):r.getLayers&&e(r.getLayers()))})};return e(this.getMap().getLayers()),t}return this.sources_||[]}setSources(t){this.sources_=t?t instanceof Array?t||!1:[t]:!1}getClosestFeature(t){var e,i,r,s,a=this.snapDistance_+1;if(this.getSources().forEach(function(h){var c=h.getClosestFeatureToCoordinate(t.coordinate);if(c&&c.getGeometry().splitAt){var u=c.getGeometry().getClosestPoint(t.coordinate),d=new wi([t.coordinate,u]),g=d.getLength()/t.frameState.viewState.resolution;g<a&&(e=h,a=g,i=c,s=d,r=u)}}),a>this.snapDistance_)return!1;var o=this.getNearestCoord(r,i.getGeometry().getCoordinates()),l=this.getMap().getPixelFromCoordinate(o);return kn(t.pixel,l)<this.snapDistance_&&(r=o),{source:e,feature:i,coord:r,link:s}}getNearestCoord(t,e){for(var i,r=Number.MAX_VALUE,s,a=0;a<e.length;a++)i=kn(t,e[a]),i<r&&(r=i,s=e[a]);return s}handleDownEvent(t){var e=this.getClosestFeature(t);if(e){var i=this;i.overlayLayer_.getSource().clear();var r=e.feature.getGeometry().splitAt(e.coord,this.tolerance_),s;if(r.length>1){var a=[];for(s=0;s<r.length;s++){var o=e.feature.clone();o.setGeometry(r[s]),a.push(o)}for(i.dispatchEvent({type:"beforesplit",original:e.feature,features:a}),e.source.dispatchEvent({type:"beforesplit",original:e.feature,features:a}),e.source.removeFeature(e.feature),s=0;s<a.length;s++)e.source.addFeature(a[s]);i.dispatchEvent({type:"aftersplit",original:e.feature,features:a}),e.source.dispatchEvent({type:"aftersplit",original:e.feature,features:a})}}return!1}handleMoveEvent(t){var e=t.map;this.overlayLayer_.getSource().clear();var i=this.getClosestFeature(t);if(i&&this.filterSplit_(i.feature)){var r,s;this.overlayLayer_.getSource().addFeature(i.feature),r=new ei(new fi(i.coord)),r._sketch_=!0,this.overlayLayer_.getSource().addFeature(r),s=new ei(i.link),s._sketch_=!0,this.overlayLayer_.getSource().addFeature(s),this.dispatchEvent({type:"pointermove",coordinate:t.coordinate,frameState:t.frameState,originalEvent:t.originalEvent,map:t.map,pixel:t.pixel,feature:i.feature,linkGeometry:i.link})}else this.dispatchEvent(t);var a=e.getTargetElement();this.cursor_&&(i?a.style.cursor!=this.cursor_&&(this.previousCursor_=a.style.cursor,a.style.cursor=this.cursor_):this.previousCursor_!==void 0&&(a.style.cursor=this.previousCursor_,this.previousCursor_=void 0))}},Gp=class extends $s{constructor(t){t=t||{},super({handleDownEvent:function(i){return e.handleDownEvent_(i)},handleDragEvent:function(i){return this.handleDragEvent_(i)},handleMoveEvent:function(i){return this.handleMoveEvent_(i)},handleUpEvent:function(i){return this.handleUpEvent_(i)}});var e=this;this.selection_=new On,this.handles_=new On,this.overlayLayer_=new Ge({source:new Fe({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(i){return e.style[(i.get("handle")||"default")+(i.get("constraint")||"")+(i.get("option")||"")]}}),this.features_=t.features,typeof t.filter=="function"&&(this._filter=t.filter),this.layers_=t.layers?t.layers instanceof Array?t.layers:[t.layers]:null,this._handleEvent=t.condition||function(){return!0},this.addFn_=t.addCondition||function(){return!1},this.setPointRadius(t.pointRadius),this.set("translateFeature",t.translateFeature!==!1),this.set("translate",t.translate!==!1),this.set("translateBBox",t.translateBBox===!0),this.set("stretch",t.stretch!==!1),this.set("scale",t.scale!==!1),this.set("rotate",t.rotate!==!1),this.set("keepAspectRatio",t.keepAspectRatio||function(i){return i.originalEvent.shiftKey}),this.set("modifyCenter",t.modifyCenter||function(i){return i.originalEvent.metaKey||i.originalEvent.ctrlKey}),this.set("noFlip",t.noFlip||!1),this.set("selection",t.selection!==!1),this.set("hitTolerance",t.hitTolerance||0),this.set("enableRotatedTransform",t.enableRotatedTransform||!1),this.set("keepRectangle",t.keepRectangle||!1),this.set("buffer",t.buffer||0),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle()}setMap(t){var e=this.getMap();if(e){var i=e.getTargetElement();e.removeLayer(this.overlayLayer_),this.previousCursor_&&i&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}super.setMap(t),this.overlayLayer_.setMap(t),t===null&&this.select(null),t!==null&&(this.isTouch=/touch/.test(t.getViewport().className),this.setDefaultStyle())}setActive(t){this.select(null),this.overlayLayer_&&this.overlayLayer_.setVisible(t),super.setActive(t)}setDefaultStyle(t){t=t||{};var e=t.pointStroke||new fe({color:[255,0,0,1],width:1}),i=t.stroke||new fe({color:[255,0,0,1],width:1,lineDash:[4,4]}),r=t.fill||new Ne({color:[255,0,0,.01]}),s=t.pointFill||new Ne({color:[255,255,255,.8]}),a=new Wo({fill:s,stroke:e,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});a.setDisplacement||(a.getAnchor()[0]=this.isTouch?-10:-5);var o=new Wo({fill:s,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),l=new Wo({fill:s,stroke:e,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function h(c,u,d){return[new Zt({image:c,stroke:u,fill:d})]}this.style={default:h(o,i,r),translate:h(o,e,s),rotate:h(a,e,s),rotate0:h(o,e,s),scale:h(o,e,s),scale1:h(o,e,s),scale2:h(o,e,s),scale3:h(o,e,s),scalev:h(l,e,s),scaleh1:h(l,e,s),scalev2:h(l,e,s),scaleh3:h(l,e,s)},this.drawSketch_()}setStyle(t,e){if(e){e instanceof Array?this.style[t]=e:this.style[t]=[e];for(var i=0;i<this.style[t].length;i++){var r=this.style[t][i].getImage();r&&(t=="rotate"&&(r.getAnchor()[0]=-5),this.isTouch&&r.setScale(1.8));var s=this.style[t][i].getText();s&&(t=="rotate"&&s.setOffsetX(this.isTouch?14:7),this.isTouch&&s.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(t){var e=this;return this.getMap().forEachFeatureAtPixel(t,function(i,r){var s=!1;if(!r){if(i===e.bbox_)return e.get("translateBBox")?{feature:i,handle:"translate",constraint:"",option:""}:!1;if(e.handles_.forEach(function(o){o===i&&(s=!0)}),s)return{feature:i,handle:i.get("handle"),constraint:i.get("constraint"),option:i.get("option")}}if(!e.get("selection"))return e.selection_.getArray().some(function(o){return i===o})?{feature:i}:null;if(e._filter)return e._filter(i,r)?{feature:i}:null;if(e.layers_){for(var a=0;a<e.layers_.length;a++)if(e.layers_[a]===r)return{feature:i};return null}else return e.features_?(e.features_.forEach(function(o){o===i&&(s=!0)}),s?{feature:i}:null):{feature:i}},{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(t,e){var i=t.getGeometry(),r=this.getMap().getView().getRotation();if(r===0||!this.get("enableRotatedTransform"))return e?i.clone():i;var s=i.clone();return s.rotate(r*-1,this.getMap().getView().getCenter()),s}_isRectangle(t){if(this.get("keepRectangle")&&t.getType()==="Polygon"){var e=t.getCoordinates()[0];return e.length===5}return!1}drawSketch_(t){var e,i,r,s=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!!this.selection_.getLength()){var a=this.getMap().getView().getRotation(),o=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),l;s&&(l=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),l.unshift(l[3])),o=Vr(o,this.get("buffer")),this.selection_.forEach((function(y){var w=this.getGeometryRotateToZero_(y).getExtent();Vc(o,w)}).bind(this));var h=this.selection_.getLength()===1?this._pointRadius(this.selection_.item(0)):0;if(h&&!(h instanceof Array)&&(h=[h,h]),t===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new ei({geometry:new fi(this.center_),handle:"rotate0"})),r=Bo(o),this.get("enableRotatedTransform")&&a!==0&&r.rotate(a,this.getMap().getView().getCenter()),i=this.bbox_=new ei(r),this.overlayLayer_.getSource().addFeature(i));else{if(this.ispt_){var c=this.getMap().getPixelFromCoordinate([o[0],o[1]]);if(c){var u=h&&h[0]||10,d=h&&h[1]||10;o=bn([this.getMap().getCoordinateFromPixel([c[0]-u,c[1]-d]),this.getMap().getCoordinateFromPixel([c[0]+u,c[1]+d])])}}r=s?new Ei([l]):Bo(o),this.get("enableRotatedTransform")&&a!==0&&r.rotate(a,this.getMap().getView().getCenter()),i=this.bbox_=new ei(r);var g=[],p=r.getCoordinates()[0];if(!this.ispt_||h){if(g.push(i),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(e=0;e<p.length-1;e++)i=new ei({geometry:new fi([(p[e][0]+p[e+1][0])/2,(p[e][1]+p[e+1][1])/2]),handle:"scale",constraint:e%2?"h":"v",option:e}),g.push(i);if(this.get("scale"))for(e=0;e<p.length-1;e++)i=new ei({geometry:new fi(p[e]),handle:"scale",option:e}),g.push(i);this.get("translate")&&!this.get("translateFeature")&&(i=new ei({geometry:new fi([(p[0][0]+p[2][0])/2,(p[0][1]+p[2][1])/2]),handle:"translate"}),g.push(i))}!this.iscircle_&&this.get("rotate")&&(i=new ei({geometry:new fi(p[3]),handle:"rotate"}),g.push(i)),this.overlayLayer_.getSource().addFeatures(g)}}}select(t,e){if(!t){this.selection_&&(this.selection_.clear(),this.drawSketch_());return}if(!(!t.getGeometry||!t.getGeometry())){if(e)this.selection_.push(t);else{var i=this.selection_.getArray().indexOf(t);this.selection_.removeAt(i)}this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:t,features:this.selection_})}}setSelection(t){this.selection_.clear(),t.forEach((function(e){this.selection_.push(e)}).bind(this)),this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(function(t){Lr(t)}),this._featureListeners=[],this.selection_.forEach((function(t){this._featureListeners.push(t.on("change",(function(){this.isUpdating_||this.drawSketch_()}).bind(this)))}).bind(this))}handleDownEvent_(t){if(this._handleEvent(t,this.selection_)){var e=this.getFeatureAtPixel_(t.pixel),i=e.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(i)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(e.handle="translate"),e.handle){this.mode_=e.handle,this.opt_=e.option,this.constraint_=e.constraint;var r=this.getMap().getView().getRotation();this.coordinate_=i.get("handle")?i.getGeometry().getCoordinates():t.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];for(var s=Bn(),a=Bn(),o=0,l;l=this.selection_.item(o);o++)if(this.geoms_.push(l.getGeometry().clone()),s=Vc(s,l.getGeometry().getExtent()),this.get("enableRotatedTransform")&&r!==0){var h=this.getGeometryRotateToZero_(l,!0);this.rotatedGeoms_.push(h),a=Vc(a,h.getExtent())}if(this.extent_=Bo(s).getCoordinates()[0],this.get("enableRotatedTransform")&&r!==0&&(this.rotatedExtent_=Bo(a).getCoordinates()[0]),this.mode_==="rotate"){this.center_=this.getCenter()||qs(s);var c=t.map.getTargetElement();c.style.cursor=this.Cursors.rotate0,this.previousCursor_=c.style.cursor}else this.center_=qs(s);return this.angle_=Math.atan2(this.center_[1]-t.coordinate[1],this.center_[0]-t.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!0}else if(this.get("selection")){if(i){this.addFn_(t)||this.selection_.clear();var u=this.selection_.getArray().indexOf(i);u<0?this.selection_.push(i):this.selection_.removeAt(u)}else this.selection_.clear();return this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:i,features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(t){return this.set("center",t)}handleDragEvent_(t){if(this._handleEvent(t,this.features_)){var e=this.getMap().getView().getRotation(),i,r,s,a,o=[this.coordinate_[0],this.coordinate_[1]],l=[t.coordinate[0],t.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":{var h=Math.atan2(this.center_[1]-l[1],this.center_[0]-l[0]);if(!this.ispt)for(i=0,s;s=this.selection_.item(i);i++)a=this.geoms_[i].clone(),a.rotate(h-this.angle_,this.center_),a.getType()=="Circle"&&a.setCenterAndRadius(a.getCenter(),a.getRadius()),s.setGeometry(a);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:h-this.angle_,pixel:t.pixel,coordinate:t.coordinate});break}case"translate":{var c=l[0]-o[0],u=l[1]-o[1];for(i=0,s;s=this.selection_.item(i);i++)s.getGeometry().translate(c,u);this.handles_.forEach(function(q){q.getGeometry().translate(c,u)}),this.coordinate_=t.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[c,u],pixel:t.pixel,coordinate:t.coordinate});break}case"scale":{var d=this.center_;if(this.get("modifyCenter")(t)){var g=this.extent_;this.get("enableRotatedTransform")&&e!==0&&(g=this.rotatedExtent_),d=g[(Number(this.opt_)+2)%4]}var p=this.geoms_.length==1&&this._isRectangle(this.geoms_[0]),y=this.constraint_,w=this.opt_,x=this.coordinate_,b=t.coordinate;if(this.get("enableRotatedTransform")&&e!==0){var L=new fi(this.coordinate_);L.rotate(e*-1,d),x=L.getCoordinates();var P=new fi(t.coordinate);P.rotate(e*-1,d),b=P.getCoordinates()}var R=(b[0]-d[0])/(x[0]-d[0]),j=(b[1]-d[1])/(x[1]-d[1]),k=[b[0]-x[0],b[1]-x[1]];if(this.get("enableRotatedTransform")&&e!==0){var T=new fi(d);T.rotate(e*-1,this.getMap().getView().getCenter()),d=T.getCoordinates()}for(this.get("noFlip")&&(R<0&&(R=-R),j<0&&(j=-j)),this.constraint_?this.constraint_=="h"?R=1:j=1:this.get("keepAspectRatio")(t)&&(R=j=Math.min(R,j)),i=0,s;s=this.selection_.item(i);i++)a=e===0||!this.get("enableRotatedTransform")?this.geoms_[i].clone():this.rotatedGeoms_[i].clone(),a.applyTransform((function(q,W,F){if(F<2)return W;if(p){var M=[[6],[0,8],[2],[4]],O=[q[0],q[1]],G=[q[2],q[3]],tt=[q[4],q[5]],Z=[q[6],q[7]],it=[q[8],q[9]];if(y){var J=w%2===0?this._countVector(O,G):this._countVector(Z,O),lt=this._projectVectorOnVector(k,J),ct=w+1<M.length?w+1:0,Et=[...M[w],...M[ct]];for(r=0;r<q.length;r+=F)W[r]=Et.includes(r)?q[r]+lt[0]:q[r],W[r+1]=Et.includes(r)?q[r+1]+lt[1]:q[r+1]}else{var S,U;switch(w){case 0:k=this._countVector(Z,b),S=this._projectVectorOnVector(k,this._countVector(tt,Z)),U=this._projectVectorOnVector(k,this._countVector(O,Z)),[W[0],W[1]]=this._movePoint(O,S),[W[4],W[5]]=this._movePoint(tt,U),[W[6],W[7]]=this._movePoint(Z,k),[W[8],W[9]]=this._movePoint(it,S);break;case 1:k=this._countVector(O,b),S=this._projectVectorOnVector(k,this._countVector(Z,O)),U=this._projectVectorOnVector(k,this._countVector(G,O)),[W[0],W[1]]=this._movePoint(O,k),[W[2],W[3]]=this._movePoint(G,S),[W[6],W[7]]=this._movePoint(Z,U),[W[8],W[9]]=this._movePoint(it,k);break;case 2:k=this._countVector(G,b),S=this._projectVectorOnVector(k,this._countVector(O,G)),U=this._projectVectorOnVector(k,this._countVector(tt,G)),[W[0],W[1]]=this._movePoint(O,U),[W[2],W[3]]=this._movePoint(G,k),[W[4],W[5]]=this._movePoint(tt,S),[W[8],W[9]]=this._movePoint(it,U);break;case 3:k=this._countVector(tt,b),S=this._projectVectorOnVector(k,this._countVector(G,tt)),U=this._projectVectorOnVector(k,this._countVector(Z,tt)),[W[2],W[3]]=this._movePoint(G,U),[W[4],W[5]]=this._movePoint(tt,k),[W[6],W[7]]=this._movePoint(Z,S);break}}}else for(r=0;r<q.length;r+=F)R!=1&&(W[r]=d[0]+(q[r]-d[0])*R),j!=1&&(W[r+1]=d[1]+(q[r+1]-d[1])*j);return a.getType()=="Circle"&&a.setCenterAndRadius(a.getCenter(),a.getRadius()),W}).bind(this)),this.get("enableRotatedTransform")&&e!==0&&a.rotate(e,this.getMap().getView().getCenter()),s.setGeometry(a);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[R,j],pixel:t.pixel,coordinate:t.coordinate});break}}this.isUpdating_=!1}}handleMoveEvent_(t){if(this._handleEvent(t,this.features_)&&!this.mode_){var e=this.getFeatureAtPixel_(t.pixel),i=t.map.getTargetElement();if(e.feature){var r=e.handle?this.Cursors[(e.handle||"default")+(e.constraint||"")+(e.option||"")]:this.Cursors.select;this.previousCursor_===void 0&&(this.previousCursor_=i.style.cursor),i.style.cursor=r}else this.previousCursor_!==void 0&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(t){if(this.mode_==="rotate"){var e=t.map.getTargetElement();e.style.cursor=this.Cursors.default,this.previousCursor_=void 0}return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1}setPointRadius(t){typeof t=="function"?this._pointRadius=t:this._pointRadius=function(){return t}}getFeatures(){return this.selection_}_projectVectorOnVector(t,e){var i=(t[0]*e[0]+t[1]*e[1])/(e[0]*e[0]+e[1]*e[1]);return[e[0]*i,e[1]*i]}_countVector(t,e){return[e[0]-t[0],e[1]-t[1]]}_movePoint(t,e){return[t[0]+e[0],t[1]+e[1]]}};Gp.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};var wv=class extends _s{constructor(t){t=t||{};var e,i;super({handleEvent:function(s){switch(s.type){case"pointerdown":return e=this.handleDownEvent(s),i=e||this._deleteCondition(s),!e;case"pointerup":return e=!1,this.handleUpEvent(s);case"pointerdrag":return e?this.handleDragEvent(s):!0;case"pointermove":return e?!1:this.handleMoveEvent(s);case"singleclick":case"click":return!i;default:return!0}}}),this.snapDistance_=t.pixelTolerance||10,this.tolerance_=1e-10,this.cursor_=t.cursor,this.sources_=t.sources?t.sources instanceof Array?t.sources:[t.sources]:[],t.source&&this.sources_.push(t.source),t.features&&this.sources_.push(new Fe({features:t.features})),this.filterSplit_=t.filter||function(){return!0},this._condition=t.condition||v1,this._deleteCondition=t.deleteCondition||_5,this._insertVertexCondition=t.insertVertexCondition||hu;var r=function(){return[new Zt({image:new fr({radius:6,fill:new Ne({color:[0,153,255,1]}),stroke:new fe({color:"#FFF",width:1.25})})})]};t.style&&(typeof t.style=="function"?r=t.style:r=function(){return t.style}),this.overlayLayer_=new Ge({source:new Fe({useSpatialIndex:!1}),name:"Modify overlay",displayInLayerSwitcher:!1,style:r,wrapX:t.wrapX})}setMap(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),super.setMap(t),this.overlayLayer_.setMap(t)}setActive(t){super.setActive(t),this.overlayLayer_&&this.overlayLayer_.getSource().clear()}setFilter(t){typeof t=="function"?this.filterSplit_=t:t===void 0&&(this.filterSplit_=function(){return!0})}getClosestFeature(t){for(var e,i,r=this.snapDistance_+1,s=0;s<this.sources_.length;s++){var a=this.sources_[s];if(e=a.getClosestFeatureToCoordinate(t.coordinate),e&&this.filterSplit_(e)){var o=e.getGeometry().getClosestPoint(t.coordinate),l=kn(t.coordinate,o)/t.frameState.viewState.resolution;l<r&&(r=l,i=o);break}}if(r>this.snapDistance_)return this.currentFeature&&this.dispatchEvent({type:"select",selected:[],deselected:[this.currentFeature]}),this.currentFeature=null,!1;var h=this.getNearestCoord(i,e.getGeometry());if(h){h=h.coord;var c=this.getMap().getPixelFromCoordinate(h);return kn(t.pixel,c)<this.snapDistance_&&(i=h),this.currentFeature!==e&&this.dispatchEvent({type:"select",selected:[e],deselected:[this.currentFeature]}),this.currentFeature=e,{source:a,feature:e,coord:i}}}getNearestCoord(t,e){var i,r,s,a,o;switch(e.getType()){case"Point":return{coord:e.getCoordinates(),dist:kn(e.getCoordinates(),t)};case"MultiPoint":return this.getNearestCoord(t,new wi(e.getCoordinates()));case"LineString":case"LinearRing":{var l;o=Number.MAX_VALUE;var h=e.getCoordinates();for(i=0;i<h.length;i++)l=kn(t,h[i]),l<o&&(o=l,a=h[i]);return{coord:a,dist:o}}case"MultiLineString":{var c=e.getLineStrings();for(a=!1,o=Number.MAX_VALUE,i=0;r=c[i];i++)s=this.getNearestCoord(t,r),s&&s.dist<o&&(a=s,o=s.dist,a.ring=i);return a}case"Polygon":{var u=e.getLinearRings();for(a=!1,o=Number.MAX_VALUE,i=0;r=u[i];i++)s=this.getNearestCoord(t,r),s&&s.dist<o&&(a=s,o=s.dist,a.ring=i);return a}case"MultiPolygon":{var d=e.getPolygons();for(a=!1,o=Number.MAX_VALUE,i=0;r=d[i];i++)s=this.getNearestCoord(t,r),s&&s.dist<o&&(a=s,o=s.dist,a.poly=i);return a}case"GeometryCollection":{var g=e.getGeometries();for(a=!1,o=Number.MAX_VALUE,i=0;r=g[i];i++)s=this.getNearestCoord(t,r),s&&s.dist<o&&(a=s,o=s.dist,a.geom=i);return a}default:return!1}}getArcs(t,e){var i=!1,r,s,a,o,l;switch(t.getType()){case"Point":{Br(e,t.getCoordinates())&&(i={geom:t,type:t.getType(),coord1:[],coord2:[],node:!0});break}case"MultiPoint":{for(r=t.getCoordinates(),s=0;s<r.length;s++)if(Br(e,r[s])){i={geom:t,type:t.getType(),index:s,coord1:[],coord2:[],node:!0};break}break}case"LinearRing":case"LineString":{var h=t.getClosestPoint(e);if(kn(h,e)<1.5*this.tolerance_){var c;if(t.getType()==="LinearRing"?(l=new wi(t.getCoordinates()),c=l.splitAt(e,this.tolerance_)):c=t.splitAt(e,this.tolerance_),c.length>2){for(r=c[1].getCoordinates(),s=2;a=c[s];s++){var u=a.getCoordinates();u.shift(),r=r.concat(u)}c=[c[0],new wi(r)]}if(c.length===2){var d=c[0].getCoordinates(),g=c[1].getCoordinates(),p=d.length+g.length-1;d.pop(),g.shift(),i={geom:t,type:t.getType(),coord1:d,coord2:g,node:t.getCoordinates().length===p,closed:!1}}else if(c.length===1){a=c[0].getCoordinates();var y=Br(a[0],e),w=Br(a[a.length-1],e);y?(a.shift(),w&&a.pop(),i={geom:t,type:t.getType(),coord1:[],coord2:a,node:!0,closed:w}):w&&(a.pop(),i={geom:t,type:t.getType(),coord1:a,coord2:[],node:!0,closed:!1})}}break}case"MultiLineString":{var x=t.getLineStrings();for(s=0;o=x[s];s++)if(i=this.getArcs(o,e),i){i.geom=t,i.type=t.getType(),i.lstring=s;break}break}case"Polygon":{var b=t.getLinearRings();for(s=0;o=b[s];s++)if(i=this.getArcs(o,e),i){i.geom=t,i.type=t.getType(),i.index=s;break}break}case"MultiPolygon":{var L=t.getPolygons();for(s=0;o=L[s];s++)if(i=this.getArcs(o,e),i){i.geom=t,i.type=t.getType(),i.poly=s;break}break}case"GeometryCollection":{for(l=t.getGeometries(),s=0;o=l[s];s++)if(i=this.getArcs(o,e),i){i.geom=t,i.g=s,i.typeg=i.type,i.type=t.getType();break}break}default:{console.error("ol/interaction/ModifyFeature "+t.getType()+" not supported!");break}}return i}handleDownEvent(t){if(!this.getActive())return!1;var e=this.getClosestFeature(t);if(e&&(this._condition(t)||this._deleteCondition(t))){var i=[];return this.arcs=[],this.sources_.forEach((function(r){var s=Vr(bn([e.coord]),this.tolerance_);i=i.concat(i,r.getFeaturesInExtent(s))}).bind(this)),this._modifiedFeatures=[],i.forEach((function(r){var s=this.getArcs(r.getGeometry(),e.coord);s&&(this._insertVertexCondition(t)||s.node)&&(s.feature=r,this._modifiedFeatures.push(r),this.arcs.push(s))}).bind(this)),this._modifiedFeatures.length?this._deleteCondition(t)?!this._removePoint(e,t):(this.dispatchEvent({type:"modifystart",coordinate:e.coord,originalEvent:t.originalEvent,features:this._modifiedFeatures}),this.handleDragEvent({coordinate:e.coord,originalEvent:t.originalEvent}),!0):!0}else return!1}getModifiedFeatures(){return this._modifiedFeatures||[]}removePoint(){this._removePoint({},{})}_getModification(t){var e=t.coord1.concat(t.coord2);switch(t.type){case"LineString":{if(t.closed&&e.push(e[0]),e.length>1&&t.geom.getCoordinates().length!=e.length)return t.coords=e,!0;break}case"MultiLineString":{if(t.closed&&e.push(e[0]),e.length>1){var i=t.geom.getCoordinates();if(i[t.lstring].length!=e.length)return i[t.lstring]=e,t.coords=i,!0}break}case"Polygon":{if(t.closed&&e.push(e[0]),e.length>3&&(i=t.geom.getCoordinates(),i[t.index].length!=e.length))return i[t.index]=e,t.coords=i,!0;break}case"MultiPolygon":{if(t.closed&&e.push(e[0]),e.length>3&&(i=t.geom.getCoordinates(),i[t.poly][t.index].length!=e.length))return i[t.poly][t.index]=e,t.coords=i,!0;break}case"GeometryCollection":{t.type=t.typeg;var r=t.geom,s=r.getGeometries();t.geom=s[t.g];var a=this._getModification(t);return r.setGeometries(s),t.geom=r,t.type="GeometryCollection",a}}return!1}_removePoint(t,e){if(!this.arcs)return!1;this.overlayLayer_.getSource().clear();var i=!1;return this.arcs.forEach((function(r){i=i||this._getModification(r)}).bind(this)),i&&(this.dispatchEvent({type:"modifystart",coordinate:t.coord,originalEvent:e.originalEvent,features:this._modifiedFeatures}),this.arcs.forEach((function(r){if(r.geom.getType()==="GeometryCollection"){if(r.coords){var s=r.geom.getGeometries();s[r.g].setCoordinates(r.coords),r.geom.setGeometries(s)}}else r.coords&&r.geom.setCoordinates(r.coords)}).bind(this)),this.dispatchEvent({type:"modifyend",coordinate:t.coord,originalEvent:e.originalEvent,features:this._modifiedFeatures})),this.arcs=[],i}handleUpEvent(t){return this.getActive()?(!this.arcs||!this.arcs.length||(this.overlayLayer_.getSource().clear(),this.dispatchEvent({type:"modifyend",coordinate:t.coordinate,originalEvent:t.originalEvent,features:this._modifiedFeatures}),this.arcs=[]),!0):!1}setArcCoordinates(t,e){var i;switch(t.type){case"Point":{t.geom.setCoordinates(e[0]);break}case"MultiPoint":{i=t.geom.getCoordinates(),i[t.index]=e[0],t.geom.setCoordinates(i);break}case"LineString":{t.geom.setCoordinates(e);break}case"MultiLineString":{i=t.geom.getCoordinates(),i[t.lstring]=e,t.geom.setCoordinates(i);break}case"Polygon":{i=t.geom.getCoordinates(),i[t.index]=e,t.geom.setCoordinates(i);break}case"MultiPolygon":{i=t.geom.getCoordinates(),i[t.poly][t.index]=e,t.geom.setCoordinates(i);break}case"GeometryCollection":{t.type=t.typeg;var r=t.geom,s=r.getGeometries();t.geom=s[t.g],this.setArcCoordinates(t,e),r.setGeometries(s),t.geom=r,t.type="GeometryCollection";break}}}handleDragEvent(t){if(!this.getActive())return!1;if(!this.arcs)return!0;this.overlayLayer_.getSource().clear();var e=new ei(new fi(t.coordinate));return this.overlayLayer_.getSource().addFeature(e),this.arcs.length&&(this.arcs.forEach((function(i){var r=i.coord1.concat([t.coordinate],i.coord2);i.closed&&r.push(t.coordinate),this.setArcCoordinates(i,r)}).bind(this)),this.dispatchEvent({type:"modifying",coordinate:t.coordinate,originalEvent:t.originalEvent,features:this._modifiedFeatures})),!0}handleMoveEvent(t){if(!this.getActive())return!0;this.overlayLayer_.getSource().clear();var e=this.getClosestFeature(t);if(e){var i=new ei(new fi(e.coord));this.overlayLayer_.getSource().addFeature(i)}var r=t.map.getTargetElement();return this.cursor_&&(e?r.style.cursor!=this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):this.previousCursor_!==void 0&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0)),!0}getCurrentFeature(){return this.currentFeature}},jp=class extends _s{constructor(t){t=t||{},super({handleEvent:function(r){return e.handleEvent_(r)}});var e=this;this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.maxCircleCoordinates_=t.maxCircleCoordinates||100,this.features_=t.features,this.source_=t.source,this.conditionFn_=t.condition,this.squareFn_=t.squareCondition,this.centeredFn_=t.centerCondition,this.canRotate_=t.canRotate!==!1,this.geometryName_=t.geometryName||"geometry",this.setSides(t.sides);var i=Ux(!0);this.sketch_=new On,this.overlayLayer_=new Ge({source:new Fe({features:this.sketch_,useSpatialIndex:!1}),name:"DrawRegular overlay",displayInLayerSwitcher:!1,style:t.style||i})}setMap(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),super.setMap(t),this.overlayLayer_.setMap(t)}setActive(t){this.reset(),super.setActive(t)}reset(){this.overlayLayer_&&this.overlayLayer_.getSource().clear(),this.started_=!1}setSides(t){t=parseInt(t),this.sides_=t>2?t:0}canRotate(t){return(t===!0||t===!1)&&(this.canRotate_=t),this.canRotate_}getSides(){return this.sides_}getGeom_(){if(this.overlayLayer_.getSource().clear(),!this.center_)return!1;var t;if(this.coord_){var e=this.center_,i=this.coord_,r,s,a,o,l;if(!this.sides_&&this.square_&&!this.centered_)return e=[(i[0]+e[0])/2,(i[1]+e[1])/2],r=[i[0]-e[0],i[1]-e[1]],a=Math.sqrt(r[0]*r[0]+r[1]*r[1]),o=new tl(e,a,"XY"),l=this.getMap().getPixelFromCoordinate(e),s=Math.max(100,Math.abs(l[0]-this.coordPx_[0]),Math.abs(l[1]-this.coordPx_[1])),s=Math.min(this.maxCircleCoordinates_,Math.round(s/3)),B0(o,s,0);var h=this.canRotate_&&this.centered_&&this.square_;if(r=[i[0]-e[0],i[1]-e[1]],this.square_&&!h){var c=Math.max(Math.abs(r[0]),Math.abs(r[1]));i=[e[0]+(r[0]>0?c:-c),e[1]+(r[1]>0?c:-c)]}if(a=Math.sqrt(r[0]*r[0]+r[1]*r[1]),a>0){o=new tl(e,a,"XY");var u;if(h?u=Math.atan2(r[1],r[0]):u=this.startAngle[this.sides_]||this.startAngle.default,this.sides_?t=B0(o,this.sides_,u):(l=this.getMap().getPixelFromCoordinate(this.center_),s=Math.max(100,Math.abs(l[0]-this.coordPx_[0]),Math.abs(l[1]-this.coordPx_[1])),s=Math.min(this.maxCircleCoordinates_,Math.round(s/(this.centered_?3:5))),t=B0(o,s,0)),h)return t;var d=t.getExtent();this.centered_?e=[2*this.center_[0]-this.coord_[0],2*this.center_[1]-this.coord_[1]]:e=this.center_;var g=(e[0]-i[0])/(d[0]-d[2]),p=(e[1]-i[1])/(d[1]-d[3]);if(this.square_){var y=Math.min(Math.abs(g),Math.abs(p));g=Math.sign(g)*y,p=Math.sign(p)*y}var w=[e[0]-d[0]*g,e[1]-d[1]*p];return t.applyTransform(function(x,b,L){for(var P=0;P<x.length;P+=L)b[P]=x[P]*g+w[0],b[P+1]=x[P+1]*p+w[1];return b}),t}}return new fi(this.center_)}drawSketch_(t){if(this.overlayLayer_.getSource().clear(),t){this.square_=this.squareFn_?this.squareFn_(t):t.originalEvent.shiftKey,this.centered_=this.centeredFn_?this.centeredFn_(t):t.originalEvent.metaKey||t.originalEvent.ctrlKey;var e=this.getGeom_();if(e){var i=this.feature_;return e.getType()==="Polygon"&&i.getGeometry().setCoordinates(e.getCoordinates()),this.overlayLayer_.getSource().addFeature(i),this.coord_&&this.square_&&(this.canRotate_&&this.centered_&&this.coord_||!this.sides_&&!this.centered_)&&this.overlayLayer_.getSource().addFeature(new ei(new wi([this.center_,this.coord_]))),i}}}drawPoint_(t,e){e||this.overlayLayer_.getSource().clear(),this.overlayLayer_.getSource().addFeature(new ei(new fi(t)))}handleEvent_(t){var e,i;switch(this._eventTime=new Date,t.type){case"pointerdown":{if(this.conditionFn_&&!this.conditionFn_(t))break;this.downPx_=t.pixel,this.start_(t);var r=500;this._longTouch=!1,setTimeout((function(){this._longTouch=new Date-this._eventTime>.9*r,this._longTouch&&this.handleMoveEvent_(t)}).bind(this),r);break}case"pointerup":{this.started_&&this.coord_&&(e=this.downPx_[0]-t.pixel[0],i=this.downPx_[1]-t.pixel[1],e*e+i*i<=this.squaredClickTolerance_&&(this.lastEvent=="pointermove"||this.lastEvent=="keydown"?this.end_(t):(e=this.upPx_[0]-t.pixel[0],i=this.upPx_[1]-t.pixel[1],e*e+i*i<=this.squaredClickTolerance_?this.end_(t):(this.handleMoveEvent_(t),this.drawPoint_(t.coordinate,!0))))),this.upPx_=t.pixel;break}case"pointerdrag":{if(this.started_){var s=this.getMap().getPixelFromCoordinate(this.center_);e=s[0]-t.pixel[0],i=s[1]-t.pixel[1],e*e+i*i<=this.squaredClickTolerance_&&this.reset()}return!this._longTouch}case"pointermove":{this.started_&&(e=this.downPx_[0]-t.pixel[0],i=this.downPx_[1]-t.pixel[1],e*e+i*i>this.squaredClickTolerance_&&(this.handleMoveEvent_(t),this.lastEvent=t.type));break}default:{if(this.lastEvent=t.type,this.started_&&t.type==="dblclick")return!1;break}}return!0}finishDrawing(){this.started_&&this.coord_&&this.end_({pixel:this.upPx_,coordinate:this.coord_})}handleMoveEvent_(t){if(this.started_){this.coord_=t.coordinate,this.coordPx_=t.pixel;var e=this.drawSketch_(t);this.dispatchEvent({type:"drawing",feature:e,pixel:t.pixel,startCoordinate:this.center_,coordinate:t.coordinate,square:this.square_,centered:this.centered_})}else this.drawPoint_(t.coordinate)}start_(t){if(this.started_)this.coord_=t.coordinate;else{this.started_=!0,this.center_=t.coordinate,this.coord_=null;var e=this.feature_=new ei({});e.setGeometryName(this.geometryName_||"geometry"),e.setGeometry(new Ei([[t.coordinate,t.coordinate,t.coordinate]])),this.drawSketch_(t),this.dispatchEvent({type:"drawstart",feature:e,pixel:t.pixel,coordinate:t.coordinate})}}end_(t){if(this.coord_=t.coordinate,this.started_=!1,this.coord_&&(this.center_[0]!==this.coord_[0]||this.center_[1]!==this.coord_[1])){var e=this.feature_;e.setGeometry(this.getGeom_()),this.source_?this.source_.addFeature(e):this.features_&&this.features_.push(e),this.dispatchEvent({type:"drawend",feature:e,pixel:t.pixel,coordinate:t.coordinate,square:this.square_,centered:this.centered_})}else this.dispatchEvent({type:"drawcancel",feature:null,pixel:t.pixel,coordinate:t.coordinate,square:this.square_,centered:this.centered_});this.center_=this.coord_=null,this.drawSketch_()}};jp.prototype.startAngle={default:Math.PI/2,3:-Math.PI/2,4:Math.PI/4};var xv=class extends io{constructor(t){t=t||{};var e=function(s,a){var o=s[0].pop();return(!this.getPolygon()||this.getPolygon().intersectsCoordinate(o))&&(this.lastOKCoord=[o[0],o[1]]),s[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),a?a.setCoordinates([s[0].concat([s[0][0]])]):a=new Ei(s),a},i=t.geometryFunction;if(i?t.geometryFunction=function(s,a,o){return a=e.bind(this)(s,a),i.bind(this)(s,a,o)}:t.geometryFunction=e,t.type="Polygon",super(t),this._select=new La({style:t.style}),this._select.setActive(!1),t.layers&&(typeof t.layers=="function"?this.layers_=t.layers:t.layers.indexOf&&(this.layers_=function(s){return t.layers.indexOf(s)>=0})),typeof t.featureFilter=="function")this._features=t.featureFilter;else if(t.featureFilter){var r=t.featureFilter;this._features=function(s){return r.indexOf?!!r[r.indexOf(s)]:!!r.item(r.getArray().indexOf(s))}}else this._features=function(){return!0};this.on("drawstart",this._startDrawing.bind(this)),this.on("drawend",this._finishDrawing.bind(this))}setMap(t){this.getMap()&&this.getMap().removeInteraction(this._select),t&&t.addInteraction(this._select),super.setMap.call(this,t)}setActive(t){this._select&&this._select.getFeatures().clear(),super.setActive.call(this,t)}removeLastPoint(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&super.removeLastPoint.call(this)}getPolygon(){return this._polygon}_startDrawing(t){var e=this.getMap();this._feature=t.feature;var i=t.feature.getGeometry().getCoordinates()[0][0];this._current=null,e.forEachFeatureAtPixel(e.getPixelFromCoordinate(i),(function(r,s){if(!this._current&&this._features(r,s)){var a=r.getGeometry();if(a.getType()==="Polygon"&&a.intersectsCoordinate(i))this._polygonIndex=!1,this._polygon=a,this._current=r;else if(a.getType()==="MultiPolygon"&&a.intersectsCoordinate(i)){for(var o=0,l;l=a.getPolygon(o);o++)if(l.intersectsCoordinate(i)){this._polygonIndex=o,this._polygon=l,this._current=r;break}}}}).bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))}_finishDrawing(t){t.hole=t.feature,t.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});var e=t.hole.getGeometry().getCoordinates()[0];if(e.length>3)if(this._polygonIndex!==!1){for(var i=t.feature.getGeometry(),r=new $r([]),s=0,a;a=i.getPolygon(s);s++)s===this._polygonIndex&&a.appendLinearRing(new Qo(e)),r.appendPolygon(a);t.feature.setGeometry(r)}else this.getPolygon().appendLinearRing(new Qo(e));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()}_geometryFn(t,e){var i=t[0].pop();return(!this.getPolygon()||this.getPolygon().intersectsCoordinate(i))&&(this.lastOKCoord=[i[0],i[1]]),t[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),e?e.setCoordinates([t[0].concat([t[0][0]])]):e=new Ei(t),e}},Ek=class extends Is{constructor(t){t=t||{},t.interactions=t.interactions||{},super({className:(t.className?t.className+" ":"")+"ol-editbar",toggleOne:!0,target:t.target}),this._source=t.source,this._interactions={},this._setSelectInteraction(t),t.edition!==!1&&this._setEditInteraction(t),this._setModifyInteraction(t)}setMap(t){this.getMap()&&(this._interactions.Delete&&this.getMap().removeInteraction(this._interactions.Delete),this._interactions.ModifySelect&&this.getMap().removeInteraction(this._interactions.ModifySelect)),super.setMap(t),this.getMap()&&(this._interactions.Delete&&this.getMap().addInteraction(this._interactions.Delete),this._interactions.ModifySelect&&this.getMap().addInteraction(this._interactions.ModifySelect))}getInteraction(t){return this._interactions[t]}_getTitle(t){if(t)return t.get?t.get("title"):typeof t=="string"?t:t.title}_setSelectInteraction(t){var e=this,i=new Is,r;if(t.interactions.Delete!==!1){t.interactions.Delete instanceof mv?this._interactions.Delete=t.interactions.Delete:this._interactions.Delete=new mv;var s=this._interactions.Delete;s.setActive(!1),this.getMap()&&this.getMap().addInteraction(s),i.addControl(new jh({className:"ol-delete",title:this._getTitle(t.interactions.Delete)||"Delete",name:"Delete",handleClick:function(o){s.delete(r.getInteraction().getFeatures());var l={type:"select",selected:[],deselected:r.getInteraction().getFeatures().getArray().slice(),mapBrowserEvent:o.mapBrowserEvent};r.getInteraction().getFeatures().clear(),r.getInteraction().dispatchEvent(l)}}))}if(t.interactions.Info!==!1&&i.addControl(new jh({className:"ol-info",name:"Info",title:this._getTitle(t.interactions.Info)||"Show informations",handleClick:function(){e.dispatchEvent({type:"info",features:r.getInteraction().getFeatures()})}})),t.interactions.Select!==!1){t.interactions.Select instanceof La?this._interactions.Select=t.interactions.Select:this._interactions.Select=new La({condition:ZS});var a=this._interactions.Select;r=new Fn({className:"ol-selection",name:"Select",title:this._getTitle(t.interactions.Select)||"Select",interaction:a,bar:i.getControls().length?i:void 0,autoActivate:!0,active:!0}),this.addControl(r),a.on("change:active",function(){a.getActive()||a.getFeatures().clear()})}}_setEditInteraction(t){if(t.interactions.DrawPoint!==!1){t.interactions.DrawPoint instanceof io?this._interactions.DrawPoint=t.interactions.DrawPoint:this._interactions.DrawPoint=new io({type:"Point",source:this._source});var e=new Fn({className:"ol-drawpoint",name:"DrawPoint",title:this._getTitle(t.interactions.DrawPoint)||"Point",interaction:this._interactions.DrawPoint});this.addControl(e)}if(t.interactions.DrawLine!==!1){t.interactions.DrawLine instanceof io?this._interactions.DrawLine=t.interactions.DrawLine:this._interactions.DrawLine=new io({type:"LineString",source:this._source,geometryFunction:function(u,d){return d?d.setCoordinates(u):d=new wi(u),this.nbpts=d.getCoordinates().length,d}});var i=new Fn({className:"ol-drawline",title:this._getTitle(t.interactions.DrawLine)||"LineString",name:"DrawLine",interaction:this._interactions.DrawLine,bar:new Is({controls:[new ro({html:this._getTitle(t.interactions.UndoDraw)||"undo",title:this._getTitle(t.interactions.UndoDraw)||"delete last point",handleClick:function(){i.getInteraction().nbpts>1&&i.getInteraction().removeLastPoint()}}),new ro({html:this._getTitle(t.interactions.FinishDraw)||"finish",title:this._getTitle(t.interactions.FinishDraw)||"finish",handleClick:function(){i.getInteraction().nbpts>2&&i.getInteraction().finishDrawing()}})]})});this.addControl(i)}if(t.interactions.DrawPolygon!==!1&&(t.interactions.DrawPolygon instanceof io?this._interactions.DrawPolygon=t.interactions.DrawPolygon:this._interactions.DrawPolygon=new io({type:"Polygon",source:this._source,geometryFunction:function(u,d){return this.nbpts=u[0].length,d?d.setCoordinates([u[0].concat([u[0][0]])]):d=new Ei(u),d}}),this._setDrawPolygon("ol-drawpolygon",this._interactions.DrawPolygon,this._getTitle(t.interactions.DrawPolygon)||"Polygon","DrawPolygon",t)),t.interactions.DrawHole!==!1&&(t.interactions.DrawHole instanceof xv?this._interactions.DrawHole=t.interactions.DrawHole:this._interactions.DrawHole=new xv,this._setDrawPolygon("ol-drawhole",this._interactions.DrawHole,this._getTitle(t.interactions.DrawHole)||"Hole","DrawHole",t)),t.interactions.DrawRegular!==!1){var r={pts:"pts",circle:"circle"};t.interactions.DrawRegular instanceof jp?(this._interactions.DrawRegular=t.interactions.DrawRegular,r.pts=this._interactions.DrawRegular.get("ptsLabel")||r.pts,r.circle=this._interactions.DrawRegular.get("circleLabel")||r.circle):(this._interactions.DrawRegular=new jp({source:this._source,sides:4}),t.interactions.DrawRegular&&(r.pts=t.interactions.DrawRegular.ptsLabel||r.pts,r.circle=t.interactions.DrawRegular.circleLabel||r.circle));var s=this._interactions.DrawRegular,a=document.createElement("DIV"),o=X.create("DIV",{parent:a});X.addListener(o,["click","touchstart"],(function(){var u=s.getSides()-1;u<2&&(u=2),s.setSides(u),l.textContent=u>2?u+" "+r.pts:r.circle}).bind(this));var l=X.create("TEXT",{html:"4 "+r.pts,parent:a}),h=X.create("DIV",{parent:a});X.addListener(h,["click","touchstart"],(function(){var u=s.getSides()+1;u<3&&(u=3),s.setSides(u),l.textContent=u+" "+r.pts}).bind(this));var c=new Fn({className:"ol-drawregular",title:this._getTitle(t.interactions.DrawRegular)||"Regular",name:"DrawRegular",interaction:this._interactions.DrawRegular,bar:new Is({controls:[new ro({html:a})]})});this.addControl(c)}}_setDrawPolygon(t,e,i,r,s){var a=new Fn({className:t,name:r,title:i,interaction:e,bar:new Is({controls:[new ro({html:this._getTitle(s.interactions.UndoDraw)||"undo",title:this._getTitle(s.interactions.UndoDraw)||"undo last point",handleClick:function(){a.getInteraction().nbpts>1&&a.getInteraction().removeLastPoint()}}),new ro({html:this._getTitle(s.interactions.FinishDraw)||"finish",title:this._getTitle(s.interactions.FinishDraw)||"finish",handleClick:function(){a.getInteraction().nbpts>3&&a.getInteraction().finishDrawing()}})]})});return this.addControl(a),a}_setModifyInteraction(t){if(t.interactions.ModifySelect!==!1&&t.interactions.Select!==!1&&(t.interactions.ModifySelect instanceof wv?this._interactions.ModifySelect=t.interactions.ModifySelect:this._interactions.ModifySelect=new wv({features:this.getInteraction("Select").getFeatures()}),this.getMap()&&this.getMap().addInteraction(this._interactions.ModifySelect),this._interactions.ModifySelect.setActive(this._interactions.Select.getActive()),this._interactions.Select.on("change:active",(function(){this._interactions.ModifySelect.setActive(this._interactions.Select.getActive())}).bind(this))),t.interactions.Transform!==!1){t.interactions.Transform instanceof Gp?this._interactions.Transform=t.interactions.Transform:this._interactions.Transform=new Gp({addCondition:Pu});var e=new Fn({html:"<i></i>",className:"ol-transform",title:this._getTitle(t.interactions.Transform)||"Transform",name:"Transform",interaction:this._interactions.Transform});this.addControl(e)}if(t.interactions.Split!==!1){t.interactions.Split instanceof vv?this._interactions.Split=t.interactions.Split:this._interactions.Split=new vv({sources:this._source});var i=new Fn({className:"ol-split",title:this._getTitle(t.interactions.Split)||"Split",name:"Split",interaction:this._interactions.Split});this.addControl(i)}if(t.interactions.Offset!==!1){t.interactions.Offset instanceof yv?this._interactions.Offset=t.interactions.Offset:this._interactions.Offset=new yv({source:this._source});var r=new Fn({html:"<i></i>",className:"ol-offset",title:this._getTitle(t.interactions.Offset)||"Offset",name:"Offset",interaction:this._interactions.Offset});this.addControl(r)}}},Sk=class extends Ng{constructor(t){t=t||{};var e=document.createElement("div");t.element=e,super(t),typeof t.offsetBox=="number"?this.offsetBox=[t.offsetBox,t.offsetBox,t.offsetBox,t.offsetBox]:this.offsetBox=t.offsetBox,this.closeBox=t.closeBox,this.onclose=t.onclose,this.onshow=t.onshow,X.create("BUTTON",{className:"closeBox"+(t.closeBox?" hasclosebox":""),type:"button",click:(function(){this.hide()}).bind(this),parent:e}),t.anchor!==!1&&X.create("DIV",{className:"anchor",parent:e}),this.content=X.create("DIV",{html:t.html||"",className:"ol-popup-content",parent:e}),t.minibar&&X.scrollDiv(this.content,{vertical:!0,mousewheel:!0,minibar:!0}),t.stopEvent&&(e.addEventListener("mousedown",function(i){i.stopPropagation()}),e.addEventListener("touchstart",function(i){i.stopPropagation()})),this._elt=e,this.setPositioning(t.positioning||"auto"),this.setPopupClass(t.popupClass||t.className||"default"),t.anim&&this.addPopupClass("anim"),t.position&&setTimeout((function(){this.show(t.position)}).bind(this))}getClassPositioning(){var t="",e=this.getPositioning();return/bottom/.test(e)&&(t+="ol-popup-bottom "),/top/.test(e)&&(t+="ol-popup-top "),/left/.test(e)&&(t+="ol-popup-left "),/right/.test(e)&&(t+="ol-popup-right "),/^center/.test(e)&&(t+="ol-popup-middle "),/center$/.test(e)&&(t+="ol-popup-center "),t}setClosebox(t){this.closeBox=t,t?this.element.classList.add("hasclosebox"):this.element.classList.remove("hasclosebox")}setPopupClass(t){var e=["ol-popup"];this.getVisible()&&e.push("visible"),this.element.className="";var i=this.getClassPositioning().split(" ").filter(function(r){return r.length>0});t?t.split(" ").filter(function(r){return r.length>0}).forEach(function(r){e.push(r)}):e.push("default"),i.forEach(function(r){e.push(r)}),this.closeBox&&e.push("hasclosebox"),this.element.classList.add.apply(this.element.classList,e)}addPopupClass(t){this.element.classList.add(t)}removePopupClass(t){this.element.classList.remove(t)}setPositioning(t){t!==void 0&&(/auto/.test(t)?(this.autoPositioning=t.split("-"),this.autoPositioning.length==1&&(this.autoPositioning[1]="auto")):this.autoPositioning=!1,t=t.replace(/auto/g,"center"),t=="center"&&(t="bottom-center"),this.setPositioning_(t))}setPositioning_(t){if(this.element){super.setPositioning(t),this.element.classList.remove("ol-popup-top","ol-popup-bottom","ol-popup-left","ol-popup-right","ol-popup-center","ol-popup-middle");var e=this.getClassPositioning().split(" ").filter(function(i){return i.length>0});this.element.classList.add.apply(this.element.classList,e)}}getVisible(){return this.element.classList.contains("visible")}show(t,e){!e&&typeof t=="string"&&(e=t,t=null),t===!0&&(t=this.getPosition());var i=this,r=this.getMap();if(r&&(e&&e!==this.prevHTML&&(this.prevHTML=e,this.content.innerHTML="",e instanceof Element?this.content.appendChild(e):X.create("DIV",{html:e,parent:this.content}),Array.prototype.slice.call(this.content.querySelectorAll("img")).forEach(function(l){l.addEventListener("load",function(){try{r.renderSync()}catch{}i.content.dispatchEvent(new Event("scroll"))})})),t)){if(this.autoPositioning){var s=r.getPixelFromCoordinate(t),a=r.getSize(),o=[];this.autoPositioning[0]=="auto"?o[0]=s[1]<a[1]/3?"top":"bottom":o[0]=this.autoPositioning[0],o[1]=s[0]<2*a[0]/3?"left":"right",this.setPositioning_(o[0]+"-"+o[1]),this.offsetBox&&this.setOffset([this.offsetBox[o[1]=="left"?2:0],this.offsetBox[o[0]=="top"?3:1]])}else this.offsetBox&&this.setOffset(this.offsetBox);this.setPosition(t),this.element.parentElement.style.display="",typeof this.onshow=="function"&&this.onshow(),this.dispatchEvent({type:"show"}),this._tout=setTimeout(function(){i.element.classList.add("visible")},0)}}hide(){this.getPosition()!=null&&(typeof this.onclose=="function"&&this.onclose(),this.setPosition(void 0),this._tout&&clearTimeout(this._tout),this.element.classList.remove("visible"),this.dispatchEvent({type:"hide"}))}},Lk=class extends Sk{constructor(t){t=t||{},t.popupClass=t.popupClass||t.className||"tooltips black",t.positioning=t.positioning||"center-left",t.stopEvent=!!t.stopEvent,super(t),this.set("maximumFractionDigits",t.maximumFractionDigits||2),typeof t.formatLength=="function"&&(this.formatLength=t.formatLength),typeof t.formatArea=="function"&&(this.formatArea=t.formatArea),typeof t.getHTML=="function"&&(this.getHTML=t.getHTML),this._interaction=new _s({handleEvent:(function(e){if(e.type==="pointermove"||e.type==="click"){var i=this.getHTML(this._feature,this.get("info"));i?this.show(e.coordinate,i):this.hide(),this._coord=e.coordinate}return!0}).bind(this)})}setMap(t){this.getMap()&&this.getMap().removeInteraction(this._interaction),super.setMap(t),this.getMap()&&this.getMap().addInteraction(this._interaction)}getHTML(t,e){return this.get("measure")?this.get("measure")+(e?"<br/>"+e:""):e||""}setInfo(t){t?setTimeout((function(){this.set("info",t),this.show(this._coord,this.get("info"))}).bind(this)):(this.set("info",""),this.hide())}removeFeature(){this.setFeature()}formatArea(t){return t>Math.pow(10,-1*this.get("maximumFractionDigits"))?t>1e4?(t/1e6).toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits)")})+" km":t.toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits")})+" m":""}formatLength(t){return t>Math.pow(10,-1*this.get("maximumFractionDigits"))?t>100?(t/1e3).toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits")})+" km":t.toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits")})+" m":""}setFeature(t){t&&t.feature&&(t=t.feature),this._feature=t,this._listener&&this._listener.forEach(function(e){Lr(e)}),this._listener=[],this.set("measure",""),t&&this._listener.push(t.getGeometry().on("change",(function(e){var i=e.target,r;i.getArea?r=this.formatArea(gg(i,{projection:this.getMap().getView().getProjection()})):i.getLength&&(r=this.formatLength(dg(i,{projection:this.getMap().getView().getProjection()}))),this.set("measure",r)}).bind(this)))}},Ck=class extends sn{constructor(t){t=t||{};var e=document.createElement("DIV");super({element:e,target:t.target}),this.contentElement=X.create("DIV",{click:(function(){this.get("hideOnClick")&&this.hide()}).bind(this),parent:e});var i=(t.className||"")+" ol-notification";t.target||(i+=" ol-unselectable ol-control ol-collapsed"),e.setAttribute("class",i),this.set("closeBox",t.closeBox),this.set("hideOnClick",t.hideOnClick)}show(t,e){var i=this,r=this.element;t&&(t instanceof Node?(this.contentElement.innerHTML="",this.contentElement.appendChild(t)):this.contentElement.innerHTML=t,this.get("closeBox")?(this.contentElement.classList.add("ol-close"),X.create("SPAN",{className:"closeBox",click:(function(){this.hide()}).bind(this),parent:this.contentElement})):this.contentElement.classList.remove("ol-close")),this._listener&&(clearTimeout(this._listener),this._listener=null),r.classList.add("ol-collapsed"),this._listener=setTimeout(function(){r.classList.remove("ol-collapsed"),!e||e>=0?i._listener=setTimeout(function(){r.classList.add("ol-collapsed"),i._listener=null},e||3e3):i._listener=null},100)}hide(){this._listener&&(clearTimeout(this._listener),this._listener=null),this.element.classList.add("ol-collapsed")}toggle(t){this.element.classList.contains("ol-collapsed")?this.show(null,t):this.hide()}},zx=class extends sn{constructor(t){t=t||{};var e=X.create("DIV",{className:t.switcherClass||"ol-layerswitcher"});super({element:e,target:t.target});var i=this;this.dcount=0,this.show_progress=t.show_progress,this.oninfo=typeof t.oninfo=="function"?t.oninfo:null,this.onextent=typeof t.onextent=="function"?t.onextent:null,this.hasextent=t.extent||t.onextent,this.hastrash=t.trash,this.reordering=t.reordering!==!1,this._layers=[],this._layerGroup=t.layerGroup&&t.layerGroup.getLayers?t.layerGroup:null,this.onchangeCheck=typeof t.onchangeCheck=="function"?t.onchangeCheck:null,typeof t.displayInLayerSwitcher=="function"&&(this.displayInLayerSwitcher=t.displayInLayerSwitcher),t.target||(e.classList.add("ol-unselectable"),e.classList.add("ol-control"),e.classList.add(t.collapsed!==!1?"ol-collapsed":"ol-forceopen"),this.button=X.create("BUTTON",{type:"button",parent:e}),this.button.addEventListener("touchstart",function(r){e.classList.toggle("ol-forceopen"),e.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:e.classList.contains("ol-collapsed")}),r.preventDefault(),i.overflow()}),this.button.addEventListener("click",function(){e.classList.toggle("ol-forceopen"),e.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!e.classList.contains("ol-forceopen")}),i.overflow()}),t.mouseover&&(e.addEventListener("mouseleave",function(){e.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!0})}),e.addEventListener("mouseover",function(){e.classList.remove("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!1})})),t.minibar&&(t.noScroll=!0),t.noScroll||(this.topv=X.create("DIV",{className:"ol-switchertopdiv",parent:e,click:function(){i.overflow("+50%")}}),this.botv=X.create("DIV",{className:"ol-switcherbottomdiv",parent:e,click:function(){i.overflow("-50%")}})),this._noScroll=t.noScroll),this.panel_=X.create("UL",{className:"panel"}),this.panelContainer_=X.create("DIV",{className:"panel-container",html:this.panel_,parent:e}),!t.target&&!t.noScroll&&X.addListener(this.panel_,"mousewheel DOMMouseScroll onmousewheel",function(r){i.overflow(Math.max(-1,Math.min(1,r.wheelDelta||-r.detail)))&&(r.stopPropagation(),r.preventDefault())}),this.header_=X.create("LI",{className:"ol-header",parent:this.panel_}),this.set("drawDelay",t.drawDelay||0),this.set("selection",t.selection),t.minibar&&setTimeout((function(){var r=X.scrollDiv(this.panelContainer_,{mousewheel:!0,vertical:!0,minibar:!0});this.on(["drawlist","toggle"],function(){r.refresh()})}).bind(this))}displayInLayerSwitcher(t){return t.get("displayInLayerSwitcher")!==!1}setMap(t){if(super.setMap(t),this.drawPanel(),this._listener)for(var e in this._listener)Lr(this._listener[e]);this._listener=null,t&&(this._listener={moveend:t.on("moveend",this.viewChange.bind(this)),size:t.on("change:size",this.overflow.bind(this))},this._layerGroup?this._listener.change=this._layerGroup.getLayers().on("change:length",this.drawPanel.bind(this)):this._listener.change=t.getLayerGroup().getLayers().on("change:length",this.drawPanel.bind(this)))}show(){this.element.classList.add("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!1})}hide(){this.element.classList.remove("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!0})}toggle(){this.element.classList.toggle("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!this.isOpen()})}isOpen(){return this.element.classList.contains("ol-forceopen")}setHeader(t){X.setHTML(this.header_,t)}overflow(t){if(this.button&&!this._noScroll){if(X.hidden(this.panel_)){X.setStyle(this.element,{height:"auto"});return}var e=X.outerHeight(this.element),i=X.outerHeight(this.panel_),r=this.button.offsetTop+X.outerHeight(this.button),s=this.panel_.offsetTop-r;if(i>e-r){X.setStyle(this.element,{height:"100%"});var a=this.panel_.querySelectorAll("li.ol-visible .li-content")[0],o=a?2*X.getStyle(a,"height"):0;switch(t){case 1:s+=o;break;case-1:s-=o;break;case"+50%":s+=Math.round(e/2);break;case"-50%":s-=Math.round(e/2);break}return s+i<=e-3*r/2?(s=e-3*r/2-i,X.hide(this.botv)):X.show(this.botv),s>=0?(s=0,X.hide(this.topv)):X.show(this.topv),X.setStyle(this.panel_,{top:s+"px"}),!0}else return X.setStyle(this.element,{height:"auto"}),X.setStyle(this.panel_,{top:0}),X.hide(this.botv),X.hide(this.topv),!1}else return!1}_setLayerForLI(t,e){var i=[];e.getLayers&&i.push(e.getLayers().on("change:length",this.drawPanel.bind(this))),t&&(i.push(e.on("change:opacity",(function(){this.setLayerOpacity(e,t)}).bind(this))),i.push(e.on("change:visible",(function(){this.setLayerVisibility(e,t)}).bind(this)))),i.push(e.on("propertychange",(function(r){(r.key==="displayInLayerSwitcher"||r.key==="openInLayerSwitcher"||r.key==="title"||r.key==="name")&&this.drawPanel(r)}).bind(this))),this._layers.push({li:t,layer:e,listeners:i})}setLayerOpacity(t,e){var i=e.querySelector(".layerswitcher-opacity-cursor");i&&(i.style.left=t.getOpacity()*100+"%"),this.dispatchEvent({type:"layer:opacity",layer:t})}setLayerVisibility(t,e){var i=e.querySelector(".ol-visibility");i&&(i.checked=t.getVisible()),t.getVisible()?e.classList.add("ol-visible"):e.classList.remove("ol-visible"),this.dispatchEvent({type:"layer:visible",layer:t})}_clearLayerForLI(){this._layers.forEach(function(t){t.listeners.forEach(function(e){Lr(e)})}),this._layers=[]}_getLayerForLI(t){for(var e=0,i;i=this._layers[e];e++)if(i.li===t)return i.layer;return null}viewChange(){this.panel_.querySelectorAll("li").forEach((function(t){var e=this._getLayerForLI(t);e&&(this.testLayerVisibility(e)?t.classList.remove("ol-layer-hidden"):t.classList.add("ol-layer-hidden"))}).bind(this))}getPanel(){return this.panelContainer_}drawPanel(){if(this.getMap()){var t=this;this.dcount++,setTimeout(function(){t.drawPanel_()},this.get("drawDelay")||0)}}drawPanel_(){if(!(--this.dcount||this.dragging_)){var t=this.panelContainer_.scrollTop;this._clearLayerForLI(),this.panel_.querySelectorAll("li").forEach((function(e){e.classList.contains("ol-header")||e.remove()}).bind(this)),this._layerGroup?this.drawList(this.panel_,this._layerGroup.getLayers()):this.getMap()&&this.drawList(this.panel_,this.getMap().getLayers()),this.panelContainer_.scrollTop=t}}switchLayerVisibility(t,e){t.get("baseLayer")?(t.getVisible()||t.setVisible(!0),e.forEach(function(i){t!==i&&i.get("baseLayer")&&i.getVisible()&&i.setVisible(!1)})):t.setVisible(!t.getVisible())}testLayerVisibility(t){if(!this.getMap())return!0;var e=this.getMap().getView().getResolution(),i=this.getMap().getView().getZoom();if(t.getMaxResolution()<=e||t.getMinResolution()>=e)return!1;if(t.getMinZoom&&(t.getMinZoom()>=i||t.getMaxZoom()<i))return!1;var r=t.getExtent();if(r){var s=this.getMap().getView().calculateExtent(this.getMap().getSize());return ki(s,r)}return!0}dragOrdering_(t){t.stopPropagation(),t.preventDefault();var e=this,i=t.currentTarget.parentNode.parentNode,r=!0,s=this.panel_,a,o=t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageY,l,h,c,u;i.parentNode.classList.add("drag");function d(){if(l){var p=c,y=e.getSelection()===p;if(p&&l){var w;u?w=u.getLayers():w=e._layerGroup?e._layerGroup.getLayers():e.getMap().getLayers();for(var x=w.getArray(),b=0;b<x.length;b++)if(x[b]==p){w.removeAt(b);break}for(var L=0;L<x.length;L++)if(x[L]===l){b>L?w.insertAt(L,p):w.insertAt(L+1,p);break}}y&&e.selectLayer(p),e.dispatchEvent({type:"reorder-end",layer:p,group:u})}i.parentNode.querySelectorAll("li").forEach(function(P){P.classList.remove("dropover"),P.classList.remove("dropover-after"),P.classList.remove("dropover-before")}),i.classList.remove("drag"),i.parentNode.classList.remove("drag"),e.element.classList.remove("drag"),h&&h.remove(),X.removeListener(document,"mousemove touchmove",g),X.removeListener(document,"mouseup touchend touchcancel",d)}function g(p){if(a=p.pageY||p.touches&&p.touches.length&&p.touches[0].pageY||p.changedTouches&&p.changedTouches.length&&p.changedTouches[0].pageY,r&&Math.abs(o-a)>2&&(r=!1,i.classList.add("drag"),c=e._getLayerForLI(i),l=!1,u=e._getLayerForLI(i.parentNode.parentNode),h=X.create("LI",{className:"ol-dragover",html:i.innerHTML,style:{position:"absolute","z-index":1e4,left:i.offsetLeft,opacity:.5,width:X.outerWidth(i),height:X.getStyle(i,"height")},parent:s}),e.element.classList.add("drag"),e.dispatchEvent({type:"reorder-start",layer:c,group:u})),!r){p.preventDefault(),p.stopPropagation(),X.setStyle(h,{top:a-X.offsetRect(s).top+s.scrollTop+5});var y;for(p.touches?y=document.elementFromPoint(p.touches[0].clientX,p.touches[0].clientY):y=p.target,y.classList.contains("ol-switcherbottomdiv")?e.overflow(-1):y.classList.contains("ol-switchertopdiv")&&e.overflow(1);y&&y.tagName!=="LI";)y=y.parentNode;(!y||!y.classList.contains("dropover"))&&i.parentNode.querySelectorAll("li").forEach(function(w){w.classList.remove("dropover"),w.classList.remove("dropover-after"),w.classList.remove("dropover-before")}),y&&y.parentNode.classList.contains("drag")&&y!==i?(l=e._getLayerForLI(y),l&&!l.get("allwaysOnTop")==!c.get("allwaysOnTop")?(y.classList.add("dropover"),y.classList.add(i.offsetTop<y.offsetTop?"dropover-after":"dropover-before")):l=!1,X.show(h)):(l=!1,y===i?X.hide(h):X.show(h)),l?h.classList.remove("forbidden"):h.classList.add("forbidden")}}X.addListener(document,"mousemove touchmove",g),X.addListener(document,"mouseup touchend touchcancel",d)}dragOpacity_(t){t.stopPropagation(),t.preventDefault();var e=this,i=t.target,r=this._getLayerForLI(i.parentNode.parentNode.parentNode);if(!r)return;var s=t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageX,a=X.getStyle(i,"left")-s;e.dragging_=!0;function o(){X.removeListener(document,"mouseup touchend touchcancel",o),X.removeListener(document,"mousemove touchmove",l),e.dragging_=!1}function l(h){var c=h.pageX||h.touches&&h.touches.length&&h.touches[0].pageX||h.changedTouches&&h.changedTouches.length&&h.changedTouches[0].pageX,u=(a+c)/X.getStyle(i.parentNode,"width"),d=Math.max(0,Math.min(1,u));X.setStyle(i,{left:d*100+"%"}),i.parentNode.nextElementSibling.innerHTML=Math.round(d*100),r.setOpacity(d)}X.addListener(document,"mouseup touchend touchcancel",o),X.addListener(document,"mousemove touchmove",l)}drawList(t,e){var i=this,r=e.getArray(),s=function(u){u.stopPropagation(),u.preventDefault();var d=i._getLayerForLI(this.parentNode.parentNode);i.switchLayerVisibility(d,e),i.get("selection")&&d.getVisible()&&i.selectLayer(d),i.onchangeCheck&&i.onchangeCheck(d)};function a(u){u.stopPropagation(),u.preventDefault();var d=i._getLayerForLI(this.parentNode.parentNode);i.oninfo(d),i.dispatchEvent({type:"info",layer:d})}function o(u){u.stopPropagation(),u.preventDefault();var d=i._getLayerForLI(this.parentNode.parentNode);i.onextent?i.onextent(d):i.getMap().getView().fit(d.getExtent(),i.getMap().getSize()),i.dispatchEvent({type:"extent",layer:d})}function l(u){u.stopPropagation(),u.preventDefault();var d=this.parentNode.parentNode.parentNode.parentNode,g,p=i._getLayerForLI(d);p?(g=i._getLayerForLI(this.parentNode.parentNode),p.getLayers().remove(g),p.getLayers().getLength()==0&&!p.get("noSwitcherDelete")&&l.call(d.querySelectorAll(".layerTrash")[0],u)):(d=this.parentNode.parentNode,i.getMap().removeLayer(i._getLayerForLI(d)))}function h(u){if(!this.displayInLayerSwitcher(u)){this._setLayerForLI(null,u);return}var d=X.create("LI",{className:(u.getVisible()?"ol-visible ":" ")+(u.get("baseLayer")?"baselayer":""),parent:t});this._setLayerForLI(d,u),this._selectedLayer===u&&d.classList.add("ol-layer-select");var g=X.create("DIV",{className:"ol-layerswitcher-buttons",parent:d}),p=X.create("DIV",{className:"li-content",parent:d});X.create("INPUT",{type:u.get("baseLayer")?"radio":"checkbox",className:"ol-visibility",checked:u.getVisible(),click:s,parent:p});var y=X.create("LABEL",{title:u.get("title")||u.get("name"),click:s,style:{userSelect:"none"},parent:p});if(y.addEventListener("selectstart",function(){return!1}),X.create("SPAN",{html:u.get("title")||u.get("name"),click:(function(R){this.get("selection")&&(R.stopPropagation(),this.selectLayer(u))}).bind(this),parent:y}),this.reordering&&(c<r.length-1&&(u.get("allwaysOnTop")||!r[c+1].get("allwaysOnTop"))||c>0&&(!u.get("allwaysOnTop")||r[c-1].get("allwaysOnTop")))&&X.create("DIV",{className:"layerup ol-noscroll",title:this.tip.up,on:{"mousedown touchstart":function(R){i.dragOrdering_(R)}},parent:g}),u.getLayers){var w=0;u.getLayers().forEach(function(R){i.displayInLayerSwitcher(R)&&w++}),w&&X.create("DIV",{className:u.get("openInLayerSwitcher")?"collapse-layers":"expend-layers",title:this.tip.plus,click:function(){var R=i._getLayerForLI(this.parentNode.parentNode);R.set("openInLayerSwitcher",!R.get("openInLayerSwitcher"))},parent:g})}if(this.oninfo&&X.create("DIV",{className:"layerInfo",title:this.tip.info,click:a,parent:g}),this.hastrash&&!u.get("noSwitcherDelete")&&X.create("DIV",{className:"layerTrash",title:this.tip.trash,click:l,parent:g}),this.hasextent&&r[c].getExtent()){var x=r[c].getExtent();x.length==4&&x[0]<x[2]&&x[1]<x[3]&&X.create("DIV",{className:"layerExtent",title:this.tip.extent,click:o,parent:g})}if(this.show_progress&&u instanceof Xe){var b=X.create("DIV",{className:"layerswitcher-progress",parent:p});this.setprogress_(u),u.layerswitcher_progress=X.create("DIV",{parent:b})}var L=X.create("DIV",{className:"layerswitcher-opacity",click:function(R){if(R.target===this){R.stopPropagation(),R.preventDefault();var j=Math.max(0,Math.min(1,R.offsetX/X.getStyle(this,"width")));i._getLayerForLI(this.parentNode.parentNode).setOpacity(j),this.parentNode.querySelectorAll(".layerswitcher-opacity-label")[0].innerHTML=Math.round(j*100)}},parent:p});if(X.create("DIV",{className:"layerswitcher-opacity-cursor ol-noscroll",style:{left:u.getOpacity()*100+"%"},on:{"mousedown touchstart":function(R){i.dragOpacity_(R)}},parent:L}),X.create("DIV",{className:"layerswitcher-opacity-label",html:Math.round(u.getOpacity()*100),parent:p}),u.getLayers&&(d.classList.add("ol-layer-group"),u.get("openInLayerSwitcher")===!0)){var P=X.create("UL",{parent:d});this.drawList(P,u.getLayers())}d.classList.add(this.getLayerClass(u)),this.dispatchEvent({type:"drawlist",layer:u,li:d})}for(var c=r.length-1;c>=0;c--)h.call(this,r[c]);this.viewChange(),t===this.panel_&&this.overflow()}getLayerClass(t){return t?t.getLayers?"ol-layer-group":t instanceof Ge?"ol-layer-vector":t instanceof dR?"ol-layer-vectortile":t instanceof Xe?"ol-layer-tile":t instanceof hP?"ol-layer-image":t instanceof hR?"ol-layer-heatmap":t.getFeatures?"ol-layer-vectorimage":"unknown":"none"}selectLayer(t,e){if(!t){if(!this.getMap())return;t=this.getMap().getLayers().item(this.getMap().getLayers().getLength()-1)}this._selectedLayer=t,this.drawPanel(),e||this.dispatchEvent({type:"select",layer:t})}getSelection(){return this._selectedLayer}setprogress_(t){if(!t.layerswitcher_progress){var e=0,i=0,r=function(){i===e?(i=e=0,X.setStyle(t.layerswitcher_progress,{width:0})):X.setStyle(t.layerswitcher_progress,{width:(e/i*100).toFixed(1)+"%"})};t.getSource().on("tileloadstart",function(){i++,r()}),t.getSource().on("tileloadend",function(){e++,r()}),t.getSource().on("tileloaderror",function(){e++,r()})}}};zx.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",plus:"expand/shrink"};const Ak=new Zt({image:new vn({src:"./data/sle.svg",scale:.9})}),Tk=new Zt({image:new vn({src:"./data/weh.svg",scale:.9})}),Mk=new Zt({image:new vn({src:"./data/bru_nlwkn.svg",scale:.9})}),Pk=new Zt({image:new vn({src:"./data/bru_andere.svg",scale:.9})}),Rk=new Zt({image:new vn({src:"./data/due.svg",scale:.9})}),Ik=new Zt({image:new vn({src:"./data/que.svg",scale:.9})}),qx=new Zt({stroke:new fe({color:"rgba(173, 114, 3, 1)",width:3})}),Nk=new Zt({stroke:new fe({color:"rgba(173, 114, 3, 1)",width:3})});function Fk(n){const t=n.get("Massn_ID");let e;switch(t){case 3:case 4:case 5:e="blue";break;case 6:case 7:case 8:case 9:case 10:e="black";break;case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 26:case 27:e="green";break;case 22:case 23:e="rgba(255, 190, 190, 0.5)";break;case 24:case 50:case 2:e="rgba(230, 152, 0, 0.5)";break;case 200:case 201:e="rgba(205, 205, 205, 1)";break;case 300:e="rgba(230, 230, 0, 0.5)";break;case 400:e="rgba(130, 130, 130, 1)";break;default:e="grey"}return new Zt({stroke:new fe({color:e,width:5})})}function kk(n){const t=n.get("Kat"),e=n.get("IDUabschn");let i,r=[10,15];return t==="E"?i="green":i="red",[new Zt({stroke:new fe({color:i,width:5,lineDash:r}),fill:new Ne({color:i})}),new Zt({geometry:function(s){const a=s.getGeometry().getCoordinates();return new Nu([a[0],a[a.length-1]])},image:new fr({radius:5,fill:new Ne({color:"black"})})}),new Zt({text:new Sr({text:e,font:"bold 14px Arial",fill:new Ne({color:"#000"}),stroke:new fe({color:"#fff",width:3}),overflow:!0,placement:"point",rotation:0})})]}function Ok(n){const t=n.get("bauart");let e,i,r;return t==="Anlegehilfe"?(e="blue",i=5):/sohlgl|umgehungs|fisch/i.test(t)?(e="red",i=5,r=[10,15]):/fu|rad/i.test(t)?(e="olive",i=5,r=[20,10]):/bio/i.test(t)?(e="green",i=5,r=[17.5,10]):/strasse|Strae/i.test(t)?(e="Black",i=5,r=[12.5,10]):(e="blue",i=5,r=void 0),new Zt({fill:new Ne({color:e}),stroke:new fe({color:e,width:i,lineDash:r})})}function Dk(n){const t=n.get("Ein_ord");let e;switch(t){case"1. Ordnung":e="./data/einErsterOrdnung.svg";break;case"2. Ordnung":e="./data/einZweiterOrdnung.svg";break;case"3. Ordnung":e="./data/einDritterOrdnung.svg";break;case"Einleitung":e="./data/einEinleitung.svg";break;case"Sonstige":e="./data/einSonstige.svg";break;default:e="./data/einSonstige.svg"}return new Zt({image:new vn({src:e,scale:.9})})}function Bk(n){const t=n.get("bauart");let e;return/boots/i.test(t)?e="./data/bwSonPun_Anleger.svg":/betriebs/i.test(t)?e="./data/sonPunBetrieb.svg":/steg/i.test(t)?e="./data/bwSonPun_Anleger.svg":t==="Infotafel"?e="./data/sonPunInfo.svg":t==="Auskolkung"?e="./data/sonPunKolk.svg":t==="Furt"?e="./data/bwSonPun_Furt.svg":t==="Tor"?e="./data/bwSonPun_Tor.svg":t==="berfahrt"?e="./data/bwSonPun_Ueberfahrt.svg":t==="Betriebspegel"?e="./data/bwSonPun_Betriebspegel.svg":e="./data/sonPunSonstige.svg",new Zt({image:new vn({src:e,scale:.9})})}function Gk(n){const t=n.get("Art");let e,i;switch(t){case"p":e="rgba(200, 200, 200, .6)",i="black";break;case"o":e="rgba(255, 220, 220, .6)",i="black";break;case"l":e="rgba(255, 190, 150, .6)",i="black";break;default:e="rgba(255, 255, 255, 1)",i="grey"}return new Zt({fill:new Ne({color:e}),stroke:new fe({color:i,width:.5})})}const jk=new Zt({stroke:new fe({color:"grey",width:.5})}),Uk=function(n,t,e){var i=0,r=5,s=t/1e3,a=s.toFixed(2);return e>i&&e<r?new Zt({text:new Sr({text:a.toString(),font:'normal 18px "Arial Light", "Helvetica Neue Light", Arial, sans-serif',offsetX:-20,offsetY:10}),stroke:new fe({color:"black",width:1})}):null},zk=function(n,t,e){var i=0,r=14,s=t/1e3,a=s.toFixed(2);return e>i&&e<r?new Zt({text:new Sr({text:a.toString(),font:'bold 20px "Arial Light", "Helvetica Neue Light", Arial, sans-serif',offsetX:-35,offsetY:10,fill:new Ne({color:"rgba(0, 0, 0, 1)"})}),stroke:new fe({color:"black",width:2})}):null};function qk(n){const t=n.get("Direction")||0;return new Zt({image:new vn({src:"./data/arrow.svg",anchor:[.5,.5],rotateWithView:!0,rotation:Math.PI/180*t-Math.PI/2})})}function Vk(n){const t=n.getGeometry().getType();return t==="Point"||t==="MultiPoint"?new Zt({image:new fr({radius:7,fill:new Ne({color:"red"}),stroke:new fe({color:"black",width:2})})}):t==="LineString"||t==="MultiLineString"?new Zt({stroke:new fe({color:"red",width:4})}):t==="Polygon"||t==="MultiPolygon"?new Zt({fill:new Ne({color:"red"}),stroke:new fe({color:"black",width:3}),opacity:.5}):new Zt}new Zt({geometry:function(n){const t=n.getGeometry().getCoordinates();return new fi(t[t.length-1])},image:new fr({radius:6,fill:new Ne({color:"red"}),stroke:new fe({color:"black",width:2})})});new Zt({fill:new Ne({color:"rgba(0, 0, 255, 0.2)",opacity:.5}),image:new vn({src:"./data/location-heading.svg",imgSize:[27,55],rotateWithView:!0})});function Fc(n,t,e,i){const s=.081819191,a=.9996,o=Math.PI;i||(t-=1e7);let l=(e-1)*6-180+3,h=t/a,c=(1-Math.sqrt(1-s**2))/(1+Math.sqrt(1-s**2)),u=h/(6378137*(1-s**2/4-3*s**4/64-5*s**6/256)),d=u+(3*c/2-27*c**3/32)*Math.sin(2*u)+(21*c**2/16-55*c**4/32)*Math.sin(4*u)+151*c**3/96*Math.sin(6*u),g=6378137/Math.sqrt(1-s**2*Math.sin(d)**2),p=Math.tan(d)**2,y=s**2*Math.cos(d)**2/(1-s**2),w=6378137*(1-s**2)/Math.pow(1-s**2*Math.sin(d)**2,1.5),x=(n-5e5)/(g*a),b=(d-g*Math.tan(d)/w*(x**2/2-(5+3*p+10*y-4*y**2-9*s**2)*x**4/24+(61+90*p+298*y+45*p**2-252*s**2-3*y**2)*x**6/720))*180/o,L=l+(x-(1+2*p+y)*x**3/6+(5-2*y+28*p-3*y**2+8*s**2+24*p**2)*x**5/120)/Math.cos(d)*180/o;return`${b.toFixed(6)},${L.toFixed(6)}`}dr.defs("EPSG:32632","+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs");OR(dr);var $o=!1;const Wk=new m1({collapsible:!0,html:'<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'});function Vx(){It.getOverlays().clear()}const Wx=new kr({center:Zv([7.35,52.7]),zoom:9}),It=new PC({target:"map",view:Wx,controls:p5().extend([new gR,new ER({extent:[727361,6839277,858148,6990951]}),Wk]),interactions:x5().extend([new MR])});var Hx=new Ck({className:"ol-notification",closeBox:!0,closeBoxTitle:"close"});It.addControl(Hx);It.addControl(new dk);It.addControl(new Dx({title:"",visible:!1,style:new Zt({text:new Sr({font:'bold 12pt "Arial",Verdana,Geneva,Lucida,Lucida Grande,Helvetica,sans-serif'})})}));It.addControl(new gk);var qg=new ul({title:"Drucken",lang:"de"});qg.setSize("A4");qg.setOrientation("portrait");qg.on(["print","error"],function(n){if(n.image)if(n.pdf){var t=new oe({orientation:n.print.orientation,unit:n.print.unit,format:n.print.size});t.addImage(n.image,"JPEG",n.print.position[0],n.print.position[1],n.print.imageWidth,n.print.imageHeight),t.save(n.print.legend?"legend.pdf":"map.pdf")}else if(n.canvas.toBlob)n.canvas.toBlob(function(r){var s=(n.print.legend?"legend.":"map.")+n.imageType.replace("image/","");saveAs(r,s)},n.imageType,n.quality);else{var e=n.canvas.toDataURL(n.imageType,n.quality),i=document.createElement("a");i.href=e,i.download=(n.print.legend?"legend.":"map.")+n.imageType.replace("image/",""),document.body.appendChild(i),i.click(),document.body.removeChild(i)}else console.warn("No canvas to export")});const sd=new Fe;let Jl=null,bv=!0,ad=null;document.createElement("div");const Hk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_gew_info_fla.geojson?bbox="+n.join(",")},strategy:an}),title:"Gewsserflchen",name:"exp_gew_fla",style:qx,visible:!1}),$k=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_biotope_noh.geojson?bbox="+n.join(",")},strategy:an}),title:"Biotope_Noh",name:"exp_bw_biotope_noh",style:qx,visible:!1}),Xk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/gehoelz_vec.geojson?bbox="+n.join(",")},strategy:an}),title:"Gehlz(Plan)",name:"gehoelz_vec",style:Nk,visible:!1}),w_=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_allgm_fsk.geojson?bbox="+n.join(",")},strategy:an}),title:"fsk",name:"fsk",style:Gk,visible:!1,minResolution:0,maxResolution:4}),$x=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_son_lin.geojson?bbox="+n.join(",")},strategy:an}),title:"Sonstig, Linien",name:"son_lin",style:Ok,visible:!1}),Yk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_gew_umn.geojson?bbox="+n.join(",")},strategy:an}),title:"U-Manahmen",name:"gew_umn",style:Fk,visible:!1}),Kk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_gew_info.geojson?bbox="+n.join(",")},strategy:an}),title:"Gew, Info",name:"gew_info",style:kk,visible:!1}),Zk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/gew.geojson?bbox="+n.join(",")},strategy:an}),title:"gew",name:"gew",style:new Zt({fill:new Ne({color:"rgba(0,28, 240, 0.4)"}),stroke:new fe({color:"blue",width:2})}),visible:!0}),Xx=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_son_pun.geojson?bbox="+n.join(",")},strategy:an}),title:"Sonstige, Punkte",name:"son_pun",style:Bk,visible:!1}),Yx=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_ein.geojson?bbox="+n.join(",")},strategy:an}),title:"Einlufe",name:"ein",style:Dk,visible:!1}),Kx=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_que.geojson?bbox="+n.join(",")},strategy:an}),title:"Querung",name:"que",style:Ik,visible:!1}),Zx=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_due.geojson?bbox="+n.join(",")},strategy:an}),title:"Dker",name:"due",style:Rk,visible:!1}),Jx=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_weh.geojson?bbox="+n.join(",")},strategy:an}),title:"Wehr",name:"weh",style:Tk,visible:!1}),Qx=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_bru_nlwkn.geojson?bbox="+n.join(",")},strategy:an}),title:"Brcke (NLWKN)",name:"bru_nlwkn",style:Mk,visible:!1}),tb=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_bru_andere.geojson?bbox="+n.join(",")},strategy:an}),title:"Brcke (andere)",name:"bru_andere",style:Pk,visible:!1}),eb=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/exp_bw_sle.geojson?bbox="+n.join(",")},strategy:an}),title:"Schleuse",name:"sle",style:Ak,visible:!0}),Jk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/km_10_scal.geojson?bbox="+n.join(",")},strategy:an}),title:"km10scal",name:"km10cal",style:jk,visible:!0,minResolution:0,maxResolution:1}),Qk=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/km_100_scal.geojson?bbox="+n.join(",")},strategy:an}),title:"km100scal",name:"km100cal",style:function(n,t){return Uk(n,n.get("km"),t)},visible:!0,minResolution:0,maxResolution:3}),tO=new Ge({source:new Fe({format:new Oi,url:function(n){return"./myLayers/km_500_scal.geojson?bbox="+n.join(",")},strategy:an}),title:"km500scal",name:"km500cal",style:function(n,t){return zk(n,n.get("km"),t)},visible:!0}),eO=new Xe({title:"NSG",name:"NSG",source:new Si({url:"https://www.umweltkarten-niedersachsen.de/arcgis/services/Natur_wms/MapServer/WMSServer",params:{LAYERS:"Naturschutzgebiet",FORMAT:"image/png",TRANSPARENT:!0,TILED:!0}}),visible:!1,opacity:.5}),iO=new Xe({title:"LSG",name:"LSG",source:new Si({url:"https://www.umweltkarten-niedersachsen.de/arcgis/services/Natur_wms/MapServer/WMSServer",params:{LAYERS:"Landschaftsschutzgebiet",FORMAT:"image/png",TRANSPARENT:!0,TILED:!0}}),visible:!1,opacity:.5}),nO=new Xe({title:"SG",name:"SG",source:new Si({url:"https://www.umweltkarten-niedersachsen.de/arcgis/services/HWSchutz_wms/MapServer/WMSServer",params:{LAYERS:"berschwemmungsgebiete_Verordnungsflechen_Niedersachsen11182",FORMAT:"image/png",TRANSPARENT:!0,TILED:!0}}),visible:!1,opacity:.5}),rO=new Xe({title:"Fliegew.",name:"Fliegew.",source:new Si({url:"https://www.umweltkarten-niedersachsen.de/arcgis/services/WRRL_wms/MapServer/WMSServer",params:{LAYERS:"Natuerliche_erheblich_veraenderte_und_kuenstliche_Fliessgewaesser",FORMAT:"image/png",TRANSPARENT:!0,TILED:!0}}),visible:!1,opacity:1}),sO=new Xe({title:"GewWms",name:"GewWms",source:new Si({url:"https://www.umweltkarten-niedersachsen.de/arcgis/services/Hydro_wms/MapServer/WMSServer",params:{LAYERS:"Gewssernetz",FORMAT:"image/png",TRANSPARENT:!0,TILED:!0}}),visible:!0,opacity:1}),aO=new Xe({title:"2023_NI",name:"2023_NI",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/dop_wms",attributions:"Orthophotos Niedersachsen, LGLN",params:{LAYERS:"ni_dop20",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),oO=new Xe({title:"2020_NI",name:"2020_NI",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/doph_wms?",attributions:" ",params:{LAYERS:"ni_dop20h_rgb_2020",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),lO=new Xe({title:"2017_NI",name:"2017_NI",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/doph_wms?",attributions:" ",params:{LAYERS:"ni_dop20h_rgb_2017",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!0}),hO=new Xe({title:"2014_NI",name:"2014_NI",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/doph_wms?",attributions:" ",params:{LAYERS:"ni_dop20h_rgb_2014",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),cO=new Xe({title:"2012_NOH",name:"2012_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"9",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),uO=new Xe({title:"2011_NI",name:"2011_NI",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/doph_wms?",attributions:" ",params:{LAYERS:"ni_dop20h_rgb_2011",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),fO=new Xe({title:"2010_NOH",name:"2010_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"8",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),dO=new Xe({title:"2009_NOH",name:"2009_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"7",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),gO=new Xe({title:"2002_NOH",name:"2002_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"6",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),mO=new Xe({title:"1990_NOH",name:"1990_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"5",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),pO=new Xe({title:"1980_NOH",name:"1980_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"4",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),_O=new Xe({title:"1970_NOH",name:"1970_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"3",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),yO=new Xe({title:"1957_NOH",name:"1957_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"2",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1}),vO=new Xe({title:"1937_NOH",name:"1937_NOH",source:new Si({url:"https://geo.grafschaft.de/arcgis/services/Migratrion_Okt_2020/BAS_Luftbilder_2/MapServer/WMSServer",attributions:" ",params:{LAYERS:"1",TILED:"true",VERSION:"1.3.0"}}),opacity:1,visible:!1});var wO=new Xe({title:"Base-DE",name:"Base-DE",type:"base",source:new Si({url:"https://sgx.geodatenzentrum.de/wms_basemapde",attributions:" GeoBasis-DE / BKG (Jahr des letzten Datenbezugs) CC BY 4.0",params:{LAYERS:"de_basemapde_web_raster_farbe",TILED:!0,VERSION:"1.3.0"}}),opacity:1,visible:!1}),xO=new Xe({title:"DOP20 NI",name:"DOP20 NI",type:"base",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/dop_wms",attributions:"Orthophotos Niedersachsen, LGLN",params:{LAYERS:"ni_dop20",TILED:!0,VERSION:"1.3.0"}}),opacity:1,visible:!1});const bO=new Xe({title:"GoogleSat",name:"GoogleSat",type:"base",baseLayer:!1,source:new Dg({url:"http://mt1.google.com/vt/lyrs=s&hl=pl&&x={x}&y={y}&z={z}"}),opacity:1,visible:!1}),EO=new Xe({title:"GoogleHybrid",name:"GoogleHybrid",type:"base",baseLayer:!1,opacity:1,visible:!1,source:new Dg({url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}"})}),SO=new Xe({title:"ESRI-Sat",name:"ESRI-Sat",type:"base",source:new K1({attributions:"Powered by Esri",url:"https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}),opacity:1,visible:!1}),LO=new Xe({title:"ESRI-Grey",name:"ESRI-Grey",type:"base",source:new K1({attributions:"Powered by Esri",url:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}"}),opacity:1,visible:!1}),CO=new Xe({title:"osm-grey",name:"osm-grey",className:"bw",type:"base",source:new Ww({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),opacity:1,visible:!1}),AO=new Xe({title:"osm-color",name:"osm-color",type:"base",source:new Ww({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),opacity:.75,visible:!0});var TO=new Xe({title:"ALKIS",name:"ALKIS",type:"base",source:new Si({url:"https://opendata.lgln.niedersachsen.de/doorman/noauth/alkis_wms?",attributions:" LGLN",params:{LAYERS:"ALKIS",TILED:!0,VERSION:"1.3.0"}}),opacity:1,visible:!1});const ib=new zx({activationMode:"click",reverse:!0,trash:!0,tipLabel:"Legende",onchangeCheck:function(n,t){}});It.addControl(ib);ib.on("layer:visible",function(n){n.layer});const Vg=new Fe,nb=new Ge({displayInLayerSwitcher:!0,title:"Messung",name:"Messung",source:Vg,style:{"fill-color":"rgba(136, 136, 136, 0.526)","stroke-color":"blue","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}});let bd,us,Uh;const x_=function(n){if(n.pointerType==="touch"){if(n.dragging)return}else if(n.dragging)return};It.on("pointermove",x_);let Os;const MO=function(n){const t=dg(n);let e;return t>1e3?e=Math.round(t/1e3*100)/100+" km":e=Math.round(t*100)/100+" m",e},PO=function(n){const t=gg(n);let e;if(t>=1e4){const i=(t/1e6).toFixed(3)+" km<sup>2</sup>",r=(t/1e4).toFixed(3)+" ha";e=i+" ("+r+")"}else e=t.toFixed(3)+" m<sup>2</sup>";return e},RO=new Zt({fill:new Ne({color:"rgba(255, 255, 255, 0.2)"}),stroke:new fe({color:"blue",width:2}),image:new fr({radius:5,stroke:new fe({color:"rgba(0, 0, 0, 0.7)"}),fill:new Ne({color:"rgba(255, 255, 255, 0.2)"})})});function Ev(n){Os=new io({source:Vg,type:n,style:function(e){const i=e.getGeometry().getType();if(i===n||i==="Point")return RO}}),It.addInteraction(Os),Sv();let t;Os.on("drawstart",function(e){bd=e.feature;let i=e.coordinate;t=bd.getGeometry().on("change",function(r){const s=r.target;let a;s instanceof Ei?(a=PO(s),i=s.getInteriorPoint().getCoordinates()):s instanceof wi&&(a=MO(s),i=s.getLastCoordinate()),us.innerHTML=a,Uh.setPosition(i)}),document.getElementById("cancelDrawingBtn").style.display="block"}),Os.on("drawend",function(){us.className="ol-tooltip ol-tooltip-static",Uh.setOffset([0,-7]),bd=null,us=null,Sv(),Lr(t),document.getElementById("cancelDrawingBtn").style.display="none"})}function Sv(){us&&us.parentNode.removeChild(us),us=document.createElement("div"),us.className="ol-tooltip ol-tooltip-measure",Uh=new Ng({element:us,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),It.addOverlay(Uh)}It.getViewport().addEventListener("contextmenu",function(n){n.preventDefault(),b_()});document.addEventListener("keydown",function(n){(n.key==="Escape"||n.key==="Esc")&&b_()});document.getElementById("cancelDrawingBtn").addEventListener("click",b_);function b_(){if(Os){Vg.clear(),Os.finishDrawing(),It.removeInteraction(Os),It.un("pointermove",x_),It.getOverlays().clear(),Uh=null,us=null,Vx(),listener&&Lr(listener),bd=null;const n=document.getElementById("cancelDrawingBtn");n&&(n.style.display="none")}}It.getViewport().addEventListener("contextmenu",function(n){if(n.preventDefault(),Os){Vg.clear(),Os.finishDrawing(),It.removeInteraction(Os),It.un("pointermove",x_),It.getOverlays().clear(),Uh=null,us=null,Vx();return}});class IO extends sn{constructor(t){const e=document.createElement("div");e.className="custom-controls1 ol-unselectable ol-control";const i=document.createElement("button");i.innerHTML="L",i.className="ol-button",i.addEventListener("click",function(){Ev("LineString")});const r=document.createElement("button");r.innerHTML="F",r.className="ol-button",r.addEventListener("click",function(){Ev("Polygon")}),e.appendChild(i),e.appendChild(r),super({element:e,target:t.target})}}It.addControl(new IO({target:"custom-controls"}));const NO=new Qn({title:"Bauw.(P)",name:"BauwP",fold:!0,fold:"close",layers:[Xx,Yx,Kx,Zx,tb,Qx,Jx,eb]}),FO=new Qn({title:"Bauw.(L)",name:"BauwL",fold:!0,fold:"close",visible:!0,layers:[Xk,$k,Hk,Yk,$x,Kk]}),kO=new Qn({title:"WMS-Lay",name:"WMS-Lay",fold:!0,fold:"close",visible:!1,layers:[TO,iO,eO,nO,rO,sO]}),OO=new Qn({title:"Luftbilder",name:"Luftbilder",fold:!0,fold:"close",visible:!1,layers:[vO,yO,_O,pO,mO,gO,dO,fO,uO,cO,hO,lO,oO,aO]}),DO=new Qn({title:"Station",name:"Station",fold:!0,fold:"close",visible:!0,layers:[Jk,Qk,tO]}),BO=new Qn({title:"Base",name:"Base",fold:!0,fold:"close",visible:!0,layers:[SO,LO,EO,bO,xO,wO,CO,AO]});It.addLayer(BO);It.addLayer(OO);It.addLayer(w_);-It.addLayer(Zk);It.addLayer(kO);It.addLayer(DO);It.addLayer(FO);It.addLayer(NO);It.addLayer(nb);const E_=new Ge({source:new Fe({}),title:"rechtsClick",name:"rechtsClick",displayInLayerSwitcher:!1});It.addLayer(E_);var bu=new Fn({html:'<i class="icon fa-fw fa fa-arrow-circle-down" aria-hidden="true"></i>',className:"select",title:"Select Info",active:!0,interaction:Bm,onToggle:function(n){alert("Jetzt ist BW-Abfrage "+(n?"aktiviert":"deaktiviert (WMS-Abfrage aktiviert)")),Bm.setActive(n),n||Bm.getFeatures().clear(),n?It.addOverlay(Yi):It.removeOverlay(Yi),bu.element.classList.toggle("active",n),bu.element.querySelector(".icon").classList.toggle("active",n),n?It.un("singleclick",Lv):It.on("singleclick",Lv)}});bu.element.classList.add("active");bu.element.querySelector(".icon").classList.add("active");var Bm=new La({layers:[nb],hitTolerance:5}),zc=new La({hitTolerance:5,multi:!0,condition:_1});zc.on("select",function(n){n.selected.forEach(function(t){zc.getLayer(t).get("name")!=="gew"?zc.getLayer(t):zc.getFeatures().clear()})});It.addInteraction(zc);function rb(n){const t=[];return n.getLayers().forEach(e=>{e instanceof Qn?t.push(...rb(e)):t.push(e)}),t}function Lv(n){const t=[];It.getLayers().forEach(r=>{const s=r.get("name");r.getVisible()&&(r instanceof Qn?s!=="GN-DOPs"&&s!=="Base"&&s!=="Station"&&s!=="BauwP"&&s!=="BauwL"&&s!==void 0&&t.push(...rb(r)):s!=="fsk"&&t.push(r))});const e=It.getView().getResolution(),i=It.getView().getProjection();t.forEach(r=>{if(r.getVisible()){const s=r.getSource();if(s instanceof Si&&typeof s.getFeatureInfoUrl=="function"){const a=r.get("name"),o=s.getFeatureInfoUrl(n.coordinate,e,i,{INFO_FORMAT:"text/html"});o&&fetch(o).then(l=>l.text()).then(l=>{if(l.trim()!==""){var h=/<body[^>]*>\s*<\/body>/i.test(l);if(h===!1){var c=iD(l);const u=GO(a,c);document.body.appendChild(u)}else console.log("nichts verwertbares gefunden")}}).catch(l=>{console.error("Fehler beim Abrufen der Daten:",l),alert("Es ist ein Fehler aufgetreten")})}}})}function GO(n,t){const e=document.createElement("p");e.id="info",e.classList.add("Info"),e.innerHTML=`${t}`;const i=document.createElement("p");return i.innerHTML="&times;",i.classList.add("close-icon"),i.addEventListener("click",function(){e.style.display="none"}),e.appendChild(i),e}var jO=document.getElementById("popup"),zn=document.getElementById("popup-content"),Up=document.getElementById("popup-closer"),Yi=new Ng({element:jO,id:"1",autoPan:!0,autoPanAnimation:{duration:250}});zn.addEventListener("contextmenu",function(n){n.stopPropagation()});It.addOverlay(Yi);Up.onclick=function(){return Yi.setPosition(void 0),Up.blur(),!1};var Up=document.getElementById("popup-closer");It.on("click",function(n){if(console.log($o),console.log("Aufgerufen"),$o===!1){var t=n.coordinate;It.forEachFeatureAtPixel(n.pixel,function(e,i){var r=i.get("name");console.log(r);var s=e.get("beschreib_lang"),a="";if(s&&s.trim()!==""&&(a="<br><u>Beschreib (lang): </u>"+s+"</p>"),r!=="gew"&&r!=="km10scal"&&r!=="km100scal"&&r!=="km500scal"&&r!=="fsk"&&r!=="sle"&&r!=="weh"&&r!=="son_lin"&&r!=="exp_gew_fla")if(e){t=e.getGeometry().getCoordinates(),Yi.setPosition(t);var o=e.get("foto1"),l="",h=e.get("foto2"),c="",u=e.get("foto3"),d="",g=e.get("foto4"),p="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto 2 ",u&&u.trim()!==""?d='<a href="'+u+`" onclick="window.open('`+u+`', '_blank'); return false;">Foto 3</a>`:d=" Foto 3 ",g&&g.trim()!==""?p='<a href="'+g+`" onclick="window.open('`+g+`', '_blank'); return false;">Foto 4</a>`:p=" Foto 4 ";var y=e.get("rwert"),w=e.get("hwert"),x=Fc(y,w,32,!0);zn.innerHTML='<div style="max-height: 200px; overflow-y: auto;"><p style="font-weight: bold; text-decoration: underline;">'+e.get("name")+"</p><p>Id = "+e.get("bw_id")+" ("+(e.get("KTR")?e.get("KTR"):"k.A.")+")</p><p>U-Pflicht = "+e.get("upflicht")+"</p><p>Bemerk = "+(e.get("bemerk")?e.get("bemerk"):"k.A.")+"</p><p>Bauj. = "+(e.get("baujahr")?e.get("baujahr"):"k.A.")+`</p><p><a href="https://www.google.com/maps?q=${x}" target="_blank" rel="noopener noreferrer">Google Maps link</a></p><p><a href="https://www.google.com/maps?q=&layer=c&cbll=${x}&cbp=12,90,0,0,1" target="_blank" rel="noopener noreferrer">streetview</a></p><p>`+l+" "+c+" "+d+" "+p+"<br><u>Beschreibung (kurz): </u>"+e.get("beschreib")+"</p><p>"+a+"</p></div>"}else Yi.setPosition(void 0);if(r==="gew_info"){var o=e.get("foto1"),l="",h=e.get("foto2"),c="",u=e.get("foto3"),d="",g=e.get("foto4"),p="",b=e.get("URL_WKDB"),L="",P=e.get("URL_WKSB");console.log(P);var R="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto 2 ",u&&u.trim()!==""?d='<a href="'+u+`" onclick="window.open('`+u+`', '_blank'); return false;">Foto 3</a>`:d=" Foto 3 ",g&&g.trim()!==""?p='<a href="'+g+`" onclick="window.open('`+g+`', '_blank'); return false;">Foto 4</a>`:p=" Foto 4 ",b&&b.trim()!==""?L='<a href="'+b+`" onclick="window.open('`+b+`', '_blank'); return false;">NLWKN-WK</a>`:L=" NLWKN-WK",P&&P.trim()!==""?R='<a href="'+P+`" onclick="window.open('`+P+`', '_blank'); return false;">BfG-WK</a>`:R="BfG-WK",t=n.coordinate,Yi.setPosition(t),zn.innerHTML='<div style="max-height: 300px; overflow-y: auto;"><p>Name: '+e.get("IDUabschn")+"<br>von "+e.get("Bez_Anfang")+" bis "+e.get("Bez_Ende")+"</p><p>"+l+" "+c+" "+d+" "+p+'<p><a href="'+e.get("U_Steckbrief")+`" onclick="window.open('`+e.get("U_Steckbrief")+`', '_blank'); return false;">NLWKN-SB</a> `+R+" "+L+'<p><a href="'+e.get("BSB")+`" onclick="window.open('`+e.get("BSB")+`', '_blank'); return false;">BSB  </a><p>Bemerk = `+(e.get("bemerk")?e.get("bemerk"):"k.A.")+'</p><a href="'+e.get("MNB")+`" onclick="window.open('`+e.get("MNB")+`', '_blank'); return false;"> MNB</a><br> Kat: `+e.get("Kat")+"</a>, KTR: "+e.get("KTR")+"</a><br><u>Beschreibung (kurz): </u>"+e.get("beschreib")+"</p></div>"}if(r==="gew_umn"&&(t=n.coordinate,Yi.setPosition(t),zn.innerHTML='<div style="max-height: 300px; overflow-y: auto;"><p>ID: '+e.get("Massn_ID")+"<br><p>Bez (Art): "+e.get("UMnArtBez")+"<br><p>Bez (Gruppe): "+e.get("UMNGrBez")+"<br></div>"),r==="son_lin"){t=n.coordinate,Yi.setPosition(t);var o=e.get("foto1"),l="",h=e.get("foto2"),c="",u=e.get("foto3"),d="",g=e.get("foto4"),p="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto 2 ",u&&u.trim()!==""?d='<a href="'+u+`" onclick="window.open('`+u+`', '_blank'); return false;">Foto 3</a>`:d=" Foto 3 ",g&&g.trim()!==""?p='<a href="'+g+`" onclick="window.open('`+g+`', '_blank'); return false;">Foto 4</a>`:p=" Foto 4 ",zn.innerHTML='<div style="max-height: 200px; overflow-y: auto;"><p style="font-weight: bold; text-decoration: underline;">'+e.get("name")+"</p><p>Id = "+e.get("bw_id")+" ("+e.get("KTR")+")</p><p>U-Pflicht = "+e.get("upflicht")+"</p><p>Bemerk = "+(e.get("bemerk")?e.get("bemerk"):"k.A.")+"</p><p>Bauj. = "+e.get("baujahr")+"</p><p>"+l+" "+c+" "+d+" "+p+"<br><u>Beschreibung (kurz): </u>"+e.get("beschreib")+"</p><p>"+a+"</p></div>"}if(r==="exp_gew_fla"){t=n.coordinate,Yi.setPosition(t);var o=e.get("foto1"),l="",h=e.get("foto2"),c="",u=e.get("foto3"),d="",g=e.get("foto4"),p="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto 2 ",u&&u.trim()!==""?d='<a href="'+u+`" onclick="window.open('`+u+`', '_blank'); return false;">Foto 3</a>`:d=" Foto 3 ",g&&g.trim()!==""?p='<a href="'+g+`" onclick="window.open('`+g+`', '_blank'); return false;">Foto 4</a>`:p=" Foto 4 ",zn.innerHTML='<div style="max-height: 200px; overflow-y: auto;"><p style="font-weight: bold; text-decoration: underline;">'+e.get("name")+"</p><p>Id = "+e.get("bw_id")+" ("+e.get("KTR")+")</p><p>U-Pflicht = "+e.get("upflicht")+"</p><p>Bemerk = "+(e.get("bemerk")?e.get("bemerk"):"k.A.")+"</p><p>Bauj. = "+e.get("baujahr")+"</p><p>"+l+" "+c+" "+d+" "+p+"<br><u>Beschreibung (kurz): </u>"+e.get("beschreib")+"</p><p>"+a+"</p></div>"}if(r==="sle"){t=n.coordinate,Yi.setPosition(t);var o=e.get("foto1"),l="",h=e.get("foto2"),c="",u=e.get("foto3"),d="",g=e.get("foto4"),p="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto 2 ",u&&u.trim()!==""?d='<a href="'+u+`" onclick="window.open('`+u+`', '_blank'); return false;">Foto 3</a>`:d=" Foto 3 ",g&&g.trim()!==""?p='<a href="'+g+`" onclick="window.open('`+g+`', '_blank'); return false;">Foto 4</a>`:p=" Foto 4 ";var y=e.get("rwert"),w=e.get("hwert");let it=Fc(y,w,32,!0);zn.innerHTML='<div style="max-height: 200px; overflow-y: auto;"><p style="font-weight: bold; text-decoration: underline;">'+e.get("name")+"</p><p>Id = "+e.get("bw_id")+" ("+e.get("KTR")+")</p><p>Bemerk = "+(e.get("bemerk")?e.get("bemerk"):"k.A.")+"</p><p>WSP (OW) = "+e.get("WSP_OW")+" m  WSP (UW) = "+e.get("WSP_UW")+` m</p><p><a href="https://www.google.com/maps?q=${it}" target="_blank" rel="noopener noreferrer">Google Maps link</a></p><p><a href="https://www.google.com/maps?q=&layer=c&cbll=${it}&cbp=12,90,0,0,1" target="_blank" rel="noopener noreferrer">streetview</a></p><p>Bauj. = `+e.get("baujahr")+"</p><p>"+l+" "+c+" "+d+" "+p+"<br><u>Beschreibung (kurz): </u>"+e.get("beschreib")+"</p><p>"+a+"</p></div>"}if(r==="weh"){t=n.coordinate,Yi.setPosition(t);var o=e.get("foto1"),l="",h=e.get("foto2"),c="",u=e.get("foto3"),d="",g=e.get("foto4"),p="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto 2 ",u&&u.trim()!==""?d='<a href="'+u+`" onclick="window.open('`+u+`', '_blank'); return false;">Foto 3</a>`:d=" Foto 3 ",g&&g.trim()!==""?p='<a href="'+g+`" onclick="window.open('`+g+`', '_blank'); return false;">Foto 4</a>`:p=" Foto 4 ";var y=e.get("rwert"),w=e.get("hwert");let it=Fc(y,w,32,!0);zn.innerHTML='<div style="max-height: 200px; overflow-y: auto;"><p style="font-weight: bold; text-decoration: underline;">'+e.get("name")+"</p><p>Id = "+e.get("bw_id")+" ("+e.get("KTR")+")</p><p>Bemerk = "+(e.get("bemerk")?e.get("bemerk"):"k.A.")+`</p><p><a href="https://www.google.com/maps?q=${it}" target="_blank" rel="noopener noreferrer">Google Maps link</a></p><p><a href="https://www.google.com/maps?q=&layer=c&cbll=${it}&cbp=12,90,0,0,1" target="_blank" rel="noopener noreferrer">streetview</a></p><p>WSP1 (OW) = `+e.get("Ziel_OW1")+" m  WSP2 (OW) = "+e.get("Ziel_OW2")+" m</p><p>Bauj. = "+e.get("baujahr")+"</p><p>"+l+" "+c+" "+d+" "+p+"<br><u>Beschreibung (kurz): </u>"+e.get("beschreib")+"</p><p>"+a+"</p></div>"}if(r==="fot"){t=n.coordinate,Yi.setPosition(t);var o=e.get("tmp"),l="",h=e.get("Path"),c="";o&&o.trim()!==""?l='<a href="'+o+`" onclick="window.open('`+o+`', '_blank'); return false;">Foto 1</a>`:l=" Foto LW 1 ",h&&h.trim()!==""?c='<a href="'+h+`" onclick="window.open('`+h+`', '_blank'); return false;">Foto 2</a>`:c=" Foto LW 2";var y=e.get("RWert"),w=e.get("HWert");let O=Fc(y,w,32,!0);zn.innerHTML='<div style="max-height: 200px; overflow-y: auto;"><p style="font-weight: bold; text-decoration: underline;">'+e.get("REFOBJ_ID")+`</p><p><a href="https://www.google.com/maps?q=${O}" target="_blank" rel="noopener noreferrer">Google Maps link</a></p><p><a href="https://www.google.com/maps?q=&layer=c&cbll=${O}&cbp=12,90,0,0,1" target="_blank" rel="noopener noreferrer">streetview</a></p><p>Datum Uhrzeit: `+e.get("DateTime_")+"</p><p>"+l+" "+c+"<br><u>Ordner: </u>"+e.get("BOrdner")+"</p></div>"}if(r==="gehoelz_vec"&&(t=n.coordinate,Yi.setPosition(t),zn.innerHTML='<div style="max-height: 300px; overflow-y: auto;"><p>Gehlzentwicklung<br><br>Bemerk: '+e.get("UMn_Bemerk")+"</p></div>"),r==="fsk"&&(e.get("Art")==="o"||e.get("Art")==="l"?(t=n.coordinate,Yi.setPosition(t),zn.innerHTML='<div style="max-height: 300px; overflow-y: auto;"><p><strong>gemark Flur Flurstck:</strong><br>'+e.get("Suche")+"</p>FSK: "+e.get("fsk")+"</p>FSK(ASL): "+e.get("FSK_ASL")+"</p><p>Eig.(ffentl.): "+e.get("Eig1")+"</p></div>"):(t=n.coordinate,Yi.setPosition(t),zn.innerHTML='<div style="max-height: 300px; overflow-y: auto;"><p><strong>gemark Flur Flurstck:</strong><br>'+e.get("Suche")+"</p>FSK: "+e.get("fsk")+"</p><p>Art (p=privat): "+e.get("Art")+"</p><p>Eig.(privat): "+e.get("Eig1")+"</p></div>")),r.toLowerCase().startsWith("geojson")){var j=e.getProperties();t=n.coordinate,Yi.setPosition(t);let k="<strong>Attributwerte:</strong><br><ul>";for(let T in j)T!=="geometry"&&(k+=`<li><strong>${T}:</strong> ${j[T]}</li>`);k+="</ul>",zn.innerHTML=k}if(r.toLowerCase().startsWith("kml")){var j=e.getProperties();t=n.coordinate,Yi.setPosition(t);let T="<strong>Attributwerte:</strong><br><ul>";for(let q in j)q!=="geometry"&&(T+=`<li><strong>${q}:</strong> ${j[q]}</li>`);T+="</ul>",zn.innerHTML=T}if(r.toLowerCase().startsWith("rechtsclick")){var j=e.getProperties();t=n.coordinate,Yi.setPosition(t);let T="<strong>Koordinaten</strong><br><ul>";for(let W in j)W!=="geometry"&&(T+=`<li><strong>${W}:</strong> ${Number(j[W]).toFixed(3)}</li>`);e.set("type","removable"),T+="</ul>";let q=Fc(e.get("x_32632"),e.get("y_32632"),32,!0);T+=`<p><a href="https://www.google.com/maps?q=${q}" target="_blank" rel="noopener noreferrer">Google Maps link</a></p>`,zn.innerHTML=T}})}else $o===!0&&UO(n)});const Ps=new yR({coordinateFormat:Vo(6),projection:"EPSG:4326",className:"custom-mouse-position",target:document.getElementById("mouse-position")});It.addControl(Ps);const qo=document.getElementById("projecSelect");qo.addEventListener("change",function(n){if(qo.value==="EPSG:3857"){const t=Vo(2);Ps.setCoordinateFormat(t),Ps.setProjection(n.target.value)}else if(qo.value==="EPSG:4326"){const t=Vo(6);Ps.setCoordinateFormat(t),Ps.setProjection(n.target.value)}else if(qo.value==="EPSG:32632"){const t=Vo(1);Ps.setCoordinateFormat(t),Ps.setProjection(n.target.value)}});function UO(n){const t=document.getElementById("mouse-position");if(sb.checked){const e=document.createElement("div");if(e.className="marker",ag=new Ng({position:n.coordinate,positioning:"center-center",element:e,stopEvent:!1}),It.addOverlay(ag),qo.value==="EPSG:3857"){const i=Vo(2),r=[n.coordinate[1],n.coordinate[0]];t.innerHTML=`Coordinates: ${i(r)}`}else if(qo.value==="EPSG:4326"){const i=Vo(6),r=zO(n.coordinate),s=[r[1],r[0]];t.innerHTML=`Coordinates: ${i(s)}`}else if(qo.value==="EPSG:32632"){const i=Vo(1),r=qO(n.coordinate),s=[r[1],r[0]];t.innerHTML=`Coordinates: ${i(s)}`}}}const sb=document.getElementById("toggle-checkbox");sb.addEventListener("change",function(){this.checked?(document.getElementById("mouse-position").innerHTML="",It.removeControl(Ps),$o=!0):(ag&&It.removeOverlay(ag),$o=!1,It.addControl(Ps))});let ag;document.getElementById("hide-button").addEventListener("click",function(){const n=document.querySelector(".controls");n.classList.toggle("hidden"),document.getElementById("custom-controls"),n.classList.contains("hidden")?document.getElementById("toggle-checkbox").checked=!1:It.addControl(Ps)});function zO(n){return Kn(n,It.getView().getProjection(),"EPSG:4326")}function qO(n){return Kn(n,"EPSG:3857","EPSG:32632")}document.addEventListener("DOMContentLoaded",function(){var n=document.getElementById("popup"),t=document.getElementById("popup-closer"),e=document.createElement("div"),i=document.createElement("a");i.textContent="Weitere Infos",i.addEventListener("click",function(r){r.preventDefault(),alert("keine Funktion")}),e.appendChild(i),e.appendChild(t),n.appendChild(e)});document.getElementById("popup-closer").onclick=function(){return Yi.setPosition(void 0),!1};var Eu=new Ge({title:"tmp_Layer2",name:"tmp_Layer2",source:new Fe,style:new Zt({image:new fr({radius:5,stroke:new fe({color:"rgb(255,165,0)",width:3}),fill:new Ne({color:"rgba(255,165,0,.3)"})}),stroke:new fe({color:"rgb(255,165,0)",width:3}),fill:new Ne({color:"rgba(255,165,0,.3)"})}),displayInLayerSwitcher:!0});It.addLayer(Eu);var ab=new S6({lang:"de",polygon:$("#polygon").prop("checked"),reverse:!0,position:!0});It.addControl(ab);ab.on("select",function(n){if(Eu.getSource().clear(),n.search.geojson){var t=new Oi,e=t.readFeature(n.search.geojson,{dataProjection:"EPSG:4326",featureProjection:It.getView().getProjection()});Eu.getSource().addFeature(e);var i=It.getView(),r=i.getResolutionForExtent(e.getGeometry().getExtent(),It.getSize()),s=i.getZoomForResolution(r),a=ol.extent.getCenter(e.getGeometry().getExtent());setTimeout(function(){i.animate({center:a,zoom:Math.min(s,16)})},100)}else It.getView().animate({center:n.coordinate,zoom:Math.max(It.getView().getZoom(),16)});VO(n.coordinate)});function VO(n){var t=new ei({geometry:new fi(n)}),e=new Zt({image:new vn({src:"data/marker.svg"})});t.setStyle(e),Eu.getSource().clear(),Eu.getSource().addFeature(t)}var Gm="",Us=null;const ob=new Zt({stroke:new fe({color:"red",width:12}),fill:new Ne({color:"rgb(234, 255, 0)"})});function WO(n){let t=[Qx,Zx,eb,Jx,tb,Yx,Kx,Xx,$x],e=[];t.forEach(i=>{if(!i)return;let r=i.getSource();if(!r)return;r.getFeatures().forEach(a=>{let o=a.getProperties(),l=o.name?o.name.toLowerCase():"",h=o.beschreib?o.beschreib.toLowerCase():"",c=n.toLowerCase();(l.includes(c)||h.includes(c))&&e.push({feature:a,layer:i})})}),$O(e),document.getElementById("close-search-results").addEventListener("click",function(){document.getElementById("search-results-container").style.display="none"})}function HO(n){let t=[];console.log("Suche gestartet Eigentmer");const e=w_.getSource();if(!e){console.error("Fehler: Die Layer-Quelle ist nicht verfgbar.");return}e.getFeatures().forEach(r=>{let s=r.getProperties(),a=s.Eig1?s.Eig1.toLowerCase():"",o=n.toLowerCase();a.includes(o)&&t.push({feature:r})}),XO(t),document.getElementById("close-search-results").addEventListener("click",function(){document.getElementById("search-results-container").style.display="none",Us&&(Us.setStyle(null),Us=null)})}function $O(n){let t=document.getElementById("search-results");if(t.innerHTML="",n.length===0){t.innerHTML="<li>Layer eingeschaltet??? Keine Treffer</li>";return}n.sort((e,i)=>{let r=e.feature.getProperties().bw_id||"",s=i.feature.getProperties().bw_id||"";return r.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}),n.forEach(e=>{let i=e.feature,r=i.getProperties(),s=r.bw_id,a=r.name||"Unbekannt",o=document.createElement("li");o.textContent=s+": "+a,o.onclick=()=>ZO(i),t.appendChild(o)})}function XO(n){let t=document.getElementById("search-results");if(t.innerHTML="",n.length===0){t.innerHTML="<li>FSK-Layer sichtbar?? Keine Treffer</li>";return}n.sort((e,i)=>{var a,o,l,h,c,u;let r=((l=(o=(a=e.feature)==null?void 0:a.getProperties())==null?void 0:o.Eig1)==null?void 0:l.trim())||"",s=((u=(c=(h=i.feature)==null?void 0:h.getProperties())==null?void 0:c.Eig1)==null?void 0:u.trim())||"";return r.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}),n.forEach(e=>{let i=e.feature,r=i.getProperties(),s=r.Eig1||"Unbekannt",a=r.Suche||"Unbekannt",o=document.createElement("li");o.textContent=s+"/ FSK: "+a,o.onclick=()=>KO(i),t.appendChild(o)})}function YO(n){const e=w_.getSource().getFeatures();let i=!1;const r=n.charAt(0),a=!isNaN(r)&&r.trim()!==""?"fsk":"Suche";e.some(o=>o.get(a)===n?(o.setStyle(ob),It.getView().fit(o.getGeometry().getExtent(),{duration:1e3}),Us=o,i=!0,!0):!1),i||alert("Kein passendes Feature gefunden!, FSK-Layer sichtbar??")}function KO(n){Us&&Us.setStyle(null),n.setStyle(ob),Us=n;let e=n.getGeometry().getExtent();It.getView().fit(e,{duration:1e3,padding:[50,50,50,50],maxZoom:18})}function ZO(n){let e=n.getGeometry().getExtent();It.getView().fit(e,{duration:1e3,padding:[50,50,50,50],maxZoom:20})}window.closeSearchResults=function(){document.getElementById("search-results-container").style.display="none"};let jm=!1;var S_=new Is({toggleOne:!0,controls:[new ro({html:'<i class="fa fa-map" ></i>',title:"Flurstckssuche",handleClick:function(){Us?(Us.setStyle(null),Us=null):(Gm=prompt("gem flur zhler/nenner oder fsk-id:",""),Gm&&YO(Gm))}}),new ro({html:'<i class="fa fa-snowflake-o" aria-hidden=true></i>',title:"Suche bw",handleClick:function(){let n=prompt("Geben Sie den Suchtext ein:");n&&n.trim()!==""?(WO(n),document.getElementById("search-results-container").style.display="block"):alert("Bitte geben Sie einen gltigen Suchtext ein. Layer sichtbar??")}}),new ro({html:'<i class="fa fa-file"></i>',title:"Suche Eigentmer",handleClick:function(){let n=prompt("Geben Sie den Suchtext ein:");n&&n.trim()!==""?(HO(n),document.getElementById("search-results-container").style.display="block"):alert("Bitte geben Sie einen gltigen Suchtext ein. FSK-Layer sichtbar??")}})]}),JO=new Is({toggleOne:!0,controls:[new Fn({html:'<i class="fa fa-map-marker" ></i>',title:"GPSPosition",onToggle:function(){ad?(navigator.geolocation.clearWatch(ad),ad=null,Jl&&(It.removeLayer(Jl),Jl=null)):ad=navigator.geolocation.watchPosition(function(n){const t=[n.coords.longitude,n.coords.latitude],e=SS(t,n.coords.accuracy);sd.clear(!0),sd.addFeatures([new ei(e.transform("EPSG:4326",It.getView().getProjection())),new ei(new fi(Zv(t)))]),bv&&(It.getView().fit(sd.getExtent(),{maxZoom:13,duration:500}),bv=!1),Jl||(Jl=new Ge({displayInLayerSwitcher:!0,style:new Zt({image:new fr({radius:8,opacity:.5,fill:new Ne({color:"red"}),stroke:new fe({color:"black",width:2})})}),source:sd,title:"gps_Layer",name:"gps_Layer",zIndex:9999}),It.addLayer(Jl))},function(n){alert(`ERROR: ${n.message}`)},{enableHighAccuracy:!0})}}),new Fn({html:'<i class="fa fa-search"></i>',title:"Suche",onToggle:function(n){},bar:S_}),new Fn({html:'<i class="fa fa-file"></i>',title:"GeoJson drag and drop",onToggle:function(){jm=!jm,jm===!0?QO():It.removeInteraction(ah)}})]});let Um=0;geojsonInput.addEventListener("change",function(n){const t=n.target.files;t.length&&Array.from(t).forEach(e=>{const i=new FileReader;i.onload=function(r){const s=r.target.result,a=new Oi;try{const o=a.readFeatures(s,{featureProjection:"EPSG:3857"}),l=new Fe({features:o}),h=e.name.replace(/\.[^/.]+$/,""),c=`GeoJSON: Lokal-${Um} (${h})`,u=`GeoJSON_Lokal_${Um}_${h}`,d=new Ge({source:l,title:c,name:u,displayInLayerSwitcher:!0,style:new Zt({stroke:new fe({color:"red",width:2}),fill:new Ne({color:"rgba(0, 0, 255, 0.1)"})})});It.addLayer(d),It.getView().fit(l.getExtent(),{padding:[20,20,20,20],maxZoom:16}),Um++}catch(o){alert("Fehler beim Laden der GeoJSON-Datei: "+o.message)}},i.readAsText(e)})});var S_=new Is({toggleOne:!0,controls:[new Fn({html:'<i class="fa fa-envelope-open" aria-hidden="true"></i>',title:"Geojson-Datei laden",onToggle:function(){geojsonInput.click()}}),new Fn({html:"L",title:"Fehlt",onToggle:function(n){alert("ohne Funktion")}})]});let ah,Cv=0,Av=0;function QO(){ah&&It.removeInteraction(ah),ah=new AR({formatConstructors:[Oi,new d3]}),ah.on("addfeatures",function(n){if(!n.file){alert("Kein Dateiname verfgbar.");return}let t=n.file.name.replace(/\.[^/.]+$/,""),e=n.file.name.split(".").pop().toLowerCase();if(n.features.length===0){alert("Keine Features aus der Datei geladen!");return}const i=new Fe;i.addFeatures(n.features);let r;(e==="geojson"||e==="json")&&t!="fot"?r="GeoJson: "+Cv+" "+t:e==="kml"?r="KML: "+Av+" "+t:t==="fot"&&(r="fot");const s=t==="fot"?qk:Vk;Cv++,Av++;const a=new Ge({source:i,name:r,title:r,style:s});It.addLayer(a),i.once("change",function(){console.log("Das 'change'-Ereignis wurde ausgelst.");const o=i.getFeatures();if(o.length>0){const l=o[0].getProperties();l&&typeof l=="object"?Object.keys(l).filter(h=>h!=="geometry"):alert("Keine gltigen Attribute im Feature gefunden."),Object.keys(l).filter(h=>h!=="geometry")}else alert("Keine Features im Layer gefunden.")}),It.getView().fit(i.getExtent(),{padding:[20,20,20,20]})}),It.addInteraction(ah)}var lb=new Is({controls:[new Fn({html:'<i class="fa fa-info"></i>',title:"Weitere Funktionen",bar:JO,onToggle:function(){}}),new Fn({html:"W",title:"Weitere Funktionen",bar:S_,onToggle:function(){}})]});It.addControl(lb);lb.setPosition("left");var zu=new Is;It.addControl(zu);zu.addControl(qg);zu.addControl(bu);zu.setPosition("bottom-right");zu.element.style.bottom="60px";var tD=setInterval(()=>{document.querySelector(".ol-control.ol-bar.bottom-left")&&clearInterval(tD)},100);document.addEventListener("DOMContentLoaded",function(){eD(__,It)});function eD(n,t){var e=new n({target:document.body,srs:["EPSG:4326","EPSG:3857","EPSG:32632"],cors:!0,popupLayer:!0,placeholder:"WMS link hier einfgen...",title:"WMS-Dienste",name:"WMS-Dienste",searchLabel:"Suche",optional:"token",services:{"Verwaltungsgrenzen NI ":"https://opendata.lgln.niedersachsen.de/doorman/noauth/verwaltungsgrenzen_wms","Hydro, Umweltkarten NI ":"https://www.umweltkarten-niedersachsen.de/arcgis/services/Hydro_wms/MapServer/WMSServer?VERSION=1.3.0.&SERVICE=WMS&REQUEST=GetCapabilities","WRRL, Umweltkarten NI ":"https://www.umweltkarten-niedersachsen.de/arcgis/services/WRRL_wms/MapServer/WMSServer?VERSION=1.3.0.&SERVICE=WMS&REQUEST=GetCapabilities","Natur, Umweltkarten NI":"https://www.umweltkarten-niedersachsen.de/arcgis/services/Natur_wms/MapServer/WMSServer?VERSION=1.3.0.&SERVICE=WMS&REQUEST=GetCapabilities","HW-Schutz, Umwelkarten NI":"https://www.umweltkarten-niedersachsen.de/arcgis/services/HWSchutz_wms/MapServer/WMSServer?VERSION=1.3.0.&SERVICE=WMS&REQUEST=GetCapabilities","schutzgebiete, NL":"https://service.pdok.nl/provincies/aardkundige-waarden/wms/v1_0?request=GetCapabilities&service=WMS","wateren, NL":"https://service.pdok.nl/kadaster/hy/wms/v1_0?","EU-Waterbodies 3rd RBMP":"https://water.discomap.eea.europa.eu/arcgis/services/WISE_WFD/WFD2022_SurfaceWaterBody_WM/MapServer/WMSServer?request=GetCapabilities&service=WMS","Luft u. Lrm":"https://www.umweltkarten-niedersachsen.de/arcgis/services/Luft_Laerm_wms/MapServer/WMSServer?VERSION=1.3.0.&SERVICE=WMS&REQUEST=GetCapabilities","Boden, Umweltkarten NI":"https://www.umweltkarten-niedersachsen.de/arcgis/services/Boden_wms/MapServer/WMSServer?VERSION=1.3.0.&SERVICE=WMS&REQUEST=GetCapabilities","Inspire Hydro":"https://sg.geodatenzentrum.de/wms_dlm250_inspire?Request=GetCapabilities&SERVICE=WMS",TopPlusOpen:"https://sgx.geodatenzentrum.de/wms_topplus_open?request=GetCapabilities&service=wms"},trace:!0});t.addControl(e),e.on("load",function(i){t.addLayer(i.layer),i.layer.set("legend",i.options.data.legend)})}function iD(n){const t=document.createElement("table");t.innerHTML=n;const i=t.querySelectorAll("tr")[1];if(i){const r=i.querySelectorAll("td");for(const s of r)if(s.textContent.includes("https://")||s.textContent.includes("http://")){const a=s.textContent.trim(),o=document.createElement("a");o.href=a,o.target="_blank";const l=document.createElement("strong");l.textContent="Link",o.appendChild(l),s.innerHTML="",s.appendChild(o)}}return t.outerHTML}var hb=[{text:"Karte zentrieren",classname:"bold",icon:xd,callback:Mv},{text:"Sonstiges",icon:xd,items:[{text:"Zentrieren",icon:xd,callback:Mv},{text:"Marker",icon:Bp,callback:Pv}]},{text:"Marker",icon:Bp,callback:Pv},"-"],to=new xd({width:180,items:hb});It.addControl(to);var Tv={text:"Remove this Marker",callback:rD};to.on("open",function(n){var t=It.forEachFeatureAtPixel(n.pixel,e=>e);t&&t.get("type")==="removable"?(to.clear(),Tv.data={marker:t},to.push(Tv)):(to.clear(),to.extend(hb),to.extend(to.getDefaultItems()))});It.on("pointermove",function(n){if(!n.dragging){var t=It.getEventPixel(n.originalEvent),e=It.hasFeatureAtPixel(t);It.getTargetElement().style.cursor=e?"pointer":""}});function nD(n){return Math.pow(2,-10*n)*Math.sin((n-.075)*(2*Math.PI)/.3)+1}function Mv(n){Wx.animate({duration:700,easing:nD,center:n.coordinate})}function rD(n){E_.getSource().removeFeature(n.data.marker)}function Pv(n){var t=Kn(n.coordinate,"EPSG:3857","EPSG:4326"),e=n.coordinate,i=Kn(n.coordinate,"EPSG:3857","EPSG:32632"),r=new Zt({image:new vn({scale:.5,src:Bp}),text:new Sr({offsetY:40})}),s=new ei({type:"removable",geometry:new fi(n.coordinate),x_3857:e[0].toFixed(3),y_3857:e[1].toFixed(3),x_4326:t[0].toFixed(3),y_4326:t[1].toFixed(3),x_32632:i[0].toFixed(3),y_32632:i[1].toFixed(3)});s.setStyle(r),E_.getSource().addFeature(s)}const sD=new Fe,cb=new Ge({displayInLayerSwitcher:!0,title:"EditBar",name:"EditBar",source:sD,style:{"fill-color":"rgba(136, 136, 136, 0.526)","stroke-color":"blue","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}});It.addLayer(cb);var ub=new La({title:"Auswahl"});ub.set("title","Auswahl");var Yn=new Ek({interactions:{Select:ub,DrawLine:"Polylinie",DrawPolygon:"Polygon",DrawHole:"Loch",DrawPoint:"Punkt",DrawRegular:!1,ModifySelect:!1,DragRotateAndZoom:!1,DragAndDrop:!1,Split:!1,Transform:!1,Offset:!1,Resize:!1},source:cb.getSource()});It.addControl(Yn);var Jn=new Lk;It.addOverlay(Jn);Yn.getInteraction("Select").on("change:active",function(n){Jn.setInfo("")});Yn.getInteraction("DrawPoint").on("change:active",function(n){Jn.setInfo(n.oldValue?"":"Click map to place a point...")});Yn.getInteraction("DrawLine").on(["change:active","drawend"],function(n){Jn.setFeature(),Jn.setInfo(n.oldValue?"":"Click map to start drawing line...")});Yn.getInteraction("DrawLine").on("drawstart",function(n){Jn.setFeature(n.feature),Jn.setInfo("Click to continue drawing line...")});Yn.getInteraction("DrawPolygon").on("drawstart",function(n){Jn.setFeature(n.feature),Jn.setInfo("Click to continue drawing shape...")});Yn.getInteraction("DrawPolygon").on(["change:active","drawend"],function(n){Jn.setFeature(),Jn.setInfo(n.oldValue?"":"Click map to start drawing shape...")});Yn.getInteraction("DrawHole").on("drawstart",function(n){Jn.setFeature(n.feature),Jn.setInfo("Click to continue drawing hole...")});Yn.getInteraction("DrawHole").on(["change:active","drawend"],function(n){Jn.setFeature(),Jn.setInfo(n.oldValue?"":"Click polygon to start drawing hole...")});Yn.on("info",function(n){const t=n.features;let e='<i class="fa fa-info-circle"></i> '+t.getLength()+" feature(s) selected";if(t.getLength()===1){const i=t.item(0);console.log(i);const r=i.getGeometry(),s=r.getType();if(s==="Point"){const a=r.getCoordinates(),o=toLonLat(a);e+=`  Koordinaten:<br>
        <b>EPSG:4326</b>: ${o[1].toFixed(6)}, ${o[0].toFixed(6)}<br>
        <b>EPSG:3857</b>: ${a[1].toFixed(2)}, ${a[0].toFixed(2)}`}else if(s==="LineString"){const a=dg(r),o=a>1e3?(a/1e3).toFixed(2)+" km":a.toFixed(2)+" m";e+="  Lnge: "+o}else if(s==="Polygon"||s==="MultiPolygon"){const a=gg(r),o=a>1e6?(a/1e6).toFixed(2)+" km":a.toFixed(2)+" m";e+="  Flche: "+o}}Hx.show(e,{duration:-1})});const zp=Yn.element;zp.style.display="none";var aD=new jh({title:"Toggle EditBar",handleClick:function(){const n=Yn.get("edition");n===void 0||n===!1?($o=!0,console.log("Global auf true"),Yn.set("edition",!0),zp.style.display="",It.getInteractions().forEach(function(e){(e instanceof La||e instanceof H2)&&e.setActive(!0)})):($o=!1,console.log("Global auf false"),Yn.set("edition",!1),zp.style.display="none",Yn.deactivateControls(),It.getInteractions().forEach(function(e){(e instanceof La||e instanceof H2)&&e.setActive(!1)}))}});It.addControl(aD);export{oi as _};
//# sourceMappingURL=index-iW4bm2Og.js.map
